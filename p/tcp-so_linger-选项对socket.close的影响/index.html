<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Javaä¸­é€šè¿‡Socket.setSoLingerè®¾ç½®SO_LINGERé€‰é¡¹ï¼Œæœ‰ä¸‰ç§ç»„åˆå½¢å¼ï¼š Socket.setSoLinger(false, linger) è®¾ç½®ä¸ºfalseï¼Œè¿™æ—¶lingerå€¼è¢«å¿½ç•¥">
<title>TCP `SO_LINGER` é€‰é¡¹å¯¹Socket.closeçš„å½±å“</title>

<link rel='canonical' href='https://mazhen.tech/p/tcp-so_linger-%E9%80%89%E9%A1%B9%E5%AF%B9socket.close%E7%9A%84%E5%BD%B1%E5%93%8D/'>

<link rel="stylesheet" href="/scss/style.min.760e3dabc1e140d2e6abd27a8ca0aabb60e568829b29f67d2df12024136eff37.css"><meta property='og:title' content="TCP `SO_LINGER` é€‰é¡¹å¯¹Socket.closeçš„å½±å“">
<meta property='og:description' content="Javaä¸­é€šè¿‡Socket.setSoLingerè®¾ç½®SO_LINGERé€‰é¡¹ï¼Œæœ‰ä¸‰ç§ç»„åˆå½¢å¼ï¼š Socket.setSoLinger(false, linger) è®¾ç½®ä¸ºfalseï¼Œè¿™æ—¶lingerå€¼è¢«å¿½ç•¥">
<meta property='og:url' content='https://mazhen.tech/p/tcp-so_linger-%E9%80%89%E9%A1%B9%E5%AF%B9socket.close%E7%9A%84%E5%BD%B1%E5%93%8D/'>
<meta property='og:site_name' content='mazhen.tech'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='java' /><meta property='article:tag' content='networking' /><meta property='article:published_time' content='2014-08-10T11:08:57&#43;08:00'/><meta property='article:modified_time' content='2014-08-10T11:08:57&#43;08:00'/>
<meta name="twitter:site" content="@rootletmistake">
    <meta name="twitter:creator" content="@rootletmistake"><meta name="twitter:title" content="TCP `SO_LINGER` é€‰é¡¹å¯¹Socket.closeçš„å½±å“">
<meta name="twitter:description" content="Javaä¸­é€šè¿‡Socket.setSoLingerè®¾ç½®SO_LINGERé€‰é¡¹ï¼Œæœ‰ä¸‰ç§ç»„åˆå½¢å¼ï¼š Socket.setSoLinger(false, linger) è®¾ç½®ä¸ºfalseï¼Œè¿™æ—¶lingerå€¼è¢«å¿½ç•¥">
    <link rel="shortcut icon" href="/favicon.png" />

  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-LBEVB8TRX2"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-LBEVB8TRX2');
        }
      </script>
    
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/mazhen_hu6e56901738cd7f8ddabbbe3def51a5b4_111611_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">mazhen.tech</a></h1>
            <h2 class="site-description">Stay hungry. Stay foolish.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='mailto:me@mazhen.tech'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/mz1999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.instagram.com/clippercongo/'
                        target="_blank"
                        title="instagram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="4" />
  <circle cx="12" cy="12" r="3" />
  <line x1="16.5" y1="7.5" x2="16.5" y2="7.501" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/crownrecount'
                        target="_blank"
                        title="telegram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/rootletmistake'
                        target="_blank"
                        title="twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://mazhen.tech/" selected>ä¸­æ–‡</option>
                                
                                    <option value="https://mazhen.tech/en/" >English</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tech/" >
                Tech
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/tcp-so_linger-%E9%80%89%E9%A1%B9%E5%AF%B9socket.close%E7%9A%84%E5%BD%B1%E5%93%8D/">TCP `SO_LINGER` é€‰é¡¹å¯¹Socket.closeçš„å½±å“</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2014-08-10</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 3 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>Javaä¸­é€šè¿‡Socket.setSoLingerè®¾ç½®<code>SO_LINGER</code>é€‰é¡¹ï¼Œæœ‰ä¸‰ç§ç»„åˆå½¢å¼ï¼š</p>
<ul>
<li><strong>Socket.setSoLinger(<code>false</code>, linger)</strong></li>
</ul>
<p>è®¾ç½®ä¸ºfalseï¼Œè¿™æ—¶lingerå€¼è¢«å¿½ç•¥ã€‚æ‘˜è‡ª<a class="link" href="http://book.douban.com/subject/1756533/"  target="_blank" rel="noopener"
    >unix network programming</a>ï¼š</p>
<blockquote>
<p>The default action of close with a TCP socket is to mark the socket as closed and return to the process immediately. The socket descriptor is on longer usable by the process: it can&rsquo;t be used as an argument to read or write.
TCP will try to send any data that is already queued to be sent to the other end, and after this occurs, the normal TCP connection termination sequence takes place.</p>
</blockquote>
<p>å¦‚æœè®¾ç½®ä¸ºfalseï¼Œsocketä¸»åŠ¨è°ƒç”¨closeæ—¶ä¼šç«‹å³è¿”å›ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ®‹ç•™åœ¨ç¼“å†²åŒºä¸­çš„æ•°æ®å‘é€åˆ°å¯¹ç«¯ï¼Œå¹¶æŒ‰ç…§æ­£å¸¸æµç¨‹å…³é—­(äº¤æ¢FIN-ACKï¼‰ï¼Œæœ€åè¿æ¥è¿›å…¥<code>TIME_WAIT</code>çŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å†™ä¸ªæ¼”ç¤ºç¨‹åºï¼Œå®¢æˆ·ç«¯å‘é€è¾ƒå¤§çš„æ•°æ®åŒ…åï¼Œç«‹åˆ»è°ƒç”¨<code>close</code>ï¼Œè€Œserverç«¯å°†<code>Receive Buffer</code>è®¾ç½®çš„å¾ˆå°ã€‚<code>close</code>ä¼šç«‹å³è¿”å›ï¼Œå®¢æˆ·ç«¯çš„Javaè¿›ç¨‹ç»“æŸï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç”¨<code>tcpdump/Wireshark</code>æŠ“åŒ…ä¼šå‘ç°ï¼Œæ“ä½œç³»ç»Ÿæ­£åœ¨å¸®ä½ å‘é€æ•°æ®ï¼Œå†…æ ¸ç¼“å†²åŒºä¸­çš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå‘é€<code>FIN</code>åŒ…å…³é—­è¿æ¥ã€‚</p>
<ul>
<li><strong>Socket.setSoLinger(<code>true</code>, <code>0</code>)</strong></li>
</ul>
<blockquote>
<p>TCP discards any data still remaining in the socket send buffer and sends an RST to the peer, not the normal four-packet connection termination sequence.</p>
</blockquote>
<p>ä¸»åŠ¨è°ƒç”¨<code>close</code>çš„ä¸€æ–¹ä¹Ÿæ˜¯ç«‹åˆ»è¿”å›ï¼Œä½†æ˜¯è¿™æ—¶TCPä¼šä¸¢å¼ƒå‘é€ç¼“å†²ä¸­çš„æ•°æ®ï¼Œè€Œä¸”ä¸æ˜¯æŒ‰ç…§æ­£å¸¸æµç¨‹å…³é—­è¿æ¥ï¼ˆä¸å‘é€FINåŒ…ï¼‰ï¼Œç›´æ¥å‘é€<code>RST</code>ï¼Œå¯¹ç«¯ä¼šæ”¶åˆ°<code>java.net.SocketException: Connection reset</code>å¼‚å¸¸ã€‚åŒæ ·ä½¿ç”¨tcpdumpæŠ“åŒ…å¯ä»¥å¾ˆå®¹æ˜“è§‚å¯Ÿåˆ°ã€‚</p>
<p>å¦å¤–æœ‰äº›äººä¼šç”¨è¿™ç§æ–¹å¼è§£å†³ä¸»åŠ¨å…³é—­æ”¾æ–¹æœ‰å¤§é‡<code>TIME_WAIT</code>çŠ¶æ€è¿æ¥çš„é—®é¢˜ï¼Œå› ä¸ºå‘é€å®Œ<code>RST</code>åï¼Œè¿æ¥ç«‹å³é”€æ¯ï¼Œä¸ä¼šåœç•™åœ¨<code>TIME_WAIT</code>çŠ¶æ€ã€‚ä¸€èˆ¬ä¸å»ºè®®è¿™ä¹ˆåšï¼Œé™¤éä½ æœ‰<a class="link" href="http://stackoverflow.com/questions/3757289/tcp-option-so-linger-zero-when-its-required/13088864#13088864"  target="_blank" rel="noopener"
    >åˆé€‚çš„ç†ç”±</a>ï¼š</p>
<blockquote>
<ul>
<li>If the a client of your server application misbehaves (times out, returns invalid data, etc.) an abortive close makes sense to avoid being stuck in CLOSE_WAIT or ending up in the TIME_WAIT state.</li>
</ul>
</blockquote>
<ul>
<li>
<p>If you must restart your server application which currently has thousands of client connections you might consider setting this socket option to avoid thousands of server sockets in TIME_WAIT (when calling close() from the server end) as this might prevent the server from getting available ports for new client connections after being restarted.</p>
</li>
<li>
<p>On page 202 in the aforementioned book it specifically says: &ldquo;There are certain circumstances which warrant using this feature to send an abortive close. One example is an RS-232 terminal server, which might hang forever in CLOSE_WAIT trying to deliver data to a stuck terminal port, but would properly reset the stuck port if it got an RST to discard the pending data.&rdquo;</p>
</li>
<li>
<p><strong>Socket.setSoLinger(<code>true</code>, <code>linger &gt; 0</code>)</strong></p>
</li>
</ul>
<blockquote>
<p>if there is any data still remaining in the socket send buffer, the process will sleep when calling close() until either all the data is sent and acknowledged by the peer or the configured linger timer expires.
if the linger time expires before the remaining data is sent and acknowledged, close returns EWOULDBLOCK and any remaining data in the send buffer is discarded.</p>
</blockquote>
<p>å¦‚æœ<code>SO_LINGER</code>é€‰é¡¹ç”Ÿæ•ˆï¼Œå¹¶ä¸”è¶…æ—¶è®¾ç½®å¤§äºé›¶ï¼Œè°ƒç”¨closeçš„çº¿ç¨‹è¢«é˜»å¡ï¼ŒTCPä¼šå‘é€ç¼“å†²åŒºä¸­çš„æ®‹ç•™æ•°æ®ï¼Œè¿™æ—¶æœ‰ä¸¤ç§å¯èƒ½çš„æƒ…å†µï¼š</p>
<ol>
<li>æ•°æ®å‘é€å®Œæ¯•ï¼Œæ”¶åˆ°å¯¹æ–¹çš„ACKï¼Œç„¶åè¿›è¡Œè¿æ¥çš„æ­£å¸¸å…³é—­ï¼ˆäº¤æ¢FIN-ACKï¼‰</li>
<li>è¶…æ—¶ï¼Œæœªå‘é€å®Œæˆçš„æ•°æ®è¢«ä¸¢å¼ƒï¼Œè¿æ¥å‘é€<code>RST</code>è¿›è¡Œéæ­£å¸¸å…³é—­</li>
</ol>
<p>ç±»ä¼¼çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥æ„é€ demoè§‚å¯Ÿè¿™ç§åœºæ™¯ã€‚å®¢æˆ·ç«¯å‘é€è¾ƒå¤§çš„æ•°æ®åŒ…ï¼Œserverç«¯å°†Receive Bufferè®¾ç½®çš„å¾ˆå°ã€‚è®¾ç½®<code>linger</code>ä¸º1ï¼Œè°ƒç”¨<code>close</code>æ—¶ç­‰å¾…1ç§’ã€‚æ³¨æ„<code>SO_LINGER</code>çš„å•ä½ä¸º<strong>ç§’</strong>ï¼Œå¥½å¤šäººè¢«å‘è¿‡ã€‚å‡è®¾<code>close</code>å1ç§’å†…ç¼“å†²åŒºä¸­çš„æ•°æ®å‘é€ä¸å®Œï¼Œä½¿ç”¨<code>tcpdump/Wireshark</code>å¯ä»¥è§‚å¯Ÿåˆ°å®¢æˆ·ç«¯å‘é€<code>RST</code>åŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°<code>java.net.SocketException: Connection reset</code>å¼‚å¸¸ã€‚</p>
<p>æœ€åï¼Œåœ¨ä½¿ç”¨NIOæ—¶ï¼Œæœ€å¥½ä¸è®¾ç½®<code>SO_LINGER</code>ï¼Œä»¥åä¼šå†å†™ä¸€ç¯‡æ–‡ç« åˆ†æã€‚</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/java/">Java</a>
        
            <a href="/tags/networking/">Networking</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E4%B8%BAwireshark%E7%BC%96%E5%86%99hsf2%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90%E6%8F%92%E4%BB%B6/">
        
        

        <div class="article-details">
            <h2 class="article-title">ä¸ºWiresharkç¼–å†™HSF2åè®®è§£ææ’ä»¶</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA-kprobe-%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA-bind-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/">
        
        

        <div class="article-details">
            <h2 class="article-title">æ‰‹åŠ¨åˆ›å»º kprobe äº‹ä»¶è¿½è¸ª bind ç³»ç»Ÿè°ƒç”¨</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%BD%BF%E7%94%A8-dwarf-%E8%BF%98%E5%8E%9F%E5%AE%8C%E6%95%B4%E7%9A%84-glibc-%E8%B0%83%E7%94%A8%E5%A0%86%E6%A0%88/">
        
        

        <div class="article-details">
            <h2 class="article-title">ä½¿ç”¨ DWARF è¿˜åŸå®Œæ•´çš„ glibc è°ƒç”¨å †æ ˆ</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/tracing-and-locating-socket-creation-in-java-processes/">
        
        

        <div class="article-details">
            <h2 class="article-title">Tracing and Locating Socket Creation in Java Processes</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E8%BF%BD%E8%B8%AA%E5%AE%9A%E4%BD%8D-java-%E8%BF%9B%E7%A8%8B%E7%9A%84-socket-%E5%88%9B%E5%BB%BA/">
        
        

        <div class="article-details">
            <h2 class="article-title">è¿½è¸ªå®šä½ Java è¿›ç¨‹çš„ Socket åˆ›å»º</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mazhen-tech" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2014 - 
        
        2025 mazhen.tech
    </section>
    
    <section class="powerby">
        
            <a target="_blank" href="https://beian.miit.gov.cn">ç²¤ ICP å¤‡ 2022085181 å· -1</a> <br/>
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.25.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
