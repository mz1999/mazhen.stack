<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="# CRaC ÁöÑÊÄßËÉΩÈ£ûË∑É‰∏é Linux ÂÜÖÊ†∏ÁöÑÂü∫Áü≥ Java Â∫îÁî®ÁöÑÂêØÂä®ÈÄüÂ∫¶ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå Serverless Âú∫ÊôØ‰∏ãÁöÑ‚ÄúÂÜ∑ÂêØÂä®‚ÄùÔºå‰∏ÄÁõ¥ÊòØÂÖ∂ÊÄßËÉΩ‰ºòÂåñÁöÑÈáçÁÇπ„ÄÇ‰º†ÁªüÁöÑÂêØÂä®ËøáÁ®ãÊ∂âÂèä JVM ÂàùÂßãÂåñ„ÄÅÁ±ªÂä†">
<title>ÁêÜËß£ CRaC ËÉåÂêéÁöÑ Linux Á≥ªÁªüÁºñÁ®ã</title>

<link rel='canonical' href='https://mazhen.tech/p/%E7%90%86%E8%A7%A3-crac-%E8%83%8C%E5%90%8E%E7%9A%84-linux-%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/'>

<link rel="stylesheet" href="/scss/style.min.760e3dabc1e140d2e6abd27a8ca0aabb60e568829b29f67d2df12024136eff37.css"><meta property='og:title' content="ÁêÜËß£ CRaC ËÉåÂêéÁöÑ Linux Á≥ªÁªüÁºñÁ®ã">
<meta property='og:description' content="# CRaC ÁöÑÊÄßËÉΩÈ£ûË∑É‰∏é Linux ÂÜÖÊ†∏ÁöÑÂü∫Áü≥ Java Â∫îÁî®ÁöÑÂêØÂä®ÈÄüÂ∫¶ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå Serverless Âú∫ÊôØ‰∏ãÁöÑ‚ÄúÂÜ∑ÂêØÂä®‚ÄùÔºå‰∏ÄÁõ¥ÊòØÂÖ∂ÊÄßËÉΩ‰ºòÂåñÁöÑÈáçÁÇπ„ÄÇ‰º†ÁªüÁöÑÂêØÂä®ËøáÁ®ãÊ∂âÂèä JVM ÂàùÂßãÂåñ„ÄÅÁ±ªÂä†">
<meta property='og:url' content='https://mazhen.tech/p/%E7%90%86%E8%A7%A3-crac-%E8%83%8C%E5%90%8E%E7%9A%84-linux-%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/'>
<meta property='og:site_name' content='mazhen.tech'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='linux' /><meta property='article:tag' content='java' /><meta property='article:tag' content='crac' /><meta property='article:tag' content='performance' /><meta property='article:published_time' content='2025-04-30T10:18:47&#43;08:00'/><meta property='article:modified_time' content='2025-04-30T10:18:47&#43;08:00'/>
<meta name="twitter:site" content="@rootletmistake">
    <meta name="twitter:creator" content="@rootletmistake"><meta name="twitter:title" content="ÁêÜËß£ CRaC ËÉåÂêéÁöÑ Linux Á≥ªÁªüÁºñÁ®ã">
<meta name="twitter:description" content="# CRaC ÁöÑÊÄßËÉΩÈ£ûË∑É‰∏é Linux ÂÜÖÊ†∏ÁöÑÂü∫Áü≥ Java Â∫îÁî®ÁöÑÂêØÂä®ÈÄüÂ∫¶ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå Serverless Âú∫ÊôØ‰∏ãÁöÑ‚ÄúÂÜ∑ÂêØÂä®‚ÄùÔºå‰∏ÄÁõ¥ÊòØÂÖ∂ÊÄßËÉΩ‰ºòÂåñÁöÑÈáçÁÇπ„ÄÇ‰º†ÁªüÁöÑÂêØÂä®ËøáÁ®ãÊ∂âÂèä JVM ÂàùÂßãÂåñ„ÄÅÁ±ªÂä†">
    <link rel="shortcut icon" href="/favicon.png" />

  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-LBEVB8TRX2"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-LBEVB8TRX2');
        }
      </script>
    
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/mazhen_hu6e56901738cd7f8ddabbbe3def51a5b4_111611_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">mazhen.tech</a></h1>
            <h2 class="site-description">Stay hungry. Stay foolish.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='mailto:me@mazhen.tech'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/mz1999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.instagram.com/clippercongo/'
                        target="_blank"
                        title="instagram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="4" />
  <circle cx="12" cy="12" r="3" />
  <line x1="16.5" y1="7.5" x2="16.5" y2="7.501" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/crownrecount'
                        target="_blank"
                        title="telegram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/rootletmistake'
                        target="_blank"
                        title="twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://mazhen.tech/" selected>‰∏≠Êñá</option>
                                
                                    <option value="https://mazhen.tech/en/" >English</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#crac-ÁöÑÊÄßËÉΩÈ£ûË∑É‰∏é-linux-ÂÜÖÊ†∏ÁöÑÂü∫Áü≥">CRaC ÁöÑÊÄßËÉΩÈ£ûË∑É‰∏é Linux ÂÜÖÊ†∏ÁöÑÂü∫Áü≥</a></li>
    <li><a href="#ËøõÁ®ã‰∏éÁ∫øÁ®ãÂèäÂÖ∂ÁîüÂëΩÂë®Êúü">ËøõÁ®ã‰∏éÁ∫øÁ®ãÂèäÂÖ∂ÁîüÂëΩÂë®Êúü</a></li>
    <li><a href="#proc-Êñá‰ª∂Á≥ªÁªüÂÜÖÊ†∏Áä∂ÊÄÅÁöÑÈÄèËßÜÈïú">/proc Êñá‰ª∂Á≥ªÁªüÔºöÂÜÖÊ†∏Áä∂ÊÄÅÁöÑ‚ÄúÈÄèËßÜÈïú‚Äù</a></li>
    <li><a href="#ptrace-Á≥ªÁªüË∞ÉÁî®ÊéåÊéßËøõÁ®ãÁöÑÈÅ•ÊéßÂô®">ptrace Á≥ªÁªüË∞ÉÁî®ÔºöÊéåÊéßËøõÁ®ãÁöÑ‚ÄúÈÅ•ÊéßÂô®‚Äù</a></li>
    <li><a href="#criu-Â¶Ç‰ΩïÂÆûÁé∞-checkpoint-Âíå-restore">CRIU Â¶Ç‰ΩïÂÆûÁé∞ Checkpoint Âíå RestoreÔºü</a>
      <ol>
        <li><a href="#checkpoint-ÂÜªÁªìËøáÁ®ã‰∏∫ËøõÁ®ãÊãç‰∏ãÁ≤æÁ°ÆÂø´ÁÖß">Checkpoint (ÂÜªÁªìËøáÁ®ã)Ôºö‰∏∫ËøõÁ®ãÊãç‰∏ãÁ≤æÁ°ÆÂø´ÁÖß</a></li>
        <li><a href="#restore-Â§çËãèËøáÁ®ã‰ªéÂø´ÁÖßÈáçÂª∫È≤úÊ¥ªËøõÁ®ã">Restore (Â§çËãèËøáÁ®ã)Ôºö‰ªéÂø´ÁÖßÈáçÂª∫È≤úÊ¥ªËøõÁ®ã</a></li>
      </ol>
    </li>
    <li><a href="#crac-Â¶Ç‰ΩïÊåáÊå•-criu">CRaC Â¶Ç‰ΩïÊåáÊå• CRIU</a>
      <ol>
        <li><a href="#checkpoint-ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ã‰πãËàû-double-fork">Checkpoint ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ã‰πãËàû (double fork)</a></li>
        <li><a href="#restore-ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ãÂèòË∫´-execv-Èìæ">Restore ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ã‚ÄúÂèòË∫´‚Äù (execv Èìæ)</a></li>
      </ol>
    </li>
    <li><a href="#ÊÄªÁªìlinux-Á≥ªÁªüÁºñÁ®ãÊòØ-crac-ÁöÑÂü∫Áü≥">ÊÄªÁªìÔºöLinux Á≥ªÁªüÁºñÁ®ãÊòØ CRaC ÁöÑÂü∫Áü≥</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tech/" >
                Tech
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E7%90%86%E8%A7%A3-crac-%E8%83%8C%E5%90%8E%E7%9A%84-linux-%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/">ÁêÜËß£ CRaC ËÉåÂêéÁöÑ Linux Á≥ªÁªüÁºñÁ®ã</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-04-30</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 22 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="crac-ÁöÑÊÄßËÉΩÈ£ûË∑É‰∏é-linux-ÂÜÖÊ†∏ÁöÑÂü∫Áü≥">
    <a href="#crac-%e7%9a%84%e6%80%a7%e8%83%bd%e9%a3%9e%e8%b7%83%e4%b8%8e-linux-%e5%86%85%e6%a0%b8%e7%9a%84%e5%9f%ba%e7%9f%b3" class="header-anchor">#</a>
    CRaC ÁöÑÊÄßËÉΩÈ£ûË∑É‰∏é Linux ÂÜÖÊ†∏ÁöÑÂü∫Áü≥
</h2><p>Java Â∫îÁî®ÁöÑÂêØÂä®ÈÄüÂ∫¶ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå Serverless Âú∫ÊôØ‰∏ãÁöÑ‚ÄúÂÜ∑ÂêØÂä®‚ÄùÔºå‰∏ÄÁõ¥ÊòØÂÖ∂ÊÄßËÉΩ‰ºòÂåñÁöÑÈáçÁÇπ„ÄÇ‰º†ÁªüÁöÑÂêØÂä®ËøáÁ®ãÊ∂âÂèä JVM ÂàùÂßãÂåñ„ÄÅÁ±ªÂä†ËΩΩÂíå JIT È¢ÑÁÉ≠ÔºåËÄóÊó∂ËæÉÈïø„ÄÇ<strong>CRaC (Coordinated Restore at Checkpoint)</strong> ÊäÄÊúØ‰∏∫Ê≠§Êèê‰æõ‰∫Ü‰∏ÄÁßçÂàõÊñ∞ÊñπÊ°àÔºöÂÆÉÂú®Â∫îÁî®ËææÂà∞ÁêÜÊÉ≥Áä∂ÊÄÅÊó∂ÊçïËé∑ÂÖ∂ÂÆåÊï¥ËøêË°åÊó∂Âø´ÁÖßÔºàCheckpointÔºâÔºåÂπ∂Âú®ÈúÄË¶ÅÊó∂Âø´ÈÄüÊÅ¢Â§çÔºàRestoreÔºâÔºå‰ªéËÄåÂÆûÁé∞ÊØ´ÁßíÁ∫ßÂêØÂä®ÂíåÂç≥Êó∂Â≥∞ÂÄºÊÄßËÉΩ„ÄÇ</p>
<p>ËøôÁßçÂº∫Â§ßÁöÑËøõÁ®ã‚ÄúÂÜªÁªì‚Äù‰∏é‚ÄúÂ§çËãè‚ÄùËÉΩÂäõÂπ∂ÈùûÂá≠Á©∫ËÄåÊù•ÔºåÂÆÉÊ∑±Â∫¶‰æùËµñ‰∫é Linux Êìç‰ΩúÁ≥ªÁªüÊèê‰æõÁöÑÂ∫ïÂ±ÇÊú∫Âà∂ÔºåÂπ∂ÈÄöËøá <strong>CRIU (Checkpoint/Restore In Userspace)</strong> Ëøô‰∏™Â∑•ÂÖ∑ÈõÜÂæó‰ª•ÂÆûÁé∞„ÄÇÂõ†Ê≠§ÔºåË¶ÅÁúüÊ≠£ÁêÜËß£ CRaC ÁöÑÂ∑•‰ΩúÂéüÁêÜÔºåÊé¢Á©∂ÂÖ∂ËÉåÂêéÁöÑ Linux Á≥ªÁªüÁºñÁ®ãÁü•ËØÜËá≥ÂÖ≥ÈáçË¶Å„ÄÇÊú¨ÊñáÂ∞Ü‰∏∫ÁÜüÊÇâÁºñÁ®ã‰ΩÜÂèØËÉΩ‰∏çÁÜüÊÇâ Linux Â∫ïÂ±ÇÁöÑÂºÄÂèëËÄÖÔºåËß£Êûê CRaC ÂÆûÁé∞ÊâÄ‰æùËµñÁöÑÂÖ≥ÈîÆ Linux Ê¶ÇÂøµÔºàÂ¶ÇËøõÁ®ã/Á∫øÁ®ã„ÄÅ/proc Êñá‰ª∂Á≥ªÁªü„ÄÅptrace Á≥ªÁªüË∞ÉÁî®Á≠âÔºâÔºåÊè≠Á§∫ CRaC ÊÄßËÉΩÈ£ûË∑ÉËÉåÂêéÁöÑ Linux‚ÄúÈ≠îÊ≥ï‚Äù„ÄÇ</p>
<h2 id="ËøõÁ®ã‰∏éÁ∫øÁ®ãÂèäÂÖ∂ÁîüÂëΩÂë®Êúü">
    <a href="#%e8%bf%9b%e7%a8%8b%e4%b8%8e%e7%ba%bf%e7%a8%8b%e5%8f%8a%e5%85%b6%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" class="header-anchor">#</a>
    ËøõÁ®ã‰∏éÁ∫øÁ®ãÂèäÂÖ∂ÁîüÂëΩÂë®Êúü
</h2><p>Ë¶ÅÁêÜËß£ CRaC Â¶Ç‰ΩïÊìç‰ΩúËøêË°å‰∏≠ÁöÑ Java Â∫îÁî®ÔºåÊàë‰ª¨È¶ñÂÖàÈúÄË¶Å‰∫ÜËß£ Linux ÊòØÂ¶Ç‰ΩïÁªÑÁªáÂíåÁÆ°ÁêÜÁ®ãÂ∫èÊâßË°åÁöÑ„ÄÇÂÖ∂Ê†∏ÂøÉÊ¶ÇÂøµÊòØ<strong>ËøõÁ®ã (Process)</strong>„ÄÇ‰Ω†ÂèØ‰ª•Â∞ÜËøõÁ®ãÁúã‰ΩúÊòØ‰∏Ä‰∏™<strong>Ê≠£Âú®ËøêË°åÁöÑÁ®ãÂ∫èÁöÑÂÆû‰æã</strong>ÔºåÂÆÉÊòØÊìç‰ΩúÁ≥ªÁªüÂàÜÈÖçËµÑÊ∫êÔºàÂ¶ÇÂÜÖÂ≠ò„ÄÅÊñá‰ª∂Âè•ÊüÑÔºâÂíåËøõË°åË∞ÉÂ∫¶ÁöÑÂü∫Êú¨Âçï‰Ωç„ÄÇÊØè‰∏™ËøõÁ®ãÈÉΩ‰ªø‰ΩõÁîüÊ¥ªÂú®Ëá™Â∑±ÁöÑÁã¨Á´ã‰∏ñÁïåÈáåÔºåÊã•ÊúâÁã¨Á´ãÁöÑÂú∞ÂùÄÁ©∫Èó¥ÔºåËøô‰øùËØÅ‰∫ÜËøõÁ®ãÈó¥ÁöÑÈöîÁ¶ªÊÄß„ÄÇ</p>
<p>ÁÑ∂ËÄåÔºåÂú®‰∏Ä‰∏™ËøõÁ®ãÂÜÖÈÉ®ÔºåÂæÄÂæÄÈúÄË¶ÅÂêåÊó∂ÊâßË°åÂ§ö‰∏™‰ªªÂä°ÊµÅ„ÄÇËøôÊó∂<strong>Á∫øÁ®ã (Thread)</strong> Â∞±ÁôªÂú∫‰∫Ü„ÄÇÁ∫øÁ®ãÊòØËøõÁ®ãÂÜÖÈÉ®ÁöÑÂÆûÈôÖÊâßË°åÂçïÂÖÉÔºåÊúâÊó∂‰πüË¢´Áß∞‰∏∫ËΩªÈáèÁ∫ßËøõÁ®ãÔºàLWPÔºâ„ÄÇ‰∏éËøõÁ®ã‰∏çÂêåÔºåÂêå‰∏ÄËøõÁ®ãÂÜÖÁöÑÊâÄÊúâÁ∫øÁ®ã<strong>ÂÖ±‰∫´</strong>ËØ•ËøõÁ®ãÁöÑÂú∞ÂùÄÁ©∫Èó¥ÂíåÂ§ßÈÉ®ÂàÜËµÑÊ∫êÔºåËøô‰ΩøÂæóÁ∫øÁ®ãÈó¥ÁöÑÈÄö‰ø°ÂíåÂàáÊç¢Êõ¥‰∏∫È´òÊïà„ÄÇ‰ΩÜÊØè‰∏™Á∫øÁ®ã‰ªçÁÑ∂‰øùÊúâËá™Â∑±Áã¨Á´ãÁöÑÊâßË°å‰∏ä‰∏ãÊñáÔºåÂ¶ÇÁ®ãÂ∫èËÆ°Êï∞Âô®„ÄÅÂØÑÂ≠òÂô®ÂíåÊ†à„ÄÇ</p>
<p>ÊúâË∂£ÁöÑÊòØÔºå‰ªé Linux ÂÜÖÊ†∏ÁöÑËßÜËßíÊù•ÁúãÔºåÂÆÉÂπ∂‰∏ç‰∏•Ê†ºÂå∫ÂàÜËøõÁ®ãÂíåÁ∫øÁ®ã„ÄÇ‰∏§ËÄÖÈÉΩË¢´ËßÜ‰∏∫ÂèØË∞ÉÂ∫¶ÁöÑ‚Äú<strong>‰ªªÂä° (Task)</strong>‚ÄùÔºåÂπ∂Áî±Áªü‰∏ÄÁöÑÊï∞ÊçÆÁªìÊûÑ task_struct Êù•ÊèèËø∞„ÄÇÁ∫øÁ®ã‰ªÖ‰ªÖÊòØ‰∏éÂÖ∂‰ªñ‰ªªÂä°ÂÖ±‰∫´‰∫ÜÊõ¥Â§öËµÑÊ∫êÔºàÁâπÂà´ÊòØÂÜÖÂ≠òÂú∞ÂùÄÁ©∫Èó¥ÔºâÁöÑ‰ªªÂä°ËÄåÂ∑≤„ÄÇÂõ†Ê≠§ÔºåÂÜÖÊ†∏Ë∞ÉÂ∫¶Âô®ÂèØ‰ª•ÂØπÂÆÉ‰ª¨‰∏ÄËßÜÂêå‰ªÅ„ÄÇ‰∏∫‰∫ÜÁÆ°ÁêÜËøô‰∫õ‰ªªÂä°ÔºåÁ≥ªÁªü‰∏∫ÂÆÉ‰ª¨ÂàÜÈÖç‰∫ÜÂîØ‰∏ÄÁöÑË∫´‰ªΩÊ†áËØÜÔºö<strong>PID (Process ID)</strong> Áî®‰∫éÊ†áËØÜÊï¥‰∏™ËøõÁ®ãÔºà‰∏ÄÁªÑÂÖ±‰∫´ËµÑÊ∫êÁöÑÁ∫øÁ®ãÔºâÔºåËÄå <strong>TID (Thread ID)</strong> ÂàôÁî®‰∫éÊ†áËØÜÊØè‰∏Ä‰∏™ÂçïÁã¨ÁöÑÁ∫øÁ®ãÔºà‰ªªÂä°Ôºâ„ÄÇÂØπ‰∫éÂçïÁ∫øÁ®ãËøõÁ®ãÔºåPID Âíå TID ÊòØÁõ∏ÂêåÁöÑ„ÄÇ</p>
<p>Êñ∞ËøõÁ®ãÁöÑËØûÁîüÔºåÊúÄÁªèÂÖ∏ÁöÑÊñπÂºèÊòØÈÄöËøá fork() Á≥ªÁªüË∞ÉÁî®„ÄÇÂΩì‰∏Ä‰∏™ËøõÁ®ãË∞ÉÁî® fork()ÔºåÂÜÖÊ†∏‰ºöÂàõÂª∫Âá∫ÂÆÉÁöÑ‰∏Ä‰∏™Âá†‰πéÂÆåÂÖ®Áõ∏ÂêåÁöÑÂâØÊú¨‚Äî‚ÄîÂ≠êËøõÁ®ã„ÄÇÂ≠êËøõÁ®ãÁªßÊâø‰∫ÜÁà∂ËøõÁ®ãÂ§ßÈÉ®ÂàÜÁä∂ÊÄÅÔºåÂåÖÊã¨ÂÜÖÂ≠òÂÜÖÂÆπÁöÑÂâØÊú¨ÔºàÈÄöËøáÂÜôÊó∂Â§çÂà∂‰ºòÂåñÔºâ„ÄÅÊñá‰ª∂ÊèèËø∞Á¨¶Á≠â„ÄÇfork() ÁöÑÂ•áÂ¶ô‰πãÂ§ÑÂú®‰∫éÂÆÉÂú®Áà∂ËøõÁ®ã‰∏≠ËøîÂõûÂ≠êËøõÁ®ãÁöÑ PIDÔºåËÄåÂú®Â≠êËøõÁ®ã‰∏≠ËøîÂõû 0Ôºå‰ΩøÂæóÁ®ãÂ∫èÂèØ‰ª•Ê†πÊçÆËøîÂõûÂÄºÂå∫ÂàÜÁà∂Â≠êÔºåÊâßË°å‰∏çÂêåÁöÑÈÄªËæë„ÄÇCRIU Âú®ÊÅ¢Â§çËøõÁ®ãÁä∂ÊÄÅÊó∂ÔºåÊ≠£ÊòØÂà©Áî® fork() Êù•ÈáçÂª∫ Checkpoint Êó∂ÂàªÁöÑËøõÁ®ãÊ†ëÁªìÊûÑ„ÄÇ</p>
<p><strong>fork() Á§∫‰æã‰ª£Á†Å (fork_example.c)</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span> <span class="c1">// ÂàõÂª∫Â≠êËøõÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// fork Â§±Ë¥•  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;fork failed&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Â≠êËøõÁ®ãÊâßË°åÁöÑ‰ª£Á†Å  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;I am the child process, PID: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// Ê®°ÊãüÂ∑•‰Ωú  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Child process exiting.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT</span><span class="err">\</span><span class="n">_SUCCESS</span><span class="p">);</span> <span class="c1">// Â≠êËøõÁ®ãÊ≠£Â∏∏ÈÄÄÂá∫  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Áà∂ËøõÁ®ãÊâßË°åÁöÑ‰ª£Á†Å  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;I am the parent process, PID: %d, Child PID: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">(),</span> <span class="n">pid</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent waiting for child...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span> <span class="c1">// ÁÆÄÂçïÁ≠âÂæÖ‰ªªÊÑèÂ≠êËøõÁ®ã  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent process: Child finished.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Process %d exiting.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="c1">// ÁºñËØëËøêË°åÔºögcc fork_example.c -o fork_example &amp;&amp; ./fork_example
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Èô§‰∫Ü fork()ÔºåËøòÊúâ‰∏Ä‰∏™Êõ¥Â∫ïÂ±ÇÁöÑÁ≥ªÁªüË∞ÉÁî® clone()ÔºåÂÆÉÊèê‰æõ‰∫ÜÊõ¥ÁªÜÁ≤íÂ∫¶ÁöÑÊéßÂà∂ÔºåÂÖÅËÆ∏ÊåáÂÆöÊñ∞ÂàõÂª∫ÁöÑ‰ªªÂä°‰∏éÁà∂‰ªªÂä°ÂÖ±‰∫´Âì™‰∫õËµÑÊ∫êÔºåÂõ†Ê≠§ clone() Êó¢ÂèØ‰ª•Áî®Êù•ÂàõÂª∫ËøõÁ®ãÔºå‰πüÂèØ‰ª•Áî®Êù•ÂàõÂª∫Á∫øÁ®ã„ÄÇ</p>
<p>fork() ÂàõÂª∫ÁöÑÂ≠êËøõÁ®ãÈªòËÆ§ÊâßË°åÁöÑÊòØÂíåÁà∂ËøõÁ®ãÁõ∏ÂêåÁöÑ‰ª£Á†Å„ÄÇÂ¶ÇÊûúÂ∏åÊúõÂ≠êËøõÁ®ãÂéªÊâßË°å‰∏Ä‰∏™<strong>ÂÖ®Êñ∞ÁöÑÁ®ãÂ∫è</strong>ÔºåÂ∞±ÈúÄË¶Å exec Á≥ªÂàóÁ≥ªÁªüË∞ÉÁî®ÔºàÂ¶Ç execv(), execlp() Á≠âÔºâÁöÑÂ∏ÆÂä©„ÄÇexec Ë∞ÉÁî®‰ºöÁî®Êñ∞Á®ãÂ∫èÁöÑÊò†ÂÉè<strong>ÂÆåÂÖ®ÊõøÊç¢</strong>ÂΩìÂâçËøõÁ®ãÁöÑÂÜÖÂ≠òÁ©∫Èó¥Ôºà‰ª£Á†Å„ÄÅÊï∞ÊçÆ„ÄÅÂ†ÜÊ†àÔºâÔºåÁÑ∂Âêé‰ªéÊñ∞Á®ãÂ∫èÁöÑÂÖ•Âè£ÁÇπÂºÄÂßãÊâßË°å„ÄÇ‰∏ÄÊó¶ exec ÊàêÂäüÔºåÂéüÊù•ÁöÑÁ®ãÂ∫èÂ∞±‰∏çÂ§çÂ≠òÂú®‰∫ÜÔºåËøô‰∏™Ë∞ÉÁî®Êú¨Ë∫´‰πü‰∏ç‰ºöËøîÂõû„ÄÇCRaC Âú®ÊÅ¢Â§çËøáÁ®ã‰∏≠Ôºåcriuengine Ëøô‰∏™ËæÖÂä©Á®ãÂ∫èÂ∞±Âà©Áî®‰∫Ü‰∏ÄËøû‰∏≤ÁöÑ execv Ë∞ÉÁî®Ôºå‰∏çÊñ≠‚ÄúÂèòË∫´‚ÄùÔºåÊúÄÁªàÊàê‰∏∫Ë¥üË¥£Á≠âÂæÖÊÅ¢Â§çÂêé JVM ÈÄÄÂá∫ÁöÑ restorewait ËøõÁ®ã„ÄÇ</p>
<p><strong>execv() Á§∫‰æã‰ª£Á†Å (exec_example.c)</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;fork failed&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Â≠êËøõÁ®ã  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Child process (PID: %d) will execute &#39;ls -l&#39;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>  
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="o">*</span><span class="n">args</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;/bin/ls&#34;</span><span class="p">,</span> <span class="s">&#34;-l&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">};</span> <span class="c1">// ÂáÜÂ§áÂèÇÊï∞ÂàóË°®  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">execv</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">);</span> <span class="c1">// ÊâßË°åÊñ∞Á®ãÂ∫è  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Â¶ÇÊûú execv ËøîÂõûÔºåËØ¥ÊòéÂá∫Èîô‰∫Ü  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;execv failed&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Áà∂ËøõÁ®ã  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent process (PID: %d) waiting for child (PID: %d)...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">(),</span> <span class="n">pid</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span> <span class="c1">// Á≠âÂæÖÂ≠êËøõÁ®ãÁªìÊùü  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent process: Child finished executing &#39;ls -l&#39;.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="c1">// ÁºñËØëËøêË°åÔºögcc exec_example.c -o exec_example &amp;&amp; ./exec_example
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ËøõÁ®ãÊúâÁîüÂ∞±ÊúâÁÅ≠„ÄÇÂΩìÂ≠êËøõÁ®ãÁªìÊùüÊó∂ÔºåÂÆÉÂπ∂‰∏ç‰ºöÁ´ãÂç≥Ê∂àÂ§±„ÄÇÂÜÖÊ†∏‰ºö‰øùÁïôÂÆÉÁöÑÈÄÄÂá∫Áä∂ÊÄÅÁ≠â‰ø°ÊÅØÔºåÁ≠âÂæÖÁà∂ËøõÁ®ãÊù•‚ÄúËÆ§È¢Ü‚Äù„ÄÇÁà∂ËøõÁ®ãÈÄöËøáË∞ÉÁî® wait() Êàñ waitpid() Á≥ªÁªüË∞ÉÁî®Êù•Ëé∑ÂèñÂ≠êËøõÁ®ãÁöÑÁªàÊ≠¢‰ø°ÊÅØÔºåÂπ∂ÂëäÁü•ÂÜÖÊ†∏ÂèØ‰ª•ÂΩªÂ∫ïÊ∏ÖÁêÜËØ•Â≠êËøõÁ®ã‰∫Ü„ÄÇwaitpid() Êèê‰æõ‰∫ÜÊõ¥Â§öÊéßÂà∂ÔºåÊØîÂ¶ÇÂèØ‰ª•Á≠âÂæÖÊåáÂÆöÁöÑÂ≠êËøõÁ®ãÔºåÊàñËÄÖ‰ª•ÈùûÈòªÂ°ûÁöÑÊñπÂºèÊ£ÄÊü•Â≠êËøõÁ®ãÁä∂ÊÄÅ„ÄÇ</p>
<p><strong>waitpid() Á§∫‰æã‰ª£Á†Å (waitpid_example.c)</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">pid1</span><span class="p">,</span> <span class="n">pid2</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">pid1</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span> <span class="c1">// ÂàõÂª∫Á¨¨‰∏Ä‰∏™Â≠êËøõÁ®ã  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">pid1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* Child 1 */</span> <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Child 1 (PID: %d) running...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span> <span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Child 1 exiting.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> <span class="nf">exit</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">pid2</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span> <span class="c1">// ÂàõÂª∫Á¨¨‰∫å‰∏™Â≠êËøõÁ®ã  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">pid2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* Child 2 */</span> <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Child 2 (PID: %d) running...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span> <span class="nf">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Child 2 exiting.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> <span class="nf">exit</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// Áà∂ËøõÁ®ãÁ≠âÂæÖÁâπÂÆöÁöÑÂ≠êËøõÁ®ã pid1  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent waiting for Child 1 (PID: %d)...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pid1</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">terminated_pid</span> <span class="o">=</span> <span class="nf">waitpid</span><span class="p">(</span><span class="n">pid1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// ÈòªÂ°ûÁ≠âÂæÖ pid1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">terminated_pid</span> <span class="o">==</span> <span class="n">pid1</span> <span class="o">&amp;&amp;</span> <span class="nf">WIFEXITED</span><span class="p">(</span><span class="n">status</span><span class="p">))</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent: Child 1 terminated normally with status: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">WEXITSTATUS</span><span class="p">(</span><span class="n">status</span><span class="p">));</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* Handle error or abnormal termination */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// Áà∂ËøõÁ®ãÁ≠âÂæÖÂè¶‰∏Ä‰∏™Â≠êËøõÁ®ã pid2  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent waiting for Child 2 (PID: %d)...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pid2</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="n">terminated_pid</span> <span class="o">=</span> <span class="nf">waitpid</span><span class="p">(</span><span class="n">pid2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// ÈòªÂ°ûÁ≠âÂæÖ pid2  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="k">if</span> <span class="p">(</span><span class="n">terminated_pid</span> <span class="o">==</span> <span class="n">pid2</span> <span class="o">&amp;&amp;</span> <span class="nf">WIFEXITED</span><span class="p">(</span><span class="n">status</span><span class="p">))</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent: Child 2 terminated normally with status: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">WEXITSTATUS</span><span class="p">(</span><span class="n">status</span><span class="p">));</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* Handle error or abnormal termination */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent exiting.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="c1">// ÁºñËØëËøêË°åÔºögcc waitpid_example.c -o waitpid_example &amp;&amp; ./waitpid_example
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶ÇÊûúÂú®Â≠êËøõÁ®ãÁªàÊ≠¢ÂêéÔºåÁà∂ËøõÁ®ãÊ≤°ÊúâÂèäÊó∂Ë∞ÉÁî® wait() Êàñ waitpid()ÔºåÈÇ£‰πàËøô‰∏™Â≠êËøõÁ®ãÂ∞±‰ºöÂèòÊàê<strong>ÂÉµÂ∞∏ËøõÁ®ã (Zombie Process)</strong>„ÄÇÂÆÉËôΩÁÑ∂‰∏çÂÜçËøêË°åÔºå‰ΩÜ‰ªçÂú®ËøõÁ®ãË°®‰∏≠Âç†ÊçÆ‰∏Ä‰∏™‰ΩçÁΩÆÔºåÁ≠âÂæÖÁà∂ËøõÁ®ãÂõûÊî∂„ÄÇÂ¶ÇÊûúÁà∂ËøõÁ®ãÂÖà‰∫éÂ≠êËøõÁ®ãÈÄÄÂá∫ÔºåÂ≠êËøõÁ®ãÂ∞±Êàê‰∫Ü<strong>Â≠§ÂÑøËøõÁ®ã (Orphan Process)</strong>„ÄÇ‰∏∫‰∫ÜÈÅøÂÖçÂ≠§ÂÑøËøõÁ®ãÂèòÊàêÊó†‰∫∫ËÆ§È¢ÜÁöÑÂÉµÂ∞∏ÔºåLinux ‰ºöËá™Âä®Â∞ÜÂÆÉ‰ª¨ÁöÑÁà∂ËøõÁ®ãËÆæÁΩÆ‰∏∫ init ËøõÁ®ãÔºàPID 1ÔºâÔºåÁî± init ËøõÁ®ãË¥üË¥£ÂõûÊî∂ÂÆÉ‰ª¨„ÄÇ</p>
<p>ÁêÜËß£‰∫ÜÂ≠§ÂÑøËøõÁ®ãÂíåÁà∂ËøõÁ®ãÂõûÊî∂Êú∫Âà∂ÂêéÔºåÂ∞±ËÉΩÊòéÁôΩ‰∏ÄÁßçÂ∏∏ËßÅÁöÑÁºñÁ®ãÊäÄÂ∑ß‚Äî‚Äî<strong>Double Fork</strong>„ÄÇÂÆÉÁöÑÁõÆÁöÑÊòØÂàõÂª∫‰∏Ä‰∏™‰∏éÂéüÂßãÁà∂ËøõÁ®ãÂÆåÂÖ®ËÑ±Á¶ªÂÖ≥Á≥ªÁöÑÂêéÂè∞ËøõÁ®ãÔºàÂÆàÊä§ËøõÁ®ãÔºâ„ÄÇÂÖ∂Ê≠•È™§ÊòØÔºöËøõÁ®ã A fork Âá∫Â≠êËøõÁ®ã BÔºåÁÑ∂ÂêéËøõÁ®ã A Á´ãÂàª waitpid() Á≠âÂæÖ B ÁªìÊùüÂπ∂ÈÄÄÂá∫ÔºõÂ≠êËøõÁ®ã B ÂÜçÊ¨° fork Âá∫Â≠ôÂ≠êËøõÁ®ã CÔºåÁÑ∂Âêé B Ëá™Â∑±Á´ãÂàªÈÄÄÂá∫ÔºõÊ≠§Êó∂ÔºåÂ≠ôÂ≠êËøõÁ®ã C Êàê‰∏∫Â≠§ÂÑøÔºåË¢´ init ËøõÁ®ãÊé•ÁÆ°Ôºå‰ªéËÄå‰∏é A ÂΩªÂ∫ïËß£ËÄ¶„ÄÇCRIU Âú®ÊâßË°å Checkpoint Êó∂ÔºåÂ∞±ËøêÁî®‰∫ÜÁ±ª‰ºº double fork ÁöÑÊñπÊ≥ïÔºåËÆ©ÊâßË°å criu dump ÂëΩ‰ª§ÁöÑËøõÁ®ãËÑ±Á¶ªË¢´Êìç‰ΩúÁöÑ JVM ËøõÁ®ãÊ†ëÔºåÈÅøÂÖç‰∫Ü‚ÄúËá™Â∑±ÂÜªÁªìËá™Â∑±‚ÄùÁöÑÂ∞¥Â∞¨Â±ÄÈù¢„ÄÇ</p>
<p><strong>double_fork Á§∫‰æã‰ª£Á†Å (double_fork_example.c)</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;  </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">pid1</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span> <span class="c1">// Á¨¨‰∏ÄÊ¨° fork
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">pid1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;First fork failed&#34;</span><span class="p">);</span> <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span> <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Á¨¨‰∏Ä‰∏™Â≠êËøõÁ®ã (ËøõÁ®ã B)  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">pid_t</span> <span class="n">pid2</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span> <span class="c1">// Á¨¨‰∫åÊ¨° fork  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">pid2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Second fork failed&#34;</span><span class="p">);</span> <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span> <span class="p">}</span>  
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Â≠ôÂ≠êËøõÁ®ã (ËøõÁ®ã C)  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Grandchild process (PID: %d, Parent PID: %d) starting.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">(),</span> <span class="nf">getppid</span><span class="p">());</span>  
</span></span><span class="line"><span class="cl">            <span class="c1">// ÈÄöÂ∏∏Âú®ËøôÈáåÊâßË°å setsid() Á≠âÂÆàÊä§ËøõÁ®ãÂåñÊìç‰Ωú  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// Ê®°ÊãüÂêéÂè∞‰ªªÂä°  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Grandchild process finished.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">            <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Á¨¨‰∏Ä‰∏™Â≠êËøõÁ®ã (ËøõÁ®ã B) Á´ãÂç≥ÈÄÄÂá∫  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;First child process (PID: %d) exiting immediately.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>  
</span></span><span class="line"><span class="cl">            <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// ÂéüÂßãÁà∂ËøõÁ®ã (ËøõÁ®ã A)  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Original parent process (PID: %d) waiting for first child (PID: %d).</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">(),</span> <span class="n">pid1</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="nf">waitpid</span><span class="p">(</span><span class="n">pid1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// Á≠âÂæÖÁ¨¨‰∏Ä‰∏™Â≠êËøõÁ®ãÈÄÄÂá∫  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Original parent exiting.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">        <span class="c1">// Â≠ôÂ≠êËøõÁ®ãÂ∑≤Êàê‰∏∫Â≠§ÂÑøÂπ∂Áî± init Êé•ÁÆ°  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="c1">// ÁºñËØëËøêË°åÔºögcc double_fork_example.c -o double_fork_example &amp;&amp; ./double_fork_example
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÊéåÊè°‰∫Ü Linux ËøõÁ®ãÂíåÁ∫øÁ®ãÁöÑÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜÔºåÊàë‰ª¨Â∞±ËÉΩÊõ¥Â•ΩÂú∞ÁêÜËß£ CRaC ÊòØÂ¶Ç‰ΩïÂú®Ëøô‰∫õÂü∫Á°Ä‰∏äËøõË°åÁ≤æÁ°ÆÁöÑÁä∂ÊÄÅÊçïËé∑‰∏éÊÅ¢Â§ç„ÄÇÊé•‰∏ãÊù•ÔºåÊàë‰ª¨Â∞ÜÁõÆÂÖâÊäïÂêë Linux Êèê‰æõÁöÑ‰∏Ä‰∏™Âº∫Â§ßÂ∑•ÂÖ∑‚Äî‚Äî/proc Êñá‰ª∂Á≥ªÁªüÔºåÁúãÁúãÂÆÉÂ¶Ç‰ΩïÂ∏ÆÂä©Êàë‰ª¨‚ÄúÈÄèËßÜ‚ÄùËøêË°å‰∏≠ËøõÁ®ãÁöÑÂÜÖÈÉ®Áä∂ÊÄÅ„ÄÇ</p>
<h2 id="proc-Êñá‰ª∂Á≥ªÁªüÂÜÖÊ†∏Áä∂ÊÄÅÁöÑÈÄèËßÜÈïú">
    <a href="#proc-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%86%85%e6%a0%b8%e7%8a%b6%e6%80%81%e7%9a%84%e9%80%8f%e8%a7%86%e9%95%9c" class="header-anchor">#</a>
    /proc Êñá‰ª∂Á≥ªÁªüÔºöÂÜÖÊ†∏Áä∂ÊÄÅÁöÑ‚ÄúÈÄèËßÜÈïú‚Äù
</h2><p>Êàë‰ª¨Â∑≤Áªè‰∫ÜËß£‰∫Ü Linux Â¶Ç‰ΩïÂàõÂª∫ÂíåÁÆ°ÁêÜËøõÁ®ãÔºå‰ΩÜË¶ÅÂÆûÁé∞ÂÉè CRaC ÈÇ£Ê†∑ÁöÑ‚ÄúÂÜªÁªì‚Äù‰∏é‚ÄúÂ§çËãè‚ÄùÔºåÂ∞±ÂøÖÈ°ªÊúâÂäûÊ≥ï<strong>Ê∑±ÂÖ•Êé¢Êü•</strong>‰∏Ä‰∏™Ê≠£Âú®ËøêË°åÁöÑËøõÁ®ãÂÜÖÈÉ®ÁöÑËØ¶ÁªÜÁä∂ÊÄÅ„ÄÇLinux Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÈùûÂ∏∏Âº∫Â§ßÁöÑÊú∫Âà∂Êù•ÂÅöÂà∞Ëøô‰∏ÄÁÇπÔºåÈÇ£Â∞±ÊòØ /proc Êñá‰ª∂Á≥ªÁªü„ÄÇ</p>
<p>ÂàùÁúãËµ∑Êù•Ôºå/proc ÂÉèÊòØ‰∏Ä‰∏™ÊôÆÈÄöÁöÑÁõÆÂΩïÔºå‰Ω†ÂèØ‰ª•Áî® cd ËøõÂÖ•ÔºåÁî® ls Êü•Áúã„ÄÇ‰ΩÜÂÆÉÂÆûÈôÖ‰∏äÊòØ‰∏Ä‰∏™<strong>ËôöÊãüÊñá‰ª∂Á≥ªÁªü</strong>„ÄÇËøôÊÑèÂë≥ÁùÄÂÆÉÈáåÈù¢ÁöÑÊñá‰ª∂ÂíåÁõÆÂΩïÂπ∂‰∏çÁúüÊ≠£Â≠òÂÇ®Âú®Á£ÅÁõò‰∏äÔºåËÄåÊòØÁî± Linux ÂÜÖÊ†∏Âú®<strong>ËøêË°åÊó∂Âä®ÊÄÅÁîüÊàê</strong>ÁöÑ„ÄÇ/proc ÊòØÂÜÖÊ†∏ÂêëÁî®Êà∑Á©∫Èó¥ÔºàËøêË°å‰∏≠ÁöÑÁ®ãÂ∫èÂíåÁî®Êà∑ÔºâÊö¥Èú≤ÂÖ∂ÂÜÖÈÉ®Êï∞ÊçÆÁªìÊûÑÂíåÁ≥ªÁªü‰ø°ÊÅØÁöÑ‰∏ªË¶ÅÊé•Âè£‰πã‰∏Ä„ÄÇ‰Ω†ÂèØ‰ª•ÊääÂÆÉÊÉ≥Ë±°Êàê‰∏ÄÊâáÁ™óÊà∑ÔºåÈÄèËøáÂÆÉÔºåÊàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ËßÇÂØüÂà∞ÂÜÖÊ†∏ÁÆ°ÁêÜ‰∏ãÁöÑÁ≥ªÁªüÁä∂ÊÄÅÔºåÁâπÂà´ÊòØ<strong>ËøêË°å‰∏≠ËøõÁ®ãÁöÑÂÆûÊó∂‰ø°ÊÅØ</strong>„ÄÇ</p>
<p>ËøôÂØπ‰∫é CRIU Âíå CRaC Êù•ËØ¥ÁÆÄÁõ¥ÊòØÊó†‰ª∑‰πãÂÆù„ÄÇÂΩì CRIU ÈúÄË¶ÅÂØπ‰∏Ä‰∏™ËøõÁ®ãÊâßË°å Checkpoint Êó∂ÔºåÂÆÉÁöÑÂ§ßÈÉ®ÂàÜ‰ø°ÊÅØÊù•Ê∫êÂ∞±ÊòØ /proc Êñá‰ª∂Á≥ªÁªü„ÄÇÈÄöËøáËØªÂèñ /proc ‰∏ãÁöÑÁâπÂÆöÊñá‰ª∂ÔºåCRIU ËÉΩÂ§üËé∑ÂèñÂà∞ÁõÆÊ†áËøõÁ®ãÂá†‰πéÊâÄÊúâÁöÑÂÖ≥ÈîÆÁä∂ÊÄÅÊï∞ÊçÆÔºå‰ªéËÄåÊûÑÂª∫Âá∫ÂÆåÊï¥ÁöÑËøõÁ®ãÂø´ÁÖß„ÄÇ</p>
<p>ËÆ©Êàë‰ª¨Êù•ÁúãÁúã /proc ‰∏ã‰∏éËøõÁ®ãÁõ∏ÂÖ≥ÁöÑÂá†‰∏™ÂÖ≥ÈîÆ‚ÄúÊÉÖÊä•Á´ô‚ÄùÔºåÂÆÉ‰ª¨ÈÄöÂ∏∏‰Ωç‰∫é‰ª•ËøõÁ®ã PID ÂëΩÂêçÁöÑÁõÆÂΩï‰∏ãÔºåÂç≥ /proc/&lt;pid&gt;/Ôºö</p>
<ul>
<li><strong>ÂÜÖÂ≠òÂ∏ÉÂ±ÄÂõæ (/proc/&lt;pid&gt;/maps Âíå smaps)</strong>: Ëøô‰∏§‰∏™Êñá‰ª∂Êè≠Á§∫‰∫ÜËøõÁ®ãÁöÑËôöÊãüÂÜÖÂ≠òÊòØÂ¶Ç‰ΩïÁªÑÁªáÁöÑ„ÄÇmaps Êñá‰ª∂ÂàóÂá∫‰∫ÜËøõÁ®ãÁöÑÊâÄÊúâÂÜÖÂ≠òÂå∫ÂüüÔºàÁß∞‰∏∫ VMAÔºåVirtual Memory AreaÔºâÔºåÂåÖÊã¨‰ª£Á†ÅÊÆµ„ÄÅÊï∞ÊçÆÊÆµ„ÄÅÂ†Ü„ÄÅÊ†à‰ª•ÂèäÂÜÖÂ≠òÊò†Â∞ÑÁöÑÊñá‰ª∂ÂíåÂÖ±‰∫´Â∫ìÔºåÊ†áÊòé‰∫ÜÊØè‰∏™Âå∫ÂüüÁöÑËµ∑Ê≠¢Âú∞ÂùÄÂíåÊùÉÈôê„ÄÇsmaps Êñá‰ª∂ÂàôÊèê‰æõ‰∫ÜÊõ¥ËØ¶ÁªÜÁöÑ‰ø°ÊÅØÔºåÂåÖÊã¨ÊØè‰∏™ VMA ÂÆûÈôÖÂç†Áî®ÁöÑÁâ©ÁêÜÂÜÖÂ≠òÔºàRSS - Resident Set SizeÔºâ„ÄÅÂÖ±‰∫´/ÁßÅÊúâÂÜÖÂ≠òÈáè„ÄÅËÑèÈ°µÔºàDirty pagesÔºâÊï∞ÈáèÁ≠â„ÄÇCRIU ÈÄöËøáËß£ÊûêÂÆÉ‰ª¨Êù•Á≤æÁ°Æ‰∫ÜËß£ËøõÁ®ãÁöÑÂÜÖÂ≠òÁªìÊûÑÔºåËøôÊòØ Checkpoint Âíå Restore ÂÜÖÂ≠òÁä∂ÊÄÅÁöÑÂü∫Á°Ä„ÄÇ</li>
<li><strong>ÊâìÂºÄÁöÑÊñá‰ª∂ÂíåËøûÊé• (/proc/&lt;pid&gt;/fd/ Âíå fdinfo/)</strong>: fd ÊòØ‰∏Ä‰∏™ÁõÆÂΩïÔºåÈáåÈù¢ÂåÖÂê´‰∫ÜÊåáÂêëËØ•ËøõÁ®ãÂΩìÂâçÊâìÂºÄÁöÑÊâÄÊúâÊñá‰ª∂ÊèèËø∞Á¨¶ÁöÑÁ¨¶Âè∑ÈìæÊé•„ÄÇÈìæÊé•ÁöÑÂêçÁß∞Â∞±ÊòØÊñá‰ª∂ÊèèËø∞Á¨¶ÁöÑÊï∞Â≠óÔºàÂ¶Ç 0, 1, 2 ÂàÜÂà´‰ª£Ë°®Ê†áÂáÜËæìÂÖ•„ÄÅËæìÂá∫„ÄÅÈîôËØØÔºâÔºåÈìæÊé•ÁöÑÁõÆÊ†áÂàôÊåáÊòé‰∫ÜÂÆÉÂÆûÈôÖ‰ª£Ë°®ÁöÑÊñá‰ª∂„ÄÅÁÆ°ÈÅìÊàñÂ•óÊé•Â≠ó„ÄÇËÄå fdinfo ÁõÆÂΩï‰∏ãÂàôÂåÖÂê´‰∫Ü‰∏é fd ‰∏≠ÊØè‰∏™ÊèèËø∞Á¨¶ÂØπÂ∫îÁöÑÊñá‰ª∂ÔºåËÆ∞ÂΩï‰∫ÜÊõ¥ËØ¶ÁªÜÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÔºåÊØîÂ¶ÇÊñá‰ª∂ÁöÑÂΩìÂâçËØªÂÜô‰ΩçÁΩÆÔºàoffsetÔºâ„ÄÅÊâìÂºÄÊó∂ÁöÑÊ†áÂøó‰ΩçÔºàflagsÔºâÁ≠â„ÄÇCRIU ÈúÄË¶ÅËØªÂèñËøô‰∫õ‰ø°ÊÅØÊù•‰øùÂ≠òÂíåÊÅ¢Â§çËøõÁ®ãÊâìÂºÄÁöÑÊñá‰ª∂Áä∂ÊÄÅ„ÄÇ</li>
<li><strong>ËøõÁ®ãÁä∂ÊÄÅÊä•Âëä (/proc/&lt;pid&gt;/stat)</strong>: Ëøô‰∏™Êñá‰ª∂‰ª•‰∏ÄË°åÊñáÊú¨ÁöÑÂΩ¢ÂºèÔºåÊèê‰æõ‰∫ÜÂÖ≥‰∫éËøõÁ®ãÁöÑÂ§ßÈáèÁä∂ÊÄÅ‰ø°ÊÅØÔºåÁî±Á©∫Ê†ºÂàÜÈöî„ÄÇÂåÖÊã¨ËøõÁ®ãÂêç„ÄÅÁä∂ÊÄÅÔºàËøêË°å„ÄÅÁù°Áú†„ÄÅÂÉµÂ∞∏Á≠âÔºâ„ÄÅÁà∂ËøõÁ®ã PID„ÄÅËøõÁ®ãÁªÑ ID„ÄÅ‰ΩøÁî®ÁöÑÂÜÖÂ≠òÈáè„ÄÅCPU Êó∂Èó¥ÁªüËÆ°Á≠âÁ≠â„ÄÇCRIU Áî®ÂÆÉÊù•Ëé∑ÂèñËøõÁ®ãÁöÑÂü∫Êú¨Â±ûÊÄßÂíåËøêË°åÁªüËÆ°„ÄÇ</li>
<li><strong>Á∫øÁ®ãÊàêÂëòÂàóË°® (/proc/&lt;pid&gt;/task/)</strong>: ÂØπ‰∫éÂ§öÁ∫øÁ®ãËøõÁ®ãÔºåËøô‰∏™ÁõÆÂΩïÈùûÂ∏∏ÈáçË¶Å„ÄÇÂÆÉ‰∏ãÈù¢ÂåÖÂê´‰∫Ü‰ª•ËØ•ËøõÁ®ã‰∏ã<strong>ÊâÄÊúâÁ∫øÁ®ãÁöÑ TID</strong> ÂëΩÂêçÁöÑÂ≠êÁõÆÂΩï„ÄÇÈÄöËøáÈÅçÂéÜËøô‰∏™ÁõÆÂΩïÔºåCRIU ÂèØ‰ª•ËØÜÂà´Âá∫‰∏Ä‰∏™ËøõÁ®ãÂåÖÂê´ÁöÑÊâÄÊúâÁ∫øÁ®ãÔºà‰ªªÂä°ÔºâÔºåÂπ∂ÂØπÊØè‰∏™Á∫øÁ®ãËøõË°åÂçïÁã¨ÁöÑÁä∂ÊÄÅÊçïËé∑„ÄÇ</li>
<li><strong>Â≠êËøõÁ®ãËÆ∞ÂΩï (/proc/&lt;pid&gt;/task/&lt;tid&gt;/children)</strong>: Ëøô‰∏™Êñá‰ª∂Ôºà‰Ωç‰∫éÁâπÂÆöÁ∫øÁ®ãÁõÆÂΩï‰∏ãÔºâËÆ∞ÂΩï‰∫ÜÁî±ËØ•Á∫øÁ®ãÁõ¥Êé•ÂàõÂª∫ÁöÑÊâÄÊúâÂ≠êËøõÁ®ãÁöÑ PID ÂàóË°®„ÄÇÈÄöËøáÈÄíÂΩíÂú∞ËØªÂèñËøô‰∏™Êñá‰ª∂ÔºåCRIU ËÉΩÂ§üÂáÜÁ°ÆÂú∞ÊûÑÂª∫Âá∫ÂÆåÊï¥ÁöÑËøõÁ®ãÊ†ëÊàñËøõÁ®ãÂÆ∂Êóè„ÄÇ</li>
<li><strong>ÂÜÖÂ≠òÊò†Â∞ÑÊñá‰ª∂ËÆøÈóÆ (/proc/&lt;pid&gt;/map_files/)</strong>: Ëøô‰∏™ÁõÆÂΩïÂåÖÂê´‰∫ÜÊåáÂêëËøõÁ®ãÂÜÖÂ≠ò‰∏≠ÈÄöËøáÊñá‰ª∂Êò†Â∞ÑÔºàmmapÔºâÊñπÂºèÂä†ËΩΩÁöÑÂÆûÈôÖÊñá‰ª∂ÁöÑÁ¨¶Âè∑ÈìæÊé•„ÄÇÈìæÊé•ÁöÑÂêçÁß∞ÂØπÂ∫î maps Êñá‰ª∂‰∏≠ÁöÑÂú∞ÂùÄËåÉÂõ¥„ÄÇËøô‰∏∫ CRIU Êèê‰æõ‰∫Ü‰∏ÄÁßçÂèØÈù†ÁöÑÊñπÂºèÊù•ËÆøÈóÆÂíåËØªÂèñËøô‰∫õÊò†Â∞ÑÊñá‰ª∂ÁöÑÂÜÖÂÆπ„ÄÇ</li>
</ul>
<p>ÈÄöËøáÁªÑÂêàÂà©Áî® /proc Êñá‰ª∂Á≥ªÁªüÊèê‰æõÁöÑËøô‰∫õÔºà‰ª•ÂèäÂÖ∂‰ªñÊú™ÂàóÂá∫ÁöÑÔºâ‰ø°ÊÅØÊ∫êÔºåCRIU ËÉΩÂ§üÂÉè‰æ¶Êé¢‰∏ÄÊ†∑ÔºåÁªÜËá¥ÂÖ•ÂæÆÂú∞Êî∂ÈõÜÁõÆÊ†áËøõÁ®ãÂèäÂÖ∂ÊâÄÊúâÁ∫øÁ®ã„ÄÅÂ≠êËøõÁ®ãÂú® Checkpoint Êó∂ÂàªÁöÑÂÆåÊï¥Áä∂ÊÄÅ„ÄÇÊ≤°Êúâ /proc Ëøô‰∏™Âº∫Â§ßÁöÑ‚ÄúÈÄèËßÜÈïú‚ÄùÔºåÂÆûÁé∞Áî®Êà∑Á©∫Èó¥ÁöÑ Checkpoint/Restore Â∞Ü‰ºöÂõ∞ÈöæÂæóÂ§ö„ÄÇ</p>
<p>‰∫ÜËß£‰∫ÜÂ¶Ç‰ΩïÈÄöËøá /proc Ëé∑ÂèñËøõÁ®ãÁä∂ÊÄÅÂêéÔºåÊàë‰ª¨Êé•‰∏ãÊù•Â∞ÜÂÖ≥Ê≥®ËøõÁ®ãËøêË°åÁöÑ‚ÄúËàûÂè∞‚Äù‚Äî‚ÄîÂÜÖÂ≠òÁÆ°ÁêÜÔºå‰ª•ÂèäËøõÁ®ãÂ¶Ç‰Ωï‰∏éÂ§ñÈÉ®‰∏ñÁïå‰∫§‰∫íÁöÑ‚ÄúÁÆ°ÈÅì‚Äù‚Äî‚ÄîÊñá‰ª∂ÊèèËø∞Á¨¶„ÄÇ</p>
<h2 id="ptrace-Á≥ªÁªüË∞ÉÁî®ÊéåÊéßËøõÁ®ãÁöÑÈÅ•ÊéßÂô®">
    <a href="#ptrace-%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8%e6%8e%8c%e6%8e%a7%e8%bf%9b%e7%a8%8b%e7%9a%84%e9%81%a5%e6%8e%a7%e5%99%a8" class="header-anchor">#</a>
    ptrace Á≥ªÁªüË∞ÉÁî®ÔºöÊéåÊéßËøõÁ®ãÁöÑ‚ÄúÈÅ•ÊéßÂô®‚Äù
</h2><p>ÈÄöËøá /proc Êñá‰ª∂Á≥ªÁªüÔºåÊàë‰ª¨Ëé∑Âæó‰∫ÜËßÇÂØüËøêË°å‰∏≠ËøõÁ®ãÂÜÖÈÉ®Áä∂ÊÄÅÁöÑÂº∫Â§ßËÉΩÂäõÔºåÂ∞±ÂÉèÊúâ‰∫Ü‰∏ÄÂâØ‚ÄúÈÄèËßÜÈïú‚Äù„ÄÇ‰ΩÜËøôËøò‰∏çÂ§üÔºåË¶ÅÂÆûÁé∞ÂÉè CRaC/CRIU ÁöÑ Checkpoint/RestoreÔºåÊàë‰ª¨‰∏ç‰ªÖÈúÄË¶Å<strong>ËßÇÂØü</strong>ÔºåËøòÈúÄË¶ÅËÉΩÂ§ü<strong>ÊéßÂà∂</strong>Âíå<strong>ÊìçÁ∫µ</strong>ÁõÆÊ†áËøõÁ®ã‚Äî‚ÄîÂú®ÂêàÈÄÇÁöÑÊó∂Êú∫ËÆ©ÂÆÉÊöÇÂÅúÔºåËØªÂèñÁîöËá≥‰øÆÊîπÂÆÉÁöÑÂÜÖÂ≠òÂíåÂØÑÂ≠òÂô®Áä∂ÊÄÅÔºåÁîöËá≥Âº∫Âà∂ÂÆÉÊâßË°åÊüê‰∫õÊìç‰Ωú„ÄÇËøôÊó∂ÔºåLinux Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÁªàÊûÅÊ≠¶Âô®Ôºå‰πüÊòØ‰∏Ä‰∏™È¢áÂÖ∑‰∫âËÆÆ‰ΩÜÊûÅÂÖ∂Âº∫Â§ßÁöÑÁ≥ªÁªüË∞ÉÁî®Ôºöptrace (process trace)„ÄÇ</p>
<p>ptrace Êèê‰æõ‰∫Ü‰∏ÄÁßçÊú∫Âà∂ÔºåÂÖÅËÆ∏‰∏Ä‰∏™ËøõÁ®ãÔºàÁß∞‰∏∫ <strong>tracer</strong>ÔºåËøΩË∏™ËÄÖÔºâÂéª<strong>ËßÇÂØüÂíåÊéßÂà∂</strong>Âè¶‰∏Ä‰∏™ËøõÁ®ãÔºàÁß∞‰∏∫ <strong>tracee</strong>ÔºåË¢´ËøΩË∏™ËÄÖÔºâÁöÑÊâßË°åÔºåÊ£ÄÊü•ÂíåÊîπÂèò tracee ÁöÑÂÜÖÂ≠òÂíåÂØÑÂ≠òÂô®„ÄÇ‰Ω†ÂèØ‰ª•ÊääÂÆÉÊÉ≥Ë±°Êàê‰∏Ä‰∏™Ëµã‰∫à tracer ËøõÁ®ãÁöÑ‚ÄúËøúÁ®ãÊéßÂà∂Âô®‚ÄùÔºåÂèØ‰ª•Áî®Êù•ÈÅ•Êéß tracee ËøõÁ®ãÁöÑ‰∏Ä‰∏æ‰∏ÄÂä®„ÄÇ</p>
<p>Ëøô‰∏™Á≥ªÁªüË∞ÉÁî®ÊòØËÆ∏Â§öÂ∫ïÂ±ÇÂ∑•ÂÖ∑ÁöÑÂü∫Áü≥Ôºö</p>
<ul>
<li><strong>Ë∞ÉËØïÂô® (Debuggers)</strong>ÔºöÂÉè GDB ËøôÊ†∑ÁöÑË∞ÉËØïÂô®ÔºåÂÖ∂Ê†∏ÂøÉÂäüËÉΩÔºàËÆæÁΩÆÊñ≠ÁÇπ„ÄÅÂçïÊ≠•ÊâßË°å„ÄÅÊ£ÄÊü•ÂèòÈáèÂÄº„ÄÅÊü•ÁúãË∞ÉÁî®Ê†àÁ≠âÔºâÂá†‰πéÂÆåÂÖ®‰æùËµñ‰∫é ptrace„ÄÇË∞ÉËØïÂô®Â∞±ÊòØ‰∏Ä‰∏™ tracer ËøõÁ®ãÔºåËÄåË¢´Ë∞ÉËØïÁöÑÁ®ãÂ∫èÂ∞±ÊòØ tracee„ÄÇ</li>
<li><strong>Á≥ªÁªüË∞ÉÁî®ËøΩË∏™Â∑•ÂÖ∑ (System Call Tracers)</strong>Ôºöstrace ÂëΩ‰ª§ËÉΩÂ§üÊòæÁ§∫‰∏Ä‰∏™ËøõÁ®ãÊâßË°åÁöÑÊâÄÊúâÁ≥ªÁªüË∞ÉÁî®ÂèäÂÖ∂ÂèÇÊï∞ÂíåËøîÂõûÂÄºÔºåËøô‰πüÊòØÈÄöËøá ptrace ÂÆûÁé∞ÁöÑ„ÄÇ</li>
<li><strong>CRIU (Checkpoint/Restore In Userspace)</strong>ÔºöÊ≠£Â¶ÇÊàë‰ª¨‰πãÂâçÊèêÂà∞ÁöÑÔºåCRIU Â§ßÈáè‰ΩøÁî® ptrace Êù•ÂÆåÊàêÈÇ£‰∫õ‰ªÖÈù† /proc Êó†Ê≥ïÂÆåÊàêÁöÑ‰ªªÂä°ÔºåÊØîÂ¶ÇÁ≤æÁ°ÆÂú∞ÊöÇÂÅúËøõÁ®ã„ÄÅËé∑ÂèñÂíåÊÅ¢Â§çÂØÑÂ≠òÂô®Áä∂ÊÄÅ„ÄÅÊ≥®ÂÖ•‚ÄúÂØÑÁîü‰ª£Á†Å‚ÄùÁ≠â„ÄÇ</li>
</ul>
<p>ptrace Êú¨Ë∫´ÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â§çÊùÇÁöÑÁ≥ªÁªüË∞ÉÁî®ÔºåÂÆÉÁöÑË°å‰∏∫Áî±‰º†ÈÄíÁªôÂÆÉÁöÑÁ¨¨‰∏Ä‰∏™ÂèÇÊï∞ request ÂÜ≥ÂÆö„ÄÇ‰∏ãÈù¢Êàë‰ª¨‰ªãÁªç‰∏Ä‰∫õÂÆÉÊèê‰æõÁöÑÂÖ≥ÈîÆËÉΩÂäõÔºåËøô‰∫õËÉΩÂäõÂØπ‰∫éÁêÜËß£ CRIU ÁöÑÂ∑•‰ΩúËá≥ÂÖ≥ÈáçË¶ÅÔºö</p>
<ol>
<li><strong>Âª∫Á´ãËøΩË∏™ÂÖ≥Á≥ª (Attaching)</strong>Ôºö
<ul>
<li>PTRACE_ATTACH Êàñ PTRACE_SEIZEÔºöËøôÊòØ tracer ÊéßÂà∂ tracee ÁöÑÁ¨¨‰∏ÄÊ≠•„ÄÇTracer ‰ΩøÁî®Ëøô‰∏§‰∏™ËØ∑Ê±Ç‰πã‰∏ÄÊù•‚ÄúÈôÑÁùÄ‚ÄùÂà∞ÁõÆÊ†á tracee ËøõÁ®ã‰∏ä„ÄÇ‰∏ÄÊó¶ÈôÑÁùÄÊàêÂäüÔºåtracee Â∞±‰ºöÊöÇÂÅú‰∏ãÊù•ÔºåÂπ∂‰∏îÂÖ∂Áä∂ÊÄÅÂèòÂåñÔºàÂ¶ÇÊî∂Âà∞‰ø°Âè∑„ÄÅÊâßË°åÁ≥ªÁªüË∞ÉÁî®ÔºâÈÉΩ‰ºöÈÄöÁü• tracer„ÄÇPTRACE_SEIZE ÊòØ‰∏Ä‰∏™ËæÉÊñ∞ÁöÑ„ÄÅÊõ¥Êé®ËçêÁöÑÊñπÂºèÔºåÂÆÉÈÅøÂÖç‰∫Ü PTRACE_ATTACH ‰∏≠‰ΩøÁî® SIGSTOP ‰ø°Âè∑ÂèØËÉΩÂ∏¶Êù•ÁöÑÂâØ‰ΩúÁî®ÔºåÊéßÂà∂Êõ¥‰∏∫Á≤æÁ°Æ„ÄÇ</li>
</ul>
</li>
<li><strong>ËØªÂÜôÂØÑÂ≠òÂô® (Reading/Writing Registers)</strong>Ôºö
<ul>
<li>PTRACE_GETREGS, PTRACE_GETFPREGS Á≠âÔºöÂÖÅËÆ∏ tracer ËØªÂèñ tracee ÂΩìÂâçÁöÑÈÄöÁî®ÂØÑÂ≠òÂô®ÔºàÂ¶ÇÊåá‰ª§ÊåáÈíà EIP/RIP„ÄÅÊ†àÊåáÈíà ESP/RSP Á≠âÔºâ„ÄÅÊµÆÁÇπÂØÑÂ≠òÂô®Á≠â CPU Áä∂ÊÄÅ„ÄÇ</li>
<li>PTRACE_SETREGS, PTRACE_SETFPREGS Á≠âÔºöÂÖÅËÆ∏ tracer ‰øÆÊîπ tracee ÁöÑÂØÑÂ≠òÂô®Áä∂ÊÄÅ„ÄÇËøôÂØπ‰∫éÊÅ¢Â§çËøõÁ®ãÂà∞Êüê‰∏™Á≤æÁ°ÆÁöÑÊâßË°åÁÇπËá≥ÂÖ≥ÈáçË¶ÅÔºåCRIU Âú® Restore Èò∂ÊÆµÂ∞±ÈúÄË¶ÅÁî®ÂÆÉÊù•ËÆæÁΩÆÂ•ΩÊÅ¢Â§çÂêéËøõÁ®ãÁöÑ CPU ‰∏ä‰∏ãÊñá„ÄÇ</li>
</ul>
</li>
<li><strong>ËØªÂÜôÂÜÖÂ≠ò (Reading/Writing Memory)</strong>Ôºö
<ul>
<li>PTRACE_PEEKDATA, PTRACE_PEEKTEXTÔºöÂÖÅËÆ∏ tracer ËØªÂèñ tracee ËøõÁ®ãÂú∞ÂùÄÁ©∫Èó¥‰∏≠‰ªªÊÑè‰ΩçÁΩÆÁöÑÊï∞ÊçÆÔºàÈÄöÂ∏∏‰ª•Â≠óÈïø‰∏∫Âçï‰ΩçÔºâ„ÄÇ</li>
<li>PTRACE_POKEDATA, PTRACE_POKETEXTÔºöÂÖÅËÆ∏ tracer Âêë tracee ËøõÁ®ãÂú∞ÂùÄÁ©∫Èó¥‰∏≠‰ªªÊÑè‰ΩçÁΩÆÂÜôÂÖ•Êï∞ÊçÆ„ÄÇCRIU Ê≠£ÊòØÂà©Áî®Ëøô‰∏™ËÉΩÂäõÔºåÂú® Checkpoint Èò∂ÊÆµÂêëÁõÆÊ†áËøõÁ®ãÊ≥®ÂÖ•‚ÄúÂØÑÁîü‰ª£Á†Å‚ÄùÔºà‰∏ÄÊÆµÂ∏ÆÂä©Êî∂ÈõÜÂÜÖÈÉ®‰ø°ÊÅØÁöÑ‰∫åËøõÂà∂‰ª£Á†ÅÔºâÔºåÂπ∂Âú® Restore Èò∂ÊÆµÂ∞ÜÂø´ÁÖß‰∏≠ÁöÑÂÜÖÂ≠òÊï∞ÊçÆÂÜôÂõûËøõÁ®ãÁ©∫Èó¥„ÄÇ</li>
</ul>
</li>
<li><strong>ÊéßÂà∂ÊâßË°å (Controlling Execution)</strong>Ôºö
<ul>
<li>PTRACE_CONTÔºöËÆ©ÊöÇÂÅúÁöÑ tracee ÁªßÁª≠ÊâßË°å„ÄÇÂèØ‰ª•ÈÄâÊã©ÊòØÂê¶‰º†ÈÄí‰∏Ä‰∏™‰ø°Âè∑Áªô tracee„ÄÇ</li>
<li>PTRACE_SYSCALLÔºöËÆ© tracee ÁªßÁª≠ÊâßË°åÔºåÁõ¥Âà∞ÂÆÉËøõÂÖ•ÊàñÈÄÄÂá∫‰∏ã‰∏Ä‰∏™Á≥ªÁªüË∞ÉÁî®Êó∂ÂÜçÊ¨°ÊöÇÂÅúÔºåÂπ∂ÈÄöÁü• tracer„ÄÇstrace Â∞±ÊòØÂü∫‰∫éÊ≠§Â∑•‰ΩúÁöÑ„ÄÇCRIU ‰πüÁî®ÂÆÉÊù•Á≤æÁ°ÆÊéßÂà∂ÁõÆÊ†áËøõÁ®ãÊâßË°åÁâπÂÆöÁöÑÁ≥ªÁªüË∞ÉÁî®ÔºàÂ¶Ç mmap, munmapÔºâÊù•ËæÖÂä©ÂÜÖÂ≠òÁöÑ Checkpoint Âíå Restore„ÄÇ</li>
<li>PTRACE_SINGLESTEPÔºöËÆ© tracee ÊâßË°å<strong>‰∏ÄÊù°</strong>Êú∫Âô®Êåá‰ª§ÔºåÁÑ∂ÂêéÂÜçÊ¨°ÊöÇÂÅú„ÄÇËøôÊòØË∞ÉËØïÂô®ÂÆûÁé∞ÂçïÊ≠•ÊâßË°åÁöÑÂü∫Á°Ä„ÄÇ</li>
</ul>
</li>
<li><strong>Ëß£Èô§ËøΩË∏™ÂÖ≥Á≥ª (Detaching)</strong>Ôºö
<ul>
<li>PTRACE_DETACHÔºöTracer ÁªìÊùüÂØπ tracee ÁöÑËøΩË∏™„ÄÇTracee ‰ºöÊÅ¢Â§çÊ≠£Â∏∏ÊâßË°åÔºåÂ∞±ÂÉè‰ªéÊú™Ë¢´ËøΩË∏™Ëøá‰∏ÄÊ†∑ÔºàÈô§Èùû tracer ‰øÆÊîπ‰∫ÜÂÆÉÁöÑÁä∂ÊÄÅÔºâ„ÄÇ</li>
</ul>
</li>
</ol>
<p>ÈÄöËøáËøô‰∫õÂº∫Â§ßÁöÑÔºàÁîöËá≥ÂèØ‰ª•ËØ¥ÊòØÂç±Èô©ÁöÑÔºâËÉΩÂäõÔºåptrace Ëµã‰∫à‰∫Ü CRIU Ë∂ÖË∂äÊôÆÈÄöËøõÁ®ãÊùÉÈôêÁöÑÊìç‰ΩúËÉΩÂäõ„ÄÇÂÆÉ‰∏ç‰ªÖËÉΩÈÄöËøá /proc ÁúãÂà∞ËøõÁ®ãÁöÑÁä∂ÊÄÅÔºåÊõ¥ËÉΩÂÉèÂ§ñÁßëÂåªÁîü‰∏ÄÊ†∑ÔºåÁ≤æÁ°ÆÂú∞ÊöÇÂÅúËøõÁ®ã„ÄÅÊ£ÄÊü•Âíå‰øÆÊîπÂÖ∂ÂÜÖÈÉ®Áä∂ÊÄÅÔºàÂÜÖÂ≠òÂíåÂØÑÂ≠òÂô®ÔºâÔºåÁîöËá≥‚ÄúÂÄüÁî®‚ÄùÁõÆÊ†áËøõÁ®ãÁöÑ‰∏ä‰∏ãÊñáÊù•ÊâßË°åÁâπÂÆöÊìç‰ΩúÔºàÂ¶ÇÊ≥®ÂÖ•‰ª£Á†Å„ÄÅÂº∫Âà∂ÊâßË°åÁ≥ªÁªüË∞ÉÁî®Ôºâ„ÄÇÊ≠£ÊòØ ptrace ÁöÑÂ≠òÂú®Ôºå‰ΩøÂæóÂú®Áî®Êà∑Á©∫Èó¥ÂÆûÁé∞Â§çÊùÇ‰∏îÁ≤æÁ°ÆÁöÑËøõÁ®ã Checkpoint/Restore Êàê‰∏∫ÂèØËÉΩÔºå‰πüÈó¥Êé•ÊîØÊíë‰∫Ü CRaC ÊäÄÊúØÁöÑÂÆûÁé∞„ÄÇ</p>
<p>ÂΩìÁÑ∂Ôºåptrace ÁöÑÂº∫Â§ß‰πüÊÑèÂë≥ÁùÄÊΩúÂú®ÁöÑÈ£éÈô©ÔºåÊìç‰ΩúÁ≥ªÁªüÈÄöÂ∏∏‰ºöÂØπÂÖ∂‰ΩøÁî®ÊñΩÂä†‰∏Ä‰∫õÂÆâÂÖ®ÈôêÂà∂Ôºà‰æãÂ¶ÇÔºå‰∏Ä‰∏™ÊôÆÈÄöÁî®Êà∑ËøõÁ®ã‰∏çËÉΩÈöèÊÑè ptrace ÂÖ∂‰ªñÁî®Êà∑ÁöÑËøõÁ®ãÊàñÁâπÊùÉËøõÁ®ãÔºâ„ÄÇ</p>
<p>ÁêÜËß£‰∫Ü ptrace ÁöÑÊ†∏ÂøÉËÉΩÂäõÂêéÔºåÊàë‰ª¨ÂØπ CRIU Â¶Ç‰ΩïÂÆåÊàêÈÇ£‰∫õÁúã‰ºº‰∏çÂèØËÉΩÁöÑ‰ªªÂä°ÔºåÂ∫îËØ•Êúâ‰∫ÜÊõ¥Ê∑±ÁöÑ‰Ωì‰ºö„ÄÇÊé•‰∏ãÊù•ÔºåÊàë‰ª¨Â∞ÜÊääÂâçÈù¢‰ªãÁªçÁöÑÁü•ËØÜÁÇπ‰∏≤ËÅîËµ∑Êù•ÔºåÁúãÁúã CRIU ÂÖ∑‰ΩìÊòØÂ¶Ç‰Ωï‰∏ÄÊ≠•Ê≠•ÂÆûÁé∞ Checkpoint Âíå Restore ÁöÑ„ÄÇ</p>
<h2 id="criu-Â¶Ç‰ΩïÂÆûÁé∞-checkpoint-Âíå-restore">
    <a href="#criu-%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0-checkpoint-%e5%92%8c-restore" class="header-anchor">#</a>
    CRIU Â¶Ç‰ΩïÂÆûÁé∞ Checkpoint Âíå RestoreÔºü
</h2><p>Áé∞Âú®ÔºåÊàë‰ª¨Â∑≤Áªè‰∫ÜËß£‰∫Ü Linux ÁöÑËøõÁ®ãÁ∫øÁ®ãÊ®°Âûã„ÄÅÂº∫Â§ßÁöÑ /proc Êñá‰ª∂Á≥ªÁªü‰ª•ÂèäÊã•Êúâ‚ÄúÈÅ•Êéß‚ÄùËÉΩÂäõÁöÑ ptrace Á≥ªÁªüË∞ÉÁî®„ÄÇÊòØÊó∂ÂÄôÂ∞ÜËøô‰∫õÁü•ËØÜÁÇπ‰∏≤ËÅîËµ∑Êù•ÔºåÁúãÁúã CRIU (Checkpoint/Restore In Userspace) ÊòØÂ¶Ç‰ΩïÂà©Áî®ÂÆÉ‰ª¨Êù•ÊñΩÂ±ï‚ÄúÂÜªÁªì‚Äù (Checkpoint) Âíå‚ÄúÂ§çËãè‚Äù (Restore) ËøõÁ®ãÁöÑÈ≠îÊ≥ï‰∫Ü„ÄÇ</p>
<h3 id="checkpoint-ÂÜªÁªìËøáÁ®ã‰∏∫ËøõÁ®ãÊãç‰∏ãÁ≤æÁ°ÆÂø´ÁÖß">
    <a href="#checkpoint-%e5%86%bb%e7%bb%93%e8%bf%87%e7%a8%8b%e4%b8%ba%e8%bf%9b%e7%a8%8b%e6%8b%8d%e4%b8%8b%e7%b2%be%e7%a1%ae%e5%bf%ab%e7%85%a7" class="header-anchor">#</a>
    Checkpoint (ÂÜªÁªìËøáÁ®ã)Ôºö‰∏∫ËøõÁ®ãÊãç‰∏ãÁ≤æÁ°ÆÂø´ÁÖß
</h3><p>ÂΩì CRIU Ë¢´Ë¶ÅÊ±ÇÂØπ‰∏Ä‰∏™ËøõÁ®ãÔºàÂèäÂÖ∂Âêé‰ª£ÔºâËøõË°å Checkpoint Êó∂ÔºåÂÆÉ‰ºöÊâßË°å‰∏ÄÁ≥ªÂàóÁ≤æÂøÉËÆæËÆ°ÁöÑÊ≠•È™§Ôºö</p>
<ol>
<li><strong>ËØÜÂà´ÁõÆÊ†áÂÆ∂Êóè</strong>: È¶ñÂÖàÔºåCRIU ÈúÄË¶ÅÁ°ÆÂÆöË¶ÅÂÜªÁªìÁöÑÂÆåÊï¥ÁõÆÊ†á„ÄÇÂÆÉ‰ªéÁî®Êà∑ÊåáÂÆöÁöÑÊ†πËøõÁ®ã PID ÂºÄÂßãÔºåÈÄöËøáÈÄíÂΩíÂú∞ËØªÂèñ /proc/&lt;pid&gt;/task/&lt;tid&gt;/children Êñá‰ª∂ÔºåÂÉèÂâ•Ê¥ãËë±‰∏ÄÊ†∑ÔºåÊâæÂá∫ÊâÄÊúâÁõ∏ÂÖ≥ÁöÑÂ≠êËøõÁ®ãÂíåÁ∫øÁ®ãÔºåÊûÑÂª∫Âá∫ÂÆåÊï¥ÁöÑ<strong>ËøõÁ®ãÊ†ë</strong>„ÄÇ</li>
<li><strong>ÂÖ®‰Ωì‚ÄúÁ´ãÊ≠£‚Äù</strong>: Êé•‰∏ãÊù•ÔºåCRIU ÈúÄË¶ÅËÆ©Ëøô‰∏™Â∫ûÂ§ßÂÆ∂ÊóèÁöÑÊâÄÊúâÊàêÂëòÈÉΩÊöÇÂÅú‰∏ãÊù•„ÄÇÂÆÉ‰ΩøÁî® ptrace(PTRACE_SEIZE, &hellip;) ÈôÑÁùÄÂà∞ËøõÁ®ãÊ†ë‰∏≠ÁöÑ<strong>ÊØè‰∏Ä‰∏™‰ªªÂä°</strong>ÔºàËøõÁ®ã/Á∫øÁ®ãÔºâ‰∏ä„ÄÇPTRACE_SEIZE ‰ºöËÆ©Ëøô‰∫õ‰ªªÂä°Âú®‰∏ã‰∏ÄÊ¨°ÂÜÖÊ†∏ÊúâÊú∫‰ºö‰ªãÂÖ•Êó∂ÔºàÊØîÂ¶ÇÁ≥ªÁªüË∞ÉÁî®Êàñ‰∏≠Êñ≠ÔºâËøõÂÖ•ÊöÇÂÅúÁä∂ÊÄÅÔºåÂπ∂‰∏îËøôÁßçÊöÇÂÅúÊñπÂºèÊØîËÄÅÁöÑ PTRACE_ATTACH Êõ¥‰∏∫Âπ≤ÂáÄÔºå‰∏ç‰æùËµñ SIGSTOP ‰ø°Âè∑„ÄÇ</li>
<li><strong>‰ø°ÊÅØÂ§ßÊêúÈõÜ</strong>: ËøõÁ®ãÊ†ëË¢´ÂÜªÁªìÂêéÔºåCRIU ÂºÄÂßãÊâÆÊºî‚ÄúÊÉÖÊä•Âëò‚ÄùÁöÑËßíËâ≤ÔºåÈÄöËøá /proc Êñá‰ª∂Á≥ªÁªüÂíå ptrace Êî∂ÈõÜÊØè‰∏™‰ªªÂä°ÁöÑËØ¶ÁªÜÁä∂ÊÄÅÔºö
<ul>
<li><strong>ÂÜÖÂ≠òÂ∏ÉÂ±Ä</strong>: Ëß£Êûê /proc/&lt;pid&gt;/maps Âíå smaps Ëé∑ÂèñËôöÊãüÂÜÖÂ≠òÂå∫ÂüüÔºàVMAÔºâÁöÑÂú∞ÂùÄ„ÄÅÂ§ßÂ∞è„ÄÅÊùÉÈôê„ÄÅÊò†Â∞ÑÊù•Ê∫êÔºàÊñá‰ª∂ÊàñÂåøÂêçÔºâÁ≠â‰ø°ÊÅØ„ÄÇ</li>
<li><strong>Êñá‰ª∂ÊèèËø∞Á¨¶</strong>: ËØªÂèñ /proc/&lt;pid&gt;/fd/ Âíå fdinfo/ ÁõÆÂΩïÔºåËÆ∞ÂΩï‰∏ãÊâÄÊúâÊâìÂºÄÁöÑÊñá‰ª∂„ÄÅÁÆ°ÈÅì„ÄÅÂ•óÊé•Â≠óÂèäÂÖ∂Á±ªÂûã„ÄÅË∑ØÂæÑ„ÄÅÂΩìÂâçËØªÂÜô‰ΩçÁΩÆ„ÄÅÊ†áÂøó‰ΩçÁ≠âÁä∂ÊÄÅ„ÄÇ</li>
<li><strong>ËøõÁ®ã/Á∫øÁ®ãÊ†∏ÂøÉÁä∂ÊÄÅ</strong>: ÈÄöËøá /proc/&lt;pid&gt;/stat Ëé∑ÂèñËøõÁ®ãÁöÑÂü∫Êú¨Â±ûÊÄßÔºåÊõ¥ÈáçË¶ÅÁöÑÊòØÔºå‰ΩøÁî® ptrace(PTRACE_GETREGS, &hellip;) Âíå PTRACE_GETFPREGS Á≠âÂëΩ‰ª§ÔºåÁõ¥Êé•ËØªÂèñÊØè‰∏™‰ªªÂä°ÊöÇÂÅúÊó∂ÁöÑ<strong>CPU ÂØÑÂ≠òÂô®</strong>ÂÜÖÂÆπÔºàÂåÖÊã¨Êåá‰ª§ÊåáÈíà„ÄÅÊ†àÊåáÈíà„ÄÅÈÄöÁî®ÂØÑÂ≠òÂô®Á≠âÔºâ„ÄÇËøôÊòØÁ°Æ‰øùÊÅ¢Â§çÂêéËÉΩ‰ªéÊ≠£Á°Æ‰ΩçÁΩÆÁªßÁª≠ÊâßË°åÁöÑÂÖ≥ÈîÆ„ÄÇ</li>
<li><strong>ÂÖ∂‰ªñËµÑÊ∫ê</strong>: Êî∂ÈõÜÂ¶Ç‰ø°Âè∑Â§ÑÁêÜÂô®ËÆæÁΩÆ„ÄÅÂÆöÊó∂Âô®„ÄÅÂá≠ËØÅÔºàUID/GIDÔºâ„ÄÅÂëΩÂêçÁ©∫Èó¥Èö∂Â±ûÂÖ≥Á≥ªÁ≠â‰ø°ÊÅØ„ÄÇ</li>
</ul>
</li>
<li><strong>ÂÜÖÂ≠òÂÜÖÂÆπËΩ¨ÂÇ® (ÂèØËÉΩÈúÄË¶Å‚ÄúÂØÑÁîüËô´‚ÄùÂ∏ÆÂøô)</strong>: Ëé∑ÂèñÂÜÖÂ≠òÂ∏ÉÂ±ÄÂè™ÊòØÁ¨¨‰∏ÄÊ≠•ÔºåËøòÈúÄË¶ÅÊääËøô‰∫õÂÜÖÂ≠òÂå∫ÂüüÈáåÁöÑ<strong>ÂÆûÈôÖÊï∞ÊçÆ</strong>‰øùÂ≠ò‰∏ãÊù•„ÄÇÂØπ‰∫éÂ§ßÈÉ®ÂàÜÂÜÖÂ≠òÂå∫ÂüüÔºåCRIU ÂèØ‰ª•ÈÄöËøá /proc/&lt;pid&gt;/mem Êñá‰ª∂ÊàñËÄÖ process_vm_readv Á≥ªÁªüË∞ÉÁî®Êù•ËØªÂèñ„ÄÇ‰ΩÜÂØπ‰∫éÊüê‰∫õÁâπÊÆäÊàñÁßÅÊúâÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºåÊàñËÄÖ‰∏∫‰∫ÜËé∑ÂèñÊüê‰∫õÊó†Ê≥ï‰ªéÂ§ñÈÉ®Êé¢ÊµãÁöÑÂÜÖÈÉ®Áä∂ÊÄÅÔºàÂ¶ÇÁ≤æÁ°ÆÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Áä∂ÊÄÅÔºâÔºåÁõ¥Êé•ËØªÂèñÂèØËÉΩÂèóÈôêÊàñÊïàÁéá‰∏çÈ´ò„ÄÇËøôÊó∂ÔºåCRIU ‰ºöÁ•≠Âá∫ÂÆÉÁöÑ‚ÄúÊùÄÊâãÈîè‚Äù‚Äî‚Äî<strong>ÂØÑÁîü‰ª£Á†Å (Parasite Code)</strong>„ÄÇ
<ul>
<li>CRIU ‰ΩøÁî® ptrace Âú®ÁõÆÊ†áËøõÁ®ãÁöÑÂú∞ÂùÄÁ©∫Èó¥‰∏≠ÂàÜÈÖç‰∏ÄÂ∞èÂùóÂÜÖÂ≠òÔºàÈÄöËøáÂº∫Âà∂ÁõÆÊ†áËøõÁ®ãÊâßË°å mmap Á≥ªÁªüË∞ÉÁî®Ôºâ„ÄÇ</li>
<li>ÁÑ∂ÂêéÔºå‰ΩøÁî® ptrace(PTRACE_POKEDATA, &hellip;) Â∞Ü‰∏ÄÊÆµÈ¢ÑÂÖàÁºñËØëÂ•ΩÁöÑ„ÄÅ‰∏é‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑÔºàPIEÔºâ‰∫åËøõÂà∂‰ª£Á†ÅÔºàÂØÑÁîü‰ª£Á†ÅÔºâÂÜôÂÖ•ËøôÂùóÂÜÖÂ≠ò„ÄÇ</li>
<li>ÊúÄÂêéÔºåÈÄöËøá ptrace ‰øÆÊîπÁõÆÊ†áËøõÁ®ãÁöÑÊåá‰ª§ÊåáÈíàÔºåËÆ©ÂÆÉË∑≥ËΩ¨ÊâßË°åËøôÊÆµÂØÑÁîü‰ª£Á†Å„ÄÇ</li>
<li>ÂØÑÁîü‰ª£Á†ÅËøêË°åÂú®ÁõÆÊ†áËøõÁ®ãÁöÑ‰∏ä‰∏ãÊñá‰∏≠ÔºåÊã•ÊúâËÆøÈóÆÂÖ∂ÊâÄÊúâËµÑÊ∫êÁöÑÊùÉÈôêÔºåÂèØ‰ª•È´òÊïàÂú∞ÂÆåÊàêÂÜÖÂ≠òËΩ¨ÂÇ®„ÄÅÊî∂ÈõÜÂÜÖÈÉ®‰ø°ÊÅØÁ≠â‰ªªÂä°ÔºåÂπ∂Â∞ÜÁªìÊûú‰º†ÈÄíÁªô CRIU„ÄÇ‰ªªÂä°ÂÆåÊàêÂêéÔºåÂØÑÁîü‰ª£Á†ÅÈÄöËøá rt_sigreturn Á≥ªÁªüË∞ÉÁî®ÊÅ¢Â§çÁõÆÊ†áËøõÁ®ã‰πãÂâçÁöÑÂØÑÂ≠òÂô®Áä∂ÊÄÅÔºåCRIU ÂÜçÂº∫Âà∂ÁõÆÊ†áËøõÁ®ãÊâßË°å munmap Ê∏ÖÁêÜÊéâÂØÑÁîü‰ª£Á†ÅÂç†Áî®ÁöÑÂÜÖÂ≠òÔºåÊúÄÂêé ptrace(PTRACE_DETACH, &hellip;) ËÑ±Á¶ªÔºåÊï¥‰∏™ËøáÁ®ãÂØπÁõÆÊ†áËøõÁ®ãÊù•ËØ¥Âá†‰πéÊòØ‚ÄúÊó†Áóï‚ÄùÁöÑ„ÄÇ</li>
</ul>
</li>
<li><strong>ÂÜôÂÖ•ÈïúÂÉèÊñá‰ª∂</strong>: CRIU Â∞ÜÊî∂ÈõÜÂà∞ÁöÑÊâÄÊúâÁä∂ÊÄÅ‰ø°ÊÅØÔºàÂÜÖÂ≠òÂ∏ÉÂ±Ä„ÄÅÂØÑÂ≠òÂô®„ÄÅÊñá‰ª∂ÊèèËø∞Á¨¶Áä∂ÊÄÅ„ÄÅÂÜÖÂ≠òÊï∞ÊçÆÁ≠âÔºâÁªÑÁªáËµ∑Êù•ÔºåÂÜôÂÖ•Âà∞Á£ÅÁõò‰∏äÁöÑ‰∏ÄÁ≥ªÂàóÈïúÂÉèÊñá‰ª∂‰∏≠„ÄÇËøô‰∫õÊñá‰ª∂ÂÖ±ÂêåÊûÑÊàê‰∫ÜËøõÁ®ãÂú® Checkpoint Êó∂ÂàªÁöÑÂÆåÊï¥Âø´ÁÖß„ÄÇ</li>
<li><strong>(ÂèØÈÄâ) ÁªàÊ≠¢ÂéüËøõÁ®ã</strong>: Âú®Êüê‰∫õÂú∫ÊôØ‰∏ãÔºàÊØîÂ¶Ç CRaC ÁöÑÈªòËÆ§Ë°å‰∏∫ÔºâÔºåCheckpoint ÂÆåÊàêÂêéÔºåÂéüÂßãÁöÑ JVM ËøõÁ®ã‰ºöË¢´ CRIU ÁªàÊ≠¢„ÄÇ</li>
</ol>
<h3 id="restore-Â§çËãèËøáÁ®ã‰ªéÂø´ÁÖßÈáçÂª∫È≤úÊ¥ªËøõÁ®ã">
    <a href="#restore-%e5%a4%8d%e8%8b%8f%e8%bf%87%e7%a8%8b%e4%bb%8e%e5%bf%ab%e7%85%a7%e9%87%8d%e5%bb%ba%e9%b2%9c%e6%b4%bb%e8%bf%9b%e7%a8%8b" class="header-anchor">#</a>
    Restore (Â§çËãèËøáÁ®ã)Ôºö‰ªéÂø´ÁÖßÈáçÂª∫È≤úÊ¥ªËøõÁ®ã
</h3><p>Restore ËøáÁ®ãÂèØ‰ª•Áúã‰ΩúÊòØ Checkpoint ÁöÑÈÄÜÊìç‰ΩúÔºåÂÆÉÊõ¥Âä†Â§çÊùÇÔºåÈúÄË¶ÅÁ≤æÁ°ÆÂú∞ÈáçÂª∫ËøõÁ®ãÁä∂ÊÄÅÔºö</p>
<ol>
<li><strong>Ëß£ÊûêÈïúÂÉèÔºåËßÑÂàíËìùÂõæ</strong>: CRIU È¶ñÂÖàËØªÂèñ Checkpoint ÁîüÊàêÁöÑÈïúÂÉèÊñá‰ª∂ÔºåÂàÜÊûêËøõÁ®ãÈó¥ÁöÑÂÖ≥Á≥ªÔºàÁà∂Â≠ê„ÄÅÂÖ±‰∫´ËµÑÊ∫êÁ≠âÔºâÔºåÂà∂ÂÆöÊÅ¢Â§çËÆ°Âàí„ÄÇ</li>
<li><strong>Êê≠Âª∫È™®Êû∂</strong>: CRIU ‰∏•Ê†ºÊåâÁÖßÈïúÂÉè‰∏≠ËÆ∞ÂΩïÁöÑËøõÁ®ãÊ†ëÁªìÊûÑÔºåÈÄöËøáÂ§öÊ¨°Ë∞ÉÁî® fork() Êù•ÂàõÂª∫Êñ∞ÁöÑËøõÁ®ã„ÄÇÂú®Ëøô‰∏™Èò∂ÊÆµÔºåÈÄöÂ∏∏Âè™ÂàõÂª∫ËøõÁ®ãÁöÑ‰∏ªÁ∫øÁ®ã„ÄÇ</li>
<li><strong>ÊÅ¢Â§çÂü∫Êú¨ËµÑÊ∫ê</strong>: ÂØπ‰∫éÊØè‰∏™Êñ∞ÂàõÂª∫ÁöÑËøõÁ®ãÔºåCRIU ÂºÄÂßãÊÅ¢Â§çÂ§ßÈÉ®ÂàÜÁä∂ÊÄÅÔºö
<ul>
<li><strong>Êñá‰ª∂ÊèèËø∞Á¨¶</strong>: Ê†πÊçÆÈïúÂÉè‰ø°ÊÅØÈáçÊñ∞ÊâìÂºÄÊñá‰ª∂ÔºàÂèØËÉΩÈúÄË¶ÅÈ™åËØÅË∑ØÂæÑÊúâÊïàÊÄßÔºâ„ÄÅÂàõÂª∫ÁÆ°ÈÅìÂíåÂ•óÊé•Â≠óÔºåÂπ∂ËÆæÁΩÆÂ•ΩÂÆÉ‰ª¨ÁöÑÁä∂ÊÄÅÔºàÂ¶ÇÊñá‰ª∂ÂÅèÁßªÈáèÔºâ„ÄÇÂØπ‰∫éÂÖ±‰∫´ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÈúÄË¶ÅÁ°Æ‰øùÂÆÉ‰ª¨ÊåáÂêëÂêå‰∏Ä‰∏™ÂÜÖÊ†∏ÂØπË±°ÔºàÂèØËÉΩÁî®Âà∞ SCM_RIGHTS Á≠âÊäÄÊúØÔºâ„ÄÇ</li>
<li><strong>ÂÜÖÂ≠òÊò†Â∞Ñ (ÂàùÊ≠•)</strong>: ‰ΩøÁî® mmap() Ê†πÊçÆÈïúÂÉè‰∏≠ÁöÑ VMA ‰ø°ÊÅØÂàõÂª∫ÂÜÖÂ≠òÂå∫Âüü„ÄÇÂØπ‰∫éÁßÅÊúâÂÜÖÂ≠òÔºå‰ºöÂÖàÊò†Â∞ÑÂåøÂêçÂÜÖÂ≠òÔºåÁ®çÂêéÂÜçÂ°´ÂÖÖÊï∞ÊçÆÔºõÂØπ‰∫éÊñá‰ª∂Êò†Â∞ÑÔºå‰ºöÈáçÊñ∞Êò†Â∞ÑÁõ∏Â∫îÁöÑÊñá‰ª∂„ÄÇÊ≠§Êó∂Êò†Â∞ÑÁöÑËôöÊãüÂú∞ÂùÄÂèØËÉΩËøò‰∏çÊòØÊúÄÁªàÁöÑÁõÆÊ†áÂú∞ÂùÄ„ÄÇ</li>
<li><strong>ÂëΩÂêçÁ©∫Èó¥</strong>: Â¶ÇÊûúËøõÁ®ã‰ΩøÁî®‰∫ÜÈùûÈªòËÆ§ÁöÑÂëΩÂêçÁ©∫Èó¥ÔºåCRIU ‰ºöË¥üË¥£ÂàõÂª∫ÊàñÂä†ÂÖ•Ëøô‰∫õÂëΩÂêçÁ©∫Èó¥„ÄÇ</li>
<li><strong>ÂÖ∂‰ªñ</strong>: ÊÅ¢Â§çÂ∑•‰ΩúÁõÆÂΩï„ÄÅÊ†πÁõÆÂΩï„ÄÅ‰ø°Âè∑Â§ÑÁêÜÂô®Á≠â„ÄÇ</li>
</ul>
</li>
<li><strong>ÂÖ≥ÈîÆÊ≠•È™§ÔºöÂàáÊç¢‰∏ä‰∏ãÊñá‰∏éÁ≤æÁªÜÊÅ¢Â§ç</strong>: ËøôÊòØ Restore ‰∏≠ÊúÄÁ≤æÂ¶ô‰πüÊúÄÂõ∞ÈöæÁöÑÈÉ®ÂàÜ„ÄÇÂõ†‰∏∫ÊâßË°å Restore Êìç‰ΩúÁöÑ CRIU ‰ª£Á†ÅÊú¨Ë∫´ÂèØËÉΩÂ∞±‰Ωç‰∫éÈúÄË¶ÅË¢´ÊÅ¢Â§çÂÜÖÂÆπË¶ÜÁõñÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇ‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºö
<ul>
<li>CRIU ‰ºöÊâæÂà∞‰∏ÄÂùó‰∏¥Êó∂ÁöÑ„ÄÅÂÆâÂÖ®ÁöÑÂÜÖÂ≠ò‚ÄúÁ©∫Âú∞‚ÄùÔºåÂä†ËΩΩ‰∏ÄÂ∞èÊÆµËá™ÂåÖÂê´ÁöÑ„ÄÅ‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑ<strong>ÊÅ¢Â§çÂô®‰ª£Á†Å (Restorer Context)</strong>„ÄÇ</li>
<li>ÁÑ∂ÂêéÔºåÈÄöËøá‰∏ÄÊ¨°Ë∑≥ËΩ¨ÔºåÂ∞Ü CPU ÁöÑÊéßÂà∂ÊùÉ‰∫§ÁªôËøôÊÆµÊÅ¢Â§çÂô®‰ª£Á†Å„ÄÇ</li>
<li>Âú®ÊÅ¢Â§çÂô®‰ª£Á†ÅÁöÑÊéßÂà∂‰∏ãÔºåËøõË°åÊúÄÂêé‰πüÊòØÊúÄÂÖ≥ÈîÆÁöÑÊÅ¢Â§çÊ≠•È™§Ôºö
<ul>
<li><strong>Á≤æÁ°ÆÂÜÖÂ≠òÂ∏ÉÂ±Ä</strong>: ‰ΩøÁî® mremap() Â∞Ü‰πãÂâçÊò†Â∞ÑÂú®‰∏¥Êó∂Âú∞ÂùÄÁöÑÂÜÖÂ≠òÁßªÂä®Âà∞ÈïúÂÉè‰∏≠ËÆ∞ÂΩïÁöÑ<strong>ÊúÄÁªàËôöÊãüÂú∞ÂùÄ</strong>„ÄÇ‰ΩøÁî® mmap() Âú®Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆÂàõÂª∫Êñá‰ª∂Êò†Â∞ÑÂíåÂÖ±‰∫´ÂÜÖÂ≠òÊò†Â∞Ñ„ÄÇËá≥Ê≠§ÔºåËøõÁ®ãÁöÑÂÜÖÂ≠òÂ∏ÉÂ±Ä‰∏é Checkpoint Êó∂ÂÆåÂÖ®‰∏ÄËá¥„ÄÇ</li>
<li><strong>Â°´ÂÖÖÂÜÖÂ≠òÊï∞ÊçÆ</strong>: Â∞ÜÈïúÂÉèÊñá‰ª∂‰∏≠‰øùÂ≠òÁöÑÂÜÖÂ≠òÈ°µÊï∞ÊçÆÔºåÈÄöËøá read() ÊàñÁ±ª‰ººÊñπÂºèÂÜôÂõûÂà∞Áõ∏Â∫îÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇ</li>
<li><strong>ÊÅ¢Â§çÁ∫øÁ®ã</strong>: Âú®ÊúÄÁªàÁöÑÂÜÖÂ≠òÂ∏ÉÂ±Ä‰∏≠ÔºåÊ†πÊçÆ‰øùÂ≠òÁöÑÁä∂ÊÄÅÂàõÂª∫Âπ∂ÊÅ¢Â§çËøõÁ®ãÁöÑÊâÄÊúâÂÖ∂‰ªñÁ∫øÁ®ã„ÄÇ</li>
<li><strong>ÊÅ¢Â§çÂØÑÂ≠òÂô®</strong>: ‰ΩøÁî® ptrace(PTRACE_SETREGS, &hellip;)ÔºàÊàñËÄÖÂú®ÊÅ¢Â§çÂô®‰ª£Á†ÅÂÜÖÈÉ®ÈÄöËøáÁâπÂÆöÊú∫Âà∂ÔºâÂ∞ÜÊØè‰∏™Á∫øÁ®ãÁöÑ CPU ÂØÑÂ≠òÂô®ÔºàÁâπÂà´ÊòØÊåá‰ª§ÊåáÈíà IP/PC ÂíåÊ†àÊåáÈíà SPÔºâ<strong>Á≤æÁ°ÆÂú∞ËÆæÁΩÆ</strong>‰∏∫ Checkpoint Êó∂‰øùÂ≠òÁöÑÂÄº„ÄÇ</li>
<li><strong>ÊÅ¢Â§çÂÖ∂‰ªñÁªÜËäÇ</strong>: ÊÅ¢Â§çÂÆöÊó∂Âô®„ÄÅÂá≠ËØÅÁ≠â„ÄÇ</li>
</ul>
</li>
</ul>
</li>
<li><strong>‚ÄúÁÇπÁÅ´‚ÄùÂêØÂä®</strong>: ÂΩìÊâÄÊúâÁä∂ÊÄÅÈÉΩÊÅ¢Â§çÂÆåÊØïÔºåÊÅ¢Â§çÂô®‰ª£Á†Å‰ºöÊâßË°åÊúÄÂêé‰∏ÄÊ≠•‚Äî‚ÄîÈÄöÂ∏∏ÊòØ‰∏Ä‰∏™ÁâπÊÆäÁöÑËøîÂõûÊàñË∑≥ËΩ¨Êåá‰ª§ÔºåÂ∞Ü CPU ÁöÑÊéßÂà∂ÊùÉÂΩªÂ∫ï‰∫§ËøòÁªôÊÅ¢Â§çÂêéÁöÑËøõÁ®ãÔºà‰∏ªÁ∫øÁ®ãÔºâ„ÄÇÁî±‰∫éÊåá‰ª§ÊåáÈíàÂ∑≤ÁªèË¢´Á≤æÁ°ÆËÆæÁΩÆÔºåËøõÁ®ã‰ºö‰ªé Checkpoint Êó∂Ë¢´‰∏≠Êñ≠ÁöÑÈÇ£Êù°Êåá‰ª§<strong>Êó†ÁºùÂú∞ÁªßÁª≠ÊâßË°å</strong>Ôºå‰ªø‰Ωõ‰ªéÊú™Ë¢´ÊâìÊñ≠Ëøá„ÄÇ</li>
<li><strong>ÁÆ°ÁêÜ Restore ÊµÅÁ®ã (execv Èìæ)</strong>: ÂâçÈù¢ÊèêÂà∞ÔºåCRaC ÁöÑ java -XX:CRaCRestoreFrom=&hellip; ÂëΩ‰ª§ÂêØÂä®ÂêéÔºå‰ºöÈÄöËøá criuengine Ëøô‰∏™ËæÖÂä©Á®ãÂ∫èÊù•ÂçèË∞É Restore„ÄÇËøô‰∏™ËøáÁ®ãÊ∂âÂèäÂ§öÊ¨° execv Ë∞ÉÁî®ÔºöÂàùÂßã Java ÂëΩ‰ª§ execv ÂèòÊàê criuengine restoreÔºåÂêéËÄÖÂÜç execv ÂèòÊàê criu restore Êù•ÊâßË°åÁúüÊ≠£ÁöÑÊÅ¢Â§çÊìç‰Ωú„ÄÇÂΩì criu restore ÊàêÂäüÊÅ¢Â§çÁõÆÊ†á JVM ËøõÁ®ãÂêéÔºåÂÆÉ‰ºöÂÜçÊ¨° execv ÂèòÊàê criuengine restorewaitÔºåËøô‰∏™ÊúÄÁªàÁöÑËøõÁ®ãË¥üË¥£Á≠âÂæÖÊÅ¢Â§çÂêéÁöÑ JVM ËøõÁ®ãÁªìÊùüÔºåÂπ∂Â∞Ü JVM ÁöÑÈÄÄÂá∫Áä∂ÊÄÅ‰º†ÈÄíÂõûÂéª„ÄÇ</li>
</ol>
<p>ÈÄöËøáËøô‰∏ÄÁ≥ªÂàóÂ§çÊùÇËÄåÁ≤æÂØÜÁöÑÊ≠•È™§ÔºåÁªìÂêàÂØπ /proc ÁöÑËØªÂèñÂíåÂØπ ptrace ÁöÑÊ∑±Â∫¶ËøêÁî®ÔºåCRIU ÂÆûÁé∞‰∫ÜÂú®Áî®Êà∑Á©∫Èó¥ÂØπËøêË°å‰∏≠ËøõÁ®ãËøõË°åÂø´ÁÖßÂíåÊÅ¢Â§çÁöÑÂº∫Â§ßËÉΩÂäõÔºå‰∏∫ CRaC ÊäÄÊúØÁöÑÂÆûÁé∞Â•†ÂÆö‰∫ÜÂùöÂÆûÁöÑÂü∫Á°Ä„ÄÇ</p>
<p>ÁêÜËß£‰∫Ü CRIU ÁöÑÂü∫Êú¨Â∑•‰ΩúÂéüÁêÜÂêéÔºåÊàë‰ª¨Â∞±ËÉΩÊõ¥Â•ΩÂú∞ÁêÜËß£ CRaC ‰∏∫‰ΩïËøòÈúÄË¶Å‰∏Ä‰∏™‚ÄúÂçèË∞É‚ÄùÂ±Ç„ÄÇÊé•‰∏ãÊù•ÔºåÊàë‰ª¨Â∞ÜÊé¢ËÆ® CRaC ÁöÑ Resource API Â≠òÂú®ÁöÑÊÑè‰πâ„ÄÇ</p>
<h2 id="crac-Â¶Ç‰ΩïÊåáÊå•-criu">
    <a href="#crac-%e5%a6%82%e4%bd%95%e6%8c%87%e6%8c%a5-criu" class="header-anchor">#</a>
    CRaC Â¶Ç‰ΩïÊåáÊå• CRIU
</h2><p>Êàë‰ª¨Â∑≤Áªè‰∫ÜËß£‰∫Ü CRIU Â¶Ç‰ΩïÂà©Áî® Linux ÁöÑÂ∫ïÂ±ÇÊú∫Âà∂Êù•ÂÆûÁé∞ËøõÁ®ãÁöÑ Checkpoint Âíå Restore„ÄÇ‰ΩÜ CRaC (Coordinated Restore at Checkpoint) Êú¨Ë∫´Âπ∂‰∏çÁõ¥Êé•ÊâßË°åËøô‰∫õÂ§çÊùÇÁöÑÂ∫ïÂ±ÇÊìç‰Ωú„ÄÇÁõ∏ÂèçÔºåCRaC Êõ¥ÂÉèÊòØ‰∏Ä‰∏™<strong>ÊåáÊå•ÂÆò</strong>ÔºåÂÆÉÈÄöËøáÂçèË∞É JVM ÂÜÖÈÉ®Áä∂ÊÄÅÂíåÂ§ñÈÉ®ËµÑÊ∫êÔºåÂπ∂Âú®ÊÅ∞ÂΩìÁöÑÊó∂Êú∫<strong>Ë∞ÉÁî®</strong> CRIU Êù•ÂÆåÊàêÂÆûÈôÖÁöÑ‚ÄúÂÜªÁªì‚Äù‰∏é‚ÄúÂ§çËãè‚ÄùÂ∑•‰Ωú„ÄÇËøôÁßçË∞ÉÁî®ÈÄöÂ∏∏ÊòØÈÄöËøá‰∏Ä‰∏™ËæÖÂä©Á®ãÂ∫èÔºàÂú® OpenJDK CRaC ÂÆûÁé∞‰∏≠Áß∞‰∏∫ criuengineÔºâÊù•Èó¥Êé•ÂÆåÊàêÁöÑ„ÄÇËøô‰∏™ËøáÁ®ã‰∏≠ÔºåLinux ÁöÑËøõÁ®ãÂàõÂª∫„ÄÅÊõøÊç¢ÂíåÁÆ°ÁêÜÊäÄÊúØÔºåÁâπÂà´ÊòØ fork„ÄÅexecv Âíå double forkÔºåÊâÆÊºî‰∫ÜËá≥ÂÖ≥ÈáçË¶ÅÁöÑËßíËâ≤„ÄÇ</p>
<h3 id="checkpoint-ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ã‰πãËàû-double-fork">
    <a href="#checkpoint-%e6%b5%81%e7%a8%8b%e4%b8%ad%e7%9a%84%e8%bf%9b%e7%a8%8b%e4%b9%8b%e8%88%9e-double-fork" class="header-anchor">#</a>
    Checkpoint ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ã‰πãËàû (double fork)
</h3><p>ÂΩìÁî®Êà∑ÈÄöËøá jcmd &lt;pid&gt; JDK.checkpoint ÂëΩ‰ª§Ëß¶Âèë CRaC ÁöÑ Checkpoint Êó∂Ôºå‰∏ÄÂú∫Á≤æÂøÉÁºñÊéíÁöÑËøõÁ®ã‰∫§‰∫íÂ∞±ÂºÄÂßã‰∫ÜÔºö</p>
<ol>
<li><strong>JVM ÂÜÖÈÉ®ÂáÜÂ§á</strong>: JVM Êé•Êî∂Âà∞ÂëΩ‰ª§ÂêéÔºå‰ºöÊâßË°å‰∏Ä‰∫õÂáÜÂ§áÂ∑•‰ΩúÔºåÊØîÂ¶ÇËß¶Âèë‰∏ÄÊ¨° Full GC Êù•ÂáèÂ∞èÈïúÂÉè‰ΩìÁßØÔºåÁÑ∂ÂêéËøõÂÖ•‰∏Ä‰∏™ÂÖ®Â±ÄÂÆâÂÖ®ÁÇπÔºàSafepointÔºâÔºåÊöÇÂÅúÊâÄÊúâ Java Á∫øÁ®ã„ÄÇ</li>
<li><strong>ÂêØÂä®Â§ñÈÉ®ÂºïÊìé</strong>: JVM Ë∞ÉÁî® fork() ÂàõÂª∫‰∏Ä‰∏™Â≠êËøõÁ®ã (Êàë‰ª¨Áß∞‰πã‰∏∫ P1)ÔºåËøô‰∏™Â≠êËøõÁ®ã P1 ÁöÑ‰ªªÂä°ÊòØÊâßË°å criuengine checkpoint ÂëΩ‰ª§„ÄÇJVM ‰∏ªËøõÁ®ãÂàô‰ºöÊöÇÂÅúÔºåÁ≠âÂæÖ P1 ÁöÑÊüêÁßçÂΩ¢ÂºèÁöÑÂÆåÊàê‰ø°Âè∑ÊàñÈÄÄÂá∫„ÄÇ</li>
<li><strong>double fork ÁôªÂú∫</strong>: ËøôÈáåÁöÑÂÖ≥ÈîÆÂú®‰∫é criuengine (P1) Â¶Ç‰ΩïË∞ÉÁî® criu dump Êù•ÂÜªÁªìÂéüÂßãÁöÑ JVM ËøõÁ®ã„ÄÇÂ¶ÇÊûú P1 Áõ¥Êé•Ë∞ÉÁî® criu dumpÔºåÈÇ£‰πà criu ËøõÁ®ãÂ∞±‰ºöÊòØ JVM ÁöÑÂ≠ôÂ≠êËøõÁ®ãÔºå‰ªçÁÑ∂Â±û‰∫éÂêå‰∏Ä‰∏™ËøõÁ®ãÁªÑÔºåËøôÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÂèØËÉΩÂØºËá¥ÈóÆÈ¢òÔºàÊØîÂ¶ÇÂ∞ùËØïÂÜªÁªìËá™Â∑±ÊâÄÂú®ÁöÑËøõÁ®ãÁªÑÔºâ„ÄÇ‰∏∫‰∫ÜÂΩªÂ∫ïËß£ËÄ¶Ôºåcriuengine ‰ΩøÁî®‰∫Ü double fork ÊäÄÂ∑ßÔºö
<ul>
<li>P1 (criuengine checkpoint) Ë∞ÉÁî® fork() ÂàõÂª∫Â≠êËøõÁ®ã P2„ÄÇÁÑ∂Âêé P1 ‰ºöÁ≠âÂæÖ P2 ÈÄÄÂá∫„ÄÇ</li>
<li>P2 <strong>ÂÜçÊ¨°</strong>Ë∞ÉÁî® fork() ÂàõÂª∫Â≠ôÂ≠êËøõÁ®ã P3„ÄÇ</li>
<li>P2 <strong>Á´ãÂç≥ÈÄÄÂá∫</strong> (exit())„ÄÇ</li>
<li>P1 Ê£ÄÊµãÂà∞ P2 ÈÄÄÂá∫ÂêéÔºåP1 ‰πüÈÄÄÂá∫„ÄÇ</li>
<li>Ê≠§Êó∂ÔºåP3 Êàê‰∏∫‰∫Ü<strong>Â≠§ÂÑøËøõÁ®ã</strong>ÔºåÂÖ∂Áà∂ËøõÁ®ãË¢´Á≥ªÁªü init ËøõÁ®ãÔºàPID 1ÔºâÊé•ÁÆ°„ÄÇP3 Áé∞Âú®‰∏éÂéüÂßãÁöÑ JVM ËøõÁ®ãÔºàÂÆÉÁöÑ‚ÄúÊõæÁ•ñÁà∂‚ÄùÔºâÂú®ËøõÁ®ãÊ†ë‰∏äÂ∑≤ÁªèÊ≤°ÊúâÁõ¥Êé•ÂÖ≥Á≥ª‰∫Ü„ÄÇ</li>
</ul>
</li>
<li><strong>ÊâßË°åÂÜªÁªì</strong>: Êàê‰∏∫Â≠§ÂÑøÁöÑ P3 ËøõÁ®ãÁé∞Âú®ÂèØ‰ª•ÂÆâÂÖ®Âú∞ÊâßË°å criu dump -t &lt;jvm_pid&gt; &hellip; ÂëΩ‰ª§ÔºåÁõÆÊ†áÁõ¥ÊåáÂéüÂßãÁöÑ„ÄÅÊ≠£Âú®Á≠âÂæÖÁöÑ JVM ËøõÁ®ã„ÄÇcriu Âà©Áî®Êàë‰ª¨‰πãÂâçËÆ®ËÆ∫ÁöÑ /proc Âíå ptrace ÊäÄÊúØÔºåÂ∞Ü JVM ÁöÑÂÆåÊï¥Áä∂ÊÄÅ‰øùÂ≠òÂà∞ÈïúÂÉèÊñá‰ª∂‰∏≠„ÄÇ</li>
<li><strong>ÁªàÁªì‰∏éÁ≠âÂæÖ</strong>: criu dump Âú®ÊàêÂäüÂàõÂª∫ÈïúÂÉèÂêéÔºåÈÄöÂ∏∏‰ºö<strong>ÊùÄÊ≠ª</strong> (kill) Ë¢´ÂÜªÁªìÁöÑÂéüÂßã JVM ËøõÁ®ã„ÄÇËÄåÂéüÂßã JVM ËøõÁ®ãÂú® fork Âá∫ P1 ÂêéÔºåÂÆûÈôÖ‰∏äÂπ∂Ê≤°ÊúâÂÆåÂÖ®ÈòªÂ°ûÔºåÂÆÉ‰ºöÁªßÁª≠ÊâßË°å‰∏ÄÂ∞èÊÆµ‰ª£Á†ÅÔºåÈÄöÂ∏∏ÊòØËøõÂÖ•‰∏Ä‰∏™ sigwaitinfo() Ë∞ÉÁî®ÔºåÁ≠âÂæÖ‰∏Ä‰∏™ÁâπÂÆöÁöÑ‰ø°Âè∑ÔºàRESTORE_SIGNALÔºâÔºåËøô‰∏™‰ø°Âè∑Âè™ÊúâÂú®Êú™Êù•ÁöÑ Restore ËøáÁ®ã‰∏≠Êâç‰ºöË¢´ÂèëÈÄÅ„ÄÇ‰ΩÜÂú®Ê≠§‰πãÂâçÔºåÂÆÉÂ∞±Ë¢´ criu dump ÁªìÊùü‰∫ÜÁîüÂëΩ„ÄÇ</li>
</ol>
<p>ÈÄöËøá double forkÔºåCRaC Â∑ßÂ¶ôÂú∞Á°Æ‰øù‰∫ÜÊâßË°åÂÜªÁªìÊìç‰ΩúÁöÑ criu ËøõÁ®ãÁã¨Á´ã‰∫éË¢´ÂÜªÁªìÁöÑ JVM ËøõÁ®ãÊ†ë‰πãÂ§ñÔºå‰øùËØÅ‰∫Ü Checkpoint Êìç‰ΩúÁöÑÂπ≤ÂáÄÂíåÂèØÈù†„ÄÇ</p>
<h3 id="restore-ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ãÂèòË∫´-execv-Èìæ">
    <a href="#restore-%e6%b5%81%e7%a8%8b%e4%b8%ad%e7%9a%84%e8%bf%9b%e7%a8%8b%e5%8f%98%e8%ba%ab-execv-%e9%93%be" class="header-anchor">#</a>
    Restore ÊµÅÁ®ã‰∏≠ÁöÑËøõÁ®ã‚ÄúÂèòË∫´‚Äù (execv Èìæ)
</h3><p>Restore ËøáÁ®ãÂàôÂ±ïÁ§∫‰∫Ü execv Á≥ªÁªüË∞ÉÁî®ÁöÑÂ®ÅÂäõÔºåÂÆÉÂÖÅËÆ∏‰∏Ä‰∏™ËøõÁ®ãÁî®‰∏Ä‰∏™ÂÖ®Êñ∞ÁöÑÁ®ãÂ∫èÊò†ÂÉèÊõøÊç¢Ëá™Â∑±ÔºåÂÆûÁé∞‚ÄúÂéüÂú∞ÂèòË∫´‚ÄùÔºö</p>
<ol>
<li><strong>ÂêØÂä® Restore ÂëΩ‰ª§</strong>: Áî®Êà∑ÊâßË°å java -XX:CRaCRestoreFrom=&lt;checkpoint_dir&gt;„ÄÇ</li>
<li><strong>JVM ÁöÑ‚ÄúÊîπÈÅì‚Äù</strong>: Ëøô‰∏™ Java ÂëΩ‰ª§ÂêØÂä®ÁöÑ JVM ËøõÁ®ãÔºàÊàë‰ª¨Áß∞‰πã‰∏∫ P1ÔºâÂú®ÈùûÂ∏∏Êó©ÊúüÁöÑÂàùÂßãÂåñÈò∂ÊÆµÔºåÂ∞±‰ºöÊ£ÄÊµãÂà∞ -XX:CRaCRestoreFrom ÂèÇÊï∞„ÄÇÂÆÉ<strong>‰∏ç‰ºö</strong>ÁªßÁª≠ÊâßË°åÊ†áÂáÜÁöÑ JVM ÂêØÂä®ÊµÅÁ®ãÔºåËÄåÊòØÁ´ãÂç≥‚ÄúÊîπÈÅì‚Äù„ÄÇ</li>
<li><strong>Á¨¨‰∏ÄÊ¨°ÂèòË∫´ (execv)</strong>: P1 Ë∞ÉÁî® execv()ÔºåÂ∞ÜÂÖ∂Ëá™Ë∫´ÊõøÊç¢‰∏∫ criuengine restore Á®ãÂ∫è„ÄÇÊ≠§Êó∂ÔºåÂéüÊù•ÁöÑ java ËøõÁ®ã P1 ‰∏çÂ§çÂ≠òÂú®ÔºåÂèñËÄå‰ª£‰πãÁöÑÊòØËøêË°åÁùÄ criuengine restore ‰ª£Á†ÅÁöÑËøõÁ®ãÔºàÊàë‰ª¨Áß∞‰πã‰∏∫ P2ÔºåÂ∞ΩÁÆ° PID ÂèØËÉΩ‰∏é P1 Áõ∏ÂêåÔºâ„ÄÇ</li>
<li><strong>Á¨¨‰∫åÊ¨°ÂèòË∫´ (execv)</strong>: P2 (criuengine restore) Ë¥üË¥£Ëß£ÊûêÂèÇÊï∞ÔºåÂáÜÂ§áÂ•ΩË∞ÉÁî® criu ÊâÄÈúÄÁöÑÁéØÂ¢ÉÔºåÁÑ∂ÂêéÂÜçÊ¨°Ë∞ÉÁî® execv()ÔºåÂ∞ÜËá™Ë∫´ÊõøÊç¢‰∏∫ criu restore Á®ãÂ∫èÔºàÊàë‰ª¨Áß∞‰πã‰∏∫ P3Ôºâ„ÄÇ</li>
<li><strong>CRIU ÊâßË°åÊÅ¢Â§ç</strong>: P3 (criu restore) ËØªÂèñÈïúÂÉèÊñá‰ª∂ÔºåÂà©Áî® fork„ÄÅmmap„ÄÅptrace Á≠âÊäÄÊúØÔºåÂú®ÂÜÖÂ≠ò‰∏≠ÈÄêÊ≠•ÈáçÂª∫ JVM ËøõÁ®ãÁöÑÁä∂ÊÄÅ„ÄÇËøô‰∏™ÊÅ¢Â§çËøáÁ®ãÂèØËÉΩÁõ∏ÂΩìÂ§çÊùÇÔºåÊ∂âÂèäÂàõÂª∫Êñ∞ÁöÑËøõÁ®ãÔºàÊÅ¢Â§çÂêéÁöÑ JVMÔºâÔºåËÆæÁΩÆÂÜÖÂ≠òÔºåÊÅ¢Â§çÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÊÅ¢Â§çÁ∫øÁ®ãÁ≠â„ÄÇ</li>
<li><strong>Âî§ÈÜí‰∏é‰∫§Êé•</strong>: Âú®ÊÅ¢Â§çÁöÑÁõÆÊ†á JVM ËøõÁ®ãÁä∂ÊÄÅÂü∫Êú¨Â∞±Áª™Ôºå‰ΩÜÂ∞öÊú™ÂºÄÂßãÊâßË°åÁî®Êà∑‰ª£Á†ÅÊó∂ÔºåP3 (criu restore) ‰ºöÈÄöËøáÂÖ∂ÈÖçÁΩÆÁöÑÂä®‰ΩúËÑöÊú¨ÔºàÈÄöÂ∏∏ÊòØ criuengine Ëá™Ë∫´ÔºâÂêëÊÅ¢Â§çÂêéÁöÑ JVM ËøõÁ®ãÂèëÈÄÅ‰∏Ä‰∏™ÁâπÂÆöÁöÑ‰ø°Âè∑ÔºàÂ¶Ç RESTORE_SIGNALÔºâÔºåËøô‰∏™‰ø°Âè∑‰ºöÂî§ÈÜí JVM ÂÜÖÈÉ®Á≠âÂæÖÁöÑ‰ª£Á†ÅÔºàËøòËÆ∞Âæó Checkpoint ÊúÄÂêé JVM Á≠âÂæÖÁöÑ sigwaitinfo ÂêóÔºüÊÅ¢Â§çÂêéÁöÑ JVM Â∞±‰ªéËøôÈáå‚ÄúÈÜíÊù•‚ÄùÔºâ„ÄÇ</li>
<li><strong>Á¨¨‰∏âÊ¨°ÂèòË∫´ (execv)</strong>: Âú®ÊàêÂäüÊÅ¢Â§ç JVM Âπ∂ÂèëÈÄÅÂî§ÈÜí‰ø°Âè∑ÂêéÔºåP3 (criu restore) ËøõÁ®ãÁöÑ‰ªªÂä°‰πüÂç≥Â∞ÜÁªìÊùü„ÄÇÊ†πÊçÆÂêØÂä®Êó∂ÈÄöËøá --exec-cmd ÂèÇÊï∞ÁöÑÊåáÁ§∫ÔºåÂÆÉ‰ºöÊâßË°åÊúÄÂêé‰∏ÄÊ¨° execv()ÔºåÂ∞ÜËá™Ë∫´ÊõøÊç¢‰∏∫ criuengine restorewait Á®ãÂ∫èÔºàÊàë‰ª¨Áß∞‰πã‰∏∫ P4Ôºâ„ÄÇ</li>
<li><strong>ÂÆàÊúõËÄÖ (waitpid)</strong>: P4 (criuengine restorewait) ÁöÑÂîØ‰∏Ä‰ΩøÂëΩÂ∞±ÊòØÊâÆÊºî‰∏Ä‰∏™‚ÄúÂÆàÊúõËÄÖ‚Äù„ÄÇÂÆÉÁü•ÈÅìÂàöÂàöÊÅ¢Â§çÁöÑ JVM ËøõÁ®ãÁöÑ PIDÔºåÁÑ∂ÂêéË∞ÉÁî® waitpid() Á≠âÂæÖËøô‰∏™ JVM ËøõÁ®ãÁªìÊùü„ÄÇÂΩì JVM ÊúÄÁªàÈÄÄÂá∫Êó∂ÔºåP4 ‰ºöËé∑ÂèñÂÖ∂ÈÄÄÂá∫Áä∂ÊÄÅÔºåÂπ∂‰ª•Áõ∏ÂêåÁöÑÁä∂ÊÄÅÈÄÄÂá∫„ÄÇËøôÊ†∑ÔºåÊúÄÂàùÂêØÂä® java -XX:CRaCRestoreFrom=&hellip; ÂëΩ‰ª§ÁöÑÁî®Êà∑Â∞±ËÉΩÂæóÂà∞ÊÅ¢Â§çÂêé JVM ÁöÑÊúÄÁªàÊâßË°åÁªìÊûú„ÄÇ</li>
</ol>
<p>Âú®Ëøô‰∏™ execv Ë∞ÉÁî®Èìæ‰∏≠ÔºåÊéßÂà∂ÊùÉË¢´Âπ≥ÊªëÂú∞‰ªéÂàùÂßãÁöÑ Java ÂëΩ‰ª§‰º†ÈÄíÁªô criuengineÔºåÂÜçÂà∞ criu Êú¨Ë∫´ÔºåÊúÄÂêé‰∫§Êé•ÁªôË¥üË¥£Á≠âÂæÖÁöÑ criuengine restorewait„ÄÇÊï¥‰∏™ËøáÁ®ã‰∏≠ÔºåËøõÁ®ãÁöÑË∫´‰ªΩÔºàÊâßË°åÁöÑÁ®ãÂ∫èÔºâ‰∏çÊñ≠ÂèòÂåñÔºå‰ΩÜÈÄöÂ∏∏ÊòØÂú®Âêå‰∏Ä‰∏™ËøõÁ®ã ID ‰∏ãÂÆåÊàêÔºàÈô§‰∫Ü criu restore ÂÜÖÈÉ®ÈáçÂª∫ JVM Êó∂‰ºöÂàõÂª∫Êñ∞ËøõÁ®ãÔºâÔºåÈ´òÊïàÂú∞Âà©Áî®‰∫ÜÁé∞ÊúâÁöÑËøõÁ®ã‰∏ä‰∏ãÊñáÊù•ÊâßË°å‰∏çÂêåÁöÑ‰ªªÂä°Èò∂ÊÆµ„ÄÇ</p>
<p>ÊÄªÁªìÊù•ËØ¥ÔºåCRaC Âπ∂ÈùûÈ≠îÊ≥ïÔºåËÄåÊòØÂª∫Á´ãÂú®ÂØπ Linux ËøõÁ®ãÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜÁöÑÊ∑±ÂàªÁêÜËß£ÂíåÂ∑ßÂ¶ôËøêÁî®‰πã‰∏ä„ÄÇÂÆÉÈÄöËøáËæÖÂä©Á®ãÂ∫èÔºåÁ≤æÁ°ÆÂú∞ÁºñÊéí fork„ÄÅexecv„ÄÅwaitpid Á≠âÁ≥ªÁªüË∞ÉÁî®ÔºåÊåáÊå• CRIU Ëøô‰Ωç‚ÄúÂ∫ïÂ±ÇÂ§ßÂ∏à‚ÄùÂÆåÊàêÂ§çÊùÇÁöÑ Checkpoint Âíå Restore Êìç‰ΩúÔºåÊúÄÁªàÂÆûÁé∞‰∫Ü Java Â∫îÁî®ÂêØÂä®ÊÄßËÉΩÁöÑÂ∑®Â§ßÈ£ûË∑É„ÄÇ</p>
<h2 id="ÊÄªÁªìlinux-Á≥ªÁªüÁºñÁ®ãÊòØ-crac-ÁöÑÂü∫Áü≥">
    <a href="#%e6%80%bb%e7%bb%93linux-%e7%b3%bb%e7%bb%9f%e7%bc%96%e7%a8%8b%e6%98%af-crac-%e7%9a%84%e5%9f%ba%e7%9f%b3" class="header-anchor">#</a>
    ÊÄªÁªìÔºöLinux Á≥ªÁªüÁºñÁ®ãÊòØ CRaC ÁöÑÂü∫Áü≥
</h2><p>ÂõûÈ°æÂÖ®ÊñáÔºåÊàë‰ª¨‰∏ÄËµ∑Êé¢Á¥¢‰∫Ü CRaC ÊäÄÊúØËÉåÂêéÊâÄ‰æùËµñÁöÑÂÖ≥ÈîÆ Linux Á≥ªÁªüÁºñÁ®ãÊ¶ÇÂøµ„ÄÇ‰ªéÂü∫Êú¨ÁöÑËøõÁ®ã‰∏éÁ∫øÁ®ãÊ®°Âûã„ÄÅÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜÔºàfork, execv, waitpid, double forkÔºâÔºåÂà∞Âº∫Â§ßÁöÑËøõÁ®ãÁä∂ÊÄÅ‚ÄúÈÄèËßÜÈïú‚Äù /proc Êñá‰ª∂Á≥ªÁªüÔºåÂÜçÂà∞ËÉΩÂ§üÁ≤æÁªÜÊéßÂà∂ËøõÁ®ãÁöÑ‚ÄúÈÅ•ÊéßÂô®‚Äùptrace Á≥ªÁªüË∞ÉÁî®ÔºåËøô‰∫õÈÉΩÊòØ Linux Êèê‰æõÁöÑÂ∫ïÂ±ÇËÉΩÂäõ„ÄÇ</p>
<p>Êàë‰ª¨ÁúãÂà∞ÔºåCRIU Ê≠£ÊòØÂ∑ßÂ¶ôÂú∞ÁªÑÂêàËøêÁî®‰∫ÜËøô‰∫õÊú∫Âà∂ÔºåÊâçÂæó‰ª•Âú®Áî®Êà∑Á©∫Èó¥ÂÆûÁé∞ÂØπËøêË°å‰∏≠ËøõÁ®ãËøõË°åÁ≤æÁ°Æ Checkpoint Âíå Restore ÁöÑÂ§çÊùÇÊìç‰Ωú„ÄÇËÄå CRaC ÂàôÊõ¥Ëøõ‰∏ÄÊ≠•ÔºåÈÄöËøáÂçèË∞É JVM ÂÜÖÈÉ®Áä∂ÊÄÅÂíåÂ§ñÈÉ®ËµÑÊ∫êÔºåÂπ∂ÊåáÊå• CRIU ÂÆåÊàêÊ†∏ÂøÉÁöÑÂÜªÁªì‰∏éÂ§çËãè‰ªªÂä°ÔºåÊúÄÁªàËææÊàê‰∫ÜÂ§ßÂπÖ‰ºòÂåñ Java Â∫îÁî®ÂêØÂä®ÊÄßËÉΩÁöÑÁõÆÊ†á„ÄÇ</p>
<p>Âõ†Ê≠§ÔºåÁêÜËß£Ëøô‰∫õ Linux Á≥ªÁªüÁºñÁ®ãÁöÑÁü•ËØÜÔºå‰∏ç‰ªÖËÉΩÂ∏ÆÂä©Êàë‰ª¨Êè≠ÂºÄ CRaC ÂÆûÁé∞ÂéüÁêÜÁöÑÁ•ûÁßòÈù¢Á∫±ÔºåÊõ¥ËÉΩËÆ©Êàë‰ª¨‰Ωì‰ºöÂà∞Áé∞‰ª£ËΩØ‰ª∂ÊäÄÊúØÂàõÊñ∞ÂæÄÂæÄÊòØÂª∫Á´ãÂú®ÂØπÂ∫ïÂ±ÇÁ≥ªÁªüÊ∑±ÂàªÁêÜËß£ÂíåÂàõÈÄ†ÊÄßÂ∫îÁî®ÁöÑÂü∫Á°Ä‰πã‰∏ä„ÄÇÂ∏åÊúõÊú¨ÊñáËÉΩ‰∏∫ÊÇ®ÊâìÂºÄ‰∏ÄÊâáÈÄöÂæÄ Linux Á≥ªÁªüÁºñÁ®ã‰∏ñÁïåÁöÑÂ∞èÁ™óÔºåÊøÄÂèëÊÇ®Ëøõ‰∏ÄÊ≠•Êé¢Á¥¢ÁöÑÂÖ¥Ë∂£„ÄÇ</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/linux/">Linux</a>
        
            <a href="/tags/java/">Java</a>
        
            <a href="/tags/crac/">Crac</a>
        
            <a href="/tags/performance/">Performance</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/crac-%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/">
        
        

        <div class="article-details">
            <h2 class="article-title">CRaC ÊäÄÊúØÊ∑±Â∫¶Ëß£Êûê</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%8F%AD%E7%A7%98-jvm-%E5%81%9C%E9%A1%BF%E7%9A%84%E8%83%8C%E5%90%8E%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-safepoint/">
        
        

        <div class="article-details">
            <h2 class="article-title">Êè≠Áßò JVM ÂÅúÈ°øÁöÑËÉåÂêéÔºöÊ∑±ÂÖ•ÁêÜËß£ Safepoint</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/perf-%E7%9A%84-cpu-clock-%E4%B8%8E-cpu-cycles-%E9%87%87%E6%A0%B7%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%AF%B9%E6%AF%94/">
        
        

        <div class="article-details">
            <h2 class="article-title">Perf ÁöÑ cpu-clock ‰∏é cpu-cycles ÈááÊ†∑ÂÆûÁé∞‰∏éÂØπÊØî</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/wall-clock-%E4%B8%8E-cpu-cycles-%E9%87%87%E6%A0%B7%E7%9A%84%E5%8C%BA%E5%88%AB/">
        
        

        <div class="article-details">
            <h2 class="article-title">Wall-Clock ‰∏é CPU-Cycles ÈááÊ†∑ÁöÑÂå∫Âà´</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%BD%BF%E7%94%A8-printassembly-%E6%9F%A5%E7%9C%8B-jit-%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81/">
        
        

        <div class="article-details">
            <h2 class="article-title">‰ΩøÁî® PrintAssembly Êü•Áúã JIT ÁºñËØëÂêéÁöÑÊ±áÁºñ‰ª£Á†Å</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mazhen-tech" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2014 - 
        
        2025 mazhen.tech
    </section>
    
    <section class="powerby">
        
            <a target=\"_blank\" href=\"https://beian.miit.gov.cn\">Á≤§ ICP Â§á 2022085181 Âè∑ -1</a> <br/>
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.25.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
