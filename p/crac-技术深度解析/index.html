<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="# ÂºïË®Ä Âú®Áé∞‰ª£ËΩØ‰ª∂Êû∂ÊûÑ‰∏≠ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå Serverless ËÆ°ÁÆóÈ¢ÜÂüüÔºåÂ∫îÁî®ÁöÑÂø´ÈÄüÂêØÂä®ÂíåÈ´òÊïàËµÑÊ∫êÂà©Áî®ÂèòÂæóËá≥ÂÖ≥ÈáçË¶Å„ÄÇJava ‰Ωú‰∏∫‰ºÅ‰∏öÁ∫ßÂ∫îÁî®ÂºÄÂèëÁöÑÈ¶ñÈÄâËØ≠Ë®ÄÔºåÂ∞ΩÁÆ°Êã•Êúâ">
<title>CRaC ÊäÄÊúØÊ∑±Â∫¶Ëß£Êûê</title>

<link rel='canonical' href='https://mazhen.tech/p/crac-%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/'>

<link rel="stylesheet" href="/scss/style.min.760e3dabc1e140d2e6abd27a8ca0aabb60e568829b29f67d2df12024136eff37.css"><meta property='og:title' content="CRaC ÊäÄÊúØÊ∑±Â∫¶Ëß£Êûê">
<meta property='og:description' content="# ÂºïË®Ä Âú®Áé∞‰ª£ËΩØ‰ª∂Êû∂ÊûÑ‰∏≠ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå Serverless ËÆ°ÁÆóÈ¢ÜÂüüÔºåÂ∫îÁî®ÁöÑÂø´ÈÄüÂêØÂä®ÂíåÈ´òÊïàËµÑÊ∫êÂà©Áî®ÂèòÂæóËá≥ÂÖ≥ÈáçË¶Å„ÄÇJava ‰Ωú‰∏∫‰ºÅ‰∏öÁ∫ßÂ∫îÁî®ÂºÄÂèëÁöÑÈ¶ñÈÄâËØ≠Ë®ÄÔºåÂ∞ΩÁÆ°Êã•Êúâ">
<meta property='og:url' content='https://mazhen.tech/p/crac-%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/'>
<meta property='og:site_name' content='mazhen.tech'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='linux' /><meta property='article:tag' content='java' /><meta property='article:tag' content='crac' /><meta property='article:tag' content='performance' /><meta property='article:published_time' content='2025-04-28T16:56:24&#43;08:00'/><meta property='article:modified_time' content='2025-04-28T16:56:24&#43;08:00'/>
<meta name="twitter:site" content="@rootletmistake">
    <meta name="twitter:creator" content="@rootletmistake"><meta name="twitter:title" content="CRaC ÊäÄÊúØÊ∑±Â∫¶Ëß£Êûê">
<meta name="twitter:description" content="# ÂºïË®Ä Âú®Áé∞‰ª£ËΩØ‰ª∂Êû∂ÊûÑ‰∏≠ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå Serverless ËÆ°ÁÆóÈ¢ÜÂüüÔºåÂ∫îÁî®ÁöÑÂø´ÈÄüÂêØÂä®ÂíåÈ´òÊïàËµÑÊ∫êÂà©Áî®ÂèòÂæóËá≥ÂÖ≥ÈáçË¶Å„ÄÇJava ‰Ωú‰∏∫‰ºÅ‰∏öÁ∫ßÂ∫îÁî®ÂºÄÂèëÁöÑÈ¶ñÈÄâËØ≠Ë®ÄÔºåÂ∞ΩÁÆ°Êã•Êúâ">
    <link rel="shortcut icon" href="/favicon.png" />

  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-LBEVB8TRX2"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-LBEVB8TRX2');
        }
      </script>
    
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/mazhen_hu6e56901738cd7f8ddabbbe3def51a5b4_111611_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">mazhen.tech</a></h1>
            <h2 class="site-description">Stay hungry. Stay foolish.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='mailto:me@mazhen.tech'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/mz1999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.instagram.com/clippercongo/'
                        target="_blank"
                        title="instagram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="4" />
  <circle cx="12" cy="12" r="3" />
  <line x1="16.5" y1="7.5" x2="16.5" y2="7.501" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/crownrecount'
                        target="_blank"
                        title="telegram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/rootletmistake'
                        target="_blank"
                        title="twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://mazhen.tech/" selected>‰∏≠Êñá</option>
                                
                                    <option value="https://mazhen.tech/en/" >English</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ÂºïË®Ä">ÂºïË®Ä</a></li>
    <li><a href="#‰∏Äcrac-Ê¶ÇËø∞ÂëäÂà´Êº´ÈïøÁ≠âÂæÖ">‰∏Ä„ÄÅCRaC Ê¶ÇËø∞ÔºöÂëäÂà´Êº´ÈïøÁ≠âÂæÖ</a>
      <ol>
        <li><a href="#‰ªÄ‰πàÊòØ-crac">‰ªÄ‰πàÊòØ CRaCÔºü</a></li>
        <li><a href="#crac-ÁöÑÊ†∏ÂøÉ‰ºòÂäø">CRaC ÁöÑÊ†∏ÂøÉ‰ºòÂäø</a></li>
        <li><a href="#crac-ÁöÑÂÖ≥ÈîÆÊ¶ÇÂøµ">CRaC ÁöÑÂÖ≥ÈîÆÊ¶ÇÂøµ</a></li>
      </ol>
    </li>
    <li><a href="#‰∫åcrac-vs-aotÂêØÂä®‰ºòÂåñÁöÑ‰∏§Êù°Ë∑ØÂæÑ">‰∫å„ÄÅCRaC vs. AOTÔºöÂêØÂä®‰ºòÂåñÁöÑ‰∏§Êù°Ë∑ØÂæÑ</a>
      <ol>
        <li><a href="#aot-ÊäÄÊúØÁÆÄ‰ªã">AOT ÊäÄÊúØÁÆÄ‰ªã</a></li>
        <li><a href="#aot-ÁöÑÊåëÊàò‰∏éÂ±ÄÈôê">AOT ÁöÑÊåëÊàò‰∏éÂ±ÄÈôê</a></li>
        <li><a href="#jit-ÁöÑ‰ºòÂäøËøêË°åÊó∂Âä®ÊÄÅ‰ºòÂåñÁöÑÂ®ÅÂäõ">JIT ÁöÑ‰ºòÂäøÔºöËøêË°åÊó∂Âä®ÊÄÅ‰ºòÂåñÁöÑÂ®ÅÂäõ</a></li>
        <li><a href="#jit-ÁöÑ‰∏ªË¶ÅÁº∫ÁÇπ">JIT ÁöÑ‰∏ªË¶ÅÁº∫ÁÇπ</a></li>
        <li><a href="#aot-vs-jit-ÂØπÊØîÊÄªÁªì">AOT vs. JIT ÂØπÊØîÊÄªÁªì</a></li>
        <li><a href="#crac-ÁöÑÂàáÂÖ•ÁÇπ">CRaC ÁöÑÂàáÂÖ•ÁÇπ</a></li>
      </ol>
    </li>
    <li><a href="#‰∏âÂÆûÁé∞ÂéüÁêÜÊ∑±ÂÖ•-crac-ÁöÑÂøÉËÑè">‰∏â„ÄÅÂÆûÁé∞ÂéüÁêÜÔºöÊ∑±ÂÖ• CRaC ÁöÑÂøÉËÑè</a>
      <ol>
        <li><a href="#Âü∫Áü≥criu">Âü∫Áü≥ÔºöCRIU</a>
          <ol>
            <li><a href="#checkpoint-ËøáÁ®ãËØ¶Ëß£">Checkpoint ËøáÁ®ãËØ¶Ëß£</a></li>
            <li><a href="#restore-ËøáÁ®ãËØ¶Ëß£">Restore ËøáÁ®ãËØ¶Ëß£</a></li>
            <li><a href="#criu-Â∞èÁªì">CRIU Â∞èÁªì</a></li>
          </ol>
        </li>
        <li><a href="#crac-ÁöÑËÆæËÆ°ÁêÜÂøµ">CRaC ÁöÑËÆæËÆ°ÁêÜÂøµ</a></li>
        <li><a href="#openjdk-crac-ÂÆûÁé∞Ê¶ÇËßà">OpenJDK CRaC ÂÆûÁé∞Ê¶ÇËßà</a>
          <ol>
            <li><a href="#checkpoint-ÊµÅÁ®ãÊ¶ÇËßà">Checkpoint ÊµÅÁ®ãÊ¶ÇËßà</a></li>
            <li><a href="#checkpoint-ÁöÑËøõÁ®ã‰∫§‰∫í">Checkpoint ÁöÑËøõÁ®ã‰∫§‰∫í</a></li>
            <li><a href="#restore-ÊµÅÁ®ãÊ¶ÇËßà">Restore ÊµÅÁ®ãÊ¶ÇËßà</a></li>
            <li><a href="#restore-ÁöÑËøõÁ®ã‰∫§‰∫í">Restore ÁöÑËøõÁ®ã‰∫§‰∫í</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#Âõõcrac-‰ΩøÁî®ÊåáÂçó">Âõõ„ÄÅCRaC ‰ΩøÁî®ÊåáÂçó</a>
      <ol>
        <li><a href="#‰∏∫‰ΩïÈúÄË¶Å-orgcrac-ÂåÖ">‰∏∫‰ΩïÈúÄË¶Å org.crac ÂåÖ</a></li>
        <li><a href="#Ê∑ªÂä†-orgcrac-api-‰æùËµñ">Ê∑ªÂä† org.crac API ‰æùËµñ</a></li>
        <li><a href="#crac-ÁöÑÂçèË∞ÉÊú∫Âà∂">CRaC ÁöÑÂçèË∞ÉÊú∫Âà∂</a></li>
        <li><a href="#Êñá‰ª∂ÊèèËø∞Á¨¶Á≠ñÁï•-file-descriptor-policies">Êñá‰ª∂ÊèèËø∞Á¨¶Á≠ñÁï• (File Descriptor Policies)</a>
          <ol>
            <li><a href="#ÈÖçÁΩÆÊñπÂºè">ÈÖçÁΩÆÊñπÂºè</a></li>
            <li><a href="#Êñá‰ª∂-file-ËßÑÂàô">Êñá‰ª∂ (file) ËßÑÂàô</a></li>
            <li><a href="#ÁÆ°ÈÅì-pipe-ËßÑÂàô">ÁÆ°ÈÅì (pipe) ËßÑÂàô</a></li>
            <li><a href="#Â•óÊé•Â≠ó-socket-ËßÑÂàô">Â•óÊé•Â≠ó (socket) ËßÑÂàô</a></li>
            <li><a href="#ÂéüÂßãÊñá‰ª∂ÊèèËø∞Á¨¶-filedescriptor-ËßÑÂàô">ÂéüÂßãÊñá‰ª∂ÊèèËø∞Á¨¶ (filedescriptor) ËßÑÂàô</a></li>
            <li><a href="#ÈáçË¶ÅÊèêÁ§∫">ÈáçË¶ÅÊèêÁ§∫</a></li>
          </ol>
        </li>
        <li><a href="#crac-ÂÆûÊàò">CRaC ÂÆûÊàò</a></li>
        <li><a href="#Ê≥®ÊÑè‰∫ãÈ°π">Ê≥®ÊÑè‰∫ãÈ°π</a></li>
      </ol>
    </li>
    <li><a href="#‰∫îcrac-ÁöÑÂ∫îÁî®Âú∫ÊôØ‰∏éÁîüÊÄÅ">‰∫î„ÄÅCRaC ÁöÑÂ∫îÁî®Âú∫ÊôØ‰∏éÁîüÊÄÅ</a>
      <ol>
        <li><a href="#ÁêÜÊÉ≥Â∫îÁî®Âú∫ÊôØ">ÁêÜÊÉ≥Â∫îÁî®Âú∫ÊôØ</a></li>
        <li><a href="#Ê°ÜÊû∂‰∏éÂπ≥Âè∞ÊîØÊåÅ">Ê°ÜÊû∂‰∏éÂπ≥Âè∞ÊîØÊåÅ</a></li>
        <li><a href="#crac-ÈÉ®ÁΩ≤ÊñπÊ°à">CRaC ÈÉ®ÁΩ≤ÊñπÊ°à</a></li>
        <li><a href="#ÊÄßËÉΩÂü∫ÂáÜ">ÊÄßËÉΩÂü∫ÂáÜ</a></li>
        <li><a href="#Êú™Êù•Â±ïÊúõÁîüÊÄÅÊåÅÁª≠ÂÆåÂñÑ">Êú™Êù•Â±ïÊúõÔºöÁîüÊÄÅÊåÅÁª≠ÂÆåÂñÑ</a></li>
      </ol>
    </li>
    <li><a href="#ÂÖ≠apusic-jdk-with-crac-support">ÂÖ≠„ÄÅApusic JDK with CRaC Support</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tech/" >
                Tech
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/crac-%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/">CRaC ÊäÄÊúØÊ∑±Â∫¶Ëß£Êûê</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-04-28</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 42 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="ÂºïË®Ä">
    <a href="#%e5%bc%95%e8%a8%80" class="header-anchor">#</a>
    ÂºïË®Ä
</h2><p>Âú®Áé∞‰ª£ËΩØ‰ª∂Êû∂ÊûÑ‰∏≠ÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂæÆÊúçÂä°Âíå <code>Serverless</code> ËÆ°ÁÆóÈ¢ÜÂüüÔºåÂ∫îÁî®ÁöÑÂø´ÈÄüÂêØÂä®ÂíåÈ´òÊïàËµÑÊ∫êÂà©Áî®ÂèòÂæóËá≥ÂÖ≥ÈáçË¶Å„ÄÇJava ‰Ωú‰∏∫‰ºÅ‰∏öÁ∫ßÂ∫îÁî®ÂºÄÂèëÁöÑÈ¶ñÈÄâËØ≠Ë®ÄÔºåÂ∞ΩÁÆ°Êã•ÊúâÂ∫ûÂ§ßÁöÑÁîüÊÄÅÂíå‰∏∞ÂØåÁöÑÂºÄÂèëÂ∑•ÂÖ∑Ôºå‰ΩÜÂú®ÂêØÂä®ÈÄüÂ∫¶ÊñπÈù¢ÂßãÁªàÈù¢‰∏¥ÊåëÊàò„ÄÇ‰∏éÂéüÁîüÁºñËØëËØ≠Ë®ÄÂíåÈÉ®ÂàÜËÑöÊú¨ËØ≠Ë®ÄÁõ∏ÊØîÔºåJava Â∫îÁî®Âú®ÂêØÂä®ËøáÁ®ã‰∏≠Â≠òÂú®ÊòéÊòæÁöÑÊÄßËÉΩÂ∑ÆË∑ù„ÄÇ‚ÄúÂÜ∑ÂêØÂä®‚ÄùÔºåÂç≥Â∫îÁî®ÂÆû‰æãÈ¶ñÊ¨°ÂêØÂä®ÔºåÊàñÊòØ‰ªé‰ºëÁú†Áä∂ÊÄÅÂî§ÈÜíÊó∂ÔºåÁ≥ªÁªüÈúÄË¶ÅÁªèÂéÜÂ§çÊùÇÁöÑÂàùÂßãÂåñËøáÁ®ãÔºåËøô‰∏ç‰ªÖ‰ºöÂØºËá¥ÊòæËëóÁöÑÊó∂Èó¥Âª∂ËøüÔºåËøò‰ºöÂºïÂèëËµÑÊ∫êÊ∂àËÄóÁöÑÂ≥∞ÂÄº„ÄÇ</p>
<p>ÈÇ£‰πàÔºå‰∏∫‰ªÄ‰πà Java Â∫îÁî®ÁöÑÂÜ∑ÂêØÂä®‰ºöÊØîËæÉÊÖ¢Âë¢ÔºüËøôÂπ∂‰∏ç‰ªÖ‰ªÖÊòØ‰∏Ä‰∏™Âçï‰∏ÄÁöÑÊ≠•È™§ÔºåËÄåÊòØÊ∂âÂèäÂ§ö‰∏™Èò∂ÊÆµÔºåÈÄöÂ∏∏ÂèØ‰ª•ÂàÜ‰∏∫‚Äú<strong>JVM ÂêØÂä®</strong>‚Äù„ÄÅ‚Äú<strong>Â∫îÁî®ÂêØÂä®</strong>‚ÄùÂíå‚Äú<strong>Â∫îÁî®È¢ÑÁÉ≠</strong>‚Äù‰∏â‰∏™‰∏ªË¶ÅËøáÁ®ãÔºö</p>
<ol>
<li><strong>JVM ÂêØÂä® (JVM Start - Áõ∏ÂØπËæÉÂø´):</strong> Ëøô‰∏™Èò∂ÊÆµ‰∏ªË¶ÅÊòØ Java ËôöÊãüÊú∫ÔºàJVMÔºâËá™Ë∫´ÁöÑÂàùÂßãÂåñÔºåÂåÖÊã¨Âä†ËΩΩÊ†∏ÂøÉÂ∫ì„ÄÅÂàùÂßãÂåñÂÜÖÂ≠òÁÆ°ÁêÜÔºàÂ¶ÇÂ†Ü„ÄÅÂûÉÂúæÊî∂ÈõÜÂô®Ôºâ„ÄÅËÆæÁΩÆÂÜÖÈÉ®Êï∞ÊçÆÁªìÊûÑ‰ª•ÂèäËøõË°å‰∏Ä‰∫õÊó©ÊúüÁöÑÂü∫Á°Ä‰ºòÂåñ„ÄÇ</li>
<li><strong>Â∫îÁî®ÂêØÂä® (Application Start - ÈúÄË¶Å‰∏Ä‰∫õÊó∂Èó¥):</strong> Âú® JVM ÂáÜÂ§áÂ•Ω‰πãÂêéÔºåÂºÄÂßãÂä†ËΩΩÂ∫îÁî®Á®ãÂ∫èËá™Ë∫´ÁöÑÁ±ªÂíåÊâÄÊúâ‰æùËµñÂ∫ì„ÄÇËøôÊòØ‰∏Ä‰∏™ÂØÜÈõÜÁöÑËøáÁ®ãÔºåÊ∂âÂèäÊü•Êâæ„ÄÅÈ™åËØÅÂíåËß£ÊûêÂ§ßÈáèÁöÑÁ±ª„ÄÇÁ¥ßÊé•ÁùÄÔºåÂ∫îÁî®Ê°ÜÊû∂ÔºàÂ¶Ç Spring BootÔºâ‰ºöÊâßË°åÂÖ∂ÂàùÂßãÂåñÈÄªËæëÔºöÊâ´ÊèèÁªÑ‰ª∂„ÄÅËß£ÊûêÈÖçÁΩÆ„ÄÅÊûÑÂª∫‰æùËµñÊ≥®ÂÖ•ÂÆπÂô®„ÄÅÂàùÂßãÂåñÁ∫øÁ®ãÊ±†„ÄÅÂª∫Á´ãÊï∞ÊçÆÂ∫ìËøûÊé•Á≠â„ÄÇËøô‰∏™Èò∂ÊÆµÂÆåÊàêÂêéÔºåÂ∫îÁî®ÈÄöÂ∏∏ÂèØ‰ª•Â§ÑÁêÜÁ¨¨‰∏Ä‰∏™ËØ∑Ê±ÇÔºåÂõ†Ê≠§Ëøô‰∏™Èò∂ÊÆµÁöÑËÄóÊó∂Â∏∏Ë¢´Áß∞‰∏∫‚Äú<strong>È¶ñÊ¨°ÂìçÂ∫îÊó∂Èó¥ÔºàTime to first responseÔºâ</strong>‚Äù„ÄÇ</li>
<li><strong>Â∫îÁî®È¢ÑÁÉ≠ (Application Warmup - ÈúÄË¶ÅËæÉÈïøÊó∂Èó¥):</strong> Âç≥‰ΩøÂ∫îÁî®ËÉΩÂ§üÂìçÂ∫îÁ¨¨‰∏Ä‰∏™ËØ∑Ê±ÇÔºåÂÆÉÈÄöÂ∏∏ËøòËøúÊú™ËææÂà∞ÊúÄ‰Ω≥ÊÄßËÉΩ„ÄÇJava ÁöÑÈ´òÊÄßËÉΩ‰æùËµñ‰∫éÂç≥Êó∂ÁºñËØëÂô® <strong>JIT</strong>ÔºàJust-In-Time CompilerÔºâ„ÄÇ<code>JIT</code> ‰ºöÂú®ËøêË°åÊó∂ÁõëÊéß‰ª£Á†ÅÊâßË°åÊÉÖÂÜµÔºåËØÜÂà´‚ÄúÁÉ≠ÁÇπÔºàhotspotÔºâ‚Äù‰ª£Á†ÅÔºàÈ¢ëÁπÅÊâßË°åÁöÑÊñπÊ≥ïÔºâÔºåÂπ∂Â∞ÜÂÖ∂ÁºñËØëÊàêÊú¨Âú∞Êú∫Âô®Á†Å‰ª•ÊèêÂçáÊïàÁéá„ÄÇËøô‰∏™ÁºñËØëËøáÁ®ãÊòØÂàÜÂ±ÇÁöÑÔºà‰æãÂ¶ÇÔºå‰ªéËß£ÈáäÊâßË°åÂà∞ C1 ÁºñËØëÔºåÂÜçÂà∞Êõ¥Ê∑±Â±ÇÊ¨°‰ºòÂåñÁöÑ C2 ÁºñËØëÔºâÔºåÈúÄË¶ÅÊó∂Èó¥ÂíåÂÆûÈôÖÁöÑ‰∏öÂä°Ë¥üËΩΩÊù•Ëß¶ÂèëÂíåÂÆåÊàê„ÄÇÊ≠§Â§ñÔºåËøòÂèØËÉΩÊ∂âÂèäÁºìÂ≠òÁöÑÂ°´ÂÖÖ„ÄÅËøûÊé•Ê±†ÁöÑÈ¢ÑÁÉ≠Á≠â„ÄÇÂè™ÊúâÂú® <code>JIT</code> ÂÆåÊàê‰∫ÜÂÖ≥ÈîÆ‰ª£Á†ÅÁöÑÁºñËØë‰ºòÂåñÔºåÂπ∂‰∏îÂ∫îÁî®Â§ÑÁêÜ‰∫Ü‰∏ÄÂÆöÈáèÁöÑËØ∑Ê±ÇÂêéÔºåÊâçËÉΩËææÂà∞ÂÖ∂Â≥∞ÂÄºÊÄßËÉΩ„ÄÇËøô‰∏™ËøáÁ®ãË¢´Áß∞‰∏∫‚Äú<strong>Â∫îÁî®È¢ÑÁÉ≠</strong>‚Äù„ÄÇÊúüÈó¥ËøòÂèØËÉΩ‰º¥ÈöèÁùÄÁºñËØë/Âèç‰ºòÂåñÔºàDeoptimisationsÔºâÂíåÂûÉÂúæÂõûÊî∂ÊöÇÂÅúÔºàGarbage Collector pausesÔºâÂ∏¶Êù•ÁöÑÊÄßËÉΩÊ≥¢Âä®„ÄÇ</li>
</ol>
<p><img src="https://cdn.mazhen.tech/2024/202504241446155.png"
	
	
	
	loading="lazy"
	
		alt="JVM PERFORMANCE GRAPH"
	
	
></p>
<p>Ëøô‰∏â‰∏™Èò∂ÊÆµÂè†Âä†Ëµ∑Êù•ÔºåÁâπÂà´ÊòØ‚ÄúÂ∫îÁî®ÂêØÂä®‚ÄùÂíå‚ÄúÂ∫îÁî®È¢ÑÁÉ≠‚ÄùÈò∂ÊÆµÁöÑËÄóÊó∂ÔºåÂØºËá¥‰∫Ü Java Â∫îÁî®ÁöÑÂÜ∑ÂêØÂä®Êó∂Èó¥ËæÉÈïøÔºåÂπ∂‰∏îÈúÄË¶Å‰∏ÄÊÆµÊó∂Èó¥ÊâçËÉΩËææÂà∞ÁêÜÊÉ≥ÁöÑÂ§ÑÁêÜËÉΩÂäõ„ÄÇÂØπ‰∫éÈúÄË¶ÅÂø´ÈÄüÂìçÂ∫îÂíåÂºπÊÄß‰º∏Áº©ÁöÑÂæÆÊúçÂä°Âíå Serverless Âú∫ÊôØÔºåËøôÁßçÂª∂ËøüÊòØ‰∫üÂæÖËß£ÂÜ≥ÁöÑÁóõÁÇπ„ÄÇÁºìÊÖ¢ÁöÑÂêØÂä®ÂΩ±ÂìçÊâ©ÂÆπÊïàÁéáÔºåËÄåÊº´ÈïøÁöÑÈ¢ÑÁÉ≠ÂàôÊÑèÂë≥ÁùÄÂú®ËææÂà∞Â≥∞ÂÄºÊÄßËÉΩÂâçÔºåÂ∫îÁî®ÁöÑÂ§ÑÁêÜËÉΩÂäõÂèóÈôê‰∏îÂìçÂ∫îÊó∂Èó¥‰∏çÁ®≥ÂÆö„ÄÇ</p>
<p>Ê≠£ÊòØ‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏ÄÁóõÁÇπÔºå<strong>CRaC (Coordinated Restore at Checkpoint)</strong> ÊäÄÊúØÂ∫îËøêËÄåÁîü„ÄÇÂÆÉÂπ∂ÈùûÈÄê‰∏Ä‰ºòÂåñ‰∏äËø∞ÂêØÂä®ÂíåÈ¢ÑÁÉ≠ÁöÑÂêÑ‰∏™ÁéØËäÇÔºåËÄåÊòØÂè¶ËæüËπäÂæÑÔºö<strong>ÈÄöËøáÂú®Â∫îÁî®Á®ãÂ∫èÂÆåÊàêÂàùÂßãÂåñÂπ∂ÂÖÖÂàÜ‚ÄúÈ¢ÑÁÉ≠‚ÄùËææÂà∞Êé•ËøëÂ≥∞ÂÄºÊÄßËÉΩÁä∂ÊÄÅÂêéÔºåÂàõÂª∫‰∏Ä‰∏™ÂåÖÂê´Êï¥‰∏™ JVM ËøõÁ®ãÁä∂ÊÄÅÁöÑ‚ÄúÂø´ÁÖß‚ÄùÔºàCheckpointÔºâÔºåÂπ∂Âú®ÈúÄË¶ÅÊñ∞ÂÆû‰æãÊó∂Áõ¥Êé•‰ªéËøô‰∏™Âø´ÁÖßÂø´ÈÄü‚ÄúÊÅ¢Â§ç‚ÄùÔºàRestoreÔºâ</strong>„ÄÇËøôÁßçÊñπÂºèÂá†‰πéÂÆåÂÖ®ÁªïËøá‰∫ÜËÄóÊó∂ÁöÑ‚ÄúÂ∫îÁî®ÂêØÂä®‚ÄùÂíå‚ÄúÂ∫îÁî®È¢ÑÁÉ≠‚ÄùËøáÁ®ãÔºåÊúâÊúõÂ∞ÜÂêØÂä®Âπ∂ËææÂà∞È´òÊÄßËÉΩÁä∂ÊÄÅÁöÑÊó∂Èó¥Áº©Áü≠Âà∞ÊØ´ÁßíÁ∫ßÂà´„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504241459599.jpeg"
	
	
	
	loading="lazy"
	
		alt="MICROSERVICE ENVIRONMENT"
	
	
></p>
<p>Êú¨ÊñáÊó®Âú®Ê∑±ÂÖ•Êé¢ËÆ® CRaC ÊäÄÊúØÔºå‰ªéÂÖ∂Ê†∏ÂøÉÂéüÁêÜ„ÄÅ‰∏é AOT Á≠âÊäÄÊúØÁöÑÂØπÊØî„ÄÅÂÖ∑‰ΩìÂÆûÁé∞Êú∫Âà∂„ÄÅÂÆûÈôÖ‰ΩøÁî®ÊñπÊ≥ïÔºåÂà∞ÂÖ∂Âú®‰∏çÂêåÂú∫ÊôØ‰∏ãÁöÑÂ∫îÁî®ÂíåÁîüÊÄÅÂèëÂ±ïÔºåÂÖ®Èù¢Ëß£ÊûêËøô‰∏ÄÊó®Âú®Èù©Êñ∞ Java ÂêØÂä®‰∏éÈ¢ÑÁÉ≠ÊÄßËÉΩÁöÑÂâçÊ≤øÊäÄÊúØ„ÄÇ</p>
<h2 id="‰∏Äcrac-Ê¶ÇËø∞ÂëäÂà´Êº´ÈïøÁ≠âÂæÖ">
    <a href="#%e4%b8%80crac-%e6%a6%82%e8%bf%b0%e5%91%8a%e5%88%ab%e6%bc%ab%e9%95%bf%e7%ad%89%e5%be%85" class="header-anchor">#</a>
    ‰∏Ä„ÄÅCRaC Ê¶ÇËø∞ÔºöÂëäÂà´Êº´ÈïøÁ≠âÂæÖ
</h2><h3 id="‰ªÄ‰πàÊòØ-crac">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af-crac" class="header-anchor">#</a>
    ‰ªÄ‰πàÊòØ CRaCÔºü
</h3><p><a class="link" href="https://openjdk.org/projects/crac/"  target="_blank" rel="noopener"
    >CRaCÔºàCoordinated Restore at CheckpointÔºâ</a>ÊòØ OpenJDK ÁöÑ‰∏Ä‰∏™È°πÁõÆÔºåÊó®Âú®ÈÄöËøáÂàõÊñ∞ÁöÑÊñπÂºèÊòæËëóÁº©Áü≠ Java Â∫îÁî®ÁöÑÂêØÂä®Êó∂Èó¥„ÄÇCRaC  ÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ÊòØÔºöÂú®Â∫îÁî®Á®ãÂ∫èËøêË°åÂà∞Êüê‰∏™ÁêÜÊÉ≥Áä∂ÊÄÅÔºàÈÄöÂ∏∏ÊòØÂàùÂßãÂåñÂÆåÊàêÂπ∂ÁªèËøáÈ¢ÑÁÉ≠ÂêéÔºâÊó∂ÔºåÂàõÂª∫‰∏Ä‰∏™ÂåÖÂê´Êï¥‰∏™ JVM ËøõÁ®ãÂÜÖÂ≠òÁä∂ÊÄÅÔºàÂåÖÊã¨Â†ÜÂÜÖÂ≠ò„ÄÅÂ∑≤Âä†ËΩΩÁ±ª„ÄÅÂ∑≤ÁºñËØë‰ª£Á†Å„ÄÅÁ∫øÁ®ãÁä∂ÊÄÅÁ≠âÔºâÁöÑÂø´ÁÖßÔºåÂç≥‚ÄúÊ£ÄÊü•ÁÇπ‚ÄùÔºà<strong>Checkpoint</strong>ÔºâÔºåÂπ∂Â∞ÜÂÖ∂ÊåÅ‰πÖÂåñ„ÄÇÂΩìÈúÄË¶ÅÂêØÂä®Êñ∞ÂÆû‰æãÊó∂Ôºå‰∏çÂÜçÊâßË°å‰º†ÁªüÁöÑÂêØÂä®ÊµÅÁ®ãÔºåËÄåÊòØÁõ¥Êé•‰ªéËØ•Âø´ÁÖß‚ÄúÊÅ¢Â§ç‚ÄùÔºà<strong>Restore</strong>ÔºâJVM Áä∂ÊÄÅ„ÄÇËøô‰∏™ÊÅ¢Â§çËøáÁ®ãË∑≥Ëøá‰∫ÜÂ§ßÈÉ®ÂàÜ JVM ÂàùÂßãÂåñ„ÄÅÁ±ªÂä†ËΩΩÂíåÂ∫îÁî®ÂàùÂßãÂåñÊ≠•È™§Ôºå‰ªéËÄåÊûÅÂ§ßÂú∞Âä†Âø´‰∫ÜÂêØÂä®ÈÄüÂ∫¶„ÄÇÂÖ∂‰∏≠Ôºå‚ÄúÂçèË∞É‚ÄùÔºà<strong>Coordinated</strong>ÔºâÊòØÂÖ≥ÈîÆÔºåÊÑèÂë≥ÁùÄ JVM ÈúÄË¶Å‰∏éÂ∫îÁî®Á®ãÂ∫èÈÄöËøáÁâπÂÆö API ËøõË°å‰∫§‰∫íÔºå‰ª•Á°Æ‰øùÂú®ÂàõÂª∫Ê£ÄÊü•ÁÇπÂíåÊÅ¢Â§çÊó∂ÔºåÂ§ñÈÉ®ËµÑÊ∫êÔºàÂ¶ÇÊñá‰ª∂Âè•ÊüÑ„ÄÅÁΩëÁªúËøûÊé•ÔºâËÉΩÂ§üË¢´Â¶•ÂñÑÂú∞ÂÖ≥Èó≠ÂíåÈáçÊñ∞Âª∫Á´ã„ÄÇ</p>
<h3 id="crac-ÁöÑÊ†∏ÂøÉ‰ºòÂäø">
    <a href="#crac-%e7%9a%84%e6%a0%b8%e5%bf%83%e4%bc%98%e5%8a%bf" class="header-anchor">#</a>
    CRaC ÁöÑÊ†∏ÂøÉ‰ºòÂäø
</h3><ul>
<li><strong>ÊûÅÈÄüÂêØÂä®Ôºö</strong> ËøôÊòØ CRaC ÊúÄÊòæËëóÁöÑ‰ºòÂäø„ÄÇ‰º†Áªü Java Â∫îÁî®ÂêØÂä®ÂèØËÉΩÈúÄË¶ÅÊï∞ÁßíÁîöËá≥Êï∞ÂçÅÁßíÔºåËÄå‰ΩøÁî® CRaC ‰ªéÂø´ÁÖßÊÅ¢Â§çÔºåÂèØ‰ª•Â∞ÜÂêØÂä®Êó∂Èó¥Áº©Áü≠Âà∞Êï∞ÁôæÊØ´ÁßíÁîöËá≥Êõ¥Áü≠ÔºåÊé•ËøëÂéüÁîüÂ∫îÁî®ÁöÑÂêØÂä®ÈÄüÂ∫¶„ÄÇÂõ†‰∏∫ÂÆÉÁõ¥Êé•Ë∑≥Ëøá‰∫Ü JVM ÂàùÂßãÂåñ„ÄÅÁ±ªÂä†ËΩΩ„ÄÅÂ∫îÁî®ÂàùÂßãÂåñÂíåÂ§ßÈÉ®ÂàÜ JIT È¢ÑÁÉ≠Á≠âËÄóÊó∂ÁéØËäÇ„ÄÇ</li>
<li><strong>Âç≥Êó∂Â≥∞ÂÄºÊÄßËÉΩÔºö</strong> Áî±‰∫é <strong>Checkpoint</strong> ÈÄöÂ∏∏ÊòØÂú®Â∫îÁî®Â∑≤ÁªèÂÆåÊàê JIT ÁºñËØë‰ºòÂåñÂíåÈ¢ÑÁÉ≠ÂêéÂàõÂª∫ÁöÑÔºåÂõ†Ê≠§ÊÅ¢Â§çÂêéÁöÑÂÆû‰æãÂá†‰πéÂèØ‰ª•Á´ãÂç≥ËææÂà∞ÂÖ∂ÊúÄ‰Ω≥ÊÄßËÉΩÁä∂ÊÄÅÔºåÈÅøÂÖç‰∫Ü‰º†ÁªüÂêØÂä®ÂêéÊº´ÈïøÁöÑ‚ÄúÈ¢ÑÁÉ≠‚ÄùÁ≠âÂæÖÊúü„ÄÇËøôÂØπ‰∫éÈúÄË¶ÅÂø´ÈÄüÂìçÂ∫îËØ∑Ê±ÇÁöÑÂú∫ÊôØÔºàÂ¶Ç ServerlessÔºâÂ∞§ÂÖ∂ÈáçË¶Å„ÄÇ</li>
<li><strong>ÊΩúÂú®ÁöÑËµÑÊ∫êËäÇÁ∫¶Ôºö</strong> ‰º†ÁªüÁöÑÂêØÂä®ÂíåÈ¢ÑÁÉ≠ËøáÁ®ãÈÄöÂ∏∏ÊòØ CPU ÂØÜÈõÜÂûãÁöÑ„ÄÇÈÄöËøá CRaCÔºåËøô‰∫õÂØÜÈõÜÁöÑËÆ°ÁÆóË¢´ËΩ¨ÁßªÂà∞‰∫Ü <strong>Checkpoint</strong> ÂàõÂª∫Èò∂ÊÆµÔºàÈÄöÂ∏∏Âú®ÈùûÈ´òÂ≥∞Êó∂ÊÆµÊàñÊûÑÂª∫ËøáÁ®ã‰∏≠ÂÆåÊàêÔºâÔºåËÄåÂú®ÂÆûÈôÖÈúÄË¶ÅÂêØÂä®Êñ∞ÂÆû‰æãÊó∂ÔºàÂ¶ÇÊúçÂä°Êâ©ÂÆπÊàñÂáΩÊï∞Ë∞ÉÁî®Êó∂ÔºâÔºåËµÑÊ∫êÊ∂àËÄóÊòæËëóÈôç‰ΩéÔºåÊúâÂä©‰∫éÊèêÈ´òËµÑÊ∫êÂà©Áî®ÁéáÂíåÈôç‰ΩéÊàêÊú¨„ÄÇ</li>
</ul>
<h3 id="crac-ÁöÑÂÖ≥ÈîÆÊ¶ÇÂøµ">
    <a href="#crac-%e7%9a%84%e5%85%b3%e9%94%ae%e6%a6%82%e5%bf%b5" class="header-anchor">#</a>
    CRaC ÁöÑÂÖ≥ÈîÆÊ¶ÇÂøµ
</h3><ul>
<li><strong>Checkpoint (Ê£ÄÊü•ÁÇπ):</strong> ÊåáÂàõÂª∫ JVM ËøõÁ®ãÁä∂ÊÄÅÂø´ÁÖßÁöÑÊìç‰ΩúÔºå‰ª•ÂèäÁîüÊàêÁöÑÂåÖÂê´ËØ•Áä∂ÊÄÅÁöÑÊåÅ‰πÖÂåñÊñá‰ª∂ÊàñÈïúÂÉè„ÄÇ</li>
<li><strong>Restore (ÊÅ¢Â§ç):</strong> Êåá‰ªé‰∏Ä‰∏™Â∑≤Â≠òÂú®ÁöÑ <strong>Checkpoint</strong> Âø´ÈÄüÂä†ËΩΩ JVM Áä∂ÊÄÅÔºåÂêØÂä®‰∏Ä‰∏™Êñ∞ JVM ÂÆû‰æãÁöÑËøáÁ®ã„ÄÇ</li>
<li><strong>Coordination (ÂçèË∞É):</strong> Êåá JVM ‰∏éÂ∫îÁî®Á®ãÂ∫è‰πãÈó¥ÈÄöËøáÁâπÂÆö APIÔºà<code>jdk.crac</code> ÂåÖÔºâËøõË°åÁöÑ‰∫§‰∫í„ÄÇÂ∫îÁî®Á®ãÂ∫èÈúÄË¶ÅÂÆûÁé∞Êé•Âè£Êù•ÁÆ°ÁêÜÂÖ∂ËµÑÊ∫êÔºàÂ¶ÇÂÖ≥Èó≠ÁΩëÁªúËøûÊé•„ÄÅÊñá‰ª∂Âè•ÊüÑÁ≠âÔºâ‰ª•Á°Æ‰øù <strong>Checkpoint</strong> ÁöÑ‰∏ÄËá¥ÊÄßÔºåÂπ∂Âú® <strong>Restore</strong> ÂêéÈáçÊñ∞Âª∫Á´ãËøô‰∫õËµÑÊ∫ê„ÄÇËøôÊòØ‰øùËØÅÊÅ¢Â§çÂêéÁöÑÂ∫îÁî®ËÉΩÊ≠£Â∏∏Â∑•‰ΩúÁöÑÂÖ≥ÈîÆ„ÄÇ</li>
</ul>
<h2 id="‰∫åcrac-vs-aotÂêØÂä®‰ºòÂåñÁöÑ‰∏§Êù°Ë∑ØÂæÑ">
    <a href="#%e4%ba%8ccrac-vs-aot%e5%90%af%e5%8a%a8%e4%bc%98%e5%8c%96%e7%9a%84%e4%b8%a4%e6%9d%a1%e8%b7%af%e5%be%84" class="header-anchor">#</a>
    ‰∫å„ÄÅCRaC vs. AOTÔºöÂêØÂä®‰ºòÂåñÁöÑ‰∏§Êù°Ë∑ØÂæÑ
</h2><p>‰∏∫‰∫ÜËß£ÂÜ≥ Java ÂêØÂä®ÊÖ¢ÂíåÈ¢ÑÁÉ≠ÈïøÁöÑÈóÆÈ¢òÔºå‰∏öÁïåÊé¢Á¥¢‰∫Ü‰∏çÂêåÁöÑ‰ºòÂåñË∑ØÂæÑ„ÄÇÈô§‰∫Ü <strong>CRaC</strong>ÔºåÂè¶‰∏ÄÁßçÂπøÂèóÂÖ≥Ê≥®ÁöÑÊäÄÊúØÊòØ <strong>AOT</strong>ÔºàAhead-of-TimeÔºâÁºñËØëÔºåÁâπÂà´ÊòØ‰ª• <strong>GraalVM Native Image</strong> ‰∏∫‰ª£Ë°®ÁöÑÂÆûÁé∞„ÄÇ‰∏§ËÄÖÈÉΩÊó®Âú®Áº©Áü≠ÂêØÂä®Êó∂Èó¥Ôºå‰ΩÜÂÆÉ‰ª¨ÁöÑÂéüÁêÜÂíåÁâπÊÄßÂç¥Â§ßÁõ∏ÂæÑÂ∫≠„ÄÇ</p>
<h3 id="aot-ÊäÄÊúØÁÆÄ‰ªã">
    <a href="#aot-%e6%8a%80%e6%9c%af%e7%ae%80%e4%bb%8b" class="header-anchor">#</a>
    AOT ÊäÄÊúØÁÆÄ‰ªã
</h3><p>AOT ÁºñËØëÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ÊòØÔºåÂú®Â∫îÁî®Á®ãÂ∫èËøêË°å‰πãÂâçÔºåÂ∞±Â∞ÜÂÖ∂ Java Â≠óËäÇÁ†ÅÁõ¥Êé•ÁºñËØëÊàêÊú¨Âú∞Êú∫Âô®Á†ÅÔºåÁîüÊàê‰∏Ä‰∏™Áã¨Á´ãÁöÑÂèØÊâßË°åÊñá‰ª∂Ôºà‰æãÂ¶Ç GraalVM Native ImageÔºâ„ÄÇËøôÊ†∑ÂÅöÂ∏¶Êù•ÁöÑ‰∏ªË¶Å‰ºòÂäøÊòØÔºö</p>
<ul>
<li><strong>Êó†ÈúÄËß£ÈáäÂ≠óËäÇÁ†Å (No interpreting bytecodes):</strong> ÂêØÂä®Êó∂Áõ¥Êé•ÊâßË°åÊú¨Âú∞‰ª£Á†ÅÔºåË∑≥Ëøá‰∫Ü JVM Ëß£ÈáäÊâßË°åÂ≠óËäÇÁ†ÅÁöÑÈò∂ÊÆµ„ÄÇ</li>
<li><strong>Êó†ÈúÄËøêË°åÊó∂ÁºñËØë (No runtime compilation of code):</strong> Ê∂àÈô§‰∫Ü JIT Âú®ËøêË°åÊó∂ÁºñËØë‰ª£Á†ÅÂ∏¶Êù•ÁöÑ CPU ÂºÄÈîÄ„ÄÇ</li>
<li><strong>ÂêØÂä®Âç≥ÂÖ®ÈÄü (Start at &lsquo;full speed&rsquo;, straight away):</strong> Â∫îÁî®ÂêØÂä®ÂêéÂá†‰πéÁ´ãÂàªÂ∞±ËÉΩËææÂà∞ÂÖ∂Á®≥ÂÆöÊÄßËÉΩÁä∂ÊÄÅÔºàÂ∞ΩÁÆ°Ëøô‰∏™Á®≥ÂÆöÁä∂ÊÄÅÂèØËÉΩ‰∏çÊòØÊúÄÈ´òÂ≥∞ÂÄºÔºâÔºåÂ§ßÂ§ßÁº©Áü≠‰∫Ü‚ÄúÈ¶ñÊ¨°ÂìçÂ∫îÊó∂Èó¥‚Äù„ÄÇ</li>
<li><strong>Êõ¥Â∞èÁöÑÂÜÖÂ≠òÂç†Áî®Ôºö</strong> ÁîüÊàêÁöÑÊú¨Âú∞ÂèØÊâßË°åÊñá‰ª∂‰∏çÂåÖÂê´ JVM Âíå JIT ÁºñËØëÂô®ÔºåËøêË°åÊó∂ÂÜÖÂ≠òÂç†Áî®ÈÄöÂ∏∏ÊòæËëó‰Ωé‰∫éÊ†áÂáÜ JVM„ÄÇ</li>
</ul>
<h3 id="aot-ÁöÑÊåëÊàò‰∏éÂ±ÄÈôê">
    <a href="#aot-%e7%9a%84%e6%8c%91%e6%88%98%e4%b8%8e%e5%b1%80%e9%99%90" class="header-anchor">#</a>
    AOT ÁöÑÊåëÊàò‰∏éÂ±ÄÈôê
</h3><p>ÁÑ∂ËÄåÔºåAOT Âπ∂ÈùûÂÆåÁæéÊó†Áº∫ÔºåÂÆÉ‰πüÈù¢‰∏¥‰∏Ä‰∫õÂõ∫ÊúâÁöÑÊåëÊàòÔºö</p>
<ol>
<li>
<p><strong>ÈùôÊÄÅÁºñËØëÁöÑÊú¨Ë¥® (AOT is, by definition, static)</strong>
<strong>AOT</strong> ÁöÑÊú¨Ë¥®ÊòØ‰ª£Á†ÅÂú®ËøêË°å<strong>‰πãÂâç</strong>Â∞±Ë¢´ÁºñËØë„ÄÇËøôÊÑèÂë≥ÁùÄÁºñËØëÂô®<strong>Êó†Ê≥ïËé∑Áü•‰ª£Á†ÅÂú®ËøêË°åÊó∂ÁöÑÂÆûÈôÖË°å‰∏∫</strong> „ÄÇ<strong>AOT</strong> ‰∏çËÉΩÂÉè <strong>JIT</strong> ÈÇ£Ê†∑Ê†πÊçÆËøêË°åÊó∂ÁöÑÁúüÂÆûË¥üËΩΩÂíå‰ª£Á†ÅË∑ØÂæÑËøõË°åÊ∑±Â∫¶‰ºòÂåñ„ÄÇ</p>
</li>
<li>
<p><strong>Profile Guided Optimization (PGO) ÁöÑÂºïÂÖ•‰∏éÂ±ÄÈôê</strong>
‰∏∫‰∫ÜÁºìËß£ÈùôÊÄÅÁºñËØëÁº∫‰πèËøêË°åÊó∂‰ø°ÊÅØÁöÑÁº∫ÁÇπÔºå<strong>AOT</strong> ÂèØ‰ª•ÁªìÂêà <strong>Profile Guided Optimization (PGO)</strong>„ÄÇ</p>
</li>
</ol>
<p><strong>PGO</strong> ÁöÑÂü∫Êú¨ÊÄùË∑ØÊòØÔºöÂÖàÈÄöËøáÊèíÊ°©ÔºàInstrumentationÔºâÊàñËÄÖÈááÊ†∑ÁöÑÊñπÂºèËøêË°å‰∏ÄÊ¨°Á®ãÂ∫èÔºåÊî∂ÈõÜ‰ª£Á†ÅÊâßË°åÈ¢ëÁéá„ÄÅÂàÜÊîØË∑≥ËΩ¨Á≠â‰ø°ÊÅØÔºåÁîüÊàê Profile Êï∞ÊçÆÔºà‰æãÂ¶Ç GCC ‰∏≠‰ΩøÁî® <code>-fprofile-generate</code> ÁºñËØëËøêË°å‰ª•ÁîüÊàê profile Êñá‰ª∂ÔºâÔºõÁÑ∂ÂêéÔºåÂú®ÊúÄÁªàÁºñËØëÊó∂Â∞ÜËøô‰∫õ Profile Êï∞ÊçÆÊèê‰æõÁªôÁºñËØëÂô®Ôºà‰æãÂ¶Ç GCC ‰ΩøÁî® <code>-fprofile-use</code>ÔºâÔºåËÆ©ÁºñËØëÂô®Ê†πÊçÆËøô‰∫õ‚ÄúÂÖàÈ™åÁü•ËØÜ‚ÄùËøõË°åÊõ¥ÈíàÂØπÊÄßÁöÑ‰ºòÂåñÔºåÊØîÂ¶ÇÊõ¥Â•ΩÂú∞ÂÆâÊéí‰ª£Á†ÅÂ∏ÉÂ±Ä„ÄÅÊõ¥ÂáÜÁ°ÆÂú∞ËøõË°åÂàÜÊîØÈ¢ÑÊµã„ÄÅÊõ¥ÊúâÊïàÂú∞ËøõË°åÂáΩÊï∞ÂÜÖËÅîÁ≠â„ÄÇ</p>
<p><strong>ÁÑ∂ËÄåÔºåÂØπ‰∫é AOT ÁºñËØëÊù•ËØ¥ÔºåPGO Âè™ËÉΩÈÉ®ÂàÜÁºìËß£ÈóÆÈ¢ò (can partially help)</strong>„ÄÇÂõ†‰∏∫Êî∂ÈõÜÂà∞ÁöÑ Profile Êï∞ÊçÆÂèØËÉΩÂè™‰ª£Ë°®‰∫ÜÊüê‰∏ÄÊ¨°ÊàñÊüêÂá†Ê¨°ËøêË°åÁöÑÁâπÂæÅÔºåÊó†Ê≥ïÂÆåÂÖ®Ë¶ÜÁõñÊâÄÊúâÂèØËÉΩÁöÑËøêË°åÊó∂Âú∫ÊôØÂíåËæìÂÖ•Êï∞ÊçÆ„ÄÇÂõ†Ê≠§ÔºåÂü∫‰∫é <strong>PGO</strong> ÁöÑ <strong>AOT</strong> ‰ºòÂåñÊïàÊûúÈÄöÂ∏∏‰ªç<strong>Èöæ‰ª•Â™≤Áæé JIT</strong> ÁöÑÂä®ÊÄÅ‰ºòÂåñËÉΩÂäõ„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504241551875.png"
	
	
	
	loading="lazy"
	
		alt="JVM PERFORMANCE GRAPH"
	
	
></p>
<ol start="3">
<li><strong>ÂÖºÂÆπÊÄßÈóÆÈ¢ò</strong>
<strong>AOT</strong> ÂØπ Java ÁöÑÂä®ÊÄÅÁâπÊÄßÔºàÂ¶ÇÂèçÂ∞Ñ„ÄÅÂä®ÊÄÅ‰ª£ÁêÜ„ÄÅËøêË°åÊó∂Â≠óËäÇÁ†ÅÁîüÊàêÔºâÊîØÊåÅÊúâÈôêÔºåÈÄöÂ∏∏ÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÈÖçÁΩÆÊàñ‰ª£Á†ÅË∞ÉÊï¥ÔºåÂπ∂ÈùûÊâÄÊúâ Java Â∫ìÈÉΩËÉΩÁõ¥Êé•ÂÖºÂÆπ„ÄÇ</li>
</ol>
<h3 id="jit-ÁöÑ‰ºòÂäøËøêË°åÊó∂Âä®ÊÄÅ‰ºòÂåñÁöÑÂ®ÅÂäõ">
    <a href="#jit-%e7%9a%84%e4%bc%98%e5%8a%bf%e8%bf%90%e8%a1%8c%e6%97%b6%e5%8a%a8%e6%80%81%e4%bc%98%e5%8c%96%e7%9a%84%e5%a8%81%e5%8a%9b" class="header-anchor">#</a>
    JIT ÁöÑ‰ºòÂäøÔºöËøêË°åÊó∂Âä®ÊÄÅ‰ºòÂåñÁöÑÂ®ÅÂäõ
</h3><p>‰∏é <strong>AOT</strong> ÁöÑÈùôÊÄÅÁºñËØë‰∏çÂêåÔºå<strong>JIT</strong> ÁºñËØëÊòØÂú®Á®ãÂ∫èËøêË°åÊúüÈó¥ËøõË°åÁöÑ„ÄÇËøôËµã‰∫à‰∫Ü <strong>JIT</strong> ÁºñËØëÂô®Áã¨ÁâπÁöÑ‰ºòÂäøÔºå‰ΩøÂÖ∂ËÉΩÂ§üËøõË°åÊØî <strong>AOT</strong> Êõ¥Ê∑±Â±ÇÊ¨°„ÄÅÊõ¥Á≤æÂáÜÁöÑ‰ºòÂåñ„ÄÇ</p>
<ul>
<li><strong>Âü∫‰∫éÁúüÂÆûËøêË°åÊÉÖÂÜµÁöÑ‰ºòÂåñÔºö</strong> <strong>JIT</strong> ÁºñËØëÂô®ÂèØ‰ª•ËßÇÂØüÂà∞‰ª£Á†Å<strong>ÂÆûÈôÖ</strong>ÁöÑËøêË°åË∑ØÂæÑ„ÄÅÁÉ≠ÁÇπÊñπÊ≥ï„ÄÅÂàÜÊîØË∑≥ËΩ¨È¢ëÁéá„ÄÅÊï∞ÊçÆÁ±ªÂûãÂàÜÂ∏ÉÁ≠â‰ø°ÊÅØ„ÄÇÂü∫‰∫éËøô‰∫õ<strong>Âä®ÊÄÅÊî∂ÈõÜ</strong>ÁöÑ‰ø°ÊÅØÔºå<strong>JIT</strong> ÂèØ‰ª•ÂÅöÂá∫Êõ¥ÊòéÊô∫ÁöÑ‰ºòÂåñÂÜ≥Á≠ñ„ÄÇ</li>
<li><strong>ÊøÄËøõÁöÑ‰ºòÂåñÁ≠ñÁï•Ôºö</strong> <strong>JIT</strong> ÂèØ‰ª•ÈááÁî®Êõ¥ÊøÄËøõÁöÑ‰ºòÂåñÊâãÊÆµÔºå‰æãÂ¶ÇÔºö
<ul>
<li><strong>ÊñπÊ≥ïÂÜÖËÅî (Method Inlining):</strong> Â∞ÜË∞ÉÁî®È¢ëÁπÅÁöÑÂ∞èÊñπÊ≥ïÁõ¥Êé•ÂµåÂÖ•Âà∞Ë∞ÉÁî®Â§ÑÔºåÊ∂àÈô§ÊñπÊ≥ïË∞ÉÁî®ÁöÑÂºÄÈîÄ„ÄÇJIT ÂèØ‰ª•Ê†πÊçÆÂÆûÈôÖË∞ÉÁî®ÊÉÖÂÜµÂÜ≥ÂÆöÊòØÂê¶ÂÜÖËÅî‰ª•ÂèäÂÜÖËÅîÁöÑÊ∑±Â∫¶„ÄÇ</li>
<li><strong>ÈÄÉÈÄ∏ÂàÜÊûê (Escape Analysis):</strong> ÂàÜÊûêÂØπË±°ÁöÑ‰ΩúÁî®ÂüüÔºåÂ¶ÇÊûú‰∏Ä‰∏™ÂØπË±°Âè™Âú®ÊñπÊ≥ïÂÜÖÈÉ®‰ΩøÁî®Ôºå‰∏ç‰ºö‚ÄúÈÄÉÈÄ∏‚ÄùÂá∫ÂéªÔºåJIT ÂèØ‰ª•Â∞ÜÂÖ∂ÂàÜÈÖçÂú®Ê†à‰∏äËÄå‰∏çÊòØÂ†Ü‰∏äÔºåÂáèËΩª GC ÂéãÂäõÔºåÁîöËá≥ËøõË°åÈîÅÊ∂àÈô§„ÄÇ</li>
<li><strong>ÊäïÊú∫ÊÄß‰ºòÂåñ (Speculative Optimizations):</strong> JIT ÂèØ‰ª•Ê†πÊçÆËßÇÂØüÂà∞ÁöÑÈ´òÊ¶ÇÁéá‰∫ã‰ª∂ËøõË°å‰ºòÂåñÔºà‰æãÂ¶ÇÔºåÂÅáËÆæÊüê‰∏™Á±ªÂûãÊ£ÄÊü•ÊÄªÊòØÊàêÂäüÔºâÔºåÂπ∂ÂáÜÂ§áÂ•ΩÂú®ÂÅáËÆæÂ§±Ë¥•Êó∂ÂõûÈÄÄÂà∞ËæÉÊÖ¢ÁöÑ‰ª£Á†ÅË∑ØÂæÑÔºàDeoptimizationÔºâ„ÄÇ<strong>AOT</strong> ÈÄöÂ∏∏Êó†Ê≥ïÊâøÊãÖËøôÁßçÈ£éÈô©„ÄÇ</li>
</ul>
</li>
<li><strong>ÈíàÂØπÁâπÂÆöÁéØÂ¢ÉÁöÑ‰ºòÂåñÔºö</strong> <strong>JIT</strong> ÁºñËØëÂô®Áü•ÈÅìÁ®ãÂ∫è<strong>ÂΩìÂâçËøêË°å</strong>ÁöÑ CPU Êû∂ÊûÑÔºà‰æãÂ¶Ç Haswell, Skylake, Ice Lake Á≠âÔºâÔºåÂèØ‰ª•ÁîüÊàêÈíàÂØπËØ•ÁâπÂÆö CPU Êåá‰ª§ÈõÜ‰ºòÂåñÁöÑÊú∫Âô®Á†ÅÔºåÊúÄÂ§ßÂåñÁ°¨‰ª∂ÊÄßËÉΩ„ÄÇ<strong>AOT</strong> ‰∏∫‰∫ÜÈÄöÁî®ÊÄßÔºåÈÄöÂ∏∏Âè™ËÉΩÁºñËØë‰∏∫‚ÄúÊúÄÂ∞èÂÖ¨ÂàÜÊØç‚ÄùÁöÑÊåá‰ª§ÈõÜ„ÄÇ</li>
<li><strong>ÊîØÊåÅ Java Âä®ÊÄÅÁâπÊÄßÔºö</strong> <strong>JIT</strong> Â§©ÁÑ∂‰∏é Java ÁöÑÂä®ÊÄÅÁâπÊÄßÔºàÂ¶ÇÂèçÂ∞Ñ„ÄÅËøêË°åÊó∂Â≠óËäÇÁ†ÅÁîüÊàêÔºâÂçèÂêåÂ∑•‰ΩúÔºåËøô‰∫õÁâπÊÄßÂØπ‰∫é <strong>AOT</strong> Êù•ËØ¥ÂæÄÂæÄÊòØÈöæÁÇπ„ÄÇ</li>
</ul>
<p>Ê≠£ÊòØÁî±‰∫éËøô‰∫õÂü∫‰∫éËøêË°åÊó∂‰ø°ÊÅØÁöÑÂä®ÊÄÅ‰ºòÂåñËÉΩÂäõÔºåÁªèËøáÂÖÖÂàÜÈ¢ÑÁÉ≠ÁöÑ <strong>JIT</strong> ‰ª£Á†ÅÈÄöÂ∏∏ËÉΩÂ§üËææÂà∞ÊØî <strong>AOT</strong> ‰ª£Á†Å<strong>Êõ¥È´òÁöÑÂ≥∞ÂÄºÊÄßËÉΩ</strong>„ÄÇ</p>
<h3 id="jit-ÁöÑ‰∏ªË¶ÅÁº∫ÁÇπ">
    <a href="#jit-%e7%9a%84%e4%b8%bb%e8%a6%81%e7%bc%ba%e7%82%b9" class="header-anchor">#</a>
    JIT ÁöÑ‰∏ªË¶ÅÁº∫ÁÇπ
</h3><p>Â∞ΩÁÆ° <strong>JIT</strong> Âú®Â≥∞ÂÄºÊÄßËÉΩ‰∏äÊúâ‰ºòÂäøÔºå‰ΩÜÂÖ∂Áº∫ÁÇπ‰πüÊòæËÄåÊòìËßÅÔºåËøôÊ≠£ÊòØ <strong>AOT</strong> ËØïÂõæËß£ÂÜ≥ÁöÑÈóÆÈ¢ò„ÄÇ</p>
<ul>
<li><strong>ÂêØÂä®Êó∂Èó¥Èïø (Requires more time to start up):</strong> <strong>JIT</strong> ÈúÄË¶ÅÁªèÂéÜ JVM ÂêØÂä®„ÄÅÁ±ªÂä†ËΩΩ„ÄÅËß£ÈáäÊâßË°å„ÄÅÁÉ≠ÁÇπÂàÜÊûê„ÄÅ‰ª£Á†ÅÁºñËØëÁ≠âÂ§ö‰∏™ÊÖ¢ÈÄüÊìç‰ΩúÂêéÔºåÊâçËÉΩËææÂà∞ËæÉÂø´ÁöÑÊâßË°åÈÄüÂ∫¶„ÄÇ</li>
<li><strong>ËøêË°åÊó∂ÁºñËØëÂºÄÈîÄ (CPU overhead to compile code at runtime):</strong> <strong>JIT</strong> ÁºñËØëÊú¨Ë∫´ÈúÄË¶ÅÊ∂àËÄó CPU ËµÑÊ∫ê„ÄÇ</li>
<li><strong>ÂÜÖÂ≠òÂç†Áî®Â§ß (Larger memory footprint):</strong> JVM„ÄÅJIT ÁºñËØëÂô®„ÄÅÊÄßËÉΩÂàÜÊûêÊï∞ÊçÆÁ≠âÈÉΩÈúÄË¶ÅÂç†Áî®È¢ùÂ§ñÁöÑÂÜÖÂ≠ò„ÄÇ</li>
</ul>
<h3 id="aot-vs-jit-ÂØπÊØîÊÄªÁªì">
    <a href="#aot-vs-jit-%e5%af%b9%e6%af%94%e6%80%bb%e7%bb%93" class="header-anchor">#</a>
    AOT vs. JIT ÂØπÊØîÊÄªÁªì
</h3><div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">ÁâπÊÄß</th>
<th style="text-align:left">AOT (Ahead-of-Time)</th>
<th style="text-align:left">JIT (Just-In-Time)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ÁºñËØëÊó∂Êú∫</strong></td>
<td style="text-align:left">ËøêË°åÂâç (ÈùôÊÄÅ)</td>
<td style="text-align:left">ËøêË°åÊó∂ (Âä®ÊÄÅ)</td>
</tr>
<tr>
<td style="text-align:left"><strong>ÂêØÂä®ÈÄüÂ∫¶</strong></td>
<td style="text-align:left">Âø´ (Time to first response Áü≠)</td>
<td style="text-align:left">ÊÖ¢ (ÈúÄË¶Å JVM ÂàùÂßãÂåñ„ÄÅÁ±ªÂä†ËΩΩ„ÄÅËß£ÈáäÊâßË°å)</td>
</tr>
<tr>
<td style="text-align:left"><strong>È¢ÑÁÉ≠Êó∂Èó¥</strong></td>
<td style="text-align:left">Áü≠ (Âá†‰πéÊó†È¢ÑÁÉ≠)</td>
<td style="text-align:left">Èïø (ÈúÄË¶ÅËØÜÂà´ÁÉ≠ÁÇπ„ÄÅÂàÜÂ±ÇÁºñËØë‰ºòÂåñ)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Â≥∞ÂÄºÊÄßËÉΩ</strong></td>
<td style="text-align:left">ÈÄöÂ∏∏ËæÉ‰Ωé (Áº∫‰πèËøêË°åÊó∂‰ø°ÊÅØÂíåÂä®ÊÄÅ‰ºòÂåñ)</td>
<td style="text-align:left">ÈÄöÂ∏∏ËæÉÈ´ò (ÂèØËøõË°åÊøÄËøõ‰ºòÂåñ„ÄÅÈíàÂØπÊÄß‰ºòÂåñ)</td>
</tr>
<tr>
<td style="text-align:left"><strong>ÂÜÖÂ≠òÂç†Áî®</strong></td>
<td style="text-align:left">Â∞è</td>
<td style="text-align:left">Â§ß (ÂåÖÂê´ JVM„ÄÅJIT ÁºñËØëÂô®„ÄÅÂàÜÊûêÊï∞ÊçÆÁ≠â)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Âä®ÊÄÅÁâπÊÄßÊîØÊåÅ</strong></td>
<td style="text-align:left">ÊúâÈôê (ÈúÄÈÖçÁΩÆÊàñÊîπÈÄ†)</td>
<td style="text-align:left">ËâØÂ•Ω (Java Ê†∏ÂøÉ‰ºòÂäø‰πã‰∏Ä)</td>
</tr>
<tr>
<td style="text-align:left"><strong>ËøêË°åÊó∂ÂºÄÈîÄ</strong></td>
<td style="text-align:left">‰Ωé (Êó†ÁºñËØëÂºÄÈîÄ)</td>
<td style="text-align:left">Êúâ (ÁºñËØë CPU ÂºÄÈîÄ)</td>
</tr>
<tr>
<td style="text-align:left"><strong>ÂÖºÂÆπÊÄß</strong></td>
<td style="text-align:left">ÊåëÊàòËæÉÂ§ß</td>
<td style="text-align:left">Â•Ω</td>
</tr>
<tr>
<td style="text-align:left"><strong>‰ºòÂåñ‰æùÊçÆ</strong></td>
<td style="text-align:left">ÈùôÊÄÅÂàÜÊûê (+ ÊúâÈôêÁöÑ PGO)</td>
<td style="text-align:left">ËøêË°åÊó∂ÁúüÂÆûË°å‰∏∫</td>
</tr>
</tbody>
</table></div>
<h3 id="crac-ÁöÑÂàáÂÖ•ÁÇπ">
    <a href="#crac-%e7%9a%84%e5%88%87%e5%85%a5%e7%82%b9" class="header-anchor">#</a>
    CRaC ÁöÑÂàáÂÖ•ÁÇπ
</h3><p>ÁêÜËß£‰∫Ü <strong>AOT</strong> Âíå <strong>JIT</strong> ÂêÑËá™ÁöÑ‰ºòÂä£ÂêéÔºå<strong>CRaC</strong> ÁöÑ‰ª∑ÂÄºÂ∞±Êõ¥Âä†Ê∏ÖÊô∞‰∫Ü„ÄÇ</p>
<p><strong>CRaC</strong> ËØïÂõæÁªìÂêà‰∏§ËÄÖÁöÑ‰ºòÁÇπÔºåËßÑÈÅøÂÖ∂Áº∫ÁÇπÔºöÂÆÉ‰øùÁïô‰∫Ü <strong>JIT</strong> Â∏¶Êù•ÁöÑÂ≥∞ÂÄºÊÄßËÉΩ‰ºòÂäøÔºàÂõ†‰∏∫ <strong>Checkpoint</strong> ÊòØÂú® <strong>JIT</strong> ÂÖÖÂàÜÈ¢ÑÁÉ≠ÂêéÂàõÂª∫ÁöÑÔºâÔºåÂêåÊó∂ÈÄöËøáÁä∂ÊÄÅÊÅ¢Â§çÁöÑÊñπÂºèÔºåÈÅøÂÖç‰∫Ü <strong>JIT</strong> Êº´ÈïøÁöÑÂêØÂä®ÂíåÈ¢ÑÁÉ≠ËøáÁ®ãÔºåÂÆûÁé∞‰∫ÜÁ±ª‰ºº <strong>AOT</strong> ÁöÑÂø´ÈÄüÂêØÂä®ÔºàÁâπÂà´ÊòØËææÂà∞Â≥∞ÂÄºÊÄßËÉΩÁöÑÈÄüÂ∫¶Ôºâ„ÄÇ‰∏é <strong>AOT</strong> Áõ∏ÊØîÔºå<strong>CRaC</strong> ÂØπ Java Âä®ÊÄÅÁâπÊÄßÁöÑÂÖºÂÆπÊÄßÊõ¥Â•Ω„ÄÇ</p>
<p>Âõ†Ê≠§Ôºå<strong>CRaC</strong>„ÄÅ<strong>AOT</strong> Âíå‰º†ÁªüÁöÑ <strong>JIT</strong> ‰ª£Ë°®‰∫Ü Java ÊÄßËÉΩ‰ºòÂåñÁöÑ‰∏çÂêåÁ≠ñÁï•ÔºåÈÄÇÁî®‰∫é‰∏çÂêåÁöÑÂú∫ÊôØÂíåÈúÄÊ±Ç„ÄÇ</p>
<h2 id="‰∏âÂÆûÁé∞ÂéüÁêÜÊ∑±ÂÖ•-crac-ÁöÑÂøÉËÑè">
    <a href="#%e4%b8%89%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e6%b7%b1%e5%85%a5-crac-%e7%9a%84%e5%bf%83%e8%84%8f" class="header-anchor">#</a>
    ‰∏â„ÄÅÂÆûÁé∞ÂéüÁêÜÔºöÊ∑±ÂÖ• CRaC ÁöÑÂøÉËÑè
</h2><p><strong>CRaC</strong> ÊäÄÊúØÂπ∂ÈùûÁ©∫‰∏≠Ê•ºÈòÅÔºåÂÆÉÁöÑÂÆûÁé∞‰æùËµñ‰∫é‰∏Ä‰∏™Âº∫Â§ßÁöÑ Linux Â∑•ÂÖ∑Ôºö<a class="link" href="https://criu.org/"  target="_blank" rel="noopener"
    >CRIU</a>„ÄÇËôΩÁÑ∂ CRIU ÊòØ‰∏Ä‰∏™ËøêË°åÂú®Áî®Êà∑Á©∫Èó¥ÁöÑÁ®ãÂ∫èÔºå‰ΩÜÂÆÉÁöÑÊ†∏ÂøÉËÉΩÂäõÂª∫Á´ãÂú® Linux ÂÜÖÊ†∏Êèê‰æõÁöÑ‰∏∞ÂØåÁâπÊÄßÂíåÊé•Âè£‰πã‰∏ä„ÄÇÁêÜËß£ <strong>CRIU</strong> ÁöÑÂ∑•‰ΩúÂéüÁêÜÂØπ‰∫éÊ∑±ÂÖ•ÊéåÊè° <strong>CRaC</strong> Ëá≥ÂÖ≥ÈáçË¶Å„ÄÇ</p>
<h3 id="Âü∫Áü≥criu">
    <a href="#%e5%9f%ba%e7%9f%b3criu" class="header-anchor">#</a>
    Âü∫Áü≥ÔºöCRIU
</h3><p>CRIU  (Checkpoint/Restore In Userspace) ÊòØ‰∏Ä‰∏™ Linux Áî®Êà∑Á©∫Èó¥ÁöÑÂ∑•ÂÖ∑ÔºåÂÆÉÂÖÅËÆ∏‰Ω†‚ÄúÂÜªÁªì‚ÄùÔºà<strong>Checkpoint</strong>Ôºâ‰∏Ä‰∏™Ê≠£Âú®ËøêË°åÁöÑÂ∫îÁî®Á®ãÂ∫èÔºàÊàñ‰∏ÄÁªÑÂ∫îÁî®Á®ãÂ∫èÔºâÔºåÂ∞ÜÂÖ∂Áä∂ÊÄÅ‰øùÂ≠òÂà∞Á£ÅÁõòÊñá‰ª∂‰∏≠ÔºåÁÑ∂ÂêéÂú®Êú™Êù•ÁöÑÊüê‰∏™Êó∂Âàª‰ªéËøô‰∫õÊñá‰ª∂‰∏≠‚ÄúËß£ÂÜª‚ÄùÔºà<strong>Restore</strong>ÔºâÂÆÉ„ÄÇË¢´ÊÅ¢Â§çÁöÑÂ∫îÁî®Á®ãÂ∫èÂ∞Ü‰ªéË¢´ÂÜªÁªìÁöÑÈÇ£‰∏™Á≤æÁ°ÆÊó∂ÂàªÁªßÁª≠ËøêË°åÔºå‰ªø‰Ωõ‰ªÄ‰πàÈÉΩÊ≤°ÊúâÂèëÁîüËøá‰∏ÄÊ†∑„ÄÇ<strong>CRIU</strong> ÁöÑÊ†∏ÂøÉËÉΩÂäõÊòØ‰øùÂ≠òÂíåÊÅ¢Â§çËøõÁ®ãÁöÑÂêÑÁßçËµÑÊ∫êÁä∂ÊÄÅ„ÄÇ</p>
<h4 id="checkpoint-ËøáÁ®ãËØ¶Ëß£">
    <a href="#checkpoint-%e8%bf%87%e7%a8%8b%e8%af%a6%e8%a7%a3" class="header-anchor">#</a>
    Checkpoint ËøáÁ®ãËØ¶Ëß£
</h4><p><img src="https://cdn.mazhen.tech/2024/202504251743057.png"
	
	
	
	loading="lazy"
	
		alt="Checkpoint"
	
	
>
<strong>Checkpoint</strong> Èò∂ÊÆµ‰ºöÊâßË°å‰ª•‰∏ãÊ≠•È™§„ÄÇ</p>
<ol>
<li><strong>Êî∂ÈõÜËøõÁ®ãÊ†ëÂπ∂ÂÜªÁªì</strong></li>
</ol>
<p>CRIU È¶ñÂÖàÈúÄË¶ÅÁ°ÆÂÆöË¶Å <strong>Checkpoint</strong> ÁöÑÁõÆÊ†áËøõÁ®ãÂèäÂÖ∂ÊâÄÊúâÂ≠êËøõÁ®ãÂíåÁ∫øÁ®ãÔºåÊûÑÊàê‰∏Ä‰∏™ÂÆåÊï¥ÁöÑËøõÁ®ãÊ†ë„ÄÇ</p>
<p><code>/proc</code> ÊòØ‰∏Ä‰∏™ËôöÊãüÊñá‰ª∂Á≥ªÁªüÔºåÂÆÉÂπ∂‰∏çÂ≠òÂú®‰∫éÁ£ÅÁõò‰∏äÔºåËÄåÊòØÁî± Linux ÂÜÖÊ†∏Âä®ÊÄÅÁîüÊàêÔºåÁî®Êù•Êèê‰æõÊúâÂÖ≥Á≥ªÁªüÁä∂ÊÄÅÂíåÊ≠£Âú®ËøêË°åÁöÑËøõÁ®ãÁöÑ‰ø°ÊÅØ„ÄÇÂØπ‰∫éÊØè‰∏™Ê≠£Âú®ËøêË°åÁöÑËøõÁ®ãÔºå<code>/proc</code> ‰∏ãÈÉΩÊúâ‰∏Ä‰∏™‰ª•ËØ•ËøõÁ®ãÁöÑ PIDÔºàProcess IDÔºâÂëΩÂêçÁöÑÁõÆÂΩï„ÄÇ</p>
<p>Âú®‰∏Ä‰∏™ËøõÁ®ãÂÜÖÈÉ®ÔºåÂèØËÉΩÊúâ‰∏Ä‰∏™ÊàñÂ§ö‰∏™Á∫øÁ®ã„ÄÇÂú® Linux ÂÜÖÊ†∏ÁúãÊù•ÔºåÁ∫øÁ®ãÊú¨Ë¥®‰∏ä‰πüÊòØ‰∏ÄÁßç‚Äú‰ªªÂä°‚ÄùÔºàTaskÔºâÔºåÂÆÉ‰ª¨ÂÖ±‰∫´Âêå‰∏Ä‰∏™Âú∞ÂùÄÁ©∫Èó¥ÂíåÂÖ∂‰ªñËµÑÊ∫êÔºå‰ΩÜÊúâËá™Â∑±Áã¨Á´ãÁöÑÊâßË°åÊµÅÂíåË∞ÉÂ∫¶Ê†áËØÜÁ¨¶ÔºàTID, Thread IDÔºâ„ÄÇ<code>/proc/$pid/task/</code> Ëøô‰∏™ÁõÆÂΩïÂ∞±ÂåÖÂê´‰∫ÜËØ•ËøõÁ®ãÔºàPID ‰∏∫ <code>$pid</code>Ôºâ‰∏ãÁöÑÊâÄÊúâÁ∫øÁ®ãÔºà‰ªªÂä°ÔºâÁöÑ‰ø°ÊÅØ„ÄÇËØ•ÁõÆÂΩï‰∏ã‰ºö‰∏∫ÊØè‰∏™Á∫øÁ®ãÂàõÂª∫‰∏Ä‰∏™Â≠êÁõÆÂΩïÔºåÁõÆÂΩïÂêçÂ∞±ÊòØËØ•Á∫øÁ®ãÁöÑ TID„ÄÇ</p>
<p>ÈÄöËøáËØªÂèñ <code>/proc/$pid/task/</code> ÁõÆÂΩïÁöÑÂÜÖÂÆπÔºåCRIU ÂèØ‰ª•ËØÜÂà´Âá∫Â±û‰∫éËøõÁ®ã <code>$pid</code> ÁöÑÊâÄÊúâÁ∫øÁ®ãÔºàÂåÖÊã¨‰∏ªÁ∫øÁ®ãÂíåÂÖ∂‰ªñÂ≠êÁ∫øÁ®ãÔºâÔºåËé∑ÂèñÂÆÉ‰ª¨ÁöÑ TID ÂàóË°®„ÄÇ</p>
<p><code>/proc/$pid/task/$tid/children</code> Êñá‰ª∂‰Ωç‰∫éÁâπÂÆöÁ∫øÁ®ãÁöÑÁõÆÂΩï‰∏ãÔºåËÆ∞ÂΩï‰∫ÜÁî± <em>Ëøô‰∏™ÁâπÂÆöÁ∫øÁ®ã</em>ÔºàPID ‰∏∫ <code>$pid</code>ÔºåTID ‰∏∫ <code>$tid</code>Ôºâ<strong>Áõ¥Êé•ÂàõÂª∫</strong> ÁöÑÊâÄÊúâÂ≠êËøõÁ®ãÁöÑ PID ÂàóË°®„ÄÇÂ≠êËøõÁ®ãÊòØÁî± <code>fork()</code> Êàñ <code>clone()</code> Á≥ªÁªüË∞ÉÁî®ÂàõÂª∫ÁöÑ„ÄÇËøô‰∏™ <code>children</code> Êñá‰ª∂ÂëäËØâÊàë‰ª¨Ôºå‰ªéËøô‰∏™Á∫øÁ®ãÂá∫ÂèëÔºåËØûÁîü‰∫ÜÂì™‰∫õÊñ∞ÁöÑËøõÁ®ã„ÄÇ</p>
<p>CRIU ‰ªé <code>--tree</code> ÈÄâÈ°πÊåáÂÆöÁöÑÈÇ£‰∏™ÂàùÂßã PID ÂºÄÂßãÔºåÈ¶ñÂÖàÈÄöËøá <code>/proc/$pid/task/</code> ÊâæÂà∞‰∏Ä‰∏™ËøõÁ®ãÁöÑÊâÄÊúâÁ∫øÁ®ãÔºåÁÑ∂ÂêéÈÄöËøá <code>/proc/$pid/task/$tid/children</code> ÊâæÂà∞ÊØè‰∏™Á∫øÁ®ãÂàõÂª∫ÁöÑÂ≠êËøõÁ®ãÔºåÂÜçÂØπËøô‰∫õÂ≠êËøõÁ®ãÈáçÂ§çÂêåÊ†∑ÁöÑÊìç‰ΩúÔºå‰∏ÄÂ±ÇÂ±ÇÊ∑±ÂÖ•‰∏ãÂéªÔºåÊúÄÁªàÂÉèÂâ•Ê¥ãËë±‰∏ÄÊ†∑ÊääÊï¥‰∏™ËøõÁ®ãÂÆ∂ÊóèÔºàÂåÖÊã¨ÊâÄÊúâËøõÁ®ãÂíåÁ∫øÁ®ãÔºâÈÉΩËØÜÂà´Âá∫Êù•„ÄÇ</p>
<p>Âú®ÈÅçÂéÜËøáÁ®ã‰∏≠ÔºåCRIU ‰ΩøÁî® <code>ptrace</code> Á≥ªÁªüË∞ÉÁî®ÔºåÂëΩ‰ª§‰∏∫ <code>PTRACE_SEIZE</code>ÔºåÊù•ÈôÑÂä†ÔºàattachÔºâÂà∞ÁõÆÊ†áËøõÁ®ãÊ†ë‰∏≠ÁöÑÊØè‰∏™‰ªªÂä°ÔºàËøõÁ®ã/Á∫øÁ®ãÔºâ‰∏äÔºåÂπ∂Â∞ÜÂÆÉ‰ª¨<strong>ÊöÇÂÅú</strong>‰∏ãÊù•„ÄÇ</p>
<p>‰º†ÁªüÁöÑ¬†<code>PTRACE_ATTACH</code>¬†‰æùËµñ‰ø°Âè∑Êú∫Âà∂Ôºå<code>PTRACE_ATTACH</code>¬†‰ºöÂêëÁõÆÊ†áËøõÁ®ãÂèëÈÄÅ¬†<code>SIGSTOP</code>Ôºå<code>SIGSTOP</code>¬†‰ø°Âè∑ÈúÄË¶ÅË¢´ÁõÆÊ†áËøõÁ®ãÁöÑ‰ø°Âè∑Â§ÑÁêÜÁ®ãÂ∫èÂ§ÑÁêÜÔºåÁÑ∂ÂêéËøõÁ®ãÊâçÂÅúÊ≠¢„ÄÇ</p>
<p><code>PTRACE_SEIZE</code>¬†Âàô‰∏çÂêåÔºåÂÆÉ<strong>‰∏ç‰æùËµñÁî®Êà∑Á©∫Èó¥ÁöÑ‰ø°Âè∑‰º†ÈÄíÊù•ËÆ©ÁõÆÊ†áËøõÁ®ãÂÅúÊ≠¢</strong>ÔºåÊòØÂÜÖÊ†∏Â±ÇÈù¢ÁöÑ‰∏Ä‰∏™Áõ¥Êé•Êìç‰Ωú„ÄÇÂΩìË∞ÉÁî®¬†<code>ptrace(PTRACE_SEIZE, tid, ...)</code>¬†Êó∂ÔºåÂÜÖÊ†∏‰ºöÊ†áËÆ∞ÁõÆÊ†á‰ªªÂä°ÔºàÁ∫øÁ®ã¬†tidÔºâËøõÂÖ• <code>ptrace-stop</code> Áä∂ÊÄÅÔºåËøô‰∏™‰ªªÂä°‰ºöÂú®<strong>‰∏ã‰∏ÄÊ¨°ÂÜÖÊ†∏ÊúâÊú∫‰ºö‰ªãÂÖ•‰ªªÂä°ÊâßË°åÊµÅÁöÑÊó∂ÂÄô</strong>ÊöÇÂÅú„ÄÇ</p>
<ol start="2">
<li><strong>Êî∂ÈõÜ‰ªªÂä°ËµÑÊ∫êÂπ∂ËΩ¨ÂÇ®</strong></li>
</ol>
<p>ËøõÁ®ãÊ†ëË¢´ÂÜªÁªìÂêéÔºåCRIU ÂºÄÂßãÊî∂ÈõÜÊØè‰∏™‰ªªÂä°ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåÂπ∂Â∞ÜËøô‰∫õ‰ø°ÊÅØÂÜôÂÖ•ÈïúÂÉèÊñá‰ª∂Ôºàdump filesÔºâ„ÄÇËøô‰∫õ‰ø°ÊÅØ‰∏ªË¶ÅÊù•Ê∫ê‰∫é <code>/proc</code> Êñá‰ª∂Á≥ªÁªü„ÄÇ</p>
<ul>
<li><strong>ÂÜÖÂ≠òÊò†Â∞Ñ (Memory maps)</strong>
CRIU ÈÄöËøáËß£Êûê <code>/proc/$pid/maps</code> Âíå <code>/proc/$pid/smaps</code> Ëé∑ÂèñËôöÊãüÂÜÖÂ≠òÂå∫ÂüüÔºà<strong>VMA</strong>ÔºâÁöÑÂ∏ÉÂ±Ä‰ø°ÊÅØ„ÄÇ</li>
</ul>
<p><code>/proc/$pid/maps</code> ÂàóÂá∫‰∫ÜÂΩìÂâçËøõÁ®ã ($pid) <strong>ÊâÄÊúâÂÜÖÂ≠òÊò†Â∞ÑÂå∫ÂüüÔºàVirtual Memory Areas - VMAÔºâ</strong>¬†ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÔºåÊØè‰∏ÄË°å‰ª£Ë°®‰∏Ä‰∏™ËøûÁª≠ÁöÑËôöÊãüÂÜÖÂ≠òÂå∫ÂüüÔºåÈÄöÂ∏∏ÂåÖÂê´‰ª•‰∏ãÂ≠óÊÆµÔºåÁî®Á©∫Ê†ºÂàÜÈöîÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Ëµ∑ÂßãÂú∞ÂùÄ-ÁªìÊùüÂú∞ÂùÄ   ÊùÉÈôê    ÂÅèÁßªÈáè   ËÆæÂ§áÂè∑<span class="o">(</span>‰∏ª:Ê¨°<span class="o">)</span>  inode  Ë∑ØÂæÑÂêç
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶ÇÊûúÊòØ<strong>Êñá‰ª∂Êò†Â∞Ñ</strong>Ôºå<strong>ËÆæÂ§áÂè∑</strong>Ë°®Á§∫Êñá‰ª∂ÊâÄÂú®ÁöÑËÆæÂ§áÔºå<strong>inode</strong> Ë°®Á§∫Êñá‰ª∂ÁöÑ <code>inode</code> ÁºñÂè∑Ôºå<strong>Ë∑ØÂæÑÂêç</strong>‰ºöÊòæÁ§∫Ë¢´Êò†Â∞ÑÊñá‰ª∂ÁöÑ<strong>Ë∑ØÂæÑ</strong>„ÄÇ</p>
<p>ÂØπ‰∫é<strong>ÂåøÂêçÊò†Â∞Ñ</strong>ÔºåÂç≥Ê≤°ÊúâÂÖ≥ËÅîÂÖ∑‰ΩìÊñá‰ª∂ÔºåÂ¶Ç¬†malloc¬†ÂàÜÈÖçÁöÑÂÜÖÂ≠ò„ÄÅËøõÁ®ãÁöÑÂ†Ü„ÄÅÊ†àÁ≠âÔºå<strong>inode</strong> ÂÄº‰∏∫ 0Ôºå<strong>Ë∑ØÂæÑÂêç</strong>ÈÄöÂ∏∏‰∏∫Á©∫ÔºåÊàñËÄÖÊòæÁ§∫‰∏Ä‰∫õÁâπÊÆäÊ†áËÆ∞ÔºåÂ¶Ç <code>[heap]</code> Ë°®Á§∫ËøõÁ®ãÁöÑÂ†ÜÂÜÖÂ≠òÂå∫ÂüüÔºå<code>[stack]</code>Ë°®Á§∫ËøõÁ®ãÁöÑ‰∏ªÁ∫øÁ®ãÊ†àÂå∫Âüü„ÄÇ</p>
<p>‰æãÂ¶ÇÊü•ÁúãÂ∫îÁî®ÊúçÂä°Âô®ËøõÁ®ãÁöÑ <code>maps</code> Êñá‰ª∂ÂÜÖÂÆπÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">$cat</span> /proc/10854/maps
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">5b565de16000-5b565de17000 rw-p <span class="m">00003000</span> 103:02 <span class="m">34101432</span>                  /home/mazhen/works/jdk-21.0.6/jdk/bin/java
</span></span><span class="line"><span class="cl">5b5683910000-5b5683958000 rw-p <span class="m">00000000</span> 00:00 <span class="m">0</span>                          <span class="o">[</span>heap<span class="o">]</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">7f95a4000000-7f95a4028000 r--p <span class="m">00000000</span> 103:02 58869401¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† /usr/lib/x86_64-linux-gnu/libc.so.6
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">7fff8da95000-7fff8dab7000 rw-p <span class="m">00000000</span> 00:00 0¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <span class="o">[</span>stack<span class="o">]</span>
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>/proc/$pid/maps</code>¬†ÊòØ CRIU ÁêÜËß£ËøõÁ®ã<strong>ÂÜÖÂ≠òÂ∏ÉÂ±Ä</strong>ÁöÑÊ†∏ÂøÉ‰æùÊçÆÔºåËÄå <code>/proc/$pid/smaps</code>¬†ÊòØ¬†<code>/proc/$pid/maps</code>¬†ÁöÑ‰∏Ä‰∏™<strong>Êâ©Â±ïÁâàÊú¨</strong>„ÄÇ</p>
<p><code>/proc/$pid/smaps</code>‰∏∫ÊØè‰∏Ä‰∏™ÂÜÖÂ≠òÊò†Â∞ÑÂå∫ÂüüÔºà<strong>VMA</strong>ÔºâÊèê‰æõ‰∫ÜÊõ¥ËØ¶ÁªÜÁöÑÂÜÖÂ≠òÂç†Áî®ÁªüËÆ°‰ø°ÊÅØÔºàÁâ©ÁêÜÂÜÖÂ≠òÂç†Áî®„ÄÅÂÖ±‰∫´/ÁßÅÊúâ„ÄÅÂπ≤ÂáÄ/ËÑè„ÄÅÂåøÂêç„ÄÅ‰∫§Êç¢„ÄÅÈîÅÂÆöÁ≠âÔºâÔºå‰ª•ÂèäÈáçË¶ÅÁöÑÂÜÖÊ†∏ÂÜÖÈÉ®Ê†áÂøó (VmFlags)„ÄÇ<code>smaps</code> Áî±Â§ö‰∏™<strong>Âùó (block)</strong>¬†ÁªÑÊàêÔºåÊØè‰∏™ÂùóÂØπÂ∫î¬†<code>/proc/$pid/maps</code>¬†Êñá‰ª∂‰∏≠ÁöÑ‰∏ÄË°åÔºàÂç≥‰∏Ä‰∏™ <strong>VMA</strong>Ôºâ„ÄÇ</p>
<p>ËøòÊòØ‰ª•Â∫îÁî®ÊúçÂä°Âô®ËøõÁ®ã‰∏∫‰æãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">$cat</span> /proc/10854/smaps
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">5b5683910000-5b5683958000 rw-p <span class="m">00000000</span> 00:00 <span class="m">0</span>                          <span class="o">[</span>heap<span class="o">]</span>
</span></span><span class="line"><span class="cl">Size:                <span class="m">288</span> kB
</span></span><span class="line"><span class="cl">KernelPageSize:        <span class="m">4</span> kB
</span></span><span class="line"><span class="cl">MMUPageSize:           <span class="m">4</span> kB
</span></span><span class="line"><span class="cl">Rss:                  <span class="m">96</span> kB
</span></span><span class="line"><span class="cl">Pss:                  <span class="m">96</span> kB
</span></span><span class="line"><span class="cl">Pss_Dirty:            <span class="m">96</span> kB
</span></span><span class="line"><span class="cl">Shared_Clean:          <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">Shared_Dirty:          <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">Private_Clean:         <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">Private_Dirty:        <span class="m">96</span> kB
</span></span><span class="line"><span class="cl">Referenced:           <span class="m">96</span> kB
</span></span><span class="line"><span class="cl">Anonymous:            <span class="m">96</span> kB
</span></span><span class="line"><span class="cl">KSM:                   <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">LazyFree:              <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">AnonHugePages:         <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">ShmemPmdMapped:        <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">FilePmdMapped:         <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">Shared_Hugetlb:        <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">Private_Hugetlb:       <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">Swap:                  <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">SwapPss:               <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">Locked:                <span class="m">0</span> kB
</span></span><span class="line"><span class="cl">THPeligible:           <span class="m">0</span>
</span></span><span class="line"><span class="cl">ProtectionKey:         <span class="m">0</span>
</span></span><span class="line"><span class="cl">VmFlags: rd wr mr mw me ac sd 
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>ÂÜÖÂ≠òÊò†Â∞ÑÊñá‰ª∂Ôºàmapped filesÔºâ</strong></li>
</ul>
<p><code>/proc/$pid/map_files/</code> ÊòØ‰∏Ä‰∏™<strong>ÁõÆÂΩï</strong>ÔºåËøô‰∏™ÁõÆÂΩïÂåÖÂê´‰∫Ü<strong>ÊåáÂêëÂÆûÈôÖË¢´Êò†Â∞ÑÊñá‰ª∂ÁöÑÁ¨¶Âè∑ÈìæÊé• (symbolic links)</strong>„ÄÇÁõÆÂΩï‰∏≠ÁöÑÊØè‰∏™Á¨¶Âè∑ÈìæÊé•ÁöÑ<strong>ÂêçÁß∞</strong>ÂØπÂ∫î‰∫é¬†<code>/proc/$pid/maps</code>¬†Êñá‰ª∂‰∏≠ÂàóÂá∫ÁöÑ‰∏Ä‰∏™<strong>ÂÜÖÂ≠òÂå∫ÂüüÁöÑÂú∞ÂùÄËåÉÂõ¥</strong>¬†(Ê†ºÂºè‰∏∫¬†Ëµ∑ÂßãÂú∞ÂùÄ - ÁªìÊùüÂú∞ÂùÄ)„ÄÇ</p>
<p>CRIU ÈÄöËøá <code>/proc/$pid/map_files/</code>¬†Ëé∑ÂèñÊñá‰ª∂Êò†Â∞ÑÂå∫Âüü<strong>Â∫ïÂ±ÇÊñá‰ª∂ÂØπË±°ÁöÑÁõ¥Êé•ÈìæÊé•</strong>Ôºå‰∏ªË¶ÅÁî®‰∫é<strong>ÂèØÈù†Âú∞ËÆøÈóÆÂíåËØªÂèñ</strong>Ëøô‰∫õÊñá‰ª∂Êò†Â∞ÑÂå∫ÂüüÁöÑÂÜÖÂÆπ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls -l /proc/10854/map_files   
</span></span><span class="line"><span class="cl">total <span class="m">0</span>
</span></span><span class="line"><span class="cl">lr-------- <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 06:58 5b565de12000-5b565de13000 -&gt; /home/mazhen/works/jdk-21.0.6/jdk/bin/java
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">lr-------- <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 06:58 7f95a4000000-7f95a4028000 -&gt; /usr/lib/x86_64-linux-gnu/libc.so.6
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>Êñá‰ª∂ÊèèËø∞Á¨¶ (File descriptors)</strong></li>
</ul>
<p>CRIU ÈÄöËøáËØªÂèñ <code>/proc/$pid/fd</code> Âíå <code>/proc/$pid/fdinfo</code> Ëé∑ÂèñËøõÁ®ãÊâìÂºÄÁöÑÊñá‰ª∂„ÄÅÁÆ°ÈÅì„ÄÅÂ•óÊé•Â≠óÁ≠â‰ø°ÊÅØ„ÄÇCRIU ËÉΩÂ§üÂ§ÑÁêÜÂêÑÁßçÁ±ªÂûãÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂåÖÊã¨Â∏∏ËßÑÊñá‰ª∂„ÄÅÁÆ°ÈÅì„ÄÅUnix Â•óÊé•Â≠ó„ÄÅTCP Â•óÊé•Â≠óÔºàÁîöËá≥ÂåÖÊã¨Â§Ñ‰∫é ESTABLISHED Áä∂ÊÄÅÁöÑËøûÊé•Ôºâ„ÄÇ</p>
<p><code>/proc/$pid/fd</code>ÊòØ‰∏Ä‰∏™<strong>ÁõÆÂΩï</strong>ÔºåÂÆÉÂåÖÂê´<strong>Á¨¶Âè∑ÈìæÊé•</strong>ÔºåÊØè‰∏™Á¨¶Âè∑ÈìæÊé•ÁöÑÂêçÁß∞ÂØπÂ∫î‰∏Ä‰∏™Â∑≤ÊâìÂºÄÁöÑ<strong>Êñá‰ª∂ÊèèËø∞Á¨¶ÁºñÂè∑</strong>„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls -l /proc/10854/fd
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">l-wx------ <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 02:00 <span class="m">2</span> -&gt; <span class="s1">&#39;pipe:[195498]&#39;</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">lr-x------ <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 02:00 <span class="m">3</span> -&gt; /home/mazhen/works/jdk-21.0.6/jdk/lib/modules
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">lrwx------ <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 07:21 <span class="m">379</span> -&gt; <span class="s1">&#39;socket:[2629]&#39;</span>
</span></span><span class="line"><span class="cl">lrwx------ <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 07:21 <span class="m">380</span> -&gt; <span class="s1">&#39;socket:[2636]&#39;</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">lrwx------ <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 07:21 <span class="m">477</span> -&gt; <span class="s1">&#39;anon_inode:[eventpoll]&#39;</span>
</span></span><span class="line"><span class="cl">lrwx------ <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 07:21 <span class="m">478</span> -&gt; <span class="s1">&#39;anon_inode:[eventfd]&#39;</span>
</span></span><span class="line"><span class="cl">lr-x------ <span class="m">1</span> mazhen mazhen <span class="m">64</span> Apr <span class="m">25</span> 07:21 <span class="m">479</span> -&gt; anon_inode:inotify
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>/proc/$pid/fdinfo</code>‰πüÊòØ‰∏Ä‰∏™<strong>ÁõÆÂΩï</strong>ÔºåÂÆÉÂåÖÂê´<strong>ÊôÆÈÄöÊñá‰ª∂</strong>Ôºà‰∏çÊòØÁ¨¶Âè∑ÈìæÊé•ÔºâÔºåÊØè‰∏™Êñá‰ª∂ÁöÑÂêçÁß∞ÂØπÂ∫î‰∏Ä‰∏™Â∑≤ÊâìÂºÄÁöÑ<strong>Êñá‰ª∂ÊèèËø∞Á¨¶ÁºñÂè∑</strong>„ÄÇÊØè‰∏™Êñá‰ª∂Ôºà‰æãÂ¶Ç<code>/proc/$pid/fdinfo/1</code>ÔºâÂåÖÂê´ÂÖ≥‰∫éÁõ∏Â∫îÊñá‰ª∂ÊèèËø∞Á¨¶ÁöÑ<strong>ÂÖÉÊï∞ÊçÆÂíåÁä∂ÊÄÅ‰ø°ÊÅØ</strong>„ÄÇ‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls -l /proc/10854/fdinfo 
</span></span><span class="line"><span class="cl">total <span class="m">0</span>
</span></span><span class="line"><span class="cl">-r--r--r-- <span class="m">1</span> mazhen mazhen <span class="m">0</span> Apr <span class="m">25</span> 07:31 <span class="m">0</span>
</span></span><span class="line"><span class="cl">-r--r--r-- <span class="m">1</span> mazhen mazhen <span class="m">0</span> Apr <span class="m">25</span> 07:31 <span class="m">1</span>
</span></span><span class="line"><span class="cl">-r--r--r-- <span class="m">1</span> mazhen mazhen <span class="m">0</span> Apr <span class="m">25</span> 07:31 <span class="m">10</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">$ cat /proc/10854/fdinfo/20
</span></span><span class="line"><span class="cl">pos:	<span class="m">381</span>
</span></span><span class="line"><span class="cl">flags:	<span class="m">0100000</span>
</span></span><span class="line"><span class="cl">mnt_id:	<span class="m">31</span>
</span></span><span class="line"><span class="cl">ino:	<span class="m">32775204</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>/proc/$pid/fd</code>ÂëäËØâ CRIU ÈÄöËøáÂì™‰∫õÊèèËø∞Á¨¶ÁºñÂè∑ÊâìÂºÄ‰∫Ü<strong>Âì™‰∫õ</strong>ËµÑÊ∫êÔºå<code>/proc/$pid/fdinfo</code>ÂëäËØâ CRIU ÊØè‰∏™Â∑≤ÊâìÂºÄÊèèËø∞Á¨¶ÁöÑ<strong>Áä∂ÊÄÅÂíåÂÖÉÊï∞ÊçÆ</strong>ÔºàÊØîÂ¶Ç‰ΩçÁΩÆÂíåÊ†áÂøóÔºâ„ÄÇCRIU ‰ΩøÁî®Êù•Ëá™Ëøô‰∏§‰∏™‰ΩçÁΩÆÁöÑ‰ø°ÊÅØÊù•ÂÆåÊï¥‰øùÂ≠òËøõÁ®ãÂ∑≤ÊâìÂºÄÊñá‰ª∂ÂèäÂÖ∂Áä∂ÊÄÅÁöÑÊÉÖÂÜµÔºå‰ª•‰æø‰πãÂêéËÉΩÂ§üÂáÜÁ°ÆÂú∞ÊÅ¢Â§çÂÆÉ‰ª¨„ÄÇ</p>
<ul>
<li><strong>Ê†∏ÂøÉËøêË°åÂèÇÊï∞ (Core parameters)</strong></li>
</ul>
<p>‰∏∫‰∫Ü‰øùÂ≠ò‰∏Ä‰∏™‰ªªÂä°ÔºàËøõÁ®ã/Á∫øÁ®ãÔºâÁöÑÊ†∏ÂøÉËøêË°åÁä∂ÊÄÅ‰ª•‰æøÂêéÁª≠ÊÅ¢Â§çÔºåCRIU ‰∏ªË¶ÅÁªìÂêà‰ΩøÁî®‰∫Ü‰∏§ÁßçÊñπÊ≥ï„ÄÇ</p>
<p>‰ΩøÁî®¬†<code>ptrace</code>¬†Á≥ªÁªüË∞ÉÁî®ÁöÑÁâπÂÆöÂëΩ‰ª§Ôºà‰æãÂ¶Ç<code>PTRACE_GETREGS</code>¬†Êàñ¬†<code>PTRACE_GETFPREGS</code>¬†ÔºâÊù•<strong>Áõ¥Êé•ËØªÂèñ</strong>‰ªªÂä°ÊöÇÂÅúÊó∂ÁöÑ<strong>CPU ÂØÑÂ≠òÂô® (registers)</strong>¬†ÂÜÖÂÆπÔºåÂåÖÊã¨ÈÄöÁî®ÂØÑÂ≠òÂô®„ÄÅÊåá‰ª§ÊåáÈíà„ÄÅÊ†áÂøóÂØÑÂ≠òÂô®„ÄÅÊµÆÁÇπÂØÑÂ≠òÂô®Á≠âÔºâÔºå‰ª•ÂèäÂÖ∂‰ªñÂØÜÂàáÁõ∏ÂÖ≥ÁöÑÂ∫ïÂ±ÇÊâßË°åÁä∂ÊÄÅ‰ø°ÊÅØ„ÄÇ</p>
<p>ÈÄöËøáËØªÂèñÂíåËß£Êûê¬†<code>/proc/$pid/stat</code>¬†Êñá‰ª∂ÔºåËé∑ÂèñÂÖ≥‰∫é‰ªªÂä°ÁöÑ<strong>ÂêÑÁßçÁä∂ÊÄÅÂèÇÊï∞ÂíåÁªüËÆ°Êï∞ÊçÆ</strong>„ÄÇ<code>/proc/$pid/stat</code>¬†‰ª•<strong>ÂçïË°åÊñáÊú¨</strong>ÁöÑÂΩ¢ÂºèÊèê‰æõ‰∫ÜÂÖ≥‰∫éËøõÁ®ãÁöÑÂ§ßÈáè<strong>Áä∂ÊÄÅ‰ø°ÊÅØ (status information)</strong>ÔºåÂÖ∂‰∏≠ÁöÑ‰ø°ÊÅØÁî±<strong>Á©∫Ê†º</strong>ÂàÜÈöîÔºåÊØè‰∏™Â≠óÊÆµ‰ª£Ë°®‰∏Ä‰∏™ÁâπÂÆöÁöÑËøõÁ®ãÂ±ûÊÄßÊàñÁªüËÆ°ÂÄº„ÄÇ‰∏ãÈù¢ÂàóÂá∫‰∏Ä‰∫õÊúÄÊ†∏ÂøÉÂíåÂ∏∏Áî®ÁöÑÂ≠óÊÆµÔºö</p>
<ul>
<li>ÂèØÊâßË°åÊñá‰ª∂Âêç (comm)</li>
<li>ËøõÁ®ãÁä∂ÊÄÅ (state)</li>
<li>Áà∂ËøõÁ®ã ID (ppid)</li>
<li>ËøõÁ®ãÁªÑ ID (pgrp)</li>
<li>‰ºöËØù ID (session)</li>
<li>Ë∞ÉÂ∫¶‰ºòÂÖàÁ∫ßÂíå nice ÂÄº (priority, nice)</li>
<li>ËôöÊãüÂÜÖÂ≠òÂ§ßÂ∞è (vsize)</li>
<li>Â∏∏È©ªÈõÜÂ§ßÂ∞è (rss)</li>
<li>ËøõÁ®ãÂêØÂä®Êó∂Èó¥ (starttime)</li>
<li>Á≠âÂæÖÂ≠êËøõÁ®ãÁöÑ CPU Êó∂Èó¥ (cutime, cstime)</li>
</ul>
<ol start="3">
<li><strong>Ê≥®ÂÖ•ÂØÑÁîü‰ª£Á†ÅÔºàParasite CodeÔºâÂπ∂ËΩ¨ÂÇ®ÂÜÖÂ≠ò</strong></li>
</ol>
<p>‰∏∫‰∫ÜËé∑ÂèñÊüê‰∫õÊó†Ê≥ï‰ªéÂ§ñÈÉ®Áõ¥Êé•Êé¢ÊµãÁöÑ‰ø°ÊÅØÔºà‰æãÂ¶ÇËøõÁ®ãÂá≠ËØÅ„ÄÅÁ≤æÁ°ÆÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÂíåÂÜÖÂÆπÔºâÔºåCRIU ÂøÖÈ°ªÂú®ÁõÆÊ†áËøõÁ®ãÁöÑÂú∞ÂùÄÁ©∫Èó¥ÂÜÖÈÉ®ÊâßË°åÁâπÂÆöÁöÑ‰ª£Á†Å„ÄÇËøôÊ≠£ÊòØÈÄöËøá¬†<strong>ÂØÑÁîü‰ª£Á†Å (Parasite Code)</strong>¬†ÊäÄÊúØÂÆûÁé∞ÁöÑ„ÄÇ</p>
<p><strong>ÂØÑÁîü‰ª£Á†Å</strong>ÊòØ‰∏ÄÊÆµÁ≤æÂøÉÊûÑÈÄ†ÁöÑÂ∞èÂûã‰∫åËøõÂà∂Á®ãÂ∫èÔºåÂÆÉ‰ª•<strong>‰ΩçÁΩÆÊó†ÂÖ≥ÂèØÊâßË°åÊñá‰ª∂ (PIE, Position-Independent Executable)</strong>¬†Ê†ºÂºèÁºñËØë„ÄÇËøô‰∏ÄÁâπÊÄßËá≥ÂÖ≥ÈáçË¶ÅÔºåÂõ†‰∏∫ÂÆÉÂÖÅËÆ∏ CRIU Â∞ÜËøôÊÆµ‰ª£Á†ÅÂä†ËΩΩÂà∞ÁõÆÊ†áËøõÁ®ãÂú∞ÂùÄÁ©∫Èó¥‰∏≠ÁöÑ<strong>‰ªª‰ΩïÂèØÁî®‰ΩçÁΩÆ</strong>ÔºåËÄåÊó†ÈúÄÊãÖÂøÉÂõ†Á°¨ÁºñÁ†ÅÂú∞ÂùÄÂºïÂèëÁöÑÂÜ≤Á™Å„ÄÇËØ•‰ª£Á†ÅÈÄöÂ∏∏ÂåÖÂê´‰∏§ÈÉ®ÂàÜÔºö‰∏ÄÂ∞èÊÆµ‰æùËµñ‰∫éÂÖ∑‰ΩìÂ§ÑÁêÜÂô®Êû∂ÊûÑÔºàÂ¶Ç x86, ARMÔºâÁöÑÊ±áÁºñ<strong>ÂºïÂØºÁ®ãÂ∫è (bootstrap)</strong>Ôºå‰ª•Âèä‰∏ÄÊÆµÁî® C ËØ≠Ë®ÄÁºñÂÜô„ÄÅË¥üË¥£Â§ÑÁêÜÂëΩ‰ª§ÁöÑÈÄöÁî®<strong>Ê†∏ÂøÉÈÄªËæë (daemon)</strong>„ÄÇ</p>
<img src="https://cdn.mazhen.tech/2024/202504251748420.png" alt="Parasite Code" style="zoom:33%;" />
<p>Ë¶ÅÂú®ÁõÆÊ†áËøõÁ®ã‰∏≠ËøêË°åÔºå<strong>ÂØÑÁîü‰ª£Á†Å</strong>ÈúÄË¶ÅËá™Â∑±ÁöÑÂÜÖÂ≠òÁ©∫Èó¥Êù•Â≠òÊîæÂÖ∂‰ª£Á†Å„ÄÅËøêË°åÊ†à‰ª•ÂèäÁî®‰∫éÂíå CRIU ËøõË°åÈÄö‰ø°ÁöÑÂèÇÊï∞Âå∫Âüü„ÄÇÁî±‰∫é CRIU ‰∏çËÉΩÁõ¥Êé•Êìç‰ΩúÁõÆÊ†áËøõÁ®ãÁöÑÂÜÖÂ≠òÂàÜÈÖçÔºåÂÆÉÂ∑ßÂ¶ôÂú∞Âà©Áî®‰∫Ü¬†<code>ptrace</code>¬†Êú∫Âà∂Ôºö</p>
<ul>
<li><strong>ÂáÜÂ§áÂÜÖÂ≠òÁ©∫Èó¥</strong>
<ul>
<li>CRIU È¶ñÂÖà‰ΩøÁî®¬†<code>ptrace</code>¬†ÊéßÂà∂ÁõÆÊ†áËøõÁ®ãÔºåÂπ∂<strong>‰øùÂ≠òÂÖ∂ÂΩìÂâçÁöÑÂØÑÂ≠òÂô®Áä∂ÊÄÅ</strong>ÔºàÂ∞§ÂÖ∂ÊòØÊåá‰ª§ÊåáÈíà CS:IP ÂíåÊ†àÊåáÈíàÔºâ„ÄÇ</li>
<li>Êé•ÁùÄÔºåCRIU ‰øÆÊîπÁõÆÊ†áËøõÁ®ãÁöÑÂØÑÂ≠òÂô®ÔºåÂ°´ÂÖ•ÊâßË°å¬†<code>mmap</code>¬†Á≥ªÁªüË∞ÉÁî®ÊâÄÈúÄÁöÑÁºñÂè∑ÂíåÂèÇÊï∞„ÄÇ</li>
<li>ÈÄöËøá¬†<code>ptrace(PTRACE_SYSCALL,...)</code>Ôºå<strong>Âº∫Âà∂ÁõÆÊ†áËøõÁ®ãÊâßË°åËøô‰∏™¬†mmap¬†Ë∞ÉÁî®</strong>„ÄÇËøô‰ºöÂú®ÁõÆÊ†áËøõÁ®ãÁöÑÂú∞ÂùÄÁ©∫Èó¥‰∏≠ÂàÜÈÖç‰∏ÄÂùó<strong>ÂÖ±‰∫´ÂÜÖÂ≠òÂå∫Âüü</strong>„ÄÇ</li>
</ul>
</li>
<li><strong>Ê≥®ÂÖ•Âπ∂ÊâßË°åÂØÑÁîü‰ª£Á†Å</strong>
<ul>
<li>CRIU ‰ΩøÁî® <code>ptrace(PTRACE_POKEDATA, ...)</code> ÔºåÂ∞ÜÈ¢ÑÂÖàÁºñËØëÂ•ΩÁöÑÂÆåÊï¥<strong>ÂØÑÁîü‰ª£Á†Å</strong>‰∫åËøõÂà∂Êï∞ÊçÆÂÜôÂÖ•Âà∞ÂàöÂàöÂàÜÈÖçÁöÑÂÖ±‰∫´ÂÜÖÂ≠òÂå∫Âüü‰∏≠„ÄÇ</li>
<li>CRIU ÂÜçÊ¨°‰ΩøÁî®¬†<code>ptrace</code>¬†‰øÆÊîπÁõÆÊ†áËøõÁ®ãÁöÑÂØÑÂ≠òÂô®ÔºåÂ∞Ü<strong>Êåá‰ª§ÊåáÈíà (IP/PC)</strong>¬†ÊåáÂêëÂÖ±‰∫´ÂÜÖÂ≠ò‰∏≠<strong>ÂØÑÁîü‰ª£Á†Å</strong>ÁöÑÂÖ•Âè£ÁÇπ„ÄÇ</li>
<li>CRIU ÂëΩ‰ª§ÁõÆÊ†áËøõÁ®ãÊÅ¢Â§çÊâßË°å <code>ptrace(PTRACE_CONT, ...)</code>„ÄÇÊ≠§Êó∂ÔºåÁõÆÊ†áËøõÁ®ã‰æøÂºÄÂßãÊâßË°åË¢´Ê≥®ÂÖ•ÁöÑ<strong>ÂØÑÁîü‰ª£Á†Å</strong>„ÄÇ</li>
</ul>
</li>
</ul>
<p><strong>ÂØÑÁîü‰ª£Á†Å</strong>ËøêË°åÂú®ÁõÆÊ†áËøõÁ®ãÁöÑ‰∏ä‰∏ãÊñá‰∏≠ÔºåÂõ†Ê≠§Êã•ÊúâËÆøÈóÆËØ•ËøõÁ®ãÊâÄÊúâËµÑÊ∫êÁöÑÊùÉÈôê„ÄÇÂÆÉÂèØ‰ª•ÊâßË°å CRIU ÊåáÊ¥æÁöÑÂêÑÁßç‰ªªÂä°Ôºå‰æãÂ¶ÇËØªÂèñÂíåËΩ¨ÂÇ®ÁßÅÊúâÂÜÖÂ≠òÈ°µ„ÄÅÊî∂ÈõÜÊñá‰ª∂ÊèèËø∞Á¨¶ÁöÑËØ¶ÁªÜÁä∂ÊÄÅÁ≠â„ÄÇ</p>
<ol start="4">
<li><strong>Ê∏ÖÁêÜ (Cleanup)</strong></li>
</ol>
<p>ÂΩìÊâÄÊúâÈúÄË¶ÅÈÄöËøáÂØÑÁîü‰ª£Á†ÅÂÆåÊàêÁöÑ‰ªªÂä°ÁªìÊùüÂêéÔºåÂøÖÈ°ªÂ∞ÜÂÖ∂ÂΩªÂ∫ïÁßªÈô§ÔºåÂπ∂Â∞ÜÁõÆÊ†áËøõÁ®ãÊÅ¢Â§çÂà∞‰πãÂâçÁöÑÁä∂ÊÄÅÔºå‰ªø‰Ωõ‰ªéÊú™Ë¢´ÊâìÊâ∞ËøáÔºö</p>
<ul>
<li><strong>ÂØÑÁîü‰ª£Á†ÅÈÄÄÂá∫</strong>
<ul>
<li>CRIU ÈÄöËøáÂÖ±‰∫´ÂÜÖÂ≠òÊàñ‰∏ìÁî®ÈÄö‰ø°ÈÄöÈÅìÂêëÂØÑÁîü‰ª£Á†ÅÂèëÈÄÅ‰∏Ä‰∏™ÁªìÊùüÂëΩ‰ª§ (<code>PARASITE_CMD_FINI</code>)„ÄÇ</li>
<li><strong>ÂØÑÁîü‰ª£Á†Å</strong>Êî∂Âà∞ÂëΩ‰ª§ÂêéÔºåÊâßË°åÂøÖË¶ÅÁöÑÊ∏ÖÁêÜÊìç‰ΩúÔºåÁÑ∂ÂêéË∞ÉÁî®¬†<code>rt_sigreturn()</code>¬†Á≥ªÁªüË∞ÉÁî®„ÄÇÊ≠§Á≥ªÁªüË∞ÉÁî®‰ºöÂà©Áî® CRIU ‰∫ãÂÖàÂáÜÂ§áÂ•ΩÁöÑ‰ø°ÊÅØÔºå<strong>ÊÅ¢Â§çÁõÆÊ†áËøõÁ®ãÂú®ÂØÑÁîü‰ª£Á†ÅÊ≥®ÂÖ•Ââç‰∏ÄÂàªÁöÑÂØÑÂ≠òÂô®Áä∂ÊÄÅ</strong>„ÄÇ</li>
</ul>
</li>
<li><strong>CRIU Ê∏ÖÁêÜÁéØÂ¢É</strong>
<ul>
<li>CRIU ÈÄöËøá¬†<code>ptrace</code>¬†ÁõëËßÜÁ≥ªÁªüË∞ÉÁî®ÔºåÂπ∂Êã¶Êà™¬†<code>rt_sigreturn()</code>¬†ÁöÑÈÄÄÂá∫„ÄÇ</li>
<li>Âú®ÁõÆÊ†áËøõÁ®ãÂØÑÂ≠òÂô®Â∑≤ÊÅ¢Â§ç„ÄÅ‰ΩÜÂØÑÁîü‰ª£Á†ÅÁöÑÂÜÖÂ≠òÂå∫ÂüüËøòÂú®ÁöÑÁü≠ÊöÇÊó∂ÂàªÔºåCRIU ÂÜçÊ¨°Âà©Áî®¬†<code>ptrace</code>¬†<strong>Âº∫Âà∂ÁõÆÊ†áËøõÁ®ãÊâßË°å¬†munmap¬†Á≥ªÁªüË∞ÉÁî®</strong>ÔºåÂ∞Ü‰πãÂâç‰∏∫ÂØÑÁîü‰ª£Á†ÅÂàÜÈÖçÁöÑÂÖ±‰∫´ÂÜÖÂ≠òÂå∫ÂüüËß£Èô§Êò†Â∞ÑÔºåÂΩªÂ∫ïÊäπÈô§ÂÖ∂ÁóïËøπ„ÄÇ</li>
</ul>
</li>
<li><strong>ÊÅ¢Â§çÊ≠£Â∏∏ËøêË°å</strong>
<ul>
<li>ÊúÄÂêéÔºåCRIU Ë∞ÉÁî®¬†<code>ptrace(PTRACE_DETACH, ...)</code>¬†‰ªéÁõÆÊ†áËøõÁ®ãÂàÜÁ¶ª„ÄÇ</li>
<li>ÁõÆÊ†áËøõÁ®ã‰ªéÂÖ∂ÂéüÂßãË¢´‰∏≠Êñ≠ÁöÑÊåá‰ª§Â§ÑÔºàÁî±ÊÅ¢Â§çÁöÑÂØÑÂ≠òÂô®Áä∂ÊÄÅÂÜ≥ÂÆöÔºâÁªßÁª≠ÊâßË°åÔºåÊï¥‰∏™ËøõÁ®ãÊ†ëÊÅ¢Â§çËøêË°åÔºå<strong>Checkpoint</strong> Êìç‰ΩúÂÆåÊàê„ÄÇ</li>
</ul>
</li>
</ul>
<h4 id="restore-ËøáÁ®ãËØ¶Ëß£">
    <a href="#restore-%e8%bf%87%e7%a8%8b%e8%af%a6%e8%a7%a3" class="header-anchor">#</a>
    Restore ËøáÁ®ãËØ¶Ëß£
</h4><p><img src="https://cdn.mazhen.tech/2024/202504270949861.png"
	
	
	
	loading="lazy"
	
		alt="Restore"
	
	
></p>
<p><strong>Restore (ÊÅ¢Â§ç)</strong>¬†ËøáÁ®ãÂèØ‰ª•Áúã‰ΩúÊòØ <strong>Checkpoint</strong> (Ê£ÄÊü•ÁÇπ) ÁöÑÈÄÜÂêëÊìç‰Ωú„ÄÇÂú®Ëøô‰∏™ËøáÁ®ã‰∏≠ÔºåÊâßË°åÊÅ¢Â§çÂëΩ‰ª§ÁöÑ CRIU ËøõÁ®ã‰ºöÁªèÂéÜ‰∏ÄÁ≥ªÂàóÁ≤æÂøÉËÆæËÆ°ÁöÑÊ≠•È™§ÔºåÊúÄÁªà‚ÄúÂèòÂΩ¢‚ÄùÊàê‰∏∫Ê£ÄÊü•ÁÇπÊó∂ÂàªË¢´ÂÜªÁªìÁöÑÁõÆÊ†áËøõÁ®ãÔºàÊàñËøõÁ®ãÊ†ëÔºâÔºåÂπ∂‰ªéÈÇ£‰∏ÄÂàªÁªßÁª≠ËøêË°å„ÄÇÊï¥‰∏™ËøáÁ®ãÂ§ßËá¥ÂàÜ‰∏∫‰ª•‰∏ãÂõõ‰∏™‰∏ªË¶ÅÈò∂ÊÆµÔºö</p>
<ol>
<li><strong>Ëß£ÊûêÂÖ±‰∫´ËµÑÊ∫ê</strong></li>
</ol>
<p>CRIU È¶ñÂÖàËØªÂèñÊ£ÄÊü•ÁÇπÁîüÊàêÁöÑÈïúÂÉèÊñá‰ª∂ÔºåÂàÜÊûêËøõÁ®ãÈó¥ÁöÑ‰æùËµñÂÖ≥Á≥ª„ÄÇÂÆÉ‰ºöÊâæÂá∫Âì™‰∫õËµÑÊ∫êÂÆû‰æãÔºà‰æãÂ¶ÇÔºöÂêå‰∏Ä‰∏™‰ºöËØù ID„ÄÅÂêå‰∏Ä‰∏™ÊâìÂºÄÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÊåáÂêëÁöÑÂÜÖÊ†∏Êñá‰ª∂ÂØπË±°„ÄÅÂêå‰∏ÄÂùóÂÖ±‰∫´ÂÜÖÂ≠òÂå∫ÂüüÁ≠âÔºâÊòØË¢´Â§ö‰∏™ËøõÁ®ãÂÖ±Âêå‰ΩøÁî®ÁöÑ„ÄÇ</p>
<p>ËØÜÂà´Âá∫Ëøô‰∫õÂÖ±‰∫´ËµÑÊ∫êÂêéÔºåCRIU ‰ºöÊ†áËÆ∞ÂÆÉ‰ª¨ÔºåÂπ∂Á°ÆÂÆöÊÅ¢Â§çÁ≠ñÁï•„ÄÇÊüê‰∫õËµÑÊ∫ê‰ºöÈÄöËøá<strong>ÁªßÊâø</strong>ÔºàÂ¶Ç‰ºöËØù IDÔºåÂú® fork() Êó∂Áî±Â≠êËøõÁ®ãËá™ÁÑ∂Ëé∑ÂæóÔºâÔºåÂÖ∂‰ªñÁöÑÂàôÈúÄË¶ÅÊõ¥Â§çÊùÇÁöÑÊú∫Âà∂ÔºåÊØîÂ¶ÇÂà©Áî® <strong>Unix domain socket</strong> Âíå <strong>SCM_RIGHTS Ê∂àÊÅØ</strong> Âú®ËøõÁ®ãÈó¥‰º†ÈÄíÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÊàñËÄÖ‰ΩøÁî® <strong>memfd</strong> Á≠âÊäÄÊúØÊù•ÈáçÂª∫ÂÖ±‰∫´ÂÜÖÂ≠òÂå∫Âüü„ÄÇËøô‰∏ÄÊ≠•ÊòØ‰∏∫‰∫ÜÁ°Æ‰øùÂú®ÂêéÁª≠Èò∂ÊÆµÔºåËøô‰∫õÂÖ±‰∫´ËµÑÊ∫êËÉΩË¢´Ê≠£Á°ÆÂú∞ÂàõÂª∫‰∏ÄÊ¨°ÔºåÂπ∂Ë¢´ÊâÄÊúâÁõ∏ÂÖ≥ÁöÑËøõÁ®ãÂÖ±‰∫´ÔºåËÄå‰∏çÊòØÂêÑËá™ÂàõÂª∫Áã¨Á´ãÁöÑÂÆû‰æã„ÄÇ</p>
<ol start="2">
<li><strong>ÂàõÂª∫ËøõÁ®ãÊ†ë</strong></li>
</ol>
<p>CRIU ‰∏•Ê†ºÊåâÁÖßÈïúÂÉèÊñá‰ª∂‰∏≠ËÆ∞ÂΩïÁöÑÁà∂Â≠êÂÖ≥Á≥ªÔºåÈÄöËøáÂ§öÊ¨°Ë∞ÉÁî®¬†<code>fork()</code>¬†Á≥ªÁªüË∞ÉÁî®Êù•ÈáçÊñ∞ÂàõÂª∫ÂéüÂßãÁöÑËøõÁ®ãÊ†ë„ÄÇÊØè‰∏™¬†<code>fork()</code>¬†ÈÉΩ‰ºö‰∫ßÁîü‰∏Ä‰∏™Êñ∞ÁöÑËøõÁ®ãÔºåÂÖ∂Áà∂ËøõÁ®ãÊòØ‰πãÂâçÂ∑≤ÊÅ¢Â§çÁöÑÂØπÂ∫îÁà∂ËøõÁ®ã„ÄÇ</p>
<p>Ê≥®ÊÑèÔºåÂú®Ëøô‰∏™Èò∂ÊÆµÔºå<strong>Âè™ÂàõÂª∫ËøõÁ®ãÁöÑ‰∏ªÁ∫øÁ®ã</strong>„ÄÇÁõÆÊ†áËøõÁ®ãÁöÑÊâÄÊúâÂÖ∂‰ªñÁ∫øÁ®ãÁöÑÊÅ¢Â§ç‰ºöË¢´<strong>Êé®ËøüÂà∞ÊúÄÂêé‰∏Ä‰∏™Èò∂ÊÆµ</strong>Ôºå‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÁÆÄÂåñÂêéÁª≠ÂÜÖÂ≠òÂ∏ÉÂ±ÄË∞ÉÊï¥Êó∂ÁöÑÂêåÊ≠•ÈóÆÈ¢ò„ÄÇ</p>
<ol start="3">
<li><strong>ÊÅ¢Â§çÂü∫Êú¨‰ªªÂä°ËµÑÊ∫ê</strong></li>
</ol>
<p>Âú®Ëøô‰∏™Èò∂ÊÆµÔºåCRIU ‰∏∫ËøõÁ®ãÊ†ë‰∏≠ÁöÑÊØè‰∏™ËøõÁ®ãÊÅ¢Â§çÈô§‰∫ÜÂ∞ëÊï∞Âá†Á±ªÁâπÊÆäËµÑÊ∫ê‰πãÂ§ñÁöÑÂ§ßÈÉ®ÂàÜÁä∂ÊÄÅ„ÄÇÊ≠§Êó∂ÊÅ¢Â§çÁöÑËµÑÊ∫êÂåÖÊã¨Ôºö</p>
<ul>
<li><strong>Êñá‰ª∂ÊèèËø∞Á¨¶Ôºö</strong>¬†ÊâìÂºÄÊ£ÄÊü•ÁÇπÊó∂ËÆ∞ÂΩïÁöÑÊñá‰ª∂Ôºà‰ΩøÁî®‰øùÂ≠òÁöÑË∑ØÂæÑ„ÄÅËÆøÈóÆÊ®°Âºè„ÄÅÊ†áÂøó‰ΩçÔºâÔºåÂπ∂Ê†πÊçÆÈúÄË¶ÅËÆæÁΩÆÂà∞<strong>Á°ÆÂàáÁöÑÊñá‰ª∂ÂÅèÁßªÈáè</strong>„ÄÇÂØπ‰∫éÁÆ°ÈÅì„ÄÅÂ•óÊé•Â≠óÁ≠â‰πü‰ºöËøõË°åÂàõÂª∫„ÄÇ</li>
<li><strong>ÂëΩÂêçÁ©∫Èó¥ (Namespaces):</strong>¬†Â¶ÇÊûúËøõÁ®ã‰ΩøÁî®‰∫ÜÈùûÈªòËÆ§ÁöÑÂëΩÂêçÁ©∫Èó¥ÔºàÂ¶Ç PID„ÄÅMount„ÄÅNetwork„ÄÅIPC„ÄÅUser„ÄÅUTSÔºâÔºåCRIU ‰ºöÂàõÂª∫ÊàñÂä†ÂÖ•Áõ∏Â∫îÁöÑÂëΩÂêçÁ©∫Èó¥ÔºåÈöîÁ¶ªËøõÁ®ãÁéØÂ¢É„ÄÇ</li>
<li><strong>ÁßÅÊúâÂÜÖÂ≠òÊò†Â∞ÑÔºö</strong>¬†Êò†Â∞ÑËøõÁ®ãÁöÑ<strong>ÁßÅÊúâ</strong>ÂÜÖÂ≠òÂå∫ÂüüÔºàÂ¶Ç‰ª£Á†ÅÊÆµ„ÄÅÊï∞ÊçÆÊÆµ„ÄÅÂ†Ü„ÄÅÂåøÂêçÊò†Â∞ÑÁ≠âÔºâÔºåÂπ∂‰ªéÈïúÂÉèÊñá‰ª∂‰∏≠ËØªÂèñÊ£ÄÊü•ÁÇπÊó∂‰øùÂ≠òÁöÑÊï∞ÊçÆÔºå<strong>Â°´ÂÖÖ</strong>Âà∞Ëøô‰∫õÂÜÖÂ≠òÂå∫Âüü‰∏≠„ÄÇ</li>
<li><strong>Â•óÊé•Â≠ó (Sockets):</strong>¬†ÂàõÂª∫Â•óÊé•Â≠óÔºåÂπ∂ÊÅ¢Â§çÂÖ∂Áä∂ÊÄÅÔºàÂ¶Ç TCP ËøûÊé•ÁöÑÁä∂ÊÄÅÔºåÂ¶ÇÊûúÊ£ÄÊü•ÁÇπÊó∂‰øùÂ≠ò‰∫ÜÁõ∏ÂÖ≥‰ø°ÊÅØÂπ∂ÈÖçÁΩÆ‰∫Ü TCP ‰øÆÂ§çÔºâ„ÄÇ</li>
<li><strong>Â∑•‰ΩúÁõÆÂΩï‰∏éÊ†πÁõÆÂΩïÔºö</strong>¬†Ë∞ÉÁî®¬†chdir()¬†Âíå¬†chroot()¬†ÊÅ¢Â§çËøõÁ®ãÊ£ÄÊü•ÁÇπÊó∂ÂàªÁöÑÂΩìÂâçÂ∑•‰ΩúÁõÆÂΩïÂíåÊ†πÁõÆÂΩï„ÄÇ</li>
<li><strong>ÂÖ∂‰ªñÔºö</strong>¬†ËøòÂèØËÉΩÂåÖÊã¨ÊÅ¢Â§ç‰ø°Âè∑Â§ÑÁêÜÂô®„ÄÅËøõÁ®ãÁöÑ umask Á≠â„ÄÇ</li>
</ul>
<p>ÊúâÂõõÁ±ªÂÖ≥ÈîÆËµÑÊ∫êÂú®Ê≠§Èò∂ÊÆµ<strong>‰∏ç‰ºö</strong>Ë¢´ÂÆåÂÖ®ÊÅ¢Â§çÔºåÂÆÉ‰ª¨ÁöÑÊÅ¢Â§çË¢´ÁâπÊÑèÊé®ËøüÂà∞‰∫ÜÊúÄÂêéÈò∂ÊÆµÔºö</p>
<ul>
<li>ÂÜÖÂ≠òÊò†Â∞ÑÁöÑ<strong>Á°ÆÂàáËôöÊãüÂú∞ÂùÄ</strong>ÔºàÊ≠§Èò∂ÊÆµÂèØËÉΩÊò†Â∞ÑÂú®‰∏¥Êó∂Âú∞ÂùÄÔºâ„ÄÇ</li>
<li><strong>ÂÆöÊó∂Âô® (Timers)</strong>„ÄÇ</li>
<li><strong>Âá≠ËØÅ (Credentials)</strong>¬†(Â¶Ç UID, GID, Capabilities)„ÄÇ</li>
<li><strong>Á∫øÁ®ã (Threads)</strong>¬†(Èô§‰∫Ü‰∏ªÁ∫øÁ®ã)„ÄÇ</li>
</ul>
<p>ËøôÂá†Á±ªËµÑÊ∫ê‰πãÊâÄ‰ª•Âª∂ËøüÊÅ¢Â§çÔºå‰∏ªË¶ÅÊòØÂõ†‰∏∫ÂÆÉ‰ª¨Ë¶Å‰πà‰æùËµñ‰∫éÊúÄÁªàÁöÑÂÜÖÂ≠òÂ∏ÉÂ±ÄÔºåË¶Å‰πàÊ∂âÂèäÁâπÊùÉÊìç‰ΩúÔºåË¶Å‰πàÂú®ÊúÄÁªàÊâßË°åÂâçÊÅ¢Â§çÂèØËÉΩÂØºËá¥Áä∂ÊÄÅ‰∏ç‰∏ÄËá¥ÊàñÂ§çÊùÇÂåñÂ§ÑÁêÜ„ÄÇ</p>
<ol start="4">
<li><strong>ÂàáÊç¢Âà∞ Restorer ContextÔºåÊÅ¢Â§çÂâ©‰ΩôËµÑÊ∫êÂπ∂ÁªßÁª≠ÊâßË°å</strong></li>
</ol>
<p>ËøôÊòØÊúÄÂÖ≥ÈîÆÁöÑ‰∏ÄÊ≠•„ÄÇÂõ†‰∏∫ÊâßË°åÊÅ¢Â§çÊìç‰ΩúÁöÑ CRIU ‰ª£Á†ÅÊú¨Ë∫´Â∞±‰Ωç‰∫éÈúÄË¶ÅË¢´ÊõøÊç¢ÊéâÁöÑÂÜÖÂ≠òÂå∫Âüü‰∏≠„ÄÇÁõ¥Êé•ÊâßË°å¬†<code>munmap()</code>¬†Âç∏ËΩΩÊóßÂÜÖÂ≠òÊàñ¬†<code>mmap()</code>¬†Êò†Â∞ÑÊñ∞ÂÜÖÂ≠òÂà∞ÂΩìÂâçÂú∞ÂùÄÔºåÈÉΩ‰ºöÂØºËá¥ CRIU Ëá™Ë∫´Â¥©Ê∫É„ÄÇ</p>
<p>‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåCRIU ÂºïÂÖ•‰∫Ü‰∏Ä‰∏™ <strong>Restorer Context (ÊÅ¢Â§çÂô®‰∏ä‰∏ãÊñá)</strong>ÔºåËøôÊòØ‰∏ÄÂ∞èÊÆµ<strong>Ëá™ÂåÖÂê´ÁöÑ„ÄÅ‰ΩçÁΩÆÊó†ÂÖ≥ÁöÑ (PIE)</strong>¬†‰ª£Á†ÅÔºå‰∏ç‰æùËµñÂ§ñÈÉ®Â∫ìÔºåÂπ∂‰∏îË¢´Âä†ËΩΩÂà∞‰∏Ä‰∏™‰∏¥Êó∂ÁöÑ„ÄÅÊó¢‰∏çÂ±û‰∫é CRIU ‰∏ª‰Ωì‰πü‰∏çÂ±û‰∫éÁõÆÊ†áËøõÁ®ãÊúÄÁªàÂÜÖÂ≠òÂ∏ÉÂ±ÄÁöÑ‚Äú<strong>ÂÆâÂÖ®Âú∞Â∏¶ (safe zone)</strong>‚Äù„ÄÇ</p>
<p>CRIU ÂáÜÂ§áÂ•ΩÊÅ¢Â§çÊâÄÈúÄÁöÑÊï∞ÊçÆÔºàÂ¶ÇÊúÄÁªàÂÜÖÂ≠òÊò†Â∞Ñ‰ø°ÊÅØ„ÄÅÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÅÂá≠ËØÅÁ≠âÔºâÔºåÊâæÂà∞ÂêàÈÄÇÁöÑÂÜÖÂ≠ò‚ÄúÁ©∫Ê¥û‚ÄùÂä†ËΩΩÊÅ¢Â§çÂô®‰ª£Á†ÅÂíåÊï∞ÊçÆÔºåÁÑ∂ÂêéÈÄöËøá‰∏ÄÊ¨°<strong>Ë∑≥ËΩ¨</strong>ÔºåÂ∞Ü CPU ÁöÑÊâßË°åÊéßÂà∂ÊùÉËΩ¨ÁßªÁªôËøôÊÆµÊÅ¢Â§çÂô®‰ª£Á†Å„ÄÇ</p>
<p>Âú® <strong>Restorer Context</strong> ‰∏≠ÔºåÂÆåÊàêÊúÄÂêéÂá†È°πËµÑÊ∫êÁöÑÊÅ¢Â§çÔºö</p>
<ul>
<li><strong>ÂÜÖÂ≠òÊò†Â∞Ñ (Memory):</strong>¬†‰ΩøÁî®¬†<code>mremap()</code>¬†Â∞Ü‰πãÂâçÊò†Â∞ÑÂú®‰∏¥Êó∂Âú∞ÂùÄÁöÑÁßÅÊúâÂåøÂêçÂÜÖÂ≠òÁßªÂä®Âà∞ÊúÄÁªàÁöÑÁõÆÊ†áËôöÊãüÂú∞ÂùÄ„ÄÇ‰ΩøÁî®¬†<code>mmap()</code>¬†Âú®Ê≠£Á°ÆÁöÑÂú∞ÂùÄÂàõÂª∫Êñá‰ª∂Êò†Â∞ÑÂíåÂÖ±‰∫´ÂÜÖÂ≠òÊò†Â∞ÑÔºàÂèØËÉΩÈÄöËøá‰πãÂâçÂáÜÂ§áÂ•ΩÁöÑ¬†<code>memfd</code>¬†Êñá‰ª∂ÊèèËø∞Á¨¶Êù•ÂÆûÁé∞ÂÖ±‰∫´Ôºâ„ÄÇÊ≠§Êó∂ÔºåÂÆåÊï¥ÁöÑ„ÄÅÁ≤æÁ°ÆÁöÑËøõÁ®ãÂÜÖÂ≠òÂ∏ÉÂ±ÄË¢´Âª∫Á´ãËµ∑Êù•„ÄÇ</li>
<li><strong>ÂÆöÊó∂Âô® (Timers):</strong>¬†ÊÅ¢Â§çÂπ∂ÂêØÂä®ÊâÄÊúâÁöÑÂÆöÊó∂Âô®„ÄÇÂõ†‰∏∫Ê≠§Êó∂ÁéØÂ¢ÉÂ∑≤Á®≥ÂÆöÔºåÂèØ‰ª•ÈÅøÂÖçÂÆöÊó∂Âô®ËøáÊó©Ëß¶ÂèëÊàñËÆ°Êó∂ÂÅèÂ∑Æ„ÄÇ</li>
<li><strong>Âá≠ËØÅ (Credentials):</strong>¬†ËÆæÁΩÆËøõÁ®ãÊúÄÁªàÁöÑÁî®Êà∑ ID„ÄÅÁªÑ ID„ÄÅËÉΩÂäõÈõÜÁ≠â„ÄÇËøôÈÄöÂ∏∏Âú®ÈúÄË¶ÅÁâπÊùÉÁöÑÊìç‰ΩúÔºàÂ¶Ç¬†<code>fork()</code>¬†ÊåáÂÆö PIDÔºâÂÆåÊàêÂêéÔºå‰ΩÜÂú®ÂΩªÂ∫ïÊîæÂºÉÁâπÊùÉ‰πãÂâçËøõË°å„ÄÇ</li>
<li><strong>Á∫øÁ®ã (Threads):</strong>¬†Âú®ÊúÄÁªàÁöÑÂÜÖÂ≠òÂ∏ÉÂ±Ä‰∏≠ÔºåÊ†πÊçÆ‰øùÂ≠òÁöÑÁä∂ÊÄÅÂàõÂª∫Âπ∂ÊÅ¢Â§çÁõÆÊ†áËøõÁ®ãÁöÑÊâÄÊúâÂÖ∂‰ªñÁ∫øÁ®ã„ÄÇ</li>
</ul>
<p>ÊúÄÂêéÔºå<strong>Restorer Context</strong> ÂÆåÊàêÊâÄÊúâËÆæÁΩÆÂêéÔºåÂÆÉ‰ºö<strong>Á≤æÁ°ÆÂú∞ÊÅ¢Â§çÁõÆÊ†áËøõÁ®ã‰∏ªÁ∫øÁ®ãÁöÑÂØÑÂ≠òÂô®Áä∂ÊÄÅ</strong>ÔºàÂåÖÊã¨ÊúÄÈáçË¶ÅÁöÑ<strong>Êåá‰ª§ÊåáÈíà IP/PC</strong>ÔºåÊåáÂêëÊ£ÄÊü•ÁÇπÊó∂ÂàªË¢´‰∏≠Êñ≠ÁöÑÈÇ£Êù°Êåá‰ª§ÔºâÔºåÁÑ∂ÂêéÂ∞Ü CPU ÁöÑÊéßÂà∂ÊùÉÂΩªÂ∫ï‰∫§ËøòÁªôÁõÆÊ†áËøõÁ®ã„ÄÇËá≥Ê≠§ÔºåÁõÆÊ†áËøõÁ®ãÂ∞±ÂÉè‰ªéÊú™Ë¢´ÊâìÊñ≠Ëøá‰∏ÄÊ†∑Ôºå‰ªéÊ£ÄÊü•ÁÇπÊó∂ÂàªÁöÑÁä∂ÊÄÅ<strong>Êó†ÁºùÂú∞ÁªßÁª≠ÊâßË°å</strong>„ÄÇ</p>
<h4 id="criu-Â∞èÁªì">
    <a href="#criu-%e5%b0%8f%e7%bb%93" class="header-anchor">#</a>
    CRIU Â∞èÁªì
</h4><p>CRIU ÈÄöËøá <code>ptrace</code> ÂíåÁ≤æÂøÉËÆæËÆ°ÁöÑ<strong>ÂØÑÁîü‰ª£Á†Å</strong>Êú∫Âà∂Ôºå‰ª•ÂèäÂØπ <code>/proc</code> Êñá‰ª∂Á≥ªÁªüÁöÑÊ∑±Â∫¶Âà©Áî®ÔºåÂÆûÁé∞‰∫ÜÂú®Áî®Êà∑Á©∫Èó¥ÂØπËøêË°å‰∏≠ËøõÁ®ãËøõË°å <strong>Checkpoint</strong> Âíå <strong>Restore</strong> ÁöÑÂº∫Â§ßËÉΩÂäõÔºå‰∏∫ CRaC ÊäÄÊúØÁöÑÂÆûÁé∞Â•†ÂÆö‰∫ÜÂùöÂÆûÁöÑÂü∫Á°Ä„ÄÇ</p>
<h3 id="crac-ÁöÑËÆæËÆ°ÁêÜÂøµ">
    <a href="#crac-%e7%9a%84%e8%ae%be%e8%ae%a1%e7%90%86%e5%bf%b5" class="header-anchor">#</a>
    CRaC ÁöÑËÆæËÆ°ÁêÜÂøµ
</h3><p>ÁêÜËß£‰∫Ü CRIU ÁöÑÂº∫Â§ßËÉΩÂäõÂêéÔºå‰∏Ä‰∏™Ëá™ÁÑ∂ÁöÑÈóÆÈ¢òÊòØÔºöÊó¢ÁÑ∂ CRIU ËÉΩÂ§üÂ§ÑÁêÜÊâìÂºÄÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶ÂíåÁΩëÁªúËøûÊé•ÔºåÁîöËá≥ÂèØ‰ª•ÈÄèÊòéÂú∞ÊÅ¢Â§çÂÆÉ‰ª¨Ôºå‰∏∫‰ªÄ‰πà CRaC Âç¥Ë¶ÅÊ±ÇÂºÄÂèëËÄÖÈÄöËøá APIÔºà<code>jdk.crac.Resource</code>ÔºâÊù•ÊâãÂä®ÁÆ°ÁêÜËøô‰∫õÂ§ñÈÉ®ËµÑÊ∫êÔºåÈÄöÂ∏∏ÈúÄË¶ÅÂú® <code>beforeCheckpoint</code> ‰∏≠ÂÖ≥Èó≠ÂÆÉ‰ª¨ÔºåÂú® <code>afterRestore</code> ‰∏≠ÈáçÊñ∞Âª∫Á´ãÂÆÉ‰ª¨Âë¢Ôºü</p>
<p>ÂØπ‰∫éËøô‰∏™ÈóÆÈ¢òÔºåÊàëÊü•ÈòÖ‰∫Ü CRaC ÊâÄÊúâÁõ∏ÂÖ≥ÁöÑÊñáÊ°£ÔºåÈòÖËØª‰∫Ü CRaC ÂéüÂûãÂÆûÁé∞ÁöÑÊ∫êÁ†ÅÔºåÈÉΩÊ≤°ÊúâËé∑ÂæóÊª°ÊÑèÁöÑÁ≠îÊ°à„ÄÇ‰∫éÊòØÂú® CRaC ÁöÑÂºÄÂèëËÄÖÈÇÆ‰ª∂ÂàóË°®‰∏≠ËØ¢ÈóÆÔºåÊúÄÁªà‰ªéÊ†∏ÂøÉ Committer ÁöÑ<a class="link" href="https://mail.openjdk.org/pipermail/crac-dev/2025-April/002313.html"  target="_blank" rel="noopener"
    >ÂõûÂ§ç</a>‰∏≠ÂæóÂà∞Ëß£Á≠î„ÄÇ</p>
<img src="https://cdn.mazhen.tech/2024/202504271032455.jpg" alt="CRaC ÈÇÆ‰ª∂ÂàóË°®" style="zoom: 33%;" />
<p>Ê†πÊçÆ CRaC ÂºÄÂèëËÄÖÁöÑÈòêËø∞ÔºåËøôÂπ∂ÈùûÊäÄÊúØ‰∏äÁöÑÈôêÂà∂ÔºåËÄåÊòØ‰∏Ä‰∏™Ê∑±ÊÄùÁÜüËôëÁöÑ<strong>Êû∂ÊûÑÈÄâÊã© (architectural choice)</strong>„ÄÇÂÖ∂Ê†∏ÂøÉËÆæËÆ°ÁêÜÂøµÂèØ‰ª•Ê¶ÇÊã¨‰∏∫ <strong>ÂçèË∞É‰∏éÈÄÇÂ∫î</strong>„ÄÇ</p>
<p>CRIU ÁöÑ‰∏ªË¶ÅÂä®Êú∫‰πã‰∏ÄÊòØÂÆûÁé∞ËøêË°å‰∏≠ÂÆπÂô®ÁöÑÈÄèÊòéËøÅÁßª„ÄÇÂú®ÂÆπÂô®ËøÅÁßªÂú∫ÊôØ‰∏ãÔºåÁéØÂ¢ÉÔºàÊñá‰ª∂Á≥ªÁªü„ÄÅÁΩëÁªúÔºâÈÄöÂ∏∏ÊòØË¢´Á≤æÂøÉÁÆ°ÁêÜÁöÑ„ÄÇÂÆπÂô®ËøêË°åÊó∂ÔºàÂ¶Ç Docker„ÄÅKubernetes CRIÔºâÂèØ‰ª•ÈÖçÂêà CRIU Â∑•‰ΩúÔºåÁ°Æ‰øùÊÅ¢Â§çÂêéÔºåÂ§ñÈÉ®ÁéØÂ¢ÉÔºàÊØîÂ¶ÇÁΩëÁªúËøûÊé•ÁöÑÂØπÁ´Ø„ÄÅÊåÇËΩΩÁöÑÊñá‰ª∂Á≥ªÁªüÔºâ‰ªçÁÑ∂ÊúâÊïàÊàñË¢´Ê≠£Á°ÆÂú∞ÈáçÊñ∞Âª∫Á´ãÔºå‰ªéËÄåÂØπÂÆπÂô®ÂÜÖÁöÑËøõÁ®ãÂÅöÂà∞‚ÄúÈÄèÊòé‚Äù„ÄÇÊØîÂ¶ÇÔºåÁΩëÁªúËøûÊé•ÊÅ¢Â§çÊó∂ÔºåÂÆπÂô®ËøêË°åÊó∂‰ºöÂ§ÑÁêÜÂ•Ω IP Âú∞ÂùÄ„ÄÅË∑ØÁî±Á≠âÈóÆÈ¢ò„ÄÇ</p>
<p>Â¶ÇÊûú‰Ω†ËøΩÊ±ÇÁöÑÊòØ CRIU ÈÇ£Áßç‚ÄúÈÄèÊòéÊÅ¢Â§ç‚ÄùÔºåÁêÜËÆ∫‰∏äÂèØ‰ª•Áõ¥Êé•Âú® Java ËøõÁ®ã‰∏ä‰ΩøÁî® CRIU„ÄÇ‰ΩÜËøôÊúâÈ£éÈô©ÔºåÂèØËÉΩ‰ºöÁ†¥ÂùèÂ∫îÁî®Á®ãÂ∫èÁöÑÂÜÖÈÉ®ÈÄªËæë„ÄÇÂõ†‰∏∫ Java Â∫îÁî®ÂèØËÉΩ‰æùËµñÂ§ñÈÉ®ËµÑÊ∫êÁöÑÁä∂ÊÄÅÔºåÂ¶ÇÊûúÁéØÂ¢ÉÂèòÂåñËÄåÂ∫îÁî®Ê≤°ÊúâÊÑüÁü•ÂíåË∞ÉÊï¥ÔºåÂ∞±‰ºöÂá∫ÈóÆÈ¢òÔºàÊØîÂ¶ÇÊï∞ÊçÆÂ∫ìËøûÊé•ÊåáÂêë‰∫ÜÊóßÁöÑ„ÄÅ‰∏çÂ≠òÂú®ÁöÑ IPÔºåÊàñËÄÖÊñá‰ª∂Âè•ÊüÑÊåáÂêë‰∫Ü‰∏Ä‰∏™Âú®ÊÅ¢Â§çÁéØÂ¢É‰∏≠Â∑≤ÂèòÂåñÊàñ‰∏çÂ≠òÂú®ÁöÑÊñá‰ª∂Ôºâ„ÄÇ</p>
<p>CRaC ÁöÑÁõÆÊ†á‰∏çÊòØËøΩÊ±ÇÂÆåÂÖ®ÈÄèÊòéÁöÑÊÅ¢Â§ç„ÄÇÂÆÉÊÉ≥Ë¶ÅÁöÑÊòØÔºö‰øùÁïô JVM ÂíåÂ∫îÁî®Á®ãÂ∫èÂÜÖÈÉ®ËÆ°ÁÆóÁöÑ<strong>Êúâ‰ª∑ÂÄºÁöÑÁä∂ÊÄÅ</strong>ÔºàÊØîÂ¶Ç JIT ÁºñËØëÁªìÊûú„ÄÅÁºìÂ≠òÊï∞ÊçÆ„ÄÅ‰∏öÂä°ÈÄªËæëÁä∂ÊÄÅÔºâÔºå‰ΩÜË¶ÅËÆ©Â∫îÁî®Á®ãÂ∫èÊúâÊú∫‰ºö<strong>‰∏ªÂä®ÈÄÇÂ∫î</strong>ÊÅ¢Â§çÊó∂ÂèØËÉΩÂ∑≤ÁªèÂèòÂåñÁöÑ<strong>Êñ∞ÁéØÂ¢É</strong>„ÄÇ</p>
<p><strong>CRaCÔºàCoordinated Restore at CheckpointÔºâ</strong> ÁöÑÂêçÂ≠óÂº∫Ë∞É‰∫Ü‚ÄúÂçèË∞É‚ÄùÔºà<strong>Coordinated</strong>Ôºâ„ÄÇÂÆÉË¶ÅÊ±ÇÂ∫îÁî®Á®ãÂ∫èÈÄöËøáÂÆûÁé∞ <code>Resource</code> Êé•Âè£Êù•ÂèÇ‰∏é <code>Checkpoint</code> Âíå <code>Restore</code> ËøáÁ®ã„ÄÇCRaC Â∏åÊúõÂºÄÂèëËÄÖÂØπÊØè‰∏Ä‰∏™Â§ñÈÉ®ËµÑÊ∫êÔºàÊñá‰ª∂„ÄÅÁΩëÁªúËøûÊé•„ÄÅÊï∞ÊçÆÂ∫ìËøûÊé•Á≠âÔºâÂú®ÊÅ¢Â§çÊó∂Â¶Ç‰ΩïÂ§ÑÁêÜÔºåÂÅöÂá∫<strong>ÊúâÊÑèËØÜÁöÑÂÜ≥ÂÆö</strong>ÔºöËøô‰∏™ËµÑÊ∫êÂú® <strong>Checkpoint</strong> ÂâçÂ∫îËØ•Â¶Ç‰ΩïÂ§ÑÁêÜÔºàÈÄöÂ∏∏ÊòØÂÖ≥Èó≠ÔºâÔºüÂú® <strong>Restore</strong> ÂêéÂ∫îËØ•Â¶Ç‰ΩïÂ§ÑÁêÜÔºàÈÄöÂ∏∏ÊòØÈáçÊñ∞Âª∫Á´ãÊàñÈ™åËØÅÔºâÔºü</p>
<p>ËøôÁßçÂº∫Âà∂ÊÄßÁöÑÂçèË∞ÉÊú∫Âà∂Ë¢´ CRaC ËßÜ‰∏∫‰∏Ä‰∏™<strong>ÁâπÊÄß (feature)</strong>ÔºåËÄå‰∏çÊòØ‰∏Ä‰∏™Áº∫Èô∑„ÄÇËøôÁ°Æ‰øù‰∫ÜÂ∫îÁî®Á®ãÂ∫èËÉΩÂ§ü‰ºòÈõÖÂú∞ÈÄÇÂ∫î (gracefully adapt) ÊÅ¢Â§çÂêéÁöÑÊñ∞ÁéØÂ¢ÉÔºåËÄå‰∏çÊòØÁõ≤ÁõÆÂú∞ÂÅáËÆæÂ§ñÈÉ®‰∏ñÁïå‰∏ÄÊàê‰∏çÂèò„ÄÇÈÄöËøáÊòæÂºèÂú∞ÂÖ≥Èó≠ÂíåÈáçÊñ∞Âª∫Á´ãËøûÊé•„ÄÅÈ™åËØÅÊñá‰ª∂Âè•ÊüÑÁ≠âÊìç‰ΩúÔºåÂèØ‰ª•Â§ßÂ§ßÊèêÈ´òÂ∫îÁî®Á®ãÂ∫èÂú® <strong>Restore</strong> ÂêéÁöÑÂÅ•Â£ÆÊÄßÂíåÊ≠£Á°ÆÊÄß„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504271102426.jpeg"
	
	
	
	loading="lazy"
	
		alt="CRaC design"
	
	
></p>
<p>ÁÆÄËÄåË®Ä‰πãÔºåCRaC ÁöÑËÆæËÆ°Âì≤Â≠¶ÊòØÔºå<strong>Áâ∫Áâ≤‰∏ÄÂÆöÁöÑÈÄèÊòéÂ∫¶ÔºåÊç¢ÂèñÂ∫îÁî®Âú®ÊÅ¢Â§çÂêéÂØπÁéØÂ¢ÉÂèòÂåñÁöÑÂÅ•Â£ÆÈÄÇÂ∫îËÉΩÂäõ</strong>„ÄÇÂÆÉË¶ÅÊ±ÇÂºÄÂèëËÄÖÊõ¥Âä†ÊòéÁ°ÆÂú∞ÊÄùËÄÉÂíåÁÆ°ÁêÜÂ∫îÁî®ÁöÑÂ§ñÈÉ®‰æùËµñ„ÄÇËôΩÁÑ∂ËøôÂú®ÂàùÊúüÂèØËÉΩÂ∏¶Êù•‰∏Ä‰∫õÈ¢ùÂ§ñÁöÑÂ∑•‰ΩúÔºàÊØîÂ¶ÇÂ§ÑÁêÜÊó•ÂøóÊñá‰ª∂Âè•ÊüÑÔºâÔºå‰ΩÜÂÖ∂ÁõÆÁöÑÊòØ‰∏∫‰∫ÜÁ°Æ‰øùÂ∫îÁî®Âú® CRaC ÊÅ¢Â§çÂêéËÉΩÂ§üÁ®≥ÂÆö„ÄÅÊ≠£Á°ÆÂú∞ËøêË°åÂú®‰∏Ä‰∏™ÂèØËÉΩÂ∑≤ÁªèÂèëÁîüÂèòÂåñÁöÑÊñ∞ÁéØÂ¢É‰∏≠„ÄÇ</p>
<h3 id="openjdk-crac-ÂÆûÁé∞Ê¶ÇËßà">
    <a href="#openjdk-crac-%e5%ae%9e%e7%8e%b0%e6%a6%82%e8%a7%88" class="header-anchor">#</a>
    OpenJDK CRaC ÂÆûÁé∞Ê¶ÇËßà
</h3><p>‰∫ÜËß£‰∫Ü CRaC ÁöÑËÆæËÆ°ÁêÜÂøµÂíåÂ∫ïÂ±Ç‰æùËµñ CRIU ÂêéÔºåÊàë‰ª¨Êù•ÁúãÁúã CRaC ÂäüËÉΩÂú® OpenJDK ÂÜÖÈÉ®ÁöÑÂ§ßËá¥ÂÆûÁé∞ÊµÅÁ®ã„ÄÇËøô‰∏™ËøáÁ®ãÊ∂âÂèä Java API Â±Ç„ÄÅJVM ÂÜÖÈÉ®ÂÆûÁé∞„ÄÅÂ§ñÈÉ®ÂºïÊìéÔºàÈªòËÆ§ÊòØÂåÖË£Ö‰∫Ü CRIU ÁöÑ criuengineÔºâ‰ª•ÂèäÊìç‰ΩúÁ≥ªÁªüÂ±ÇÈù¢ÁöÑ‰∫§‰∫í„ÄÇ</p>
<h4 id="checkpoint-ÊµÅÁ®ãÊ¶ÇËßà">
    <a href="#checkpoint-%e6%b5%81%e7%a8%8b%e6%a6%82%e8%a7%88" class="header-anchor">#</a>
    Checkpoint ÊµÅÁ®ãÊ¶ÇËßà
</h4><p>Checkpoint ËøáÁ®ãÁöÑÁõÆÊ†áÊòØÂÆâÂÖ®Âú∞ÂÅúÊ≠¢ JVMÔºåÈÄöÁü•ÊâÄÊúâÂ∑≤Ê≥®ÂÜåÁöÑËµÑÊ∫êËøõË°åÂáÜÂ§áÔºåÁÑ∂ÂêéË∞ÉÁî®Â§ñÈÉ®ÂºïÊìéÊù•ÂàõÂª∫ËøõÁ®ãÈïúÂÉè„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504271113195.png"
	
	
	
	loading="lazy"
	
		alt="Checkpoint"
	
	
></p>
<ol>
<li><strong>Ëß¶Âèë Checkpoint</strong></li>
</ol>
<p>Áî®Êà∑ÊâßË°å¬†<code>jcmd &lt;pid&gt; JDK.checkpoint</code>Ôºå<code>CheckpointDCmd::execute</code>¬†Ë¢´Ë∞ÉÁî®ÔºåÂÆÉËß£Êûê¬†<code>jdk.crac.Core</code>¬†Á±ªÔºåÂπ∂Ë∞ÉÁî®ÂÖ∂ÈùôÊÄÅÊñπÊ≥ï¬†<code>checkpointRestoreInternal(long jcmdStream)</code>„ÄÇ<code>jcmdStream</code>¬†ÊòØÁî®‰∫éËæìÂá∫ <code>jcmd</code> ÁªìÊûúÁöÑÊµÅ„ÄÇ</p>
<ol start="2">
<li><strong>Java Â±ÇÂáÜÂ§á</strong></li>
</ol>
<p>ÈÅçÂéÜÊâÄÊúâÊ≥®ÂÜåÂà∞ÂÖ®Â±Ä‰∏ä‰∏ãÊñá <a class="link" href="https://crac.github.io/openjdk-builds/javadoc/api/java.base/jdk/crac/Context.html"  target="_blank" rel="noopener"
    >Context</a>ÁöÑ¬†<a class="link" href="https://crac.github.io/openjdk-builds/javadoc/api/java.base/jdk/crac/Resource.html"  target="_blank" rel="noopener"
    >Resource</a>¬†ÂÆûÁé∞ÔºåÂπ∂Ë∞ÉÁî®ÂÆÉ‰ª¨ÁöÑ¬†<code>beforeCheckpoint</code>¬†ÊñπÊ≥ï„ÄÇ<code>Resource</code>¬†Âú®Ê≠§ÊñπÊ≥ï‰∏≠ÊâßË°åÂøÖË¶ÅÁöÑÊ∏ÖÁêÜÊàñÂáÜÂ§áÂ∑•‰ΩúÔºà‰æãÂ¶ÇÔºåÂÖ≥Èó≠‰∏çÈúÄË¶ÅÁöÑÁΩëÁªúËøûÊé•„ÄÅÂà∑Êñ∞ÁºìÂÜ≤Âå∫Á≠âÔºâ„ÄÇ</p>
<ol start="3">
<li><strong>ËøõÂÖ• JVM/Native Â±Ç</strong></li>
</ol>
<p>Ë∞ÉÁî® native ÊñπÊ≥ï¬†<code>checkpointRestore0(int[] fdArr, Object[] objArr, boolean dryRun, long jcmdStream)</code>„ÄÇ</p>
<p>ÂÆö‰πâÂú® <code>CracCore.c</code> ‰∏≠ÁöÑ JNI ÂÆûÁé∞ <code>Java_jdk_crac_Core_checkpointRestore0</code>¬†Ë∞ÉÁî®¬†<code>JVM_Checkpoint</code>„ÄÇ</p>
<p><code>JVM_Checkpoint</code>¬†ÊòØ‰∏Ä‰∏™ JVM Ê†áÂáÜÂÖ•Âè£ÁÇπÔºåÂÆÉË∞ÉÁî®¬†<code>crac::checkpoint</code>ÔºåÊ≠£ÂºèËøõÂÖ• CRaC ÁöÑ <code>checkpoint</code> Èò∂ÊÆµ„ÄÇ</p>
<ol start="4">
<li><strong>JVM ÂÜÖÈÉ® Checkpoint ÂáÜÂ§á</strong></li>
</ol>
<p><code>crac::checkpoint</code> ÊòØ CRaC ÁöÑ‰∏ªÂÖ•Âè£ÔºåÈ¶ñÂÖàÊâßË°å‰∏ÄÊ¨°Âº∫Âà∂ Full GC (<code>GCCause::_full_gc_alot</code>) ÔºåÊ∏ÖÁêÜÊú™‰ΩøÁî®ÁöÑÂ†ÜÂå∫ÂüüÔºå‰ª•ÂáèÂ∞èÈïúÂÉè‰ΩìÁßØ„ÄÇ</p>
<p>ÁÑ∂ÂêéÈÄöËøá ¬†<code>VMThread::execute()</code> ËøõÂÖ• JVM ÁöÑ <strong>Safepoint</strong>ÔºåËøôÊòØÊâÄÊúâÁöÑ Java Á∫øÁ®ãÈÉΩÂ∑≤ÊöÇÂÅúÔºåÂáÜÂ§áÂ•ΩÊâßË°åÊé•‰∏ãÊù•ÁöÑ checkpoint Êìç‰Ωú„ÄÇ</p>
<ol start="5">
<li><strong>checkpoint Êìç‰ΩúÊâßË°å</strong></li>
</ol>
<p>ÈÅçÂéÜ¬†<code>/proc/self/fd</code>¬†‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂ÊèèËø∞Á¨¶ÔºåÂ¶ÇÊûúÊúâÂ∫îÁî®Á®ãÂ∫èÊâìÂºÄ‰ΩÜÊú™Â£∞ÊòéÁöÑËµÑÊ∫êÔºå‰ºöÂØºËá¥ Checkpoint Â§±Ë¥•ÔºåÊìç‰Ωú‰ºöÊèêÂâçËøîÂõûÔºåÊúÄÁªàÂØºËá¥ Java Â±ÇÊäõÂá∫¬†CheckpointException„ÄÇ</p>
<p>Â¶ÇÊûú‰∏ÄÂàáÈ°∫Âà©ÔºåË∞ÉÁî®¬†<code>report_ok_to_jcmd_if_any()</code>„ÄÇËøô‰ºöÂêë jcmd ÂÆ¢Êà∑Á´ØÂèëÈÄÅ‰∏Ä‰∏™ÂàùÊ≠•ÁöÑÊàêÂäüÂìçÂ∫îÔºåÁÑ∂ÂêéÊâçË∞ÉÁî®Â§ñÈÉ®ÂºïÊìé„ÄÇËøôÊ†∑ÂÅöÊòØÂõ†‰∏∫Â§ñÈÉ®ÂºïÊìéÔºàÂ¶Ç CRIUÔºâÈÄöÂ∏∏‰ºöÊùÄÊ≠ªÂéüÂßã JVM ËøõÁ®ãÔºåÊâÄ‰ª•ÂìçÂ∫îÂøÖÈ°ªÂú®Ê≠§‰πãÂâçÂèëÈÄÅ„ÄÇ</p>
<p>Êé•ÁùÄÂú®  <code>call_crengine</code> fork Êñ∞ÁöÑËøõÁ®ãÔºåÂä†ËΩΩÂ§ñÈÉ®ÂºïÊìé <code>criuengine</code>ÔºåÊâßË°å <code>criuengine</code>ÁöÑ <code>checkpoint</code>ÊñπÊ≥ï„ÄÇ</p>
<p>Âú®<code>checkpoint</code>ÊñπÊ≥ï‰∏≠‰ΩøÁî®¬†<strong>double fork</strong> ÊäÄÂ∑ßÔºåËÆ©Â≠ôÂ≠êËøõÁ®ãÊâßË°å CRIUÔºåËøôÊ†∑ CRIU ËøõÁ®ãÂ∞±‰∏çÂÜçÊòØ JVM ÁöÑÂ≠êËøõÁ®ã„ÄÇ</p>
<p>Â≠ôÂ≠êËøõÁ®ãÊâßË°åÁöÑÂÖ∑‰ΩìÂëΩ‰ª§ÊòØ <code>criu dump -t &lt;jvm_pid&gt; -D &lt;checkpoint_dir&gt; --shell-job [options...]</code>ÔºåÂÜªÁªì JVM ËøõÁ®ãÔºåÂ∞ÜÂÖ∂Áä∂ÊÄÅ‰øùÂ≠òÂà∞¬†<code>&lt;checkpoint_dir&gt;</code>¬†‰∏ãÁöÑÈïúÂÉèÊñá‰ª∂‰∏≠ÔºåÁÑ∂Âêé¬†<strong>ÊùÄÊ≠ª</strong>¬†ÂéüÂßãÁöÑ JVM ËøõÁ®ã„ÄÇ</p>
<ol start="6">
<li><strong>JVM ÊöÇÂÅúÁÇπ</strong></li>
</ol>
<p>JVM ËøõÁ®ã‰ªé <code>call_crengine</code> Âø´ÈÄüËøîÂõûÔºåÁªßÁª≠ÊâßË°åËá≥ <code>sigwaitinfo()</code> ÈòªÂ°û„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">sigset_t</span> <span class="n">waitmask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nf">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">waitmask</span><span class="p">);</span>          <span class="c1">// ÂàùÂßãÂåñÁ©∫‰ø°Âè∑ÈõÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">sigaddset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">waitmask</span><span class="p">,</span> <span class="n">RESTORE_SIGNAL</span><span class="p">);</span> <span class="c1">// Ê∑ªÂä†Ëá™ÂÆö‰πâÁöÑÊÅ¢Â§ç‰ø°Âè∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kt">siginfo_t</span> <span class="n">info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">sig</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sig</span> <span class="o">=</span> <span class="nf">sigwaitinfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">waitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">);</span> <span class="c1">// &lt;--- JVM Âú®ËøôÈáåÈòªÂ°ûÔºåÈòªÂ°ûÁ≠âÂæÖÊåáÂÆö‰ø°Âè∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">sig</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">errno</span> <span class="o">==</span> <span class="n">EINTR</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩì JVM ÂÆåÊàêÊ£ÄÊü•ÁÇπÔºàcheckpointÔºâÂêéÔºå‰ºöËøõÂÖ•Á≠âÂæÖÂæ™ÁéØÔºåÂêéÁª≠ÊÅ¢Â§çËøõÁ®ã‰ºöÈÄöËøá<code>RESTORE_SIGNAL</code>‰ø°Âè∑Âî§ÈÜí JVM„ÄÇ</p>
<h4 id="checkpoint-ÁöÑËøõÁ®ã‰∫§‰∫í">
    <a href="#checkpoint-%e7%9a%84%e8%bf%9b%e7%a8%8b%e4%ba%a4%e4%ba%92" class="header-anchor">#</a>
    Checkpoint ÁöÑËøõÁ®ã‰∫§‰∫í
</h4><p>Âú®ÈÄöËøáÂ§ñÈÉ®ÂºïÊìé <code>criuengine</code>ÊâßË°å<code>criu dump</code>ÁöÑËøáÁ®ã‰∏≠Ôºå‰ΩøÁî®‰∫Ü Linux Â∏∏ËßÅÁöÑÁºñÁ®ãÊäÄÂ∑ß<strong>double fork</strong>Ôºå‰∏ªË¶ÅÂéüÂõ†ÊòØ‰∏∫‰∫Ü<strong>Ëß£ËÄ¶</strong>ÔºöÈÄöËøáËÆ©‰∏≠Èó¥ËøõÁ®ãÂø´ÈÄüÈÄÄÂá∫Ôºå‰ΩøÂæóÊâßË°å¬†<code>criu dump</code>¬†ÁöÑÂ≠ôÂ≠êËøõÁ®ãÊàê‰∏∫Â≠§ÂÑøËøõÁ®ãÔºåË¢´¬†init¬†ËøõÁ®ãÊî∂ÂÖªÔºå‰ªéËÄå‚ÄúÈÄÉÁ¶ª‚Äù‰∫ÜÂéüÂßã JVM ÁöÑËøõÁ®ãÊ†ë„ÄÇ</p>
<p>ÊúÄÁªàÊâßË°å¬†<code>criu dump</code>¬†ÁöÑËøõÁ®ã‰∏çÂ±û‰∫éÂéüÂßã JVM ËøõÁ®ãÁöÑËøõÁ®ãÊ†ëÔºåËøôÈÅøÂÖç‰∫Ü CRIU Âú®ÊâßË°å Checkpoint Êó∂Â∞ùËØïÂÜªÁªìÂÖ∂Ëá™Ë∫´ÁöÑÈóÆÈ¢òÔºå‰øùËØÅ‰∫Ü Checkpoint Êìç‰ΩúÁöÑÊ≠£Á°ÆÊÄß„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504271546812.png"
	
	
	
	loading="lazy"
	
		alt="checkpoint"
	
	
></p>
<p>‰∏äÂõæÊÄªÁªì‰∫Ü Checkpoint ËøáÁ®ã‰∏≠Ê∂âÂèäÁöÑÂ§ö‰∏™ËøõÁ®ãÁöÑÂàõÂª∫„ÄÇ</p>
<ol>
<li><strong>JVM fork -&gt; P1 (criuengine checkpoint)</strong>: JVM ÂàõÂª∫Â≠êËøõÁ®ã P1 ËøêË°å <code>criuengine checkpoint</code>ÔºåJVM ËøõÁ®ãÁ≠âÂæÖ P1„ÄÇ</li>
<li><strong>P1 fork -&gt; P2</strong>: P1 ÂàõÂª∫Â≠êËøõÁ®ã P2ÔºåP1 Á≠âÂæÖ P2„ÄÇ</li>
<li><strong>P2 fork -&gt; P3 &amp; P2 exit</strong>: P2 ÂàõÂª∫Â≠ôÂ≠êËøõÁ®ã P3ÔºåÁÑ∂Âêé P2 <strong>Á´ãÂç≥ÈÄÄÂá∫</strong>„ÄÇ</li>
<li><strong>P1 exit</strong>: P1 Ê£ÄÊµãÂà∞ P2 ÈÄÄÂá∫Ôºå‰∫éÊòØ P1 ‰πüÈÄÄÂá∫„ÄÇ</li>
<li><strong>JVM ÁªßÁª≠</strong>: JVM Ê£ÄÊµãÂà∞ P1 ÈÄÄÂá∫Ôºå<code>call_crengine</code> ËøîÂõûÔºåJVM ÁªßÁª≠ÊâßË°åÁõ¥Âà∞ <code>sigwaitinfo</code> ÈòªÂ°û„ÄÇ</li>
<li><strong>P3 fork -&gt; criu dump</strong>: P3 Êàê‰∏∫Â≠§ÂÑøËøõÁ®ãÔºàË¢´ <code>init/systemd</code> Êé•ÁÆ°ÔºâÔºåÂàõÂª∫ <code>criu</code> ËøõÁ®ãÔºåÊúÄÁªàÊâßË°å <code>criu dump</code>ÔºåÂÜªÁªìÂπ∂ÊùÄÊ≠ªÈòªÂ°û‰∏≠ÁöÑ JVM„ÄÇ</li>
</ol>
<h4 id="restore-ÊµÅÁ®ãÊ¶ÇËßà">
    <a href="#restore-%e6%b5%81%e7%a8%8b%e6%a6%82%e8%a7%88" class="header-anchor">#</a>
    Restore ÊµÅÁ®ãÊ¶ÇËßà
</h4><p>Restore ËøáÁ®ãÁöÑÁõÆÊ†áÊòØ‰ªé Checkpoint ÈïúÂÉèÂêØÂä®‰∏Ä‰∏™Êñ∞ÁöÑ JVM ÂÆû‰æãÔºå‰ΩøÂÖ∂ÊÅ¢Â§çÂà∞ Checkpoint Êó∂ÂàªÁöÑÁä∂ÊÄÅÔºåÁÑ∂ÂêéÁªßÁª≠ÊâßË°å„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504271552897.png"
	
	
	
	loading="lazy"
	
		alt="Restore"
	
	
></p>
<ol>
<li><strong>Ëß¶Âèë Restore</strong></li>
</ol>
<p>Áî®Êà∑ÂêØÂä® JVMÔºåÂπ∂ÊåáÂÆö Restore Áõ∏ÂÖ≥ÁöÑÂèÇÊï∞  <code>-XX:CRaCRestoreFrom=&lt;checkpoint_dir&gt;</code>„ÄÇ</p>
<ol start="2">
<li><strong>JVM ÂàùÂßãÂåñ</strong></li>
</ol>
<p>Âú®ÂàõÂª∫ JVM ÁöÑËøáÁ®ã‰∏≠ÔºåÊ£ÄÊµãÂà∞ <strong>Restore</strong> ËØ∑Ê±ÇÔºåË∞ÉÁî® <code>crac::restore()</code>„ÄÇ</p>
<ol start="3">
<li><strong>ÂáÜÂ§áÂπ∂ÂàáÊç¢ÂºïÊìé</strong></li>
</ol>
<p>ËøõÂÖ• <code>crac::restore()</code> ÔºåÈ¶ñÂÖàË∞ÉÁî®<code>compute_crengine()</code> ÔºåÁ°ÆÂÆöÂ§ñÈÉ®ÂºïÊìéÁöÑË∑ØÂæÑÂíåÂèÇÊï∞„ÄÇ</p>
<p>ÁÑ∂Âêé‰ΩøÁî®ÂΩìÂâçËøõÁ®ã ID (<code>os::current_process_id()</code>) ÂàõÂª∫‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑ <strong>ÂÖ±‰∫´ÂÜÖÂ≠ò (SHM)</strong> Ë∑ØÂæÑÔºåÊâìÂºÄ <strong>SHM</strong> Êñá‰ª∂ÔºåÂπ∂Â∞Ü Restore ÂèÇÊï∞ÂÜôÂÖ•Âà∞ <strong>SHM</strong>Ôºà<code>CracRestoreParameters::write_to</code>Ôºâ„ÄÇ<strong>SHM</strong> Áî®‰∫éÂú®¬†<code>crac::restore</code>ÔºàÂàùÂßã JVMÔºâÂíåÊÅ¢Â§çÂêéÁöÑ JVM ‰πãÈó¥‰º†ÈÄíÊñ∞ÁöÑÂêØÂä®ÂèÇÊï∞„ÄÅÂ±ûÊÄßÂíåÊó∂Èó¥Êà≥„ÄÇ</p>
<p>ÊúÄÂêéË∞ÉÁî®¬†<code>os::execv(_crengine, _crengine_args)</code>„ÄÇ¬†<code>execv</code>¬†‰ºöÁî®Êñ∞ÁöÑÁ®ãÂ∫èÔºàÂ§ñÈÉ®ÂºïÊìé <code>criuengine</code>Ôºâ<strong>ÊõøÊç¢</strong>ÂΩìÂâçÁöÑ JVM ËøõÁ®ã„ÄÇÂàùÂßãÂêØÂä®ÁöÑ JVM Âà∞Ê≠§ÁªìÊùü„ÄÇ</p>
<ol start="4">
<li><strong>Â§ñÈÉ®ÂºïÊìéÊâßË°å Restore (criuengine restore)</strong></li>
</ol>
<p>Â§ñÈÉ®ÂºïÊìé <code>criuengine</code> ÊâßË°å <code>restore</code> ÊñπÊ≥ïÔºåÊûÑÂª∫¬†<code>criu restore</code>¬†ÂëΩ‰ª§ÂèÇÊï∞„ÄÇÂÖ≥ÈîÆÂèÇÊï∞ÂåÖÊã¨Ôºö</p>
<ul>
<li><code>-D &lt;checkpoint_dir&gt;</code>: ÊåáÂÆöÈïúÂÉèÁõÆÂΩï„ÄÇ</li>
<li><code>--action-script self</code>: ÊåáÂÆö¬†<code>criuengine</code>¬†Ëá™Ë∫´‰Ωú‰∏∫ CRIU ÁöÑÂä®‰ΩúËÑöÊú¨„ÄÇ</li>
<li><code>--exec-cmd -- self restorewait</code>:¬†ÊåáÂÆö CRIU ÊàêÂäüÊÅ¢Â§çËøõÁ®ãÂêéÔºåÂ∫îËØ•ÊâßË°å¬†<code>criuengine restorewait</code>¬†ÂëΩ‰ª§„ÄÇËøô‰∏™ÂëΩ‰ª§‰ºöÁ≠âÂæÖÊÅ¢Â§çÂêéÁöÑ JVM ËøõÁ®ãÁªìÊùü„ÄÇ</li>
</ul>
<p>ÊâßË°å¬†<code>execv</code>¬†ËøêË°å¬†<code>criu restore</code>¬†ÂëΩ‰ª§ÔºåÂÜçÊ¨°ÊõøÊç¢ÂΩìÂâçËøõÁ®ã„ÄÇ</p>
<ol start="5">
<li><strong>CRIU ÊâßË°åÊÅ¢Â§ç</strong></li>
</ol>
<p>CRIU ËØªÂèñÈïúÂÉèÊñá‰ª∂ÔºåÂú®ÂÜÖÂ≠ò‰∏≠ÈáçÂª∫ JVM ËøõÁ®ãÁöÑÁä∂ÊÄÅÔºàÂÜÖÂ≠òÊò†Â∞Ñ„ÄÅÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÅÂØÑÂ≠òÂô®Á≠âÔºâ„ÄÇ</p>
<p>Âú®ËøõÁ®ãÁä∂ÊÄÅÂü∫Êú¨ÊÅ¢Â§ç‰ΩÜÂ∞öÊú™ÂÆåÂÖ®ËøêË°åÊó∂ÔºåCRIU ‰ºöË∞ÉÁî®¬†<code>--action-script</code>¬†ÊåáÂÆöÁöÑËÑöÊú¨ÔºàÂç≥¬†<code>criuengine</code>ÔºâÔºåËøõÂÖ• <code>post_resume</code> ÊñπÊ≥ï„ÄÇ</p>
<p>Âú®<code>post_resume</code> ÊñπÊ≥ï‰∏≠ÔºåËé∑ÂèñÊÅ¢Â§çÂêéÁöÑ JVM PID Âíå‰πãÂâçÂ≠òÂÖ•ÁöÑ SHM IDÔºåÁÑ∂Âêé‰ΩøÁî®¬†<code>sigqueue</code>¬†ÂêëÊÅ¢Â§çÁöÑ JVM ËøõÁ®ãÂèëÈÄÅ¬†<code>RESTORE_SIGNAL</code>¬†‰ø°Âè∑„ÄÇ</p>
<ol start="6">
<li><strong>Â§ñÈÉ®Á≠âÂæÖËøõÁ®ã (criuengine restorewait)</strong></li>
</ol>
<p>Ê†πÊçÆÂèÇÊï∞ <code>--exec-cmd</code> ÊåáÂÆöÁöÑÂëΩ‰ª§ÔºåÂÜçÊ¨°ÊâßË°å <code>execv</code>ÔºåÂ∞ÜÊâßË°åÊÅ¢Â§çÁöÑ CRIU ËøõÁ®ãÊõøÊç¢‰∏∫ <code>criuengine restorewait</code>„ÄÇ</p>
<p><code>criuengine</code> ‰ΩøÁî®¬†<code>waitpid</code>¬†Á≠âÂæÖÂàöÂàöÊÅ¢Â§çÂπ∂ÁªßÁª≠ËøêË°åÁöÑ JVM ËøõÁ®ãÔºåÂÆÉ‰ºöÊçïËé∑ÂèëÁªôÂÆÉËá™Â∑±ÁöÑ‰ø°Âè∑ÔºåÂπ∂Â∞ùËØïÂ∞ÜËøô‰∫õ‰ø°Âè∑ËΩ¨ÂèëÁªô JVM ËøõÁ®ã„ÄÇ</p>
<p>ÂΩì JVM ËøõÁ®ãÊúÄÁªàÈÄÄÂá∫Êó∂Ôºå<code>waitpid</code>¬†ËøîÂõûÔºå<code>criuengine</code>¬†ËøõÁ®ã‰πü‰ª•Áõ∏ÂêåÁöÑÈÄÄÂá∫Á†ÅÊàñÂü∫‰∫é‰ø°Âè∑ÁöÑÁä∂ÊÄÅÈÄÄÂá∫„ÄÇ</p>
<ol start="7">
<li><strong>ÊÅ¢Â§çÁöÑ JVM ÁªßÁª≠ÊâßË°å</strong></li>
</ol>
<p><img src="https://cdn.mazhen.tech/2024/202504271742570.png"
	
	
	
	loading="lazy"
	
		alt="jvm restore"
	
	
></p>
<p>ÊÅ¢Â§çÁöÑ JVM ËøõÁ®ãÊî∂Âà∞ CRIU ËøõÁ®ãÂèëÈÄÅÁöÑ <code>RESTORE_SIGNAL</code>¬†‰ø°Âè∑Ôºå‰ªé <code>sigwaitinfo()</code> ÈÜíÊù•ÔºåÊâßË°åÊµÅÂõûÂà∞¬†<code>checkpoint_restore</code>¬†ÂáΩÊï∞ÔºàÂú®¬†<code>crac.cpp</code>¬†‰∏≠ÔºâÔºåÊ≠£Â•ΩÂú®¬†<code>call_crengine()</code>¬†‰πãÂêéÁ≠âÂæÖ‰ø°Âè∑ÁöÑÂú∞Êñπ„ÄÇ</p>
<p>ÊâßË°å‰∏Ä‰∫õ JVM ÊÅ¢Â§çÂä®‰ΩúÔºåÂåÖÊã¨Ê†πÊçÆ SHM ID ‰ªéÂÖ±‰∫´ÂÜÖÂ≠ò‰∏≠ËØªÂèñÊñ∞ÁöÑÂëΩ‰ª§Ë°åÂèÇÊï∞ÔºåËøõË°åÊó∂Èó¥Ê†°ÂáÜÔºåÂî§ÈÜíÂèØËÉΩÂú® <strong>Checkpoint</strong> Êó∂Â§Ñ‰∫é¬†<code>sleep</code>¬†Êàñ¬†<code>park</code>¬†Áä∂ÊÄÅÁöÑÁ∫øÁ®ã„ÄÇ</p>
<ol start="7">
<li><strong>ËøîÂõû Java Â±Ç</strong></li>
</ol>
<p>JVM Â∞ÜÊñ∞ÂèÇÊï∞ËøîÂõûÁªô <code>jdk.crac.Core</code>Ôºå<code>Core</code> Â∫îÁî®Êñ∞Â±ûÊÄßÔºåÈÅçÂéÜÊâÄÊúâÊ≥®ÂÜåÁöÑ¬†<code>Resource</code>ÔºåË∞ÉÁî®ÂÖ∂¬†<code>afterRestore</code>¬†ÊñπÊ≥ïÔºåÊâßË°åÊÅ¢Â§çÂêéÁöÑÂàùÂßãÂåñÂ∑•‰ΩúÔºà‰æãÂ¶ÇÔºåÈáçÊñ∞Âª∫Á´ãËøûÊé•„ÄÅÈáçÊñ∞Âä†ËΩΩÈÖçÁΩÆÁ≠âÔºâ„ÄÇ</p>
<ol start="7">
<li><strong>ÂÆåÊàê</strong></li>
</ol>
<p>Â¶ÇÊûúÊ≤°ÊúâÂºÇÂ∏∏Ôºå‰ªé <code>Core.checkpointRestoreInternal</code> Ê≠£Â∏∏ÈÄÄÂá∫ÔºåRestore ÊàêÂäüÔºåJVM ÁªßÁª≠ËøêË°å„ÄÇ</p>
<h4 id="restore-ÁöÑËøõÁ®ã‰∫§‰∫í">
    <a href="#restore-%e7%9a%84%e8%bf%9b%e7%a8%8b%e4%ba%a4%e4%ba%92" class="header-anchor">#</a>
    Restore ÁöÑËøõÁ®ã‰∫§‰∫í
</h4><p><strong>Restore</strong> ËøáÁ®ãÂ∑ßÂ¶ôÂú∞Âà©Áî®‰∫Ü¬†<code>execv</code>¬†Á≥ªÁªüË∞ÉÁî®Êù•<strong>ÊõøÊç¢</strong>ÂΩìÂâçËøõÁ®ãÁöÑÊò†ÂÉèÔºå‰ªéËÄåÂ∞ÜÊéßÂà∂ÊùÉÈÄêÊ≠•‰∫§Áªô‰∏ã‰∏Ä‰∏™Èò∂ÊÆµÊâÄÈúÄÁöÑÂ∑•ÂÖ∑ÔºåÊúÄÁªàÊÅ¢Â§çÁõÆÊ†á JVM ËøõÁ®ã„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂú®Ëøô‰∏™ÊµÅÁ®ã‰∏≠Ôºå<code>fork</code>¬†Âπ∂‰∏çÂÉè <strong>Checkpoint</strong> ÊµÅÁ®ãÈÇ£Ê†∑ÊòæÂºèÂú∞Áî®‰∫éÂàõÂª∫Á≠âÂæÖÂ≠êËøõÁ®ãÁöÑÁà∂ËøõÁ®ãÔºåËÄåÊòØÁî± CRIU ÂÜÖÈÉ®ÁÆ°ÁêÜÔºå‰ΩÜ¬†<code>execv</code>¬†ÊòØË¥ØÁ©øÂßãÁªàÁöÑÂÖ≥ÈîÆ„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504271821190.png"
	
	
	
	loading="lazy"
	
		alt="Restore"
	
	
></p>
<ol>
<li>
<p><strong>ÂêØÂä® Restore ÂëΩ‰ª§ (Áî®Êà∑ -&gt; P1)</strong>
Áî®Êà∑ÊâßË°å¬†<code>java -XX:CRaCRestoreFrom=&lt;checkpoint_dir&gt;</code>¬†ÂëΩ‰ª§ÔºåÂêØÂä®‰∫Ü‰∏Ä‰∏™ÂàùÂßãÁöÑ JVM ËøõÁ®ãÔºåÊàë‰ª¨Áß∞‰πã‰∏∫¬†<strong>P1</strong>„ÄÇ</p>
</li>
<li>
<p><strong>P1</strong> ÊâßË°åÁ¨¨‰∏ÄÊ¨°¬†<code>execv</code>¬†(<strong>P1</strong> -&gt; <strong>P2</strong>:¬†<code>criuengine restore</code>)
Âú®¬†<code>crac::restore()</code>‰∏≠Ôºå<strong>P1</strong> ÂáÜÂ§áÂøÖË¶ÅÁöÑÂèÇÊï∞ÔºåË∞ÉÁî®¬†<code>os::execv(_crengine, _crengine_args)</code>ÔºåËøôÈáåÁöÑ¬†<code>_crengine</code>¬†ÊòØ¬†<code>criuengine</code>¬†ÁöÑË∑ØÂæÑÔºå<code>_crengine_args</code>¬†ÂåÖÂê´‰∫Ü &ldquo;restore&rdquo; Âíå Checkpoint ÁõÆÂΩïÁ≠âÂèÇÊï∞„ÄÇ</p>
</li>
</ol>
<p>ÁªìÊûú <code>execv</code>¬†Áî®¬†<code>criuengine restore</code>¬†Á®ãÂ∫èÊõøÊç¢‰∫Ü <strong>P1</strong> ËøõÁ®ã„ÄÇÂéüÊù•ÁöÑ¬†Java¬†ËøõÁ®ã <strong>P1</strong> ‰∏çÂ§çÂ≠òÂú®„ÄÇÁé∞Âú®ÁöÑËøõÁ®ãÊàë‰ª¨Áß∞‰πã‰∏∫¬†<strong>P2</strong>ÔºåËôΩÁÑ∂ PID ÂèØËÉΩ‰∏é <strong>P1</strong> Áõ∏ÂêåÔºå‰ΩÜËøêË°åÁöÑÁ®ãÂ∫èÂ∑≤ÊîπÂèòÔºå<strong>P2</strong> Ê≠£Âú®ÊâßË°å¬†<code>criuengine restore</code>¬†ÁöÑ‰ª£Á†Å„ÄÇ</p>
<ol start="3">
<li>
<p><strong>P2</strong> ÊâßË°åÁ¨¨‰∫åÊ¨°¬†<code>execv</code>¬†(<strong>P2</strong> -&gt; <strong>P3</strong>:¬†<code>criu restore</code>)
<strong>P2</strong> ËøêË°å¬†<code>criuengine restore</code>¬†‰ª£Á†ÅÔºåËøõË°å‰∏Ä‰∫õÂáÜÂ§áÂ∑•‰ΩúÔºåÊûÑÂª∫¬†criu¬†ÂëΩ‰ª§Ë°åÁöÑÂèÇÊï∞ÔºåË∞ÉÁî® <code>execv(criu, const_cast&lt;char **&gt;(args.data()))</code>¬†ÔºåÁî®¬†<code>criu restore</code>¬†Á®ãÂ∫èÊõøÊç¢‰∫Ü <strong>P2</strong> ËøõÁ®ã„ÄÇ<code>criuengine restore</code>¬†ËøõÁ®ã <strong>P2</strong> ‰∏çÂ§çÂ≠òÂú®„ÄÇÁé∞Âú®ÁöÑËøõÁ®ãÔºàÊàë‰ª¨Áß∞‰πã‰∏∫¬†<strong>P3</strong>ÔºâÊ≠£Âú®ÊâßË°å¬†<code>criu restore</code>„ÄÇ</p>
</li>
<li>
<p><strong>P3</strong> (CRIU) ÊÅ¢Â§ç JVM ËøõÁ®ãÔºåÊâßË°åÁ¨¨‰∏âÊ¨°¬†<code>execv</code>¬†(<strong>P3</strong> -&gt; <strong>P4</strong>:¬†<code>criuengine restorewait</code>)
<strong>P3</strong> ÔºàËøêË°å¬†<code>criu restore</code>ÔºâËØªÂèñ Checkpoint ÈïúÂÉèÊñá‰ª∂ÔºåÊÅ¢Â§çÔºàforkÔºâÁõÆÊ†á JVM ËøõÁ®ã„ÄÇ</p>
</li>
</ol>
<p>Âú®ÊàêÂäüÊÅ¢Â§ç JVM ‰πãÂêéÔºåCRIU Êú¨Ë∫´ÈúÄË¶ÅÁªìÊùü„ÄÇÁî±‰∫éÊåáÂÆö‰∫Ü¬†<code>--exec-cmd -- self restorewait</code>ÔºåCRIU ‰ºöÊâßË°åÊúÄÂêé‰∏ÄÊ¨°¬†<code>execv</code>ÔºåÁî®¬†<code>criuengine restorewait</code>¬†Á®ãÂ∫èÊõøÊç¢‰∫Ü <strong>P3</strong> ËøõÁ®ã„ÄÇ<code>criu restore</code>¬†ËøõÁ®ã <strong>P3</strong> ‰∏çÂ§çÂ≠òÂú®ÔºåÁé∞Âú®ÁöÑËøõÁ®ãÔºàÊàë‰ª¨Áß∞‰πã‰∏∫¬†<strong>P4</strong>ÔºâÊ≠£Âú®ÊâßË°å¬†<code>criuengine restorewait</code>„ÄÇ‰∏éÊ≠§ÂêåÊó∂Ôºå<strong>JVM</strong>¬†Â∑≤ÁªèÁã¨Á´ãËøêË°åËµ∑Êù•ÔºåÂπ∂ÂÆåÊàê‰∫Ü <code>Restore</code> ÁöÑ Java Â±ÇÈÄªËæë„ÄÇ</p>
<ol start="5">
<li><strong>P4</strong> (<code>criuengine restorewait</code>) Á≠âÂæÖ JVM
<strong>P4</strong> ÔºàËøêË°å¬†<code>criuengine restorewait</code>¬†‰ª£Á†ÅÔºâËé∑Âèñ JVM ÁöÑ PIDÔºåËÆæÁΩÆ‰ø°Âè∑Â§ÑÁêÜÁ®ãÂ∫èÔºåÂ∞ùËØïÂ∞ÜÊé•Êî∂Âà∞ÁöÑ‰ø°Âè∑ËΩ¨ÂèëÁªô JVM„ÄÇÊúÄÂêéË∞ÉÁî®¬†<code>waitpid(pid_P_JVM, &amp;status, 0)</code>ÔºåÁ≠âÂæÖ JVM ËøõÁ®ãÁªàÊ≠¢„ÄÇÂΩì JVM ÈÄÄÂá∫Êó∂Ôºå<strong>P4</strong> Ëé∑ÂèñÂÖ∂ÈÄÄÂá∫Áä∂ÊÄÅÔºåÁÑ∂Âêé <strong>P4</strong> ‰πü‰ª•Áõ∏ÂêåÁöÑÁä∂ÊÄÅÈÄÄÂá∫„ÄÇ</li>
</ol>
<p>ÁÆÄÂçïÊù•ËØ¥ÔºåÂΩì JVM ÊÅ¢Â§çÊó∂ÔºåÈÄöËøá¬†<code>java -XX:CRaCRestoreFrom=...</code>¬†ÂêØÂä®ÁöÑËøõÁ®ãÂπ∂‰∏ç‰ºöÂêØÂä® JVMÔºåËÄåÊòØÈÄöËøá¬†<code>criuengine</code>¬†ÊâßË°å CRIUÔºåÂêéËÄÖÂ∞ÜÊÅ¢Â§çÁöÑËøõÁ®ã‰Ωú‰∏∫ÂÖ∂Â≠êËøõÁ®ãÂêØÂä®„ÄÇÂΩì CRIU ÂÆåÊàêËøõÁ®ãÈáçÂª∫ÂêéÔºåÂÆÉ‰ºöÊâßË°å¬†<code>criuengine restorewait</code>¬†ÔºåËØ•Á®ãÂ∫èÁöÑÂîØ‰∏Ä‰ªªÂä°ÊòØÁ≠âÂæÖÂÖ∂ÂîØ‰∏ÄÂ≠êËøõÁ®ãÔºàÊÅ¢Â§çÁöÑ JVMÔºâÈÄÄÂá∫Âπ∂‰º†ÈÄíÂÖ∂Áä∂ÊÄÅ„ÄÇËøôÊÑèÂë≥ÁùÄÁé∞Âú®Êúâ‰∏§‰∏™ËøõÁ®ãÔºåÊÅ¢Â§çÁöÑ JVM ËøõÁ®ãÊòØ <code>criuengine</code> ÁöÑÂ≠êËøõÁ®ã„ÄÇ</p>
<h2 id="Âõõcrac-‰ΩøÁî®ÊåáÂçó">
    <a href="#%e5%9b%9bcrac-%e4%bd%bf%e7%94%a8%e6%8c%87%e5%8d%97" class="header-anchor">#</a>
    Âõõ„ÄÅCRaC ‰ΩøÁî®ÊåáÂçó
</h2><p>Êú¨Á´†Â∞ÜËØ¶ÁªÜ‰ªãÁªçÂ¶Ç‰ΩïÂú®‰Ω†ÁöÑ Java Â∫îÁî®Á®ãÂ∫è‰∏≠‰ΩøÁî® CRaC ÊäÄÊúØÔºåÂåÖÊã¨ÁêÜËß£ÂÖ∂ÂçèË∞ÉÊú∫Âà∂„ÄÅ‰ΩøÁî® API„ÄÅÊñá‰ª∂ÊèèËø∞Á¨¶Á≠ñÁï•‰ª•ÂèäÈÄöËøá‰∏Ä‰∏™ Jetty Á§∫‰æãËøõË°åÂÆûÊàòÊºîÁªÉ„ÄÇ</p>
<h3 id="‰∏∫‰ΩïÈúÄË¶Å-orgcrac-ÂåÖ">
    <a href="#%e4%b8%ba%e4%bd%95%e9%9c%80%e8%a6%81-orgcrac-%e5%8c%85" class="header-anchor">#</a>
    ‰∏∫‰ΩïÈúÄË¶Å org.crac ÂåÖ
</h3><p>CRaC ÁöÑÊ†∏ÂøÉ APIÔºàÂ¶Ç <code>Resource</code> Êé•Âè£ÔºâÊúÄÂàùÂ≠òÂú®‰∫é‰∏çÂêåÁöÑÂåÖË∑ØÂæÑ‰∏ãÔºà‰æãÂ¶ÇÊó©ÊúüÁöÑ <code>javax.crac</code> Êàñ JDK ÂÜÖÈÉ®ÁöÑ <code>jdk.crac</code>Ôºâ„ÄÇ‰∏∫‰∫ÜÊèê‰æõ‰∏Ä‰∏™<strong>Á®≥ÂÆö‰∏îÂÖºÂÆπ</strong>ÁöÑÁºñÁ®ãÊé•Âè£ÔºåÁ§æÂå∫ÂºïÂÖ•‰∫Ü <code>org.crac</code> Ëøô‰∏™Áã¨Á´ãÁöÑÂ∫ì„ÄÇ</p>
<p>‰ΩøÁî® <code>org.crac</code> Â∫ìÁöÑÂ•ΩÂ§ÑÂú®‰∫éÔºö</p>
<ul>
<li><strong>Âπ≥ÊªëÈááÁî®Ôºö</strong> ÂºÄÂèëËÄÖÂèØ‰ª•‰æùËµñËøô‰∏™Â∫ìÊù•ÁºñÂÜô CRaC Áõ∏ÂÖ≥ÁöÑ‰ª£Á†Å„ÄÇ</li>
<li><strong>Ë∑®ËøêË°åÊó∂ÂÖºÂÆπÔºö</strong> Â∫îÁî®Á®ãÂ∫èÂèØ‰ª•Âú®‰∏çÂêåÁöÑ Java ËøêË°åÊó∂‰∏äÁºñËØëÂíåËøêË°åÔºåÊó†ËÆ∫ËØ•ËøêË°åÊó∂ÊòØÂê¶ÂÜÖÁΩÆ‰∫Ü CRaC ÊîØÊåÅÔºàÂ¶ÇÊ†áÂáÜÁöÑ OpenJDK„ÄÅÂ∏¶Êúâ jdk.crac ÁöÑ CRaC ÊûÑÂª∫ÁâàÊú¨ÔºåÊàñËÄÖÊõ¥Êó©ÊúüÁöÑ javax.crac ÂÆûÁé∞Ôºâ„ÄÇ</li>
<li><strong>Êú™Êù•ÈÄÇÂ∫îÊÄßÔºö</strong> Âç≥‰æøÊú™Êù• CRaC API ÁöÑÂåÖË∑ØÂæÑÂèëÁîüÂèòÂåñÔºåÂ∫îÁî®Á®ãÂ∫è‰ª£Á†Å‰πüÊó†ÈúÄ‰øÆÊîπÔºåÂè™ÈúÄÊõ¥Êñ∞ org.crac Â∫ìÁâàÊú¨Âç≥ÂèØ„ÄÇ</li>
</ul>
<p><code>org.crac</code> Â∫ìÁöÑÊ†∏ÂøÉÂäüËÉΩÊòØ‰Ωú‰∏∫ CRaC API ÁöÑ‰∏Ä‰∏™<strong>ÈÄÇÈÖçÂô®</strong>„ÄÇ</p>
<ul>
<li><strong>ÁºñËØëÊó∂Ôºö</strong> ÂÆÉÊèê‰æõ‰∫Ü‰∏é <code>jdk.crac</code>Ôºà‰ª•ÂèäÂéÜÂè≤‰∏äÁöÑ <code>javax.crac</code>ÔºâÂÆåÂÖ®ÈïúÂÉèÁöÑ API Êé•Âè£Ôºå‰æõÂºÄÂèëËÄÖÁºñËØëÊó∂‰æùËµñ„ÄÇ</li>
<li><strong>ËøêË°åÊó∂Ôºö</strong>
<ul>
<li><code>org.crac</code> ‰ΩøÁî®<strong>ÂèçÂ∞Ñ</strong>Êú∫Âà∂Êù•Ê£ÄÊµãÂΩìÂâçËøêË°åÁöÑ JVM ÊòØÂê¶ÂåÖÂê´ÂÆûÈôÖÁöÑ CRaC ÂÆûÁé∞ÔºàÊ£ÄÊü•ÊòØÂê¶Â≠òÂú® <code>jdk.crac.Core</code> Êàñ <code>javax.crac.Core</code>Ôºâ„ÄÇ</li>
<li>Â¶ÇÊûú<strong>Ê£ÄÊµãÂà∞</strong> CRaC ÂÆûÁé∞ÔºåÊâÄÊúâÂØπ <code>org.crac</code> API ÁöÑË∞ÉÁî®ÈÉΩ‰ºöË¢´<strong>ËΩ¨Âèë</strong>ÁªôÂ∫ïÂ±ÇÁöÑÂÆûÈôÖÂÆûÁé∞„ÄÇ</li>
<li>Â¶ÇÊûú<strong>Êú™Ê£ÄÊµãÂà∞</strong> CRaC ÂÆûÁé∞Ôºà‰æãÂ¶ÇÂú®Ê†áÂáÜ OpenJDK ‰∏äËøêË°åÔºâÔºåËØ∑Ê±Ç‰ºöË¢´ËΩ¨ÂèëÂà∞‰∏Ä‰∏™<strong>ËôöÊãüÔºàdummyÔºâÂÆûÁé∞</strong>„ÄÇËøô‰∏™ËôöÊãüÂÆûÁé∞ÂÖÅËÆ∏Â∫îÁî®Á®ãÂ∫èÊ≠£Â∏∏ËøêË°åÔºå<code>Resource</code> ‰πüÂèØ‰ª•Ê≥®ÂÜåÔºå‰ΩÜ‰ªª‰ΩïÂ∞ùËØïÂàõÂª∫ <code>Checkpoint</code> ÁöÑËØ∑Ê±ÇÔºàÂ¶ÇË∞ÉÁî® <code>Core.checkpointRestore()</code>ÔºâÈÉΩ‰ºö<strong>Â§±Ë¥•Âπ∂ÊäõÂá∫ÂºÇÂ∏∏</strong>„ÄÇ</li>
</ul>
</li>
</ul>
<p>ÈÄöËøáËøôÁßçÊñπÂºèÔºå<code>org.crac</code> Â∫ìÁ°Æ‰øù‰∫ÜÂ∫îÁî®Á®ãÂ∫èÂç≥‰ΩøÂú®‰∏çÊîØÊåÅ CRaC ÁöÑÁéØÂ¢É‰∏≠‰πüËÉΩËøêË°åÔºåÂêåÊó∂Âú®ÊîØÊåÅ CRaC ÁöÑÁéØÂ¢É‰∏≠ËÉΩÂ§üÊó†ÁºùÂØπÊé•„ÄÇ</p>
<h3 id="Ê∑ªÂä†-orgcrac-api-‰æùËµñ">
    <a href="#%e6%b7%bb%e5%8a%a0-orgcrac-api-%e4%be%9d%e8%b5%96" class="header-anchor">#</a>
    Ê∑ªÂä† org.crac API ‰æùËµñ
</h3><p>ÂèØ‰ª•ÈÄöËøá Maven Êàñ Gradle Â∞Ü <code>org.crac</code> Â∫ìÊ∑ªÂä†Âà∞‰Ω†ÁöÑÈ°πÁõÆ‰∏≠Ôºö</p>
<ul>
<li><strong>Maven</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">crac</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">crac</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="n">$</span><span class="p">{</span><span class="n">crac</span><span class="p">.</span><span class="na">version</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>Gradle</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">implementation</span><span class="w"> </span><span class="err">&#39;</span><span class="n">org</span><span class="p">.</span><span class="na">crac</span><span class="p">:</span><span class="n">crac</span><span class="p">:</span><span class="n">1</span><span class="p">.</span><span class="na">4</span><span class="p">.</span><span class="na">0</span><span class="err">&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="crac-ÁöÑÂçèË∞ÉÊú∫Âà∂">
    <a href="#crac-%e7%9a%84%e5%8d%8f%e8%b0%83%e6%9c%ba%e5%88%b6" class="header-anchor">#</a>
    CRaC ÁöÑÂçèË∞ÉÊú∫Âà∂
</h3><p>Â¶ÇÂâçÊâÄËø∞ÔºåCRaC ÁöÑÊ†∏ÂøÉËÆæËÆ°ÁêÜÂøµÊòØ‚ÄúÂçèË∞É‰∏éÈÄÇÂ∫î‚Äù„ÄÇËôΩÁÑ∂Â∫ïÂ±ÇÁöÑ CRIU ËÉΩÂ§üÂÜªÁªìÂíåÊÅ¢Â§çËøõÁ®ãÁöÑÂ§ßÈÉ®ÂàÜÁä∂ÊÄÅÔºå‰ΩÜÂØπ‰∫é<strong>Â§ñÈÉ®ËµÑÊ∫ê</strong>ÔºàExternal ResourcesÔºâÔºåÂ¶ÇÊâìÂºÄÁöÑÊñá‰ª∂„ÄÅÁΩëÁªúËøûÊé•ÔºàSocketÔºâ„ÄÅÊï∞ÊçÆÂ∫ìËøûÊé•Á≠âÔºåÁÆÄÂçïÁöÑÈÄèÊòéÊÅ¢Â§çÂèØËÉΩ‰ºöÂØºËá¥ÈóÆÈ¢ò„ÄÇÂéüÂõ†Âú®‰∫éÔºö</p>
<ul>
<li><strong>ÁéØÂ¢ÉÂèòÂåñÔºö</strong> <code>Restore</code> ÂèëÁîüÊó∂ÔºåËøêË°åÁéØÂ¢ÉÂèØËÉΩÂ∑≤ÁªèÊîπÂèòÔºà‰æãÂ¶ÇÔºåIP Âú∞ÂùÄ„ÄÅ‰∏ªÊú∫Âêç„ÄÅÊåÇËΩΩÁöÑÊñá‰ª∂Á≥ªÁªüÂÜÖÂÆπÔºâ„ÄÇÁõ¥Êé•ÊÅ¢Â§çÊóßÁöÑËµÑÊ∫êÂè•ÊüÑÂèØËÉΩÊåáÂêëÊó†ÊïàÊàñÈîôËØØÁöÑÁõÆÊ†á„ÄÇ</li>
<li><strong>Áä∂ÊÄÅÂ§±ÊïàÔºö</strong> Êüê‰∫õÂ§ñÈÉ®ËµÑÊ∫êÁöÑÁä∂ÊÄÅÂèØËÉΩÂÖ∑ÊúâÊó∂ÊïàÊÄßÔºà‰æãÂ¶ÇÔºåÊï∞ÊçÆÂ∫ìËøûÊé•Ë∂ÖÊó∂„ÄÅÊñá‰ª∂Ë¢´ÂÖ∂‰ªñËøõÁ®ã‰øÆÊîπÔºâ„ÄÇ</li>
<li><strong>ËµÑÊ∫êÂÜ≤Á™ÅÔºö</strong> ÊÅ¢Â§çÁöÑËøõÁ®ãÂèØËÉΩÂ∞ùËØï‰ΩøÁî®Â∑≤Ë¢´Êñ∞ÁéØÂ¢ÉÂç†Áî®ÁöÑËµÑÊ∫êÔºà‰æãÂ¶ÇÔºåÁ´ØÂè£Âè∑Ôºâ„ÄÇ</li>
</ul>
<p>Âõ†Ê≠§ÔºåCRaC <strong>‰∏çÈÄâÊã©</strong>ËÆ© CRIU ÈªòËÆ§ÈÄèÊòéÂú∞Â§ÑÁêÜËøô‰∫õÂ§ñÈÉ®ËµÑÊ∫êÔºåËÄåÊòØË¶ÅÊ±ÇÂ∫îÁî®Á®ãÂ∫è<strong>ÂøÖÈ°ª</strong>ÂèÇ‰∏éÂà∞ <strong>Checkpoint</strong> Âíå <strong>Restore</strong> ÁöÑËøáÁ®ã‰∏≠Ôºå‰∏ªÂä®ÁÆ°ÁêÜËøô‰∫õËµÑÊ∫ê„ÄÇËøôÂ∞±ÊòØ‚ÄúÂçèË∞É‚ÄùÁöÑÂê´‰πâ„ÄÇÂ∫îÁî®Á®ãÂ∫èÈúÄË¶ÅÊòéÁ°ÆÂëäÁü• CRaC Â¶Ç‰ΩïÂÆâÂÖ®Âú∞Â§ÑÁêÜËøô‰∫õÂ§ñÈÉ®ËøûÊé•ÂíåÁä∂ÊÄÅÔºå‰ª•Á°Æ‰øùÂú® <strong>Restore</strong> ÂêéËÉΩÂ§üÊ≠£Á°ÆÂú∞ÈÄÇÂ∫îÊñ∞ÁéØÂ¢É„ÄÇ</p>
<p>‰∏∫‰∫ÜÂÆûÁé∞ËøôÁßçÂçèË∞ÉÔºå<code>org.crac</code> ÂåÖÊèê‰æõ‰∫ÜÊ†∏ÂøÉÁöÑ <code>Resource</code> Êé•Âè£Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">org.crac</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ... imports ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Resource</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kt">void</span><span class="w"> </span><span class="nf">beforeCheckpoint</span><span class="p">(</span><span class="n">Context</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kt">void</span><span class="w"> </span><span class="nf">afterRestore</span><span class="p">(</span><span class="n">Context</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÈúÄË¶ÅÁÆ°ÁêÜÂ§ñÈÉ®ËµÑÊ∫êÁöÑÁ±ªÂèØ‰ª•ÂÆûÁé∞ <code>Resource</code> Êé•Âè£Ôºö</p>
<ul>
<li>Âú® Checkpoint ÂâçË∞ÉÁî® <code>beforeCheckpoint(Context&lt;? extends Resource&gt; context)</code>ÔºåÁî®‰∫é<strong>ÈáäÊîæ/ÂÖ≥Èó≠</strong>Â§ñÈÉ®ËµÑÊ∫êÔºåÁ°Æ‰øùÁä∂ÊÄÅ‰∏ÄËá¥„ÄÇÂ¶ÇÊûúÊó†Ê≥ïÂáÜÂ§áÂ•ΩÔºåÊäõÂá∫ÂºÇÂ∏∏ÈòªÊ≠¢ Checkpoint„ÄÇ</li>
<li>Âú® Restore ÂêéË∞ÉÁî® <code>afterRestore(Context&lt;? extends Resource&gt; context)</code>ÔºåÁî®‰∫é<strong>ÈáçÊñ∞Âª∫Á´ã/È™åËØÅ</strong>Â§ñÈÉ®ËµÑÊ∫êÔºåÊÅ¢Â§çÁä∂ÊÄÅ„ÄÇÂ¶ÇÊûúÊÅ¢Â§çÂ§±Ë¥•ÔºåÊäõÂá∫ÂºÇÂ∏∏„ÄÇ</li>
</ul>
<p>ÈÄöËøá <code>org.crac.Core.getGlobalContext().register(this)</code> ÔºåÂ∞ÜÂÆûÁé∞‰∫Ü <code>Resource</code> ÁöÑÂØπË±°Ê≥®ÂÜåÁªô CRaC ËøêË°åÊó∂„ÄÇÊ≥®ÂÜåÈ°∫Â∫èÂÜ≥ÂÆö‰∫Ü <code>beforeCheckpoint</code> ÁöÑË∞ÉÁî®È°∫Â∫èÔºåËÄå <code>afterRestore</code> Âàô‰ª•Áõ∏ÂèçÈ°∫Â∫èË∞ÉÁî®„ÄÇ</p>
<h3 id="Êñá‰ª∂ÊèèËø∞Á¨¶Á≠ñÁï•-file-descriptor-policies">
    <a href="#%e6%96%87%e4%bb%b6%e6%8f%8f%e8%bf%b0%e7%ac%a6%e7%ad%96%e7%95%a5-file-descriptor-policies" class="header-anchor">#</a>
    Êñá‰ª∂ÊèèËø∞Á¨¶Á≠ñÁï• (File Descriptor Policies)
</h3><p>ËôΩÁÑ∂ CRaC Êé®ËçêÈÄöËøáÂÆûÁé∞ <code>Resource</code> Êé•Âè£Êù•‰∏ªÂä®ÁÆ°ÁêÜÂ§ñÈÉ®ËµÑÊ∫êÔºå‰ΩÜ‰πüÊèê‰æõ‰∫Ü‰∏ÄÁßçÂü∫‰∫éÈÖçÁΩÆÁöÑÂ§áÈÄâÊñπÊ°àÔºåÁß∞‰∏∫<strong>Êñá‰ª∂ÊèèËø∞Á¨¶Á≠ñÁï• (File Descriptor Policies)</strong>„ÄÇËøô‰∏ªË¶ÅÁî®‰∫éÂ§ÑÁêÜÈÇ£‰∫õ<strong>Èöæ‰ª•‰øÆÊîπ</strong>‰ª•Ê∑ªÂä† <code>Resource</code> ÂõûË∞ÉÁöÑ‰ª£Á†ÅÔºå‰æãÂ¶ÇÁ¨¨‰∏âÊñπÂ∫ìÊàñ JDK ÂÜÖÈÉ®‰ª£Á†ÅÔºàÊ≥®ÊÑèÔºöÊ≠§Á≠ñÁï•‰ªÖÈÄÇÁî®‰∫éÈÄöËøá JDK API ÊâìÂºÄÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Ôºå‰∏çÈÄÇÁî®‰∫é Native ‰ª£Á†ÅÊâìÂºÄÁöÑ FDÔºâ„ÄÇ</p>
<h4 id="ÈÖçÁΩÆÊñπÂºè">
    <a href="#%e9%85%8d%e7%bd%ae%e6%96%b9%e5%bc%8f" class="header-anchor">#</a>
    ÈÖçÁΩÆÊñπÂºè
</h4><p>ÈÄöËøáËÆæÁΩÆÁ≥ªÁªüÂ±ûÊÄß <code>jdk.crac.resource-policies</code> ÊåáÂêë‰∏Ä‰∏™Á≠ñÁï•Êñá‰ª∂Êù•ÂêØÁî®„ÄÇËØ•Êñá‰ª∂ÈááÁî®Á±ª‰ºº YAML ÁöÑÊ†ºÂºèÔºåÂåÖÂê´‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËßÑÂàôÔºåËßÑÂàô‰πãÈó¥Áî® <code>---</code> ÂàÜÈöî„ÄÇ‰ª• <code>#</code> ÂºÄÂ§¥ÁöÑË°åÊòØÊ≥®Èáä„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># ËßÑÂàôÁ§∫‰æã 1: ÂÖ≥Èó≠ÁâπÂÆöÊñá‰ª∂  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">file  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/path/to/my/file  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">close  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ËßÑÂàôÁ§∫‰æã 2: ÂøΩÁï•ÊâÄÊúâ .log Êñá‰ª∂ (‰∫§Áªô CRIU Â§ÑÁêÜ)  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">FILE</span><span class="w"> </span><span class="c"># Á±ªÂûã‰∏çÂå∫ÂàÜÂ§ßÂ∞èÂÜô  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;**\*.log&#34;</span><span class="w"> </span><span class="c"># ÊîØÊåÅ glob Ê®°Âºè  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">ignore  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">warn</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c"># Á¶ÅÊ≠¢ÂØπÊ≠§ËßÑÂàôÂåπÈÖçÁöÑ FD ÊâìÂç∞Ë≠¶Âëä  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ËßÑÂàôÁ§∫‰æã 3: ÈáçÊñ∞ÊâìÂºÄ Unix socket  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">socket  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l">unix  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">localPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/run/app.sock  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l">reopen</span><span class="w"> </span><span class="c"># Ê≥®ÊÑèÔºösocket ÁöÑ reopen ÁõÆÂâçÂèØËÉΩ‰∏çÂÆåÂñÑ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>CRaC Âú® Checkpoint Êó∂‰ºöÊ£ÄÊü•ÊâÄÊúâÊâìÂºÄÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶„ÄÇÂØπ‰∫éÊØè‰∏™ FDÔºåÂÆÉ‰ºö<strong>ÊåâÈ°∫Â∫è</strong>Êü•ÊâæÁ≠ñÁï•Êñá‰ª∂‰∏≠ÁöÑËßÑÂàôÔºå<strong>Á¨¨‰∏Ä‰∏™ÂåπÈÖç</strong>ÁöÑËßÑÂàôÂ∞ÜË¢´Â∫îÁî®ÔºåÂêéÁª≠ËßÑÂàô‰ºöË¢´ÂøΩÁï•„ÄÇ</p>
<p>ÊØè‰∏™ËßÑÂàôÂøÖÈ°ªÂåÖÂê´ <code>type</code> Âíå <code>action</code> ‰∏§‰∏™Â±ûÊÄßÔºàÂÄº‰∏çÂå∫ÂàÜÂ§ßÂ∞èÂÜôÔºâ„ÄÇ</p>
<p><strong>ÂèØÁî®Á±ªÂûã (type):</strong></p>
<ul>
<li>file: Êú¨Âú∞Êñá‰ª∂Á≥ªÁªü‰∏äÁöÑÊñá‰ª∂ÊàñÁõÆÂΩï„ÄÇ</li>
<li>pipe: ÂåøÂêçÁÆ°ÈÅìÔºàÂëΩÂêçÁÆ°ÈÅì‰ΩøÁî® file Á±ªÂûãÔºâ„ÄÇ</li>
<li>socket: ÁΩëÁªúÂ•óÊé•Â≠óÔºàTCP, UDP Á≠âÔºâÊàñ Unix ÂüüÂ•óÊé•Â≠ó„ÄÇ</li>
<li>filedescriptor: Êó†Ê≥ïÈÄöËøá‰ª•‰∏äÁ±ªÂûãËØÜÂà´ÁöÑÂéüÂßãÊñá‰ª∂ÊèèËø∞Á¨¶Ôºà‰æãÂ¶ÇÔºåÁî± Native ‰ª£Á†ÅÊâìÂºÄ‰ΩÜÈÄöËøá JDK API Êö¥Èú≤ÁöÑÔºâ„ÄÇ</li>
</ul>
<h4 id="Êñá‰ª∂-file-ËßÑÂàô">
    <a href="#%e6%96%87%e4%bb%b6-file-%e8%a7%84%e5%88%99" class="header-anchor">#</a>
    Êñá‰ª∂ (file) ËßÑÂàô
</h4><p>ÈÄöËøá <code>path</code> Â±ûÊÄßÂåπÈÖçÔºåÊîØÊåÅ <a class="link" href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-"  target="_blank" rel="noopener"
    >glob Ê®°Âºè</a>„ÄÇ</p>
<p>**ÂèØÁî®Êìç‰Ωú (action)**ÊîØÊåÅÔºö</p>
<ul>
<li><strong>error</strong>: (ÈªòËÆ§) ÊâìÂç∞ÈîôËØØÂπ∂ÂØºËá¥ Checkpoint Â§±Ë¥•„ÄÇ</li>
<li><strong>ignore</strong>: ÂøΩÁï•Ê≠§ FDÔºåÂ∞ÜÂÖ∂Â§ÑÁêÜÂÆåÂÖ®ÂßîÊâòÁªôÂ∫ïÂ±ÇÁöÑ Checkpoint/Restore ÂºïÊìéÔºàÂ¶Ç CRIUÔºâ„ÄÇCRIU ÈÄöÂ∏∏‰ºöÂ∞ùËØïÈ™åËØÅÂπ∂Âú® Restore Êó∂ÈáçÊñ∞ÊâìÂºÄÊñá‰ª∂„ÄÇ<strong>ËøôÊòØÂ∞ÜÂ§ÑÁêÜË¥£‰ªª‰∫§Áªô CRIU ÁöÑÊñπÂºè„ÄÇ</strong></li>
<li><strong>close</strong>: Âú® Checkpoint ÂâçÂÖ≥Èó≠Êñá‰ª∂„ÄÇÂ¶ÇÊûúÂú® Restore ÂêéÂ∞ùËØï‰ΩøÁî®ËØ• FDÔºå‰ºöÂØºËá¥ËøêË°åÊó∂ÂºÇÂ∏∏„ÄÇ</li>
<li><strong>reopen</strong>: Âú® Checkpoint ÂâçÂÖ≥Èó≠Êñá‰ª∂ÔºåÂπ∂Âú® Restore ÂêéÂ∞ùËØïÂú®Áõ∏Âêå‰ΩçÁΩÆÈáçÊñ∞ÊâìÂºÄÂÆÉ„ÄÇ</li>
</ul>
<h4 id="ÁÆ°ÈÅì-pipe-ËßÑÂàô">
    <a href="#%e7%ae%a1%e9%81%93-pipe-%e8%a7%84%e5%88%99" class="header-anchor">#</a>
    ÁÆ°ÈÅì (pipe) ËßÑÂàô
</h4><p>ÂåøÂêçÁÆ°ÈÅìÊó†Ê≥ïÈÄöËøáÂêçÁß∞ËØÜÂà´ÔºåÂõ†Ê≠§ÈÄöÂ∏∏ÊúÄÂ§öÂè™Êúâ‰∏Ä‰∏™ pipe ËßÑÂàô„ÄÇ</p>
<p><strong>ÂèØÁî®Êìç‰Ωú (action)</strong> ÊîØÊåÅ <strong>error</strong>Ôºå<strong>ignore</strong> Âíå <strong>close</strong>ÔºåÂê´‰πâÂíåÊñá‰ª∂ËßÑÂàôÁõ∏Âêå„ÄÇ</p>
<h4 id="Â•óÊé•Â≠ó-socket-ËßÑÂàô">
    <a href="#%e5%a5%97%e6%8e%a5%e5%ad%97-socket-%e8%a7%84%e5%88%99" class="header-anchor">#</a>
    Â•óÊé•Â≠ó (socket) ËßÑÂàô
</h4><p>ÂèØ‰ª•ÈÄöËøá‰ª•‰∏ãÂ±ûÊÄßÁªÜÂåñÂåπÈÖçÔºö</p>
<ul>
<li><strong>family</strong>: <code>ipv4/inet4</code>, <code>ipv6/inet6</code>, <code>ip/inet</code> (‰ªªÊÑè IP), <code>unix</code>„ÄÇ</li>
<li><strong>localAddress</strong>, <strong>remoteAddress</strong>: IP Âú∞ÂùÄÊàñ <code>*</code> (‰ªªÊÑèÂú∞ÂùÄ)„ÄÇ</li>
<li><strong>localPort</strong>, <strong>remotePort</strong>: Á´ØÂè£Âè∑Êàñ <code>*</code> (‰ªªÊÑèÁ´ØÂè£)„ÄÇ</li>
<li><strong>localPath</strong>, <strong>remotePath</strong>: Unix Â•óÊé•Â≠óË∑ØÂæÑÔºåÊîØÊåÅ glob Ê®°Âºè„ÄÇ</li>
</ul>
<p><strong>ÂèØÁî®Êìç‰Ωú (action)</strong>  ÊîØÊåÅ <strong>error</strong>Ôºå<strong>ignore</strong> Âíå <strong>close</strong>„ÄÇ<strong>reopen</strong> ‰πüÂèØ‰ª•‰ΩøÁî®ÔºåÂÆÉ‰ºöÂú® Checkpoint ÂâçÂÖ≥Èó≠Â•óÊé•Â≠óÔºå‰ΩÜÁõÆÂâçÈáçÊñ∞ÊâìÂºÄÁöÑÈÄªËæëÔºàÁâπÂà´ÊòØÂØπ‰∫éÁõëÂê¨Â•óÊé•Â≠óÔºâÂèØËÉΩÂ∞öÊú™ÂÆåÂÖ®ÂÆûÁé∞„ÄÇ</p>
<h4 id="ÂéüÂßãÊñá‰ª∂ÊèèËø∞Á¨¶-filedescriptor-ËßÑÂàô">
    <a href="#%e5%8e%9f%e5%a7%8b%e6%96%87%e4%bb%b6%e6%8f%8f%e8%bf%b0%e7%ac%a6-filedescriptor-%e8%a7%84%e5%88%99" class="header-anchor">#</a>
    ÂéüÂßãÊñá‰ª∂ÊèèËø∞Á¨¶ (filedescriptor) ËßÑÂàô
</h4><p>Áî®‰∫éÂåπÈÖçÈÇ£‰∫õÊ≤°ÊúâÂØπÂ∫î Java ÂØπË±°ÔºàÂ¶Ç <code>FileOutputStream</code>ÔºâÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶„ÄÇ</p>
<p>ÂèØ‰ª•ÈÄöËøáÊï∞ÂÄº <code>value: 123</code> ÔºåÊàñÂéüÁîüÊèèËø∞ÁöÑÊ≠£ÂàôË°®ËææÂºè <code>regex: .*something.*</code> (Java Ê≠£ÂàôËØ≠Ê≥ï) Êù•ÂåπÈÖç„ÄÇ</p>
<p><strong>ÂèØÁî®Êìç‰Ωú (action)</strong>  ÊîØÊåÅ <strong>error</strong>Ôºå <strong>ignore</strong> Âíå <strong>close</strong>„ÄÇ</p>
<h4 id="ÈáçË¶ÅÊèêÁ§∫">
    <a href="#%e9%87%8d%e8%a6%81%e6%8f%90%e7%a4%ba" class="header-anchor">#</a>
    ÈáçË¶ÅÊèêÁ§∫
</h4><p>Êñá‰ª∂ÊèèËø∞Á¨¶Á≠ñÁï•Ë¢´ËÆ§‰∏∫ÊòØ<strong>ÊùÉÂÆú‰πãËÆ°</strong>ÔºåÁî®‰∫éÂ§ÑÁêÜÊó†Ê≥ïÁõ¥Êé•‰øÆÊîπ‰ª£Á†ÅÁöÑÊÉÖÂÜµ„ÄÇ<strong>È¶ñÈÄâ‰∏îÊõ¥ÂÅ•Â£ÆÁöÑÊñπÂºè‰ªçÁÑ∂ÊòØÂÆûÁé∞ Resource Êé•Âè£</strong>ÔºåÂõ†‰∏∫Â∫îÁî®Á®ãÂ∫èÊúÄ‰∫ÜËß£Â¶Ç‰ΩïÊ≠£Á°Æ„ÄÅÂÆâÂÖ®Âú∞Â§ÑÁêÜÂÖ∂Â§ñÈÉ®ËµÑÊ∫êÔºåÂ∞§ÂÖ∂ÊòØÂú®Èù¢ÂØπÁéØÂ¢ÉÂèòÂåñÊó∂„ÄÇËøáÂ∫¶‰æùËµñ ignore Á≠ñÁï•ÂèØËÉΩÈöêËóèÊΩúÂú®ÁöÑ Restore ÂêéÈóÆÈ¢ò„ÄÇ</p>
<h3 id="crac-ÂÆûÊàò">
    <a href="#crac-%e5%ae%9e%e6%88%98" class="header-anchor">#</a>
    CRaC ÂÆûÊàò
</h3><p>‰∏ãÈù¢Êàë‰ª¨ÈÄöËøá‰∏Ä‰∏™ÁÆÄÂçïÁöÑ Jetty Web ÊúçÂä°Âô®Á§∫‰æãÔºåÊºîÁ§∫Â¶Ç‰Ωï‰ΩøÁî® <code>org.crac</code> API Êù•ÊîØÊåÅ CRaC„ÄÇÂÆåÊï¥‰ª£Á†ÅÂèØÂú® <a class="link" href="https://github.com/org-crac/example-jetty"  target="_blank" rel="noopener"
    >example-jetty</a> ‰ªìÂ∫ìÊâæÂà∞„ÄÇ</p>
<ol>
<li><strong>ÂàùÂßã Jetty Â∫îÁî®</strong></li>
</ol>
<p>ÂÅáËÆæÊàë‰ª¨Êúâ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ Jetty Â∫îÁî®Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">ServerManager</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Server</span><span class="w"> </span><span class="n">server</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ServerManager</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Server</span><span class="p">(</span><span class="n">8080</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">server</span><span class="p">.</span><span class="na">setHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractHandler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="n">ServerManager</span><span class="w"> </span><span class="n">serverManager</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">response</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;Hello World&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">serverManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServerManager</span><span class="p">(</span><span class="n">8080</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">App</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><strong>Ê∑ªÂä† org.crac ‰æùËµñ</strong><br>
Âú® <code>pom.xml</code> (Maven) Êàñ <code>build.gradle</code> (Gradle) ‰∏≠Ê∑ªÂä† <code>org.crac</code> ‰æùËµñ„ÄÇ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">crac</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">crac</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="n">0</span><span class="p">.</span><span class="na">1</span><span class="p">.</span><span class="na">3</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li><strong>Â∞ùËØï Checkpoint (È¢ÑÊúüÂ§±Ë¥•)</strong></li>
</ol>
<p>ÁºñËØëÂπ∂ËøêË°åÂ∫îÁî®ÔºåÂêØÁî® CRaC Âπ∂ÊåáÂÆö Checkpoint ÁõÆÂΩïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># ÁºñËØë</span>
</span></span><span class="line"><span class="cl">$ mvn clean package
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËøêË°å  </span>
</span></span><span class="line"><span class="cl">$ java -XX:CRaCCheckpointTo<span class="o">=</span>cr -Djdk.crac.collect-fd-stacktraces<span class="o">=</span><span class="nb">true</span> -jar target/example-jetty-1.0-SNAPSHOT.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â∫îÁî®ÂêØÂä®ÂêéÔºåÂ∞ùËØïËÆøÈóÆ <code>http://localhost:8080</code>ÔºåÂ∫îËØ•ËÉΩÁúãÂà∞‚ÄúHello World‚Äù„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl localhost:8080
</span></span><span class="line"><span class="cl">Hello World
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂ÂêéÂ∞ùËØïËß¶Âèë CheckpointÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Êü•Êâæ PID </span>
</span></span><span class="line"><span class="cl">$ jps
</span></span><span class="line"><span class="cl"><span class="m">35297</span> example-jetty-1.0-SNAPSHOT.jar
</span></span><span class="line"><span class="cl"><span class="m">36051</span> Jps
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ëß¶Âèë Checkpoint</span>
</span></span><span class="line"><span class="cl">jcmd <span class="m">35297</span> JDK.checkpoint
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§Êó∂ÔºåÂ∫îÁî®ÊéßÂà∂Âè∞‰ºöÊâìÂç∞Á±ª‰ºº‰ª•‰∏ãÁöÑÂºÇÂ∏∏Âπ∂ÈÄÄÂá∫ÔºåÂõ†‰∏∫ Jetty ÊâìÂºÄ‰∫ÜÁõëÂê¨Á´ØÂè£Ôºà‰∏Ä‰∏™ Socket Êñá‰ª∂ÊèèËø∞Á¨¶ÔºâÔºåËÄåÊàë‰ª¨Ê≤°ÊúâÂ§ÑÁêÜÂÆÉÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">An exception during a checkpoint operation:
</span></span><span class="line"><span class="cl">jdk.internal.crac.mirror.CheckpointException
</span></span><span class="line"><span class="cl">	Suppressed: jdk.internal.crac.mirror.impl.CheckpointOpenSocketException: sun.nio.ch.ServerSocketChannelImpl<span class="o">[</span>/<span class="o">[</span>0:0:0:0:0:0:0:0<span class="o">]</span>:8080<span class="o">]</span>
</span></span><span class="line"><span class="cl">		at java.base/jdk.internal.crac.JDKSocketResourceBase.lambda<span class="nv">$beforeCheckpoint$0</span><span class="o">(</span>JDKSocketResourceBase.java:68<span class="o">)</span>
</span></span><span class="line"><span class="cl">		at java.base/jdk.internal.crac.mirror.Core.checkpointRestore1<span class="o">(</span>Core.java:170<span class="o">)</span>
</span></span><span class="line"><span class="cl">		at java.base/jdk.internal.crac.mirror.Core.checkpointRestore<span class="o">(</span>Core.java:315<span class="o">)</span>
</span></span><span class="line"><span class="cl">		at java.base/jdk.internal.crac.mirror.Core.checkpointRestoreInternal<span class="o">(</span>Core.java:328<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li><strong>ÂÆûÁé∞ Resource Êé•Âè£</strong></li>
</ol>
<p>Êàë‰ª¨ÈúÄË¶ÅËÆ© <code>ServerManager</code> ÂÆûÁé∞ <code>Resource</code> Êé•Âè£ÔºåÂú® Checkpoint ÂâçÂÅúÊ≠¢ Jetty ÊúçÂä°Âô®ÔºàÂÖ≥Èó≠ SocketÔºâÔºåÂú® Restore ÂêéÈáçÊñ∞ÂêØÂä®ÂÆÉ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.crac.Context</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.crac.Core</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.crac.Resource</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">class</span> <span class="nc">ServerManager</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">beforeCheckpoint</span><span class="p">(</span><span class="n">Context</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c1">// Stop the connectors only and keep the expensive application running</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnectors</span><span class="p">()).</span><span class="na">forEach</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">LifeCycle</span><span class="p">.</span><span class="na">stop</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterRestore</span><span class="p">(</span><span class="n">Context</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnectors</span><span class="p">()).</span><span class="na">forEach</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">LifeCycle</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="n">c</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Â∞Ü <code>Resource</code> Ê≥®ÂÜåÂà∞‰∏Ä‰∏™¬†<code>Context</code>¬†‰∏≠ÔºåËØ•¬†<code>Context</code>¬†Â∞ÜË∞ÉÁî®¬†<code>Resource</code>¬†ÁöÑÊñπÊ≥ï‰Ωú‰∏∫ÈÄöÁü•„ÄÇÊúâ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑ¬†<code>Context</code>¬†ÂèØ‰ª•‰Ωú‰∏∫ÈªòËÆ§ÈÄâÊã©„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">ServerManager</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="nf">ServerManager</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Core</span><span class="p">.</span><span class="na">getGlobalContext</span><span class="p">().</span><span class="na">register</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li><strong>ÂÜçÊ¨°Â∞ùËØï Checkpoint (È¢ÑÊúüÊàêÂäü)</strong><br>
ÈáçÊñ∞ÁºñËØëÂπ∂ËøêË°åÂ∫îÁî®</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ mvn  clean package  
</span></span><span class="line"><span class="cl">$ java -XX:CRaCCheckpointTo<span class="o">=</span>cr -jar target/example-jetty-1.0-SNAPSHOT.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËÆøÈóÆ <code>http://localhost:8080</code> ËøõË°åÈ¢ÑÁÉ≠„ÄÇÁÑ∂ÂêéÂÜçÊ¨°Ëß¶Âèë CheckpointÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ jcmd &lt;pid&gt; JDK.checkpoint
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÊ¨°Ôºå‰Ω†Â∫îËØ•Âú®Â∫îÁî®ÊéßÂà∂Âè∞ÁúãÂà∞Á±ª‰ººËæìÂá∫ÔºåË°®Êòé Jetty Ë¢´ÂÅúÊ≠¢ÔºåÁÑ∂Âêé Checkpoint Ë¢´ÂàõÂª∫ÔºåÊúÄÂêéÂéüÂßã JVM Ë¢´ÊùÄÊ≠ªÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">INFO: Starting checkpoint
</span></span><span class="line"><span class="cl">2025-04-28 02:42:16.653:INFO:oejs.AbstractConnector:Attach Listener: Stopped ServerConnector@270421f5<span class="o">{</span>HTTP/1.1, <span class="o">(</span>http/1.1<span class="o">)}{</span>0.0.0.0:8080<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>1<span class="o">]</span>    <span class="m">42035</span> killed     java -XX:CRaCCheckpointTo<span class="o">=</span>cr -jar target/example-jetty-1.0-SNAPSHOT.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂêåÊó∂ÔºåÂú® <code>cr</code> ÁõÆÂΩï‰∏ã‰ºöÁîüÊàê Checkpoint ÈïúÂÉèÊñá‰ª∂„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls cr                                                                                                                                                   
</span></span><span class="line"><span class="cl">core-42035.img  core-42045.img  core-42081.img  core-42092.img  core-42426.img  core-42436.img  core-42446.img     pstree.img
</span></span><span class="line"><span class="cl">core-42036.img  core-42046.img  core-42082.img  core-42093.img  core-42427.img  core-42437.img  dump4.log          seccomp.img
</span></span><span class="line"><span class="cl">core-42037.img  core-42047.img  core-42083.img  core-42094.img  core-42428.img  core-42438.img  fdinfo-2.img       stats-dump
</span></span><span class="line"><span class="cl">core-42038.img  core-42048.img  core-42084.img  core-42116.img  core-42429.img  core-42439.img  files.img          timens-0.img
</span></span><span class="line"><span class="cl">core-42039.img  core-42049.img  core-42085.img  core-42119.img  core-42430.img  core-42440.img  fs-42035.img       tty-info.img
</span></span><span class="line"><span class="cl">core-42040.img  core-42050.img  core-42086.img  core-42121.img  core-42431.img  core-42441.img  ids-42035.img
</span></span><span class="line"><span class="cl">core-42041.img  core-42051.img  core-42088.img  core-42422.img  core-42432.img  core-42442.img  inventory.img
</span></span><span class="line"><span class="cl">core-42042.img  core-42052.img  core-42089.img  core-42423.img  core-42433.img  core-42443.img  mm-42035.img
</span></span><span class="line"><span class="cl">core-42043.img  core-42079.img  core-42090.img  core-42424.img  core-42434.img  core-42444.img  pagemap-42035.img
</span></span><span class="line"><span class="cl">core-42044.img  core-42080.img  core-42091.img  core-42425.img  core-42435.img  core-42445.img  pages-1.img
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li><strong>‰ªé Checkpoint ÊÅ¢Â§ç</strong></li>
</ol>
<p>‰ΩøÁî® <code>-XX:CRaCRestoreFrom</code> ÂèÇÊï∞ÂêØÂä®‰∏Ä‰∏™Êñ∞ÁöÑ JVM ÂÆû‰æãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ java -XX:CRaCRestoreFrom<span class="o">=</span>cr
</span></span><span class="line"><span class="cl">2025-04-28 02:46:57.664:INFO:oejs.AbstractConnector:Attach Listener: Started ServerConnector@270421f5<span class="o">{</span>HTTP/1.1, <span class="o">(</span>http/1.1<span class="o">)}{</span>0.0.0.0:8080<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áé∞Âú®Ôºå‰Ω†ÂèØ‰ª•ÂÜçÊ¨°ËÆøÈóÆ <code>http://localhost:8080</code>ÔºåÂ∫îÁî®Â∫îËØ•ËÉΩÂ§üÊ≠£Â∏∏ÂìçÂ∫î„ÄÇ</p>
<p>Êü•ÁúãËøõÁ®ãÁöÑÁà∂Â≠êÂÖ≥Á≥ªÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ps axfo pid,ppid,command
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">  <span class="m">31809</span>   <span class="m">31807</span>  <span class="se">\_</span> sshd: mazhen <span class="o">[</span>priv<span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="m">31830</span>   <span class="m">31809</span>      <span class="se">\_</span> sshd: mazhen@pts/0,pts/1
</span></span><span class="line"><span class="cl">  <span class="m">31831</span>   <span class="m">31830</span>          <span class="se">\_</span> -zsh
</span></span><span class="line"><span class="cl">  <span class="m">44224</span>   <span class="m">31831</span>          <span class="p">|</span>   <span class="se">\_</span> /home/mazhen/21.0.5.crac/lib/criuengine restorewait
</span></span><span class="line"><span class="cl">  <span class="m">42035</span>   <span class="m">44224</span>          <span class="p">|</span>       <span class="se">\_</span> java -XX:CRaCCheckpointTo<span class="o">=</span>cr -jar target/example-jetty-1.0-SNAPSHOT.jar
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂíåÂâçÈù¢ CRaC ÂÆûÁé∞ÂéüÁêÜÂàÜÊûê‰∏ÄËá¥ÔºåÊÅ¢Â§çÁöÑ JVM ËøõÁ®ãÊòØ <code>criuengine</code> ÁöÑÂ≠êËøõÁ®ã„ÄÇ</p>
<h3 id="Ê≥®ÊÑè‰∫ãÈ°π">
    <a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" class="header-anchor">#</a>
    Ê≥®ÊÑè‰∫ãÈ°π
</h3><ul>
<li><strong>Êû∂ÊûÑ‰∏éÁéØÂ¢ÉÈôêÂà∂</strong>
CRaC ÁöÑ Checkpoint Âíå Restore <strong>ÂøÖÈ°ªÂú®Áõ∏ÂêåÁöÑ CPU Êû∂ÊûÑ</strong>Ôºà‰æãÂ¶ÇÔºåÈÉΩÊòØ x64 ÊàñÈÉΩÊòØ ARM64Ôºâ‰∏äËøõË°å„ÄÇ</li>
</ul>
<p>Ê≠§Â§ñÔºåÂÆÉÁõÆÂâç‰∏ªË¶Å‰æùËµñ <strong>Linux</strong> Êìç‰ΩúÁ≥ªÁªüÂíåÁâπÂÆöÁöÑÊîØÊåÅ CRaC ÁöÑ JDK ÊûÑÂª∫ÁâàÊú¨ÔºàÂ¶Ç Azul Zulu CRaC builds, Apusic JDK with CRaC Support Á≠âÔºâ„ÄÇ</p>
<ul>
<li>
<p><strong>Á≥ªÁªüÊó∂ÈíüÂèòÂåñ</strong>
Â∫îÁî®Á®ãÂ∫èÈúÄË¶ÅÊ≥®ÊÑèÔºå‰ªé Checkpoint Âà∞ Restore ‰πãÈó¥ÂèØËÉΩÂ≠òÂú®ÊòæËëóÁöÑ<strong>Á≥ªÁªüÊó∂ÈíüË∑≥Ë∑É</strong>„ÄÇÂØπ‰∫é‰æùËµñÊó∂Èó¥ÁöÑÈÄªËæëÔºàÂ¶ÇÁºìÂ≠òËøáÊúü„ÄÅÂÆöÊó∂‰ªªÂä°„ÄÅÂêåÊ≠•Êú∫Âà∂ÔºâÔºåÂèØËÉΩÈúÄË¶ÅÂú® afterRestore ÂõûË∞É‰∏≠ËøõË°åÊ†°ÂáÜÊàñÁâπÊÆäÂ§ÑÁêÜÔºå‰ª•ÈÅøÂÖçÂõ†Êó∂Èó¥Â∑ÆÂØºËá¥ÁöÑË°å‰∏∫ÂºÇÂ∏∏„ÄÇËôΩÁÑ∂ OpenJDK CRaC ÂÜÖÈÉ®‰ºöÂ∞ùËØïÊ†°ÂáÜ System.nanoTime()Ôºå‰ΩÜÂ∫îÁî®Â±ÇÈù¢ÁöÑÊó∂Èó¥ÊïèÊÑüÈÄªËæë‰ªçÈúÄÂºÄÂèëËÄÖÂÖ≥Ê≥®„ÄÇ</p>
</li>
<li>
<p><strong>ÂπÇÁ≠âÊÄß</strong>
<code>beforeCheckpoint</code> Âíå <code>afterRestore</code> ÁöÑÂÆûÁé∞Â∫îËØ•ÊòØÂπÇÁ≠âÁöÑÔºåÂç≥Â§öÊ¨°Ë∞ÉÁî®‰πüÂ∫îËØ•‰∫ßÁîüÁõ∏ÂêåÁöÑÁªìÊûúÊàñÊó†ÂâØ‰ΩúÁî®„ÄÇ</p>
</li>
<li>
<p><strong>ÂÆâÂÖ®ÊÄß</strong>
Checkpoint ÈïúÂÉèÂåÖÂê´‰∫Ü JVM ËøõÁ®ãÁöÑÂÆåÊï¥ÂÜÖÂ≠òÁä∂ÊÄÅÔºåÂèØËÉΩÂåÖÂê´ÊïèÊÑüÊï∞ÊçÆÔºàÂ¶ÇÂØÜÁ†Å„ÄÅÂØÜÈí•„ÄÅÁî®Êà∑Êï∞ÊçÆÁ≠âÔºâ„ÄÇÂøÖÈ°ªÂÉèÂØπÂæÖÁîü‰∫ßÊï∞ÊçÆÂ∫ìÂ§á‰ªΩ‰∏ÄÊ†∑ÔºåÂ¶•ÂñÑ‰øùÁÆ° Checkpoint Êñá‰ª∂ÔºåÊéßÂà∂ËÆøÈóÆÊùÉÈôê„ÄÇ</p>
</li>
</ul>
<h2 id="‰∫îcrac-ÁöÑÂ∫îÁî®Âú∫ÊôØ‰∏éÁîüÊÄÅ">
    <a href="#%e4%ba%94crac-%e7%9a%84%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e4%b8%8e%e7%94%9f%e6%80%81" class="header-anchor">#</a>
    ‰∫î„ÄÅCRaC ÁöÑÂ∫îÁî®Âú∫ÊôØ‰∏éÁîüÊÄÅ
</h2><p>CRaC ÊäÄÊúØ‰ª•ÂÖ∂ÊòæËëóÁº©Áü≠ÂêØÂä®Êó∂Èó¥ÂíåÂÆûÁé∞Âç≥Êó∂Â≥∞ÂÄºÊÄßËÉΩÁöÑ‰ºòÂäøÔºåÂú®Â§ö‰∏™È¢ÜÂüüÂ±ïÁé∞Âá∫Â∑®Â§ßÁöÑÂ∫îÁî®ÊΩúÂäõÔºåÂπ∂‰∏îÂÖ∂ÁîüÊÄÅÁ≥ªÁªüÊ≠£Âú®ÈÄêÊ≠•ÂèëÂ±ïÂ£ÆÂ§ß„ÄÇ</p>
<h3 id="ÁêÜÊÉ≥Â∫îÁî®Âú∫ÊôØ">
    <a href="#%e7%90%86%e6%83%b3%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" class="header-anchor">#</a>
    ÁêÜÊÉ≥Â∫îÁî®Âú∫ÊôØ
</h3><ul>
<li>
<p><strong>Serverless Functions (FaaS)</strong>
ËøôÊòØ CRaC ÊúÄÂÖ∏ÂûãÁöÑÂ∫îÁî®Âú∫ÊôØ‰πã‰∏Ä„ÄÇServerless ÂáΩÊï∞ÁöÑÂÜ∑ÂêØÂä®Âª∂ËøüÊòØÂΩ±ÂìçÁî®Êà∑‰ΩìÈ™åÂíåÊàêÊú¨ÁöÑÂÖ≥ÈîÆÂõ†Á¥†„ÄÇCRaC ÂèØ‰ª•Â∞ÜÂáΩÊï∞ÁöÑÂêØÂä®Êó∂Èó¥‰ªéÁßíÁ∫ßÈôç‰ΩéÂà∞ÊØ´ÁßíÁ∫ßÔºåÊûÅÂ§ßÂú∞ÊîπÂñÑÂÜ∑ÂêØÂä®ÊÄßËÉΩÔºå‰ΩøÂæó Java Âú® Serverless È¢ÜÂüüÊõ¥ÂÖ∑Á´û‰∫âÂäõ„ÄÇAWS Lambda SnapStart Â∞±ÊòØÂü∫‰∫éÁ±ª‰ºº CRaC ÁöÑÊäÄÊúØÂÆûÁé∞ÁöÑ„ÄÇ</p>
</li>
<li>
<p><strong>ÂæÆÊúçÂä°</strong>
Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÔºåÊúçÂä°ÂÆû‰æãÈúÄË¶ÅÈ¢ëÁπÅÂú∞ÂêØÂä®„ÄÅÂÅúÊ≠¢ÂíåÊ∞¥Âπ≥Êâ©Â±ï„ÄÇCRaC ÂèØ‰ª•ÊòæËëóÂä†Âø´Êñ∞ÊúçÂä°ÂÆû‰æãÁöÑÂêØÂä®ÈÄüÂ∫¶ÔºåÊèêÈ´òËá™Âä®‰º∏Áº©ÔºàAuto-scalingÔºâÁöÑÂìçÂ∫îËÉΩÂäõÂíåÊïàÁéáÔºåÂ∞§ÂÖ∂ÊòØÂú®Â∫îÂØπÁ™ÅÂèëÊµÅÈáèÊó∂„ÄÇ</p>
</li>
<li>
<p><strong>ÊâπÂ§ÑÁêÜ‰Ωú‰∏ö</strong>
ÂØπ‰∫éÈúÄË¶ÅÂø´ÈÄüÂêØÂä®„ÄÅÊâßË°å‰ªªÂä°ÁÑ∂ÂêéÈÄÄÂá∫ÁöÑÊâπÂ§ÑÁêÜ‰Ωú‰∏öÔºåCRaC ÂèØ‰ª•Ê∂àÈô§Â§ßÈÉ®ÂàÜÂêØÂä®ÂºÄÈîÄÔºåÊèêÈ´ò‰Ωú‰∏öÊâßË°åÊïàÁéá„ÄÇ</p>
</li>
<li>
<p><strong>ËµÑÊ∫êÂèóÈôêÁéØÂ¢É</strong>
Âú®ÂÜÖÂ≠òÊàñ CPU ËµÑÊ∫êÂèóÈôêÁöÑÁéØÂ¢É‰∏≠ÔºåCRaC ÈÄöËøáÈÅøÂÖçÂêØÂä®ÂíåÈ¢ÑÁÉ≠Èò∂ÊÆµÁöÑÈ´òËµÑÊ∫êÊ∂àËÄóÔºåÊúâÂä©‰∫éÊõ¥È´òÊïàÂú∞Âà©Áî®ËµÑÊ∫ê„ÄÇ</p>
</li>
</ul>
<h3 id="Ê°ÜÊû∂‰∏éÂπ≥Âè∞ÊîØÊåÅ">
    <a href="#%e6%a1%86%e6%9e%b6%e4%b8%8e%e5%b9%b3%e5%8f%b0%e6%94%af%e6%8c%81" class="header-anchor">#</a>
    Ê°ÜÊû∂‰∏éÂπ≥Âè∞ÊîØÊåÅ
</h3><p>ÈöèÁùÄ CRaC ÊäÄÊúØÁöÑÂèëÂ±ïÔºåË∂äÊù•Ë∂äÂ§öÁöÑ Java Ê°ÜÊû∂ÂíåÂπ≥Âè∞ÂºÄÂßãÊèê‰æõÂØπÂÖ∂ÁöÑÊîØÊåÅÔºå‰ª•ÁÆÄÂåñÂºÄÂèëËÄÖÁöÑ‰ΩøÁî®„ÄÇ</p>
<ul>
<li>
<p><strong>Spring Framework / Spring Boot</strong>
‰ªé Spring Framework 6.1 Âíå Spring Boot 3.2 ÂºÄÂßãÔºåÊèê‰æõ‰∫ÜÂØπ CRaC ÁöÑÂÆòÊñπÊîØÊåÅ„ÄÇÂºÄÂèëËÄÖÂèØ‰ª•ÈÄöËøáÁÆÄÂçïÁöÑÈÖçÁΩÆÔºà‰æãÂ¶Ç <code>-Dspring.context.checkpoint=onRefresh</code>ÔºâÂÆûÁé∞Â∫îÁî®ÂêØÂä®Êó∂ÁöÑËá™Âä® CheckpointÔºåÊàñËÄÖÊâãÂä®Ëß¶Âèë Checkpoint ‰ª•ÂåÖÂê´Êõ¥ÂÆåÊï¥ÁöÑÂ∫îÁî®Áä∂ÊÄÅ„ÄÇSpring ‰ºöËá™Âä®Â§ÑÁêÜÂÜÖÈÉ®ÁÆ°ÁêÜÁöÑËµÑÊ∫êÔºàÂ¶ÇÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†„ÄÅÊ∂àÊÅØÁõëÂê¨Âô®Á≠âÔºâÁöÑ CRaC ÂõûË∞É„ÄÇ</p>
</li>
<li>
<p><strong>Micronaut</strong>
Micronaut Ê°ÜÊû∂Êèê‰æõ‰∫Ü‰∏ìÈó®ÁöÑ micronaut-crac Ê®°ÂùóÔºåÂèØ‰ª•Êñπ‰æøÂú∞ÈõÜÊàê CRaC ÊîØÊåÅ„ÄÇÂÆÉÂÜÖÁΩÆ‰∫ÜÂØπÂ∏∏ËßÅËµÑÊ∫êÔºàÂ¶Ç Hikari Êï∞ÊçÆÊ∫ê„ÄÅRedis ËøûÊé•ÔºâÁöÑÂçèË∞ÉÂ§ÑÁêÜ„ÄÇMicronaut ÁöÑÊûÑÂª∫Êèí‰ª∂ÔºàÂ¶Ç Gradle Êèí‰ª∂ÔºâÁîöËá≥ÂèØ‰ª•‰∏ÄÈîÆÁîüÊàêÂåÖÂê´ CRaC ÈïúÂÉèÁöÑ Docker ÈïúÂÉè„ÄÇ</p>
</li>
<li>
<p><strong>Quarkus</strong>
Quarkus ‰ªé 2.10.0 ÁâàÊú¨ÂºÄÂßãÂÜÖÁΩÆ‰∫ÜÂØπ CRaC ÁöÑÂü∫Êú¨ÊîØÊåÅ„ÄÇÂà©Áî® Quarkus ÁöÑÊûÑÂª∫Êó∂‰ºòÂåñÂíå CRaC ÁöÑËøêË°åÊó∂ÊÅ¢Â§çËÉΩÂäõÔºåÂèØ‰ª•Ëøõ‰∏ÄÊ≠•ÊèêÂçáÂ∫îÁî®ÁöÑÂêØÂä®ÊÄßËÉΩ„ÄÇ</p>
</li>
<li>
<p><strong>AWS Lambda SnapStart</strong>
ËôΩÁÑ∂Â∫ïÂ±ÇÂÆûÁé∞ÁªÜËäÇÊú™ÂÆåÂÖ®ÂÖ¨ÂºÄÔºå‰ΩÜ AWS Lambda ÁöÑ SnapStart ÂäüËÉΩÂú®ÂéüÁêÜÂíåÊïàÊûú‰∏ä‰∏é CRaC ÈùûÂ∏∏Áõ∏‰ººÔºåÂÆÉÂÖÅËÆ∏Áî®Êà∑‰∏∫ Lambda ÂáΩÊï∞ÂàõÂª∫Âø´ÁÖßÔºåÂπ∂Âú®Ë∞ÉÁî®Êó∂Âø´ÈÄüÊÅ¢Â§çÔºåÊòæËëóÈôç‰Ωé Java Lambda ÂáΩÊï∞ÁöÑÂÜ∑ÂêØÂä®Âª∂Ëøü„ÄÇËøôË°®Êòé CRaC ÁöÑÁêÜÂøµÂ∑≤ÁªèÂú®‰∏ªÊµÅ‰∫ëÂπ≥Âè∞‰∏äÂæóÂà∞‰∫ÜÂ∫îÁî®ÂíåÈ™åËØÅ„ÄÇ</p>
</li>
<li>
<p><strong>Azul Zulu Builds of OpenJDK</strong>
Azul ‰Ωú‰∏∫ CRaC ÊäÄÊúØÁöÑ‰∏ªË¶ÅÊé®Âä®ËÄÖ‰πã‰∏ÄÔºåÊèê‰æõ‰∫ÜÂåÖÂê´ CRaC ÂäüËÉΩÁöÑ OpenJDK ÂèëË°åÁâàÔºàZuluÔºâÔºåÊîØÊåÅ Linux/x64 Âíå Linux/ARM64 Âπ≥Âè∞ÔºåÂπ∂‰∏∫ Windows Âíå macOS Êèê‰æõÁî®‰∫éÂºÄÂèëÂíåÊµãËØïÁöÑÊ®°ÊãüÁâàÊú¨„ÄÇ</p>
</li>
</ul>
<h3 id="crac-ÈÉ®ÁΩ≤ÊñπÊ°à">
    <a href="#crac-%e9%83%a8%e7%bd%b2%e6%96%b9%e6%a1%88" class="header-anchor">#</a>
    CRaC ÈÉ®ÁΩ≤ÊñπÊ°à
</h3><p>CRaC ÁöÑÈÉ®ÁΩ≤ÊñπÊ°àÊó®Âú®Êî∂ÈõÜ Java Â∫îÁî®Á®ãÂ∫èÂàùÂßãÂåñÂíåÈ¢ÑÁÉ≠ÊâÄÈúÄÁöÑÊï∞ÊçÆ„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504281423303.png"
	
	
	
	loading="lazy"
	
		alt="flow"
	
	
></p>
<ol>
<li><strong>Âú®Èáë‰∏ùÈõÄÁéØÂ¢É‰∏≠ÈÉ®ÁΩ≤Âπ∂È¢ÑÁÉ≠Â∫îÁî®</strong>
<ul>
<li>Â∞Ü Java Â∫îÁî®Á®ãÂ∫èÈÉ®ÁΩ≤Âà∞Èáë‰∏ùÈõÄÔºàcanaryÔºâÊµãËØïÁéØÂ¢É‰∏≠„ÄÇ</li>
<li>Â∫îÁî®Á®ãÂ∫èÂ§ÑÁêÜÈáë‰∏ùÈõÄËØ∑Ê±ÇÔºåËøô‰ºöËß¶ÂèëÁ±ªÂä†ËΩΩÂíå JIT ÁºñËØëÔºå‰ªéËÄåÂÆåÊàêÈ¢ÑÁÉ≠„ÄÇ</li>
</ul>
</li>
<li><strong>ÂàõÂª∫ Checkpoint</strong>
<ul>
<li>ÂØπÊ≠£Âú®ËøêË°åÁöÑÂ∫îÁî®Á®ãÂ∫èËøõË°å Checkpoint Êìç‰Ωú„ÄÇ</li>
<li>ËøôÂ∞ÜÂàõÂª∫ JVM ÂíåÂ∫îÁî®Á®ãÂ∫èÁöÑÈïúÂÉèÔºàimageÔºâÔºåËØ•ÈïúÂÉèË¢´ËßÜ‰∏∫Êñ∞ÈÉ®ÁΩ≤ÂåÖÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ</li>
</ul>
</li>
<li><strong>Âú®Áîü‰∫ßÁéØÂ¢É‰∏≠ÈÉ®ÁΩ≤ÂíåÊÅ¢Â§ç</strong>
<ul>
<li>Â∞ÜÂ∏¶ÊúâÈïúÂÉèÁöÑ Java Â∫îÁî®Á®ãÂ∫èÈÉ®ÁΩ≤Âà∞Áîü‰∫ßÁéØÂ¢É‰∏≠„ÄÇ</li>
<li>ÈÄöËøá <code>-XX:CRaCRestoreFrom=PATH</code> ÈÄâÈ°π‰ªéÈïúÂÉèÊÅ¢Â§ç Java ËøõÁ®ã„ÄÇ</li>
<li>ÊÅ¢Â§çÂêéÁöÑ Java ËøõÁ®ãÂ∞ÜÁõ¥Êé•‰ΩøÁî®ÈïúÂÉè‰∏≠Â∑≤Âä†ËΩΩÁöÑÁ±ªÂíå JIT ‰ª£Á†ÅÔºå‰ªéËÄåÂÆûÁé∞Âø´ÈÄüÂêØÂä®ÂíåÂç≥Êó∂ËææÂà∞ÊúÄ‰Ω≥ÊÄßËÉΩ„ÄÇ</li>
</ul>
</li>
</ol>
<h3 id="ÊÄßËÉΩÂü∫ÂáÜ">
    <a href="#%e6%80%a7%e8%83%bd%e5%9f%ba%e5%87%86" class="header-anchor">#</a>
    ÊÄßËÉΩÂü∫ÂáÜ
</h3><p>Áî± Java Á§æÂå∫Âèä‰∏ªÊµÅÊ°ÜÊû∂ÂºÄÂèëËÄÖËøõË°åÁöÑÂπøÊ≥õÊÄßËÉΩÂü∫ÂáÜÊµãËØï‰∏ÄËá¥Ë°®ÊòéÔºåCRaC (Coordinated Restore at Checkpoint) ÊäÄÊúØËÉΩÂ§ü‰∏∫ Java Â∫îÁî®Â∏¶Êù•ÊòæËëóÁöÑÊÄßËÉΩÊèêÂçáÔºåÂ∞§ÂÖ∂Âú®ÂêØÂä®ÈÄüÂ∫¶ÊñπÈù¢Ë°®Áé∞Á™ÅÂá∫„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202504281408920.webp"
	
	
	
	loading="lazy"
	
		alt="crac"
	
	
></p>
<p>ÂØπ‰∫éÂ∏∏ËßÅÁöÑ Web Â∫îÁî®Á®ãÂ∫èÔºå‰æãÂ¶ÇÂü∫‰∫é Spring Boot„ÄÅMicronaut Êàñ Quarkus ÊûÑÂª∫ÁöÑÂ∫îÁî®ÔºåÈááÁî® CRaC ÁöÑÊÅ¢Â§çÊú∫Âà∂ÂèØ‰ª•Â∞ÜÂéüÂÖàÈúÄË¶ÅÊï∞ÁßíÁöÑÂêØÂä®ËøáÁ®ãÔºå<strong>Áº©Áü≠Ëá≥Âá†ÂçÅÊØ´ÁßíÁ∫ßÂà´</strong>„ÄÇËøôÊÑèÂë≥ÁùÄÂ∫îÁî®ËÉΩÂ§üÊõ¥Âø´Âú∞ËøõÂÖ•ÊúçÂä°Áä∂ÊÄÅÔºåÊèêÂçáÁî®Êà∑‰ΩìÈ™åÂíåËµÑÊ∫êÂà©Áî®Áéá„ÄÇ</p>
<p>‰∏∫‰∫ÜÂÖ∑‰ΩìÂ±ïÁ§∫ CRaC ÁöÑÊïàÊûúÔºåÊàëÂØπ Glassfish 7 ËøõË°å‰∫Ü CRaC ÁöÑÊîπÈÄ†ÈÄÇÈÖç„ÄÇÂú®ÈÉ®ÁΩ≤‰∫ÜÊ†áÂáÜ Spring PetClinic Â∫îÁî®ÁöÑÂú∫ÊôØ‰∏ãÔºö</p>
<ul>
<li><strong>Â∏∏ËßÑÂêØÂä®ËÄóÊó∂Ôºö</strong> ÈÄöËøáÊ†áÂáÜ <code>./bin/asadmin start-domain</code> ÂëΩ‰ª§ÂêØÂä®ÔºåÂÆåÊàêÊï¥‰∏™ÂêØÂä®ËøáÁ®ãÈúÄË¶Å <strong>8.813 Áßí</strong> (8813 ÊØ´Áßí)„ÄÇ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./bin/asadmin start-domain
</span></span><span class="line"><span class="cl">Waiting <span class="k">for</span> domain1 to start ........
</span></span><span class="line"><span class="cl">Waiting finished after 8,813 ms.
</span></span><span class="line"><span class="cl">Successfully started the domain : domain1
</span></span><span class="line"><span class="cl">domain  Location: /home/mazhen/works/glassfish7/glassfish/domains/domain1
</span></span><span class="line"><span class="cl">Log File: /home/mazhen/works/glassfish7/glassfish/domains/domain1/logs/server.log
</span></span><span class="line"><span class="cl">Admin Port: 4,848
</span></span><span class="line"><span class="cl">Command start-domain executed successfully.
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>CRaC ÊÅ¢Â§çËÄóÊó∂Ôºö</strong> ‰ªéÈ¢ÑÂÖàÁîüÊàêÁöÑ CRaC Âø´ÁÖß (checkpoint) Êñá‰ª∂ÊÅ¢Â§çÔºå‰ΩøÁî® <code>java -XX:CRaCRestoreFrom=cr</code> ÂëΩ‰ª§ÔºåÂêØÂä®ËøáÁ®ã<strong>‰ªÖÈúÄÁ∫¶ 36.88 ÊØ´Áßí</strong>„ÄÇ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ java -XX:CRaCRestoreFrom<span class="o">=</span>cr
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">#|2025-04-28T06:42:11.559868Z|INFO|GF 7.0.23-SNAPSHOT|jakarta.enterprise.logging.stdout|_ThreadID=323;_ThreadName=Attach Listener;_LevelValue=800;|</span>
</span></span><span class="line"><span class="cl">  STARTUPTIME <span class="m">519895593501838</span> restore<span class="p">|</span><span class="c1">#]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">#|2025-04-28T06:42:11.571942Z|INFO|GF 7.0.23-SNAPSHOT|org.glassfish.grizzly.config.GenericGrizzlyListener|_ThreadID=323;_ThreadName=Attach Listener;_LevelValue=800;|</span>
</span></span><span class="line"><span class="cl">  After restore, start transport, <span class="nv">address</span><span class="o">=</span>/0.0.0.0, <span class="nv">port</span><span class="o">=</span>8080<span class="p">|</span><span class="c1">#]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">#|2025-04-28T06:42:11.572851Z|INFO|GF 7.0.23-SNAPSHOT|org.glassfish.grizzly.config.GenericGrizzlyListener|_ThreadID=323;_ThreadName=Attach Listener;_LevelValue=800;|</span>
</span></span><span class="line"><span class="cl">  After restore, start transport, <span class="nv">address</span><span class="o">=</span>/0.0.0.0, <span class="nv">port</span><span class="o">=</span>8181<span class="p">|</span><span class="c1">#]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">#|2025-04-28T06:42:11.573165Z|INFO|GF 7.0.23-SNAPSHOT|org.glassfish.grizzly.config.GenericGrizzlyListener|_ThreadID=323;_ThreadName=Attach Listener;_LevelValue=800;|</span>
</span></span><span class="line"><span class="cl">  After restore, start transport, <span class="nv">address</span><span class="o">=</span>/0.0.0.0, <span class="nv">port</span><span class="o">=</span>4848<span class="p">|</span><span class="c1">#]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">#|2025-04-28T06:42:11.573409Z|INFO|GF 7.0.23-SNAPSHOT|org.glassfish.grizzly.config.GenericGrizzlyListener|_ThreadID=323;_ThreadName=Attach Listener;_LevelValue=800;|</span>
</span></span><span class="line"><span class="cl">  After restore, start transport, <span class="nv">address</span><span class="o">=</span>/0.0.0.0, <span class="nv">port</span><span class="o">=</span>3700<span class="p">|</span><span class="c1">#]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">#|2025-04-28T06:42:11.607504Z|INFO|GF 7.0.23-SNAPSHOT|jakarta.enterprise.logging.stdout|_ThreadID=323;_ThreadName=Attach Listener;_LevelValue=800;|</span>
</span></span><span class="line"><span class="cl">  STARTUPTIME <span class="m">519895630386924</span> restore-finish<span class="p">|</span><span class="c1">#]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊÅ¢Â§çÊó∂Èó¥ËÆ°ÁÆóÔºö<code>restore-finish - restore</code>ÔºåÊÅ¢Â§çËøáÁ®ãËÄóÊó∂‰∏∫ <code>519895630386924 - 519895593501838 = 36,885,086</code> Á∫≥ÁßíÔºåÂç≥ <strong>36.88 ÊØ´Áßí</strong>„ÄÇ</p>
<p>ÂØπÊØîÁªìÊûúÊ∏ÖÊô∞ÊòæÁ§∫Ôºå‰ΩøÁî® CRaC ÊÅ¢Â§çÔºåÂêØÂä®Êó∂Èó¥Áº©Áü≠‰∫ÜÁ∫¶ 239 ÂÄç (8813 ms / 36.88 ms)ÔºåÂÆûÁé∞‰∫ÜÊï∞ÈáèÁ∫ßÁöÑÊÄßËÉΩÈ£ûË∑É„ÄÇ</p>
<p>Èô§‰∫ÜÊÉä‰∫∫ÁöÑÂêØÂä®ÈÄüÂ∫¶ÊèêÂçáÔºåCRaC Êõ¥‰∏∫Ê†∏ÂøÉÁöÑ‰ºòÂäøÂú®‰∫éÂÆûÁé∞‰∫Ü‚ÄúÂç≥Êó∂Â≥∞ÂÄºÊÄßËÉΩ‚Äù„ÄÇ‰∏é‰º†ÁªüÂêØÂä®ÊñπÂºè‰∏çÂêåÔºåÊÅ¢Â§çÂêéÁöÑÂ∫îÁî®Á®ãÂ∫è<strong>Âá†‰πéÂèØ‰ª•Áû¨Èó¥ËææÂà∞ÂÖ∂ÂÆåÂÖ®È¢ÑÁÉ≠ (warmed-up) ÂêéÁöÑÊúÄ‰Ω≥ËøêË°åÊÄßËÉΩ</strong>„ÄÇËøôÊòØÂõ†‰∏∫ÂÆÉË∑≥Ëøá‰∫ÜËÄóÊó∂ÁöÑÁ±ªÂä†ËΩΩ„ÄÅÂàùÂßãÂåñ‰ª•Âèä JIT (Just-In-Time) ÁºñËØëÂô®ÁöÑÊó©ÊúüÁºñËØëÂíå‰ºòÂåñÈò∂ÊÆµ„ÄÇÂØπ‰∫éÈúÄË¶ÅÂø´ÈÄüÂìçÂ∫îË¥üËΩΩÂèòÂåñ„ÄÅÈ¢ëÁπÅÂºπÊÄß‰º∏Áº©ÊàñË¶ÅÊ±Ç‰ΩéÂª∂ËøüÁöÑÂú∫ÊôØ (Â¶Ç Serverless„ÄÅÂæÆÊúçÂä°Âø´ÈÄüÊâ©ÂÆπ)ÔºåËøô‰∏ÄÁâπÊÄßÂÖ∑ÊúâÊûÅÂÖ∂ÈáçË¶ÅÁöÑ‰ª∑ÂÄº„ÄÇ</p>
<h3 id="Êú™Êù•Â±ïÊúõÁîüÊÄÅÊåÅÁª≠ÂÆåÂñÑ">
    <a href="#%e6%9c%aa%e6%9d%a5%e5%b1%95%e6%9c%9b%e7%94%9f%e6%80%81%e6%8c%81%e7%bb%ad%e5%ae%8c%e5%96%84" class="header-anchor">#</a>
    Êú™Êù•Â±ïÊúõÔºöÁîüÊÄÅÊåÅÁª≠ÂÆåÂñÑ
</h3><p>ÈöèÁùÄ OpenJDK ÂØπ CRaC È°πÁõÆÁöÑÊåÅÁª≠Êé®ËøõÂíåÊ†áÂáÜÂåñÔºå‰ª•ÂèäË∂äÊù•Ë∂äÂ§öÁ¨¨‰∏âÊñπÂ∫ì„ÄÅÊ°ÜÊû∂ÔºàÂ¶Ç Spring„ÄÅMicronaut„ÄÅQuarkus„ÄÅOpen Liberty Á≠âÔºâÁöÑÁßØÊûÅÈÄÇÈÖç‰∏éÈõÜÊàêÔºåCRaC ÁöÑÁîüÊÄÅÁ≥ªÁªüÊ≠£ÈÄêÊ≠•ÊàêÁÜüÂíåÂÆåÂñÑ„ÄÇËøôÈ¢ÑÁ§∫ÁùÄÊú™Êù•Âú® Java Â∫îÁî®‰∏≠Âà©Áî® Checkpoint/Restore ÊäÄÊúØÂ∞ÜÂèòÂæóÊõ¥Âä†‰æøÊç∑ÂíåÊôÆÈÅçÔºåÊúâÊúõÊàê‰∏∫ÊèêÂçá Java Â∫îÁî®ÂêØÂä®ÊÄßËÉΩÂíåËøêË°åÊó∂ÊïàÁéáÁöÑÊ†áÂáÜÂÆûË∑µ‰πã‰∏Ä„ÄÇ</p>
<h2 id="ÂÖ≠apusic-jdk-with-crac-support">
    <a href="#%e5%85%adapusic-jdk-with-crac-support" class="header-anchor">#</a>
    ÂÖ≠„ÄÅApusic JDK with CRaC Support
</h2><p>Apusic JDK ÊòØÈáëËù∂Â§©ÁáïÔºàApusicÔºâÂÖ¨Âè∏Âü∫‰∫é OpenJDK È°πÁõÆÊûÑÂª∫ÂíåÁª¥Êä§ÁöÑ Java ÂºÄÂèëÂ∑•ÂÖ∑ÂåÖÔºàJDKÔºâÂèëË°åÁâà„ÄÇ‰∏∫‰∫ÜÊª°Ë∂≥Áî®Êà∑ÂØπÈ´òÊÄßËÉΩÂíåÂø´ÈÄüÂêØÂä®ÁöÑÈúÄÊ±ÇÔºåApusic JDK Âõ¢ÈòüÁßØÊûÅË∑üËøõÁ§æÂå∫ÂâçÊ≤øÊäÄÊúØÔºåÂπ∂Êèê‰æõ‰∫ÜÂØπ‰∏ªÊµÅ LTS ÁâàÊú¨ÁöÑÂπøÊ≥õÊîØÊåÅ„ÄÇ</p>
<ul>
<li>
<p><strong>Âü∫‰∫é BiSheng JDK</strong>
Apusic JDK ÁöÑ‰∏äÊ∏∏ÊòØÂçé‰∏∫ÂÖ¨Âè∏ÂºÄÊ∫êÁöÑ BiSheng JDK„ÄÇBiSheng JDK Êú¨Ë∫´Âú® OpenJDK ÁöÑÂü∫Á°Ä‰∏äËøõË°å‰∫ÜÊÄßËÉΩ‰ºòÂåñÂíåÁâπÊÄßÂ¢ûÂº∫ÔºåApusic JDK ÁªßÊâø‰∫ÜËøô‰∫õ‰ºòÂäøÔºåÂπ∂ÁªìÂêàËá™Ë∫´Âú®‰∏≠Èó¥‰ª∂È¢ÜÂüüÁöÑÊ∑±ÂéöÁßØÁ¥ØÔºå‰∏∫‰ºÅ‰∏öÁ∫ßÂ∫îÁî®Êèê‰æõ‰∫ÜÁ®≥ÂÆö„ÄÅÈ´òÊïàÁöÑ Java ËøêË°åÊó∂ÁéØÂ¢É„ÄÇ</p>
</li>
<li>
<p><strong>ÊîØÊåÅÂ§ö LTS ÁâàÊú¨</strong>
Apusic JDK Ëá¥Âäõ‰∫éÊèê‰æõÁ®≥ÂÆöÂèØÈù†ÁöÑ Java ÁéØÂ¢ÉÔºåÁõÆÂâç‰∏∫ <strong>Java 8, 11, 17, 21</strong> Á≠âÂ§ö‰∏™ÈïøÊúüÊîØÊåÅÔºàLTSÔºâÁâàÊú¨Êèê‰æõÊûÑÂª∫ÂíåÊîØÊåÅ„ÄÇ</p>
</li>
<li>
<p><strong>‰∏∫ JDK 17 Âíå 21 ÂºïÂÖ• CRaC ÊîØÊåÅ</strong>
Apusic Âõ¢ÈòüËÆ§ËØÜÂà∞ CRaCÔºàCoordinated Restore at CheckpointÔºâÊäÄÊúØÂú®Ëß£ÂÜ≥ Java Â∫îÁî®ÂÜ∑ÂêØÂä®ÊÖ¢ÂíåÊèêÂçáËøêË°åÊó∂ÊïàÁéáÊñπÈù¢ÂÖ∑ÊúâÂ∑®Â§ßÊΩúÂäõ„ÄÇÁÑ∂ËÄåÔºåÁî±‰∫é CRaC È°πÁõÆÂ∞öÊú™Ê≠£ÂºèÂêàÂπ∂Âà∞ OpenJDK ‰∏ªÁ∫øÔºåApusic ÈááÁî®‰∫Ü‰∏é Azul Á≠âÂéÇÂïÜÁ±ª‰ººÁöÑÊñπÂºèÔºå<strong>‰∏ªÂä®Â∞ÜÂÖ∂Ê†∏ÂøÉÂäüËÉΩÁßªÊ§çÔºàPortÔºâÂπ∂ÈõÜÊàêÂà∞‰∫Ü Apusic JDK 17 Âíå Apusic JDK 21 ÂèëË°åÁâà‰∏≠</strong>„ÄÇ</p>
</li>
<li>
<p><strong>Êèê‰æõÁâπÂÆöÁâàÊú¨ÁöÑÂèåÈáçÂèëË°åÁâà</strong>
‰∏∫‰∫ÜÊñπ‰æøÁî®Êà∑Ê†πÊçÆÂÆûÈôÖÈúÄÊ±ÇËøõË°åÈÄâÊã©ÔºåÈíàÂØπÈõÜÊàê‰∫Ü CRaC ÂäüËÉΩÁöÑ <strong>JDK 17 Âíå JDK 21</strong>ÔºåApusic Êèê‰æõ‰∫Ü‰∏§ÁßçÂèëË°åÁâàÔºö</p>
</li>
</ul>
<ol>
<li><strong>Ê†áÂáÜÁöÑ Apusic JDK (17 / 21)</strong> Ôºö‰∏çÂåÖÂê´ CRaC ÂäüËÉΩÔºåÈÄÇÁî®‰∫é‰∏çÈúÄË¶Å Checkpoint/Restore ÁâπÊÄßÁöÑÊ†áÂáÜ Java Â∫îÁî®Âú∫ÊôØ„ÄÇ</li>
<li><strong>Apusic JDK with CRaC Support (17 / 21)</strong> ÔºöÂÜÖÁΩÆ‰∫Ü CRaC ÂäüËÉΩÁöÑÁâπÊÆäÁâàÊú¨„ÄÇÁî®Êà∑ÂèØ‰ª•‰ΩøÁî®Ëøô‰∏™ÁâàÊú¨Êù•ÂºÄÂèë„ÄÅÊµãËØïÂíåÈÉ®ÁΩ≤ÈúÄË¶ÅÂà©Áî® CRaC ËøõË°åÂêØÂä®‰ºòÂåñÁöÑ Java Â∫îÁî®Á®ãÂ∫è„ÄÇ</li>
</ol>
<p>ÈÄöËøáÊèê‰æõÂ∏¶Êúâ CRaC ÊîØÊåÅÁöÑ JDK ÁâàÊú¨ÔºàÁõÆÂâç‰∏∫ JDK 17 Âíå 21ÔºâÔºåApusic ‰ΩøÂæóÂÖ∂Áî®Êà∑ËÉΩÂ§üÂú®ÂÖ∂ÁÜüÊÇâÁöÑ JDK ÂèëË°åÁâà‰∏äÔºåÊèêÂâç‰ΩìÈ™åÂíåÂ∫îÁî® CRaC ÊäÄÊúØÂ∏¶Êù•ÁöÑÊòæËëó‰ºòÂäøÔºåÁâπÂà´ÊòØÂú®ÂæÆÊúçÂä°„ÄÅServerless Á≠âÂØπÂêØÂä®ÈÄüÂ∫¶Êúâ‰∏•ËãõË¶ÅÊ±ÇÁöÑÂú∫ÊôØ‰∏ãÔºåËÉΩÂ§üËé∑ÂæóÊòéÊòæÁöÑÊÄßËÉΩÊèêÂçá„ÄÇÁî®Êà∑Âú®‰ΩøÁî® Apusic JDK with CRaC Support Êó∂ÔºåÂèØ‰ª•ÈÅµÂæ™ CRaC ÁöÑÊ†áÂáÜ‰ΩøÁî®ÊñπÊ≥ïÂíåÊúÄ‰Ω≥ÂÆûË∑µ„ÄÇ</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/linux/">Linux</a>
        
            <a href="/tags/java/">Java</a>
        
            <a href="/tags/crac/">Crac</a>
        
            <a href="/tags/performance/">Performance</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E4%BD%BF%E7%94%A8%E7%81%AB%E7%84%B0%E5%9B%BE%E8%BF%9B%E8%A1%8Cjava%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">
        
        

        <div class="article-details">
            <h2 class="article-title">‰ΩøÁî®ÁÅ´ÁÑ∞ÂõæËøõË°åJavaÊÄßËÉΩÂàÜÊûê</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/linux-tcp%E9%98%9F%E5%88%97%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0%E7%9A%84%E6%80%BB%E7%BB%93/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linux TCPÈòüÂàóÁõ∏ÂÖ≥ÂèÇÊï∞ÁöÑÊÄªÁªì</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F/">
        
        

        <div class="article-details">
            <h2 class="article-title">Ê∑±ÂÖ•ÁêÜËß£ Java Lambda Ë°®ËææÂºè</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%B8%BA-powershell-%E9%85%8D%E7%BD%AE-emacs-%E6%A8%A1%E5%BC%8F/">
        
        

        <div class="article-details">
            <h2 class="article-title">‰∏∫ PowerShell ÈÖçÁΩÆ Emacs Ê®°Âºè</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%BB%8E%E6%BA%90%E7%A0%81%E6%9E%84%E5%BB%BA-linux-%E5%86%85%E6%A0%B8/">
        
        

        <div class="article-details">
            <h2 class="article-title">‰ªéÊ∫êÁ†ÅÊûÑÂª∫ Linux ÂÜÖÊ†∏</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mazhen-tech" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2014 - 
        
        2025 mazhen.tech
    </section>
    
    <section class="powerby">
        
            <a target=\"_blank\" href=\"https://beian.miit.gov.cn\">Á≤§ ICP Â§á 2022085181 Âè∑ -1</a> <br/>
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.25.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
