<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="ÊèêÂà∞ Java ÁöÑÂûÉÂúæÂõûÊî∂ÔºàGCÔºâÔºåÂæàÂ§öÂºÄÂèëËÄÖËÑëÊµ∑‰∏≠‰ºöÁ´ãÂàªÊµÆÁé∞Âá∫‰∏Ä‰∏™ËØçÔºö‚ÄúStop-The-World‚ÄùÔºå‰πüÂ∞±ÊòØÊàë‰ª¨Â∏∏ËØ¥ÁöÑ STW„ÄÇÂÆÉÊÑèÂë≥ÁùÄÂú®ÈÇ£‰∏ÄÂàªÔºåÊâÄ">
<title>Êè≠Áßò JVM ÂÅúÈ°øÁöÑËÉåÂêéÔºöÊ∑±ÂÖ•ÁêÜËß£ Safepoint</title>

<link rel='canonical' href='https://mazhen.tech/p/%E6%8F%AD%E7%A7%98-jvm-%E5%81%9C%E9%A1%BF%E7%9A%84%E8%83%8C%E5%90%8E%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-safepoint/'>

<link rel="stylesheet" href="/scss/style.min.760e3dabc1e140d2e6abd27a8ca0aabb60e568829b29f67d2df12024136eff37.css"><meta property='og:title' content="Êè≠Áßò JVM ÂÅúÈ°øÁöÑËÉåÂêéÔºöÊ∑±ÂÖ•ÁêÜËß£ Safepoint">
<meta property='og:description' content="ÊèêÂà∞ Java ÁöÑÂûÉÂúæÂõûÊî∂ÔºàGCÔºâÔºåÂæàÂ§öÂºÄÂèëËÄÖËÑëÊµ∑‰∏≠‰ºöÁ´ãÂàªÊµÆÁé∞Âá∫‰∏Ä‰∏™ËØçÔºö‚ÄúStop-The-World‚ÄùÔºå‰πüÂ∞±ÊòØÊàë‰ª¨Â∏∏ËØ¥ÁöÑ STW„ÄÇÂÆÉÊÑèÂë≥ÁùÄÂú®ÈÇ£‰∏ÄÂàªÔºåÊâÄ">
<meta property='og:url' content='https://mazhen.tech/p/%E6%8F%AD%E7%A7%98-jvm-%E5%81%9C%E9%A1%BF%E7%9A%84%E8%83%8C%E5%90%8E%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-safepoint/'>
<meta property='og:site_name' content='mazhen.tech'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='java' /><meta property='article:tag' content='linux' /><meta property='article:tag' content='performance' /><meta property='article:published_time' content='2025-07-16T11:13:04&#43;08:00'/><meta property='article:modified_time' content='2025-07-16T11:13:04&#43;08:00'/>
<meta name="twitter:site" content="@rootletmistake">
    <meta name="twitter:creator" content="@rootletmistake"><meta name="twitter:title" content="Êè≠Áßò JVM ÂÅúÈ°øÁöÑËÉåÂêéÔºöÊ∑±ÂÖ•ÁêÜËß£ Safepoint">
<meta name="twitter:description" content="ÊèêÂà∞ Java ÁöÑÂûÉÂúæÂõûÊî∂ÔºàGCÔºâÔºåÂæàÂ§öÂºÄÂèëËÄÖËÑëÊµ∑‰∏≠‰ºöÁ´ãÂàªÊµÆÁé∞Âá∫‰∏Ä‰∏™ËØçÔºö‚ÄúStop-The-World‚ÄùÔºå‰πüÂ∞±ÊòØÊàë‰ª¨Â∏∏ËØ¥ÁöÑ STW„ÄÇÂÆÉÊÑèÂë≥ÁùÄÂú®ÈÇ£‰∏ÄÂàªÔºåÊâÄ">
    <link rel="shortcut icon" href="/favicon.png" />

  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-LBEVB8TRX2"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-LBEVB8TRX2');
        }
      </script>
    
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/mazhen_hu6e56901738cd7f8ddabbbe3def51a5b4_111611_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">mazhen.tech</a></h1>
            <h2 class="site-description">Stay hungry. Stay foolish.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='mailto:me@mazhen.tech'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/mz1999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.instagram.com/clippercongo/'
                        target="_blank"
                        title="instagram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="4" />
  <circle cx="12" cy="12" r="3" />
  <line x1="16.5" y1="7.5" x2="16.5" y2="7.501" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/crownrecount'
                        target="_blank"
                        title="telegram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/rootletmistake'
                        target="_blank"
                        title="twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://mazhen.tech/" selected>‰∏≠Êñá</option>
                                
                                    <option value="https://mazhen.tech/en/" >English</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#‰ªÄ‰πàÊòØ-safepoint">‰ªÄ‰πàÊòØ Safepoint</a>
      <ol>
        <li><a href="#jit-‰ºòÂåñÂ∏¶Êù•ÁöÑÈóÆÈ¢ò">JIT ‰ºòÂåñÂ∏¶Êù•ÁöÑÈóÆÈ¢ò</a></li>
        <li><a href="#oopmapjit-‰∏∫-jvm-ËøêË°åÊó∂ÁîüÊàêÁöÑÂú∞Âõæ">OopMapÔºöJIT ‰∏∫ JVM ËøêË°åÊó∂ÁîüÊàêÁöÑ‚ÄúÂú∞Âõæ‚Äù</a></li>
        <li><a href="#safepoint‰∏Ä‰∏™Âçè‰ΩúÂºèÁöÑÁ∫¶ÂÆöÂú∞ÁÇπ">SafepointÔºö‰∏Ä‰∏™Âçè‰ΩúÂºèÁöÑ‚ÄúÁ∫¶ÂÆöÂú∞ÁÇπ‚Äù</a></li>
      </ol>
    </li>
    <li><a href="#safepoint-ÁöÑÂ∫îÁî®Âú∫ÊôØ">Safepoint ÁöÑÂ∫îÁî®Âú∫ÊôØ</a></li>
    <li><a href="#safepoint-ÁöÑÂ∑•‰ΩúÊú∫Âà∂">Safepoint ÁöÑÂ∑•‰ΩúÊú∫Âà∂</a>
      <ol>
        <li><a href="#Âçè‰ΩúÂºèËΩÆËØ¢Êú∫Âà∂">Âçè‰ΩúÂºèËΩÆËØ¢Êú∫Âà∂</a></li>
        <li><a href="#ËΩÆËØ¢ÁÇπÁöÑ‰ΩçÁΩÆ">ËΩÆËØ¢ÁÇπÁöÑ‰ΩçÁΩÆ</a></li>
        <li><a href="#Ê†∏ÂøÉÊÄßËÉΩÊåáÊ†áÂà∞ËææÂÆâÂÖ®ÁÇπÁöÑÊó∂Èó¥-time-to-safepoint-ttsp">Ê†∏ÂøÉÊÄßËÉΩÊåáÊ†áÔºöÂà∞ËææÂÆâÂÖ®ÁÇπÁöÑÊó∂Èó¥ (Time-To-Safepoint, TTSP)</a></li>
      </ol>
    </li>
    <li><a href="#openjdk-Â∫ïÂ±ÇÂÆûÁé∞Êè≠Áßò">OpenJDK Â∫ïÂ±ÇÂÆûÁé∞Êè≠Áßò</a>
      <ol>
        <li><a href="#vmthread-‰∏é-vm_operation">VMThread ‰∏é VM_Operation</a></li>
        <li><a href="#safepoint-Êï¥‰ΩìÊµÅÁ®ã">Safepoint Êï¥‰ΩìÊµÅÁ®ã</a></li>
        <li><a href="#jit-‰ª£Á†ÅÁöÑËΩÆËØ¢Âà©Áî®È°µ‰øùÊä§page-protection">JIT ‰ª£Á†ÅÁöÑËΩÆËØ¢ÔºöÂà©Áî®È°µ‰øùÊä§ÔºàPage ProtectionÔºâ</a>
          <ol>
            <li><a href="#‰ªÄ‰πàÊòØÈ°µ‰øùÊä§Êú∫Âà∂">‰ªÄ‰πàÊòØÈ°µ‰øùÊä§Êú∫Âà∂</a></li>
            <li><a href="#openjdk-Â¶Ç‰ΩïÂà©Áî®Ëøô‰∏ÄÊú∫Âà∂">OpenJDK Â¶Ç‰ΩïÂà©Áî®Ëøô‰∏ÄÊú∫Âà∂</a></li>
          </ol>
        </li>
        <li><a href="#ÂÖ∂‰ªñÂú∫ÊôØ‰∏ãÁöÑ-safepoint-Â§ÑÁêÜ">ÂÖ∂‰ªñÂú∫ÊôØ‰∏ãÁöÑ Safepoint Â§ÑÁêÜ</a></li>
      </ol>
    </li>
    <li><a href="#ÂÆûÊàòÁõëÊéß‰∏éÂàÜÊûêÂÆâÂÖ®ÁÇπ">ÂÆûÊàòÔºöÁõëÊéß‰∏éÂàÜÊûêÂÆâÂÖ®ÁÇπ</a>
      <ol>
        <li><a href="#-xlogsafepoint-ÂèÇÊï∞"><code>-Xlog:safepoint</code> ÂèÇÊï∞</a></li>
        <li><a href="#Êó•ÂøóËß£ËØª">Êó•ÂøóËß£ËØª</a></li>
        <li><a href="#Â¶Ç‰ΩïÂÆö‰ΩçÈóÆÈ¢ò">Â¶Ç‰ΩïÂÆö‰ΩçÈóÆÈ¢ò</a></li>
      </ol>
    </li>
    <li><a href="#ÊÄªÁªì">ÊÄªÁªì</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tech/" >
                Tech
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E6%8F%AD%E7%A7%98-jvm-%E5%81%9C%E9%A1%BF%E7%9A%84%E8%83%8C%E5%90%8E%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-safepoint/">Êè≠Áßò JVM ÂÅúÈ°øÁöÑËÉåÂêéÔºöÊ∑±ÂÖ•ÁêÜËß£ Safepoint</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-07-16</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 19 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><img src="https://cdn.mazhen.tech/2024/202507161425191.png"
	
	
	
	loading="lazy"
	
		alt="title"
	
	
></p>
<p>ÊèêÂà∞ Java ÁöÑÂûÉÂúæÂõûÊî∂ÔºàGCÔºâÔºåÂæàÂ§öÂºÄÂèëËÄÖËÑëÊµ∑‰∏≠‰ºöÁ´ãÂàªÊµÆÁé∞Âá∫‰∏Ä‰∏™ËØçÔºö‚ÄúStop-The-World‚ÄùÔºå‰πüÂ∞±ÊòØÊàë‰ª¨Â∏∏ËØ¥ÁöÑ <strong>STW</strong>„ÄÇÂÆÉÊÑèÂë≥ÁùÄÂú®ÈÇ£‰∏ÄÂàªÔºåÊâÄÊúâÁöÑÂ∫îÁî®Á∫øÁ®ãÈÉΩ‰ºöË¢´ÂÜªÁªìÔºåÁ≠âÂæÖ GC ÂÆåÊàêÂÆÉÁöÑÂ∑•‰Ωú„ÄÇËøôÊòØ Java Â∫îÁî®ÁöÑÊÄßËÉΩ‚ÄúÁóõÁÇπ‚ÄùÔºåÊàë‰ª¨ÊÄªÂ∏åÊúõÂÆÉË∂äÁü≠Ë∂äÂ•Ω„ÄÇ</p>
<p>Êàë‰ª¨Áü•ÈÅì STW ‰ºöÊöÇÂÅúÂ∫îÁî®Ôºå‰ΩÜ‰Ω†ÊòØÂê¶ÊÉ≥Ëøá‰∏Ä‰∏™Êõ¥Ê∑±Â±ÇÊ¨°ÁöÑÈóÆÈ¢òÔºöJVM Á©∂Á´üÊòØÂ¶Ç‰ΩïÂÅöÂà∞ËÆ©ÊàêÂçÉ‰∏ä‰∏á‰∏™Ê≠£Âú®È´òÈÄüËøêË°åÁöÑÁ∫øÁ®ãÔºåËÉΩÂú®Âêå‰∏ÄÊó∂Âàª‚ÄúÂÆâÂÖ®Âú∞‚ÄùÂÅú‰∏ãÊù•Âë¢Ôºü</p>
<p>Êõ¥Ëøõ‰∏ÄÊ≠•ÔºåÊòØÂè™Êúâ GC Êâç‰ºöÂºïÂèëËøôÁßçÂÖ®Â±ÄÊöÇÂÅúÂêóÔºüÂ¶ÇÊûú Java Â∫îÁî®Âá∫Áé∞‰∫Ü‰∏ÄÊ¨°ÊÑèÊñô‰πãÂ§ñÁöÑÂç°È°øÔºå‰ΩÜ GC Êó•ÂøóÂç¥ÊòæÁ§∫‰∏ÄÂàáÊ≠£Â∏∏ÔºåÈÇ£‚ÄúÂÖÉÂá∂‚ÄùÂèà‰ºöÊòØË∞ÅÂë¢Ôºü</p>
<p>Ëøô‰∫õÈóÆÈ¢òÁöÑÁ≠îÊ°àÔºåÈÉΩÊåáÂêë‰∫Ü JVM ËøêË°åÊó∂‰∏≠‰∏Ä‰∏™Ëá≥ÂÖ≥ÈáçË¶ÅÔºå‰ΩÜÂèàÂæàÂ∞ëÊúâ‰∫∫‰∫ÜËß£ÁöÑÂ∫ïÂ±ÇÊú∫Âà∂Ôºö<strong>Safepoint</strong>„ÄÇ</p>
<p>ÂÆûÈôÖ‰∏äÔºåÂûÉÂúæÂõûÊî∂Âè™ÊòØ‰ΩøÁî® <strong>Safepoint</strong> Êú∫Âà∂ÁöÑ‰ºóÂ§ö‚ÄúÂÆ¢Êà∑‚Äù‰πã‰∏Ä„ÄÇ<strong>Safepoint</strong> Êú¨Ë∫´ÊòØ JVM ÁöÑ‰∏Ä‰∏™Êõ¥‰∏∫Â∫ïÂ±ÇÁöÑÈÄöÁî®ËÆæÊñΩÔºåÊòØÊâÄÊúâÈúÄË¶ÅËøõË°åÂÖ®Â±ÄÊÄßÊìç‰ΩúÔºàÊØîÂ¶Ç‰ª£Á†ÅÂèç‰ºòÂåñ„ÄÅÁ∫øÁ®ãËΩ¨ÂÇ®Á≠âÔºâÊó∂ÔºåÈÉΩÂøÖÈ°ª‰æùËµñÁöÑÂùöÂÆûÂú∞Âü∫„ÄÇ</p>
<p>Êé•‰∏ãÊù•ÔºåÂ∞±ËÆ©Êàë‰ª¨‰∏ÄËµ∑Êè≠ÂºÄ <strong>Safepoint</strong> ÁöÑÁ•ûÁßòÈù¢Á∫±ÔºåÁúãÁúãÂÆÉÊòØ‰ªÄ‰πà„ÄÅ‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂÆÉÔºå‰ª•ÂèäÂÆÉÂèàÊòØÂ¶Ç‰ΩïÂú®Â∫ïÂ±ÇËøê‰ΩúÔºåÂπ∂ÊÇÑÊó†Â£∞ÊÅØÂú∞ÂΩ±ÂìçÁùÄÊàë‰ª¨ÁöÑÂ∫îÁî®Á®ãÂ∫è„ÄÇ</p>
<h2 id="‰ªÄ‰πàÊòØ-safepoint">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af-safepoint" class="header-anchor">#</a>
    ‰ªÄ‰πàÊòØ Safepoint
</h2><p>Êàë‰ª¨Áü•ÈÅìÔºåJVM ÊúâÊó∂ÈúÄË¶ÅÊâßË°å‰∏Ä‰∫õÂΩ±ÂìçÂÖ®Â±ÄÁöÑÊìç‰ΩúÔºåÊúÄÂÖ∏ÂûãÁöÑÂ∞±ÊòØ<strong>ÂûÉÂúæÂõûÊî∂ÔºàGarbage CollectionÔºâ</strong>„ÄÇË¶ÅÂÆâÂÖ®Âú∞ËøõË°åËøô‰∫õÊìç‰ΩúÔºå‰∏Ä‰∏™Âü∫Êú¨ÂâçÊèêÂ∞±ÊòØËÆ©ÊâÄÊúâÊ≠£Âú®ÂøôÁ¢åÁöÑÁ∫øÁ®ãÈÉΩÂÅú‰∏ãÊù•ÔºåÂç≥‚ÄúStop-The-World‚Äù„ÄÇ</p>
<p>ÈÇ£‰πàÔºåJVM ÂèØ‰ª•Âú®‰ªªÊÑèÊó∂ÂàªÔºåÊöÇÂÅú‰∏Ä‰∏™Ê≠£Âú®ËøêË°åÁöÑÁ∫øÁ®ãÂêóÔºüÁ≠îÊ°àÊòØÔºö<strong>‰∏çËÉΩ„ÄÇ</strong></p>
<p>ÂéüÂõ†Âú®‰∫é‰∏Ä‰∏™Ê†∏ÂøÉÊ¶ÇÂøµÔºö<strong>Áä∂ÊÄÅÁöÑÂèØËß£ÊûêÊÄßÔºàState ParsabilityÔºâ</strong>„ÄÇ</p>
<h3 id="jit-‰ºòÂåñÂ∏¶Êù•ÁöÑÈóÆÈ¢ò">
    <a href="#jit-%e4%bc%98%e5%8c%96%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98" class="header-anchor">#</a>
    JIT ‰ºòÂåñÂ∏¶Êù•ÁöÑÈóÆÈ¢ò
</h3><p>‰∏∫‰∫ÜËøΩÊ±ÇÊûÅËá¥ÁöÑÊÄßËÉΩÔºå<strong>JITÔºàJust-In-TimeÔºâ</strong> ‰ºöÂ∞ÜÁÉ≠ÁÇπ‰ª£Á†ÅÁºñËØëÊàêÊú¨Âú∞Êú∫Âô®Á†ÅÔºåÂπ∂ËøõË°åÂêÑÁßç‰ºòÂåñÔºåÊØîÂ¶ÇÔºö</p>
<ul>
<li><strong>ÂØÑÂ≠òÂô®ÂàÜÈÖç</strong>Ôºö‰∏∫‰∫ÜËØªÂÜôÊõ¥Âø´Ôºå‰∏Ä‰∏™ Java ÁöÑÂØπË±°ÂºïÁî®ÔºåÂèØËÉΩ‰∏çÊòØÂú®Á∫øÁ®ãËøêË°åÊ†àÁöÑÂÜÖÂ≠ò‰∏≠ÔºåËÄåÊòØË¢´‰∏¥Êó∂ÊîæÂà∞‰∫Ü CPU ÂØÑÂ≠òÂô®‰∏≠„ÄÇ</li>
<li><strong>Êåá‰ª§ÈáçÊéí</strong>Ôºö‰∏∫‰∫ÜÂÖÖÂàÜÂà©Áî® CPU ÊµÅÊ∞¥Á∫øÔºåÂÆûÈôÖÊâßË°åÁöÑÊú∫Âô®Êåá‰ª§È°∫Â∫èÂèØËÉΩÂíåÊàë‰ª¨‰ª£Á†ÅÁöÑÈÄªËæëÈ°∫Â∫èÂπ∂‰∏ç‰∏ÄËá¥„ÄÇ</li>
<li><strong>ÊñπÊ≥ïÂÜÖËÅî</strong>Ôºö‰∏Ä‰∫õÊñπÊ≥ïÂèØËÉΩË¢´<strong>ÂÜÖËÅîÔºàinliningÔºâ</strong>ÔºåÂØºËá¥ÂÖ∂Áã¨Á´ãÁöÑÊ†àÂ∏ßÁªìÊûÑÁõ¥Êé•Ê∂àÂ§±„ÄÇ</li>
</ul>
<p>Ëøô‰∫õ‰ºòÂåñÊûÅÂ§ßÂú∞ÊèêÂçá‰∫ÜËøêË°åÈÄüÂ∫¶Ôºå‰ΩÜ‰πüÂ∏¶Êù•‰∫Ü‰∏Ä‰∏™‚ÄúÂâØ‰ΩúÁî®‚ÄùÔºöÂ¶ÇÊûúÂú®‰ªªÊÑè‰∏Ä‰∏™Êó∂ÂàªÊöÇÂÅúÁ∫øÁ®ãÔºåJVM ‰ºöÂèëÁé∞Ëá™Â∑±Èù¢ÂØπ‰∏Ä‰∏™‚ÄúÊ∑∑‰π±‚ÄùÁöÑÁé∞Âú∫ÔºåÂÆÉÂèØËÉΩÊó†Ê≥ïÂàÜÊ∏Ö CPU ÂØÑÂ≠òÂô®ÈáåÁöÑÊüê‰∏™ÂÄºÂà∞Â∫ïÊòØ‰∏Ä‰∏™Êï¥Êï∞ÔºåËøòÊòØ‰∏Ä‰∏™ÂØπË±°ÂºïÁî®„ÄÇËøôÁßçÁä∂ÊÄÅÔºåÊàë‰ª¨Áß∞‰πã‰∏∫<strong>‰∏çÂèØËß£ÊûêÁöÑÔºàunparsableÔºâ</strong>„ÄÇ</p>
<p>Â¶ÇÊûúÂú®ËøôÁßç‚Äú‰∏çÁ°ÆÂÆö‚ÄùÁöÑÁä∂ÊÄÅ‰∏ãÂº∫Ë°åËøõË°åÂûÉÂúæÂõûÊî∂ÔºåÂêéÊûúÊòØÁÅæÈöæÊÄßÁöÑ„ÄÇJVM ÂèØËÉΩ‰ºöÊää‰∏Ä‰∏™Â≠òÊ¥ªÁöÑÂØπË±°ÂΩìÊàêÂûÉÂúæÂõûÊî∂ÊéâÔºåÊàñËÄÖÂú®ÁßªÂä®ÂØπË±°ÂêéÊ≤°ËÉΩÊõ¥Êñ∞ÊâÄÊúâÊåáÂêëÂÆÉÁöÑÂºïÁî®ÔºàÂåÖÊã¨ÈÇ£‰∫õËóèÂú®ÂØÑÂ≠òÂô®ÈáåÁöÑÂºïÁî®ÔºâÔºåÊúÄÁªàÂØºËá¥Á®ãÂ∫èÂ¥©Ê∫É„ÄÇ</p>
<h3 id="oopmapjit-‰∏∫-jvm-ËøêË°åÊó∂ÁîüÊàêÁöÑÂú∞Âõæ">
    <a href="#oopmapjit-%e4%b8%ba-jvm-%e8%bf%90%e8%a1%8c%e6%97%b6%e7%94%9f%e6%88%90%e7%9a%84%e5%9c%b0%e5%9b%be" class="header-anchor">#</a>
    OopMapÔºöJIT ‰∏∫ JVM ËøêË°åÊó∂ÁîüÊàêÁöÑ‚ÄúÂú∞Âõæ‚Äù
</h3><p>‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåJIT ÁºñËØëÂô®Âíå JVM ËææÊàê‰∫Ü‰∏Ä‰∏™ÁöÑÂçèËÆÆÔºöJIT Âú®ÁºñËØë‰ª£Á†ÅÊó∂Ôºå‰ºö‰∏∫Êüê‰∫õ<strong>ÁâπÂÆöÁöÑÊåá‰ª§‰ΩçÁΩÆ</strong>È¢ùÂ§ñÁîüÊàê‰∏Ä‰ªΩÂÖÉÊï∞ÊçÆÔºåËøô‰ªΩÂÖÉÊï∞ÊçÆÂ∞±ÂÉè‰∏ÄÂº†<strong>Âú∞Âõæ</strong>ÔºåÂÆÉË¢´Áß∞‰∏∫ <strong>OopMap (Object Pointer Map)</strong>„ÄÇ</p>
<p>ËøôÂº†‚ÄúÂú∞Âõæ‚ÄúÁ≤æÁ°ÆÂú∞ËÆ∞ÂΩï‰∫ÜÔºö‚ÄúÂ¶ÇÊûúÁ®ãÂ∫èÊÅ∞Â•ΩÂú®Ëøô‰∏™Êåá‰ª§‰ΩçÁΩÆÂÅú‰∏ãÔºåÈÇ£‰πàÂÆÉÁöÑÊ†àÂíåÂØÑÂ≠òÂô®Â∫îËØ•ËøôÊ†∑Ëß£ËØªÔºö<code>RAX</code>ÂØÑÂ≠òÂô®ÈáåÁöÑÊòØ‰∏Ä‰∏™ÂØπË±°ÂºïÁî®ÔºåÊ†à‰∏ä<code>-8</code>ÂÅèÁßªÈáèÂ§ÑÊòØ‰∏Ä‰∏™Êï¥Êï∞Ôºå<code>-16</code>ÂÅèÁßªÈáèÂ§ÑÂèàÊòØ‰∏Ä‰∏™ÂØπË±°ÂºïÁî®‚Ä¶‚Ä¶‚Äù</p>
<p>Êúâ‰∫ÜËøô‰ªΩÂú∞ÂõæÔºåÂûÉÂúæÂõûÊî∂Âô®Â∞±ËÉΩÂáÜÁ°ÆÂú∞ÊâæÂá∫ÂΩìÂâçÁ∫øÁ®ã‰∏≠ÊâÄÊúâÁöÑ<strong>Ê†πÂØπË±°ÔºàGC RootsÔºâ</strong>Ôºå‰ªéËÄåÂÆâÂÖ®Âú∞ËøõË°åÂêéÁª≠ÁöÑÂ≠òÊ¥ªÂØπË±°ÂàÜÊûê„ÄÇ</p>
<p>‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºåJIT ÁºñËØëÂô®‰∏∫ JVM ÂáÜÂ§áÂ•Ω‰∫Ü‰∏Ä‰ªΩ<strong>Âú∞ÂõæÔºàOopMap - Object Pointer MapÔºâ</strong>ÔºåËøô‰ªΩÂú∞ÂõæÁ≤æÁ°ÆÂú∞ËÆ∞ÂΩï‰∫ÜÂú®ÂΩìÂâçËøô‰∏™ÁÇπÔºåÂì™‰∫õÂØÑÂ≠òÂô®„ÄÅÂì™‰∫õÊ†à‰ΩçÁΩÆÂ≠òÊîæÁöÑÊòØÂØπË±°ÂºïÁî®„ÄÇÊúâ‰∫ÜËøôÂº†Âú∞ÂõæÔºåÂûÉÂúæÂõûÊî∂Âô®ÔºàGCÔºâÂ∞±ËÉΩÂáÜÁ°ÆÂú∞ÊâæÂá∫ÊâÄÊúâÁöÑ<strong>Ê†πÂØπË±°ÔºàGC RootsÔºâ</strong>Ôºå‰ªéËÄåÂÆâÂÖ®Âú∞ËøõË°åÂ≠òÊ¥ªÂØπË±°ÂàÜÊûê„ÄÇ</p>
<p>‰ΩÜÊòØÔºå‰∏∫<strong>ÊØè‰∏ÄÊù°</strong>Êú∫Âô®Êåá‰ª§ÈÉΩÁîüÊàêËøôÊ†∑‰∏ÄÂº†‚ÄúÂú∞Âõæ‚ÄùÁöÑÊàêÊú¨Â§™È´ò‰∫ÜÔºå‰ºöÊ∂àËÄóÂ§ßÈáèÂÜÖÂ≠òÂπ∂ÊãñÊÖ¢ÁºñËØëËøáÁ®ã„ÄÇÂõ†Ê≠§ÔºåJIT Âè™‰ºöÂú®Êüê‰∫õÁâπÂÆöÁöÑ„ÄÅÊòì‰∫éÁÆ°ÁêÜÁöÑ‰ΩçÁΩÆÁîüÊàêÂíå‰øùÂ≠ò‚ÄúÂú∞Âõæ‚Äù„ÄÇ</p>
<p><strong>Ëøô‰∫õÂ∏¶ÊúâÊ≠£Á°Æ‚ÄúÂú∞Âõæ‚Äù‰ø°ÊÅØÔºåËÉΩÂ§üËÆ© JVM ÂÆâÂÖ®Ëß£ÊûêÁ∫øÁ®ãÁä∂ÊÄÅÁöÑÁâπÂÆö‰ΩçÁΩÆÔºåÂ∞±ÊòØÂÆâÂÖ®ÁÇπÔºàSafepointÔºâ„ÄÇ</strong></p>
<h3 id="safepoint‰∏Ä‰∏™Âçè‰ΩúÂºèÁöÑÁ∫¶ÂÆöÂú∞ÁÇπ">
    <a href="#safepoint%e4%b8%80%e4%b8%aa%e5%8d%8f%e4%bd%9c%e5%bc%8f%e7%9a%84%e7%ba%a6%e5%ae%9a%e5%9c%b0%e7%82%b9" class="header-anchor">#</a>
    SafepointÔºö‰∏Ä‰∏™Âçè‰ΩúÂºèÁöÑ‚ÄúÁ∫¶ÂÆöÂú∞ÁÇπ‚Äù
</h3><p>Áé∞Âú®Êàë‰ª¨ÂèØ‰ª•Áªô <strong>ÂÆâÂÖ®ÁÇπÔºàSafepointÔºâ</strong> ‰∏Ä‰∏™Êõ¥Ê∏ÖÊô∞ÁöÑÂÆö‰πâÔºö</p>
<blockquote>
<p><strong>Safepoint ÊòØ‰ª£Á†Å‰∏≠È¢ÑÂÖàÂÆö‰πâÂ•ΩÁöÑÁâπÂÆö‰ΩçÁΩÆÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åÂà∞Ëøô‰∫õ‰ΩçÁΩÆÊó∂ÔºåÂÆÉÁöÑÂ∫ïÂ±ÇÊâßË°åÁä∂ÊÄÅÔºàÂØÑÂ≠òÂô®„ÄÅÊ†àÔºâÊòØÁ°ÆÂÆöÁöÑÔºåËÉΩÂ§üË¢´ JVM ÂáÜÁ°ÆÁöÑËß£ÊûêÔºåÂπ∂ÂèØ‰ª•Ë¢´ JVM ÂÆâÂÖ®Âú∞Ê£ÄÊü•Âíå‰øÆÊîπ„ÄÇ</strong></p>
</blockquote>
<p>Âõ†Ê≠§ÔºåÂΩì JVM ÈúÄË¶ÅÊöÇÂÅúÊâÄÊúâÁ∫øÁ®ãÊó∂Ôºà‰æãÂ¶ÇËøõË°å GCÔºâÔºåÂÆÉ‰∏ç‰ºöÁÆÄÂçïÁ≤óÊö¥ÁöÑÁõ¥Êé•‰∏≠Êñ≠ÂÆÉ‰ª¨ÁöÑÊâßË°åÔºåËÄåÊòØ‰ºöËÆæÁΩÆ‰∏Ä‰∏™ÂÖ®Â±ÄÊ†áÂøóÔºåÁÑ∂Âêé<strong>Á≠âÂæÖÊâÄÊúâÁ∫øÁ®ã‰∏ªÂä®ËøêË°åÂà∞</strong>Á¶ªÂÆÉ‰ª¨ÊúÄËøëÁöÑ‰∏Ä‰∏™ SafepointÔºåÂú®ÈÇ£ÈáåÊ£ÄÊü•Âà∞Ëøô‰∏™Ê†áÂøóÂêéÔºåËá™Ë°åÂÜ≥ÂÆöÊöÇÂÅú„ÄÇ</p>
<p>ËøôÂ∞±ÊòØ Safepoint Êú∫Âà∂ÁöÑÊ†∏ÂøÉÔºöÂÆÉÈááÁî® <strong>Âçè‰ΩúÂºèÔºàCooperativeÔºâ</strong> ÁöÑÊñπÂºèÂ∑•‰Ωú„ÄÇJVM Êó†Ê≥ïÂº∫Ëø´Á∫øÁ®ãÂÅú‰∏ãÔºåÂè™ËÉΩÁ≠âÂæÖÁ∫øÁ®ã‚ÄúËá™Ëßâ‚ÄùÂú∞Ëµ∞Âà∞‰∏Ä‰∏™ÂèåÊñπÁ∫¶ÂÆöÂ•ΩÁöÑ„ÄÅÂèØ‰ª•ÂÆâÂÖ®‚Äú‰∫§Êé•‚ÄùÁöÑÂú∞Êñπ„ÄÇËøôÁßçÊú∫Âà∂Ôºå‰øùËØÅ‰∫ÜÊâÄÊúâÂÖ®Â±ÄÊìç‰ΩúÁöÑÁªùÂØπÂÆâÂÖ®ÂíåÊ≠£Á°Æ„ÄÇ</p>
<h2 id="safepoint-ÁöÑÂ∫îÁî®Âú∫ÊôØ">
    <a href="#safepoint-%e7%9a%84%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" class="header-anchor">#</a>
    Safepoint ÁöÑÂ∫îÁî®Âú∫ÊôØ
</h2><p>ÊèêÂà∞‚ÄúStop-The-World‚ÄùÔºåÂ§ßÈÉ®ÂàÜÂºÄÂèëËÄÖÈ¶ñÂÖàÊÉ≥Âà∞ÁöÑÂ∞±ÊòØÂûÉÂúæÂõûÊî∂„ÄÇGC ÁöÑËÆ∏Â§öÂÖ≥ÈîÆÈò∂ÊÆµÔºåÈÉΩÈúÄË¶ÅÂú®‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑ Safepoint ‰∏≠ËøõË°åÔºåÂèØ‰ª•ÂÆâÂÖ®ÁöÑËøõË°åÂØπË±°ÁöÑÊ†áËÆ∞ÂíåÊ∏ÖÁêÜ„ÄÇ</p>
<p>‰ΩÜÊòØÔºåÂ¶ÇÊûúÊàë‰ª¨Â∞Ü Safepoint ‰ªÖ‰ªÖ‰∏é GC Âàí‰∏äÁ≠âÂè∑ÔºåÈÇ£Â∞±Â§ßÂ§ß‰Ωé‰º∞‰∫ÜÂÆÉÁöÑÈáçË¶ÅÊÄß„ÄÇ</p>
<p>ÂÆûÈôÖ‰∏äÔºåSafepoint ÊòØ JVM ÁöÑ‰∏Ä‰∏™Âü∫Á°ÄÊÄßÂπ≥Âè∞Êú∫Âà∂„ÄÇ‰ªª‰ΩïÈúÄË¶Å<strong>ÂÆâÂÖ®Âú∞Ê£ÄÊü•Êàñ‰øÆÊîπÊâÄÊúâÁ∫øÁ®ãÂÖ±‰∫´Êï∞ÊçÆ</strong>ÔºàÂ¶ÇÂ†Ü„ÄÅÁ±ªÂÖÉÊï∞ÊçÆ„ÄÅÁ∫øÁ®ãÊ†àÁ≠âÔºâÁöÑÈáçÈáèÁ∫ßÊìç‰ΩúÔºåÈÉΩÂøÖÈ°ª‰æùËµñÂÆÉÊù•ÂàõÈÄ†‰∏Ä‰∏™ÂÆâÂÖ®Á°ÆÂÆöÁöÑÊâßË°åÁéØÂ¢É„ÄÇGC Âè™ÊòØËøô‰∏™Âπ≥Âè∞‰∏äÊúÄ‚ÄúÁü•Âêç‚ÄùÁöÑÂÆ¢Êà∑ËÄåÂ∑≤„ÄÇ</p>
<p>Èô§‰∫Ü GCÔºåËøòÊúâ‰∏Ä‰∫õÂ∏∏ËßÅÁöÑ VM Êìç‰ΩúÔºåÂêåÊ†∑ÈúÄË¶ÅÂú®ÂÖ®Â±Ä Safepoint ‰∏≠ÊâßË°åÔºö</p>
<ul>
<li><strong>‰ª£Á†ÅÂèç‰ºòÂåñ (Deoptimization)</strong>ÔºöÂΩì JIT ÁºñËØëÂêéÁöÑ‰ª£Á†ÅÂõ†‰∏∫Êüê‰∫õÂéüÂõ†ÔºàÂ¶ÇÂàÜÊîØÈ¢ÑÊµãÂ§±Ë¥•„ÄÅÂä†ËΩΩ‰∫ÜÊú™Ë¢´È¢ÑÊúüÁöÑÂ≠êÁ±ªÁ≠âÔºâÈúÄË¶ÅÂõûÈÄÄÂà∞Ëß£ÈáäÊâßË°åÁä∂ÊÄÅÊó∂ÔºåJVM ÈúÄË¶ÅÊöÇÂÅúÁ∫øÁ®ãÔºå‰øÆÊîπÂÖ∂Ê†àÂ∏ßÔºåËøô‰∏™ËøáÁ®ãÂøÖÈ°ªÂú® Safepoint ‰∏≠ËøõË°å„ÄÇ</li>
<li><strong>Á±ªÁöÑÈáçÂÆö‰πâ‰∏éÁÉ≠ÈÉ®ÁΩ≤ (Class Redefinition)</strong>ÔºöÂÉèÊàë‰ª¨Âú® IDE ‰∏≠ÁÉ≠Êõ¥Êñ∞‰ª£Á†ÅÔºåÊàñËÄÖ‰ΩøÁî®Êüê‰∫õÂä®ÊÄÅËØäÊñ≠Â∑•ÂÖ∑Êó∂ÔºåJVM ÈúÄË¶ÅÊõøÊç¢ÊéâÂ∑≤Âä†ËΩΩÁöÑÁ±ª„ÄÇËøô‰∏™Êìç‰Ωú‰ºöÊ∂âÂèä‰øÆÊîπÁ±ªÁöÑÂÖÉÊï∞ÊçÆÂíåÂèØËÉΩÂ≠òÂú®ÁöÑÂÆû‰æãÔºåÊòæÁÑ∂‰πüÈúÄË¶ÅÊâÄÊúâÁ∫øÁ®ãÊöÇÂÅú„ÄÇ</li>
<li><strong>Á∫øÁ®ãÂ†ÜÊ†àËΩ¨ÂÇ® (Thread Dump)</strong>ÔºöÂΩìÊàë‰ª¨‰ΩøÁî® <code>jstack</code> ÊàñÂÖ∂‰ªñÂ∑•ÂÖ∑Êù•Ëé∑ÂèñÊâÄÊúâÁ∫øÁ®ãÁöÑÂ†ÜÊ†àÂø´ÁÖßÊó∂Ôºå‰∏∫‰∫ÜÂæóÂà∞‰∏Ä‰∏™ÂáÜÁ°Æ„ÄÅ‰∏ÄËá¥ÁöÑËßÜÂõæÔºåJVM ‰ºöËß¶Âèë‰∏ÄÊ¨° Safepoint„ÄÇ</li>
<li><strong>Â†ÜËΩ¨ÂÇ® (Heap Dump)</strong>Ôºö‰∏éÁ∫øÁ®ãËΩ¨ÂÇ®Á±ª‰ººÔºåÁîüÊàêÂ†ÜÂø´ÁÖß‰πüÈúÄË¶ÅÂú®‰∏Ä‰∏™ÈùôÊÄÅÁöÑÂÜÖÂ≠òËßÜÂõæ‰∏ãËøõË°å„ÄÇ</li>
<li><strong>ÂÅèÂêëÈîÅÊâπÈáèÊí§ÈîÄ (Bulk Revocation of Biased Locks)</strong>ÔºöÂΩìÊüê‰∏™Á±ªÁöÑÂÅèÂêëÈîÅË¢´Â§ßÈáèÊí§ÈîÄÊó∂ÔºåJVM ÈúÄË¶ÅÈÅçÂéÜÊâÄÊúâÁ∫øÁ®ãÊ†àÂíåÂ†ÜÔºåÊâæÂà∞Âπ∂‰øÆÊîπÁõ∏ÂÖ≥ÁöÑÈîÅËÆ∞ÂΩï„ÄÇ</li>
<li><strong>ÂÖ∂‰ªñ JVMTI Êìç‰Ωú</strong>ÔºöËÆ∏Â§öÈÄöËøá JVMTIÔºàJVM Tool InterfaceÔºâÊèê‰æõÁöÑË∞ÉËØïÂíåÁõëÊéßÂäüËÉΩÔºå‰æãÂ¶ÇÂº∫Âà∂‰øÆÊîπÂèòÈáèÂÄºÁ≠âÔºå‰πü‰æùËµñ Safepoint Êù•‰øùËØÅÊìç‰ΩúÁöÑÂéüÂ≠êÊÄßÂíåÂÆâÂÖ®ÊÄß„ÄÇ</li>
</ul>
<p>Âõ†Ê≠§Ôºå‰∏ã‰∏ÄÊ¨°ÂΩì‰Ω†ÁöÑÂ∫îÁî®Âá∫Áé∞Âç°È°øÔºåËÄå GC Êó•ÂøóÂç¥‚ÄúÊ∏ÖÁôΩÊó†Ëæú‚ÄùÊó∂Ôºå‰∏çÂ¶®ÊÄùËÄÉ‰∏Ä‰∏ãÔºåÊòØÂê¶ÊòØ‰∏äËø∞Ëøô‰∫õÂéüÂõ†‰πã‰∏ÄÔºåËß¶Âèë‰∫Ü‰∏ÄÊ¨°ÊÑèÊñô‰πãÂ§ñÁöÑ Safepoint ÂÅúÈ°ø„ÄÇ</p>
<h2 id="safepoint-ÁöÑÂ∑•‰ΩúÊú∫Âà∂">
    <a href="#safepoint-%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6" class="header-anchor">#</a>
    Safepoint ÁöÑÂ∑•‰ΩúÊú∫Âà∂
</h2><p>Êàë‰ª¨Â∑≤ÁªèÁü•ÈÅìÔºåJVM Êó†Ê≥ïÂú®‰ªªÊÑèÊó∂ÂàªÂº∫Ë°åÊöÇÂÅúÁ∫øÁ®ãÔºåËÄåÊòØÈúÄË¶ÅÁ∫øÁ®ãÁöÑ‚ÄúÂçè‰Ωú‚Äù„ÄÇÈÇ£‰πàÔºåÊâÄÊúâÁ∫øÁ®ãÁöÑ‚ÄúÈõÜ‰ΩìÊöÇÂÅú‚ÄùÔºåÊòØÂ¶Ç‰ΩïÂèëÁîüÁöÑÂë¢Ôºü</p>
<h3 id="Âçè‰ΩúÂºèËΩÆËØ¢Êú∫Âà∂">
    <a href="#%e5%8d%8f%e4%bd%9c%e5%bc%8f%e8%bd%ae%e8%af%a2%e6%9c%ba%e5%88%b6" class="header-anchor">#</a>
    Âçè‰ΩúÂºèËΩÆËØ¢Êú∫Âà∂
</h3><p>Êï¥‰∏™Êú∫Âà∂ÁöÑÊ†∏ÂøÉÊòØ‰∏ÄÁßç<strong>Âçè‰ΩúÂºèËΩÆËØ¢ÔºàCooperative PollingÔºâ</strong>„ÄÇÂÆÉÁöÑÂ∑•‰ΩúÊµÅÁ®ãÈùûÂ∏∏Áõ¥ËßÇÔºö</p>
<ol>
<li>ÂΩì JVM ÈúÄË¶ÅÊâÄÊúâÁ∫øÁ®ãËøõÂÖ• Safepoint Êó∂ÔºåÂÆÉ‰ºöËÆæÁΩÆ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑ‚ÄúËØ∑ÊöÇÂÅú‚ÄùÊ†áÂøó„ÄÇ</li>
<li>ÊØè‰∏™Ê≠£Âú®ËøêË°åÁöÑÂ∫îÁî®Á∫øÁ®ãÔºåÂú®ÊâßË°åËá™Â∑±‰ª£Á†ÅÁöÑÂêåÊó∂Ôºå‰ºö<strong>Âë®ÊúüÊÄßÂú∞</strong>Ê£ÄÊü•Ëøô‰∏™ÂÖ®Â±ÄÊ†áÂøó„ÄÇ</li>
<li>‰∏ÄÊó¶Êüê‰∏™Á∫øÁ®ãÂèëÁé∞Ëøô‰∏™ÂÖ®Â±ÄÊ†áÂøóË¢´ËÆæÁΩÆÔºåÂÆÉÁ´ãÂç≥Âú®Ëøô‰∏™ÂÆâÂÖ®ÁöÑ‰ΩçÁΩÆÂÅú‰∏ãÔºåÂπ∂Ëá™Ë°åËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅ„ÄÇ</li>
<li>JVM ‰ºö‰∏ÄÁõ¥Á≠âÂæÖÔºåÁõ¥Âà∞ÊâÄÊúâÁöÑÂ∫îÁî®Á∫øÁ®ãÈÉΩÂà∞Ëææ‰∫ÜÂêÑËá™ÁöÑ Safepoint Âπ∂ËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅ„ÄÇ</li>
<li>Ê≠§Êó∂ÔºåJVM ÂèØ‰ª•ÂÆâÂÖ®Âú∞ËøõË°åÂÆÉÁöÑÂÖ®Â±ÄÊìç‰ΩúÔºàÂ¶ÇÂûÉÂúæÂõûÊî∂„ÄÅ‰ª£Á†ÅÂéª‰ºòÂåñÁ≠âÔºâÔºåÂõ†‰∏∫ÂÆÉÁü•ÈÅìÊâÄÊúâÁ∫øÁ®ãÈÉΩÂ§Ñ‰∫éÂèØËß£ÊûêÁöÑÁ®≥ÂÆöÁä∂ÊÄÅ„ÄÇ</li>
<li>ÂÖ®Â±ÄÊìç‰ΩúÂÆåÊàêÂêéÔºåJVM ‰ºöÊ∏ÖÈô§ÈÇ£‰∏™ÂÖ®Â±ÄÁöÑ‚ÄúËØ∑ÊöÇÂÅú‚ÄùÊ†áÂøóÔºåÂπ∂Âî§ÈÜíÊâÄÊúâÊ≠£Âú®ÈòªÂ°ûÁöÑÁ∫øÁ®ã„ÄÇ</li>
<li>Á∫øÁ®ã‰ª¨Ë¢´Âî§ÈÜíÂêéÔºåÂÆÉ‰ª¨‰ªé‰πãÂâçÊöÇÂÅúÁöÑ Safepoint Â§ÑÔºåÁªßÁª≠ÊâßË°åËá™Â∑±ÁöÑ‰ª£Á†Å„ÄÇ</li>
</ol>
<h3 id="ËΩÆËØ¢ÁÇπÁöÑ‰ΩçÁΩÆ">
    <a href="#%e8%bd%ae%e8%af%a2%e7%82%b9%e7%9a%84%e4%bd%8d%e7%bd%ae" class="header-anchor">#</a>
    ËΩÆËØ¢ÁÇπÁöÑ‰ΩçÁΩÆ
</h3><p>‰∏Ä‰∏™ÂæàËá™ÁÑ∂ÁöÑÈóÆÈ¢òÊòØÔºöÁ∫øÁ®ãÂú®Âì™ÈáåËøõË°åËΩÆËØ¢Ê£ÄÊü•Âë¢Ôºü</p>
<p>Â¶ÇÊûúÊ£ÄÊü•ÂæóÂ§™È¢ëÁπÅÔºåÊØîÂ¶ÇÊØèÊù°Êåá‰ª§ÂêéÈÉΩÊ£ÄÊü•ÔºåÈÇ£Êó†Áñë‰ºöÂ∏¶Êù•Â∑®Â§ßÁöÑÊÄßËÉΩÂºÄÈîÄ„ÄÇÂ¶ÇÊûúÊ£ÄÊü•ÂæóÂ§™Â∞ëÔºåÂèàÂèØËÉΩÂØºËá¥Á∫øÁ®ãÈïøÊó∂Èó¥Êó†Ê≥ïÂìçÂ∫îÊöÇÂÅúËØ∑Ê±Ç„ÄÇÂõ†Ê≠§ÔºåJIT ÁºñËØëÂô®ÈááÂèñ‰∫Ü‰∏ÄÁßçÊäòË°∑Á≠ñÁï•ÔºåÂú®‰∏Ä‰∫õÂÖ≥ÈîÆ‰ΩçÁΩÆÊèíÂÖ•ËΩÆËØ¢Êåá‰ª§ÔºåËøô‰∫õ‰ΩçÁΩÆË¢´Áß∞‰∏∫<strong>ËΩÆËØ¢ÁÇπÔºàPoll LocationsÔºâ</strong>Ôºö</p>
<ul>
<li><strong>ÊñπÊ≥ïÁöÑËøîÂõûÂ§Ñ</strong>ÔºöÂΩì‰∏Ä‰∏™ÊñπÊ≥ïÂç≥Â∞ÜËøîÂõûÁªôË∞ÉÁî®ËÄÖ‰πãÂâç„ÄÇ</li>
<li><strong>Âæ™ÁéØÁöÑÂõûËæπÔºàLoop Back-edgesÔºâ</strong>ÔºöÂú®‰∏Ä‰∏™Âæ™ÁéØÂç≥Â∞ÜËøõÂÖ•‰∏ã‰∏ÄÊ¨°Ëø≠‰ª£‰πãÂâç„ÄÇ</li>
</ul>
<p>ÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºå‰∏∫‰∫ÜÈÅøÂÖçÂõ†ÁºñËØëÂô®‰ºòÂåñÔºàÊØîÂ¶ÇÂ∞ÜÂ§ö‰∏™Â∞èÂæ™ÁéØÂêàÂπ∂Êàê‰∏Ä‰∏™Â§ßÂæ™ÁéØÔºâËÄåÂØºËá¥Á∫øÁ®ãÈïøÊó∂Èó¥‚ÄúÂ§±ËÅî‚ÄùÔºåÁé∞‰ª£ÁöÑ JDK ÂÄæÂêë‰∫éÂú®<strong>ÊâÄÊúâ</strong>Âæ™ÁéØÁöÑÂõûËæπÈÉΩÊèíÂÖ•ËΩÆËØ¢ÁÇπÔºåËøôÂ§ßÂ§ßÈôç‰Ωé‰∫ÜÁ∫øÁ®ãÊó†Ê≥ïÂèäÊó∂ÂìçÂ∫î Safepoint ÁöÑÈ£éÈô©„ÄÇ</p>
<p>Â¶ÇÊûú‰Ω†ÂØπÊ±áÁºñ‰ª£Á†ÅÊÑüÂÖ¥Ë∂£ÔºåÂèØ‰ª•ÂèÇËÄÉÊàë‰ª•ÂâçÁöÑÊñáÁ´†<a class="link" href="https://mazhen.tech/p/%E4%BD%BF%E7%94%A8-printassembly-%E6%9F%A5%E7%9C%8B-jit-%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81/"  target="_blank" rel="noopener"
    >‰ΩøÁî® PrintAssembly Êü•Áúã JIT ÁºñËØëÂêéÁöÑÊ±áÁºñ‰ª£Á†Å</a>Ôºå‰∏∫ JDK ÂÆâË£ÖÈÖçÁΩÆÂ•ΩÂáÜÂ§á hsdis Êèí‰ª∂ÔºåÁÑ∂Âêé‰ΩøÁî®Á±ª‰ºº‰∏ãÈù¢ÁöÑÂëΩ‰ª§Ë°åÂèÇÊï∞ËøêË°åÂ∫îÁî®ÔºåÊü•Áúã‰Ω†ÊåáÂÆö‰ª£Á†ÅÁöÑ JIT ÂèçÊ±áÁºñÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">java -XX:+UnlockDiagnosticVMOptions <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     -XX:CompileCommand<span class="o">=</span><span class="s2">&#34;print,SafepointTest::*&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     -XX:PrintAssemblyOptions<span class="o">=</span>intel <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     SafepointTest
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈöèÁùÄÁ®ãÂ∫èÁöÑËøêË°åÔºå‰Ω†ÂèØ‰ª•ÁúãÂà∞ÁÉ≠ÁÇπ‰ª£Á†Å C1„ÄÅC2 ÁºñËØëÁªìÊûúÁöÑÂèçÊ±áÁºñËæìÂá∫„ÄÇËæìÂá∫ÁöÑÂèçÊ±áÁºñ‰ª£Á†ÅÂåÖÂê´‰∫Ü‰∏∞ÂØåÁöÑÊ≥®ÈáäÔºåÂÖ∂‰∏≠ÁöÑÊ≥®Èáä <code>{poll}</code> Âíå <code>{poll_return}</code> Â∞±Ë°®ÊòéÊòØÂÆâÂÖ®ÁÇπËΩÆËØ¢ (Safepoint Poll)„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">  0x00007d6f183a075b:   test		dword ptr [r10], eax;   {poll}
</span></span><span class="line"><span class="cl">  0x00007d6f183a075e:   cmp		rbx, 0xf4240
</span></span><span class="line"><span class="cl">  0x00007d6f183a0765:   jl		0x7d6f183a0750
</span></span><span class="line"><span class="cl">  0x00007d6f183a0767:   add		rsp, 0x10
</span></span><span class="line"><span class="cl">  0x00007d6f183a076b:   pop		rbp
</span></span><span class="line"><span class="cl">  0x00007d6f183a076c:   cmp		rsp, qword ptr [r15 + 0x448]
</span></span><span class="line"><span class="cl">                                                            ;   {poll_return}
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="Ê†∏ÂøÉÊÄßËÉΩÊåáÊ†áÂà∞ËææÂÆâÂÖ®ÁÇπÁöÑÊó∂Èó¥-time-to-safepoint-ttsp">
    <a href="#%e6%a0%b8%e5%bf%83%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87%e5%88%b0%e8%be%be%e5%ae%89%e5%85%a8%e7%82%b9%e7%9a%84%e6%97%b6%e9%97%b4-time-to-safepoint-ttsp" class="header-anchor">#</a>
    Ê†∏ÂøÉÊÄßËÉΩÊåáÊ†áÔºöÂà∞ËææÂÆâÂÖ®ÁÇπÁöÑÊó∂Èó¥ (Time-To-Safepoint, TTSP)
</h3><p>Áé∞Âú®ÔºåÊàë‰ª¨Êù•Âà∞‰∫Ü Safepoint Êú∫Âà∂‰∏≠ÂØπÊÄßËÉΩÂΩ±ÂìçÊúÄÂ§ßÔºå‰πüÂæàÂÆπÊòìË¢´ÂøΩËßÜÁöÑ‰∏ÄÁéØ„ÄÇ</p>
<p>ÊÉ≥Ë±°‰∏Ä‰∏ãÔºåJVM ËÆæÁΩÆ‰∫ÜÂÖ®Â±ÄÁöÑ‚ÄúËØ∑ÊöÇÂÅú‚ÄùÊ†áÂøóÔºåÊ≠§ÂàªÔºö</p>
<ul>
<li>Á∫øÁ®ã A ÂèØËÉΩÊ≠£Â•ΩÊâßË°åÂÆå‰∏ÄÊ¨°Âæ™ÁéØÔºåÂÆÉÁ´ãÂàªÁúãÂà∞‰∫ÜÊ†áÂøóÔºåÂπ∂È©¨‰∏äÂú® Safepoint Â§ÑÊöÇÂÅú‰∫Ü„ÄÇ</li>
<li>Á∫øÁ®ã B ÂèØËÉΩÊ≠£Âú®ÊâßË°å‰∏ÄÊÆµÈïøËÆ°ÁÆóÁöÑ‰∏≠Èó¥ÈÉ®ÂàÜÔºåÂÆÉÈúÄË¶ÅÂÜçËøêË°åÂ§öÊù°Êåá‰ª§ÊâçËÉΩÂà∞Ëææ‰∏ã‰∏Ä‰∏™Âæ™ÁéØÁöÑÊú´Â∞æÔºå‰πüÂ∞±ÊòØ‰∏ã‰∏Ä‰∏™ËΩÆËØ¢ÁÇπ„ÄÇ</li>
</ul>
<p>JVM ÁöÑÂÖ®Â±ÄÊìç‰ΩúÔºàÂ¶Ç GCÔºâÂøÖÈ°ªÁ≠âÂà∞<strong>ÊâÄÊúâ</strong>Á∫øÁ®ãÈÉΩÊöÇÂÅúÂêéÊâçËÉΩÂºÄÂßã„ÄÇËøôÊÑèÂë≥ÁùÄÔºåÂç≥‰ΩøÁ∫øÁ®ã A Â∑≤ÁªèÊó©Êó©Âú∞‚ÄúÂ∞±‰Ωç‚ÄùÔºåÂÆÉ‰πüÂøÖÈ°ªÂéüÂú∞Á≠âÂæÖÔºåÁõ¥Âà∞ÊúÄÊÖ¢ÁöÑÁ∫øÁ®ã B ÂßóÂßóÊù•Ëøü„ÄÇ</p>
<p><img src="https://cdn.mazhen.tech/2024/202507151649314.png"
	
	
	
	loading="lazy"
	
		alt="TTSP"
	
	
></p>
<p>‰ªé JVM ÂèëËµ∑ÊöÇÂÅúËØ∑Ê±ÇÔºåÂà∞<strong>ÊúÄÂêé‰∏Ä‰∏™</strong>Á∫øÁ®ãÁªà‰∫éÂà∞Ëææ Safepoint Âπ∂ÊöÇÂÅúÔºåËøôÊÆµÁ≠âÂæÖÊó∂Èó¥ÔºåË¢´Áß∞‰∏∫ <strong>‚ÄúÂà∞ËææÂÆâÂÖ®ÁÇπÁöÑÊó∂Èó¥‚ÄùÔºàTime-To-SafepointÔºåÁÆÄÁß∞ TTSPÔºâ</strong>„ÄÇ</p>
<p><code>ÊÄªÂÅúÈ°øÊó∂Èó¥ ‚âà Âà∞ËææÂÆâÂÖ®ÁÇπÁöÑÊó∂Èó¥ (TTSP) + ÂÆâÂÖ®ÁÇπÂÜÖVMÊìç‰ΩúÁöÑËÄóÊó∂</code></p>
<p>Ëøô‰∏™ÂÖ¨ÂºèË°®ÊòéÔºåÊàë‰ª¨ÈÄöËøá GC Êó•ÂøóÁúãÂà∞ÁöÑÂÅúÈ°øÊó∂Èó¥Ôºå‰ªÖ‰ªÖÊòØÂÖ¨ÂºèÁöÑÂêéÂçäÈÉ®ÂàÜ„ÄÇËÄåÂêåÊ†∑‰ºöÂÜªÁªìÂ∫îÁî®ÁöÑ TTSPÔºåÂç¥ÈöêËóèÂú®ÂπïÂêé„ÄÇÂú®Êüê‰∫õÊûÅÁ´ØÊÉÖÂÜµ‰∏ãÔºå‰∏Ä‰∏™Ë°å‰∏∫ÂºÇÂ∏∏ÁöÑÁ∫øÁ®ãÂØºËá¥ÁöÑË∂ÖÈïø TTSPÔºåÁîöËá≥ÂèØËÉΩË∂ÖËøá GC Êú¨Ë∫´ÁöÑÊó∂Èó¥ÔºåÊàê‰∏∫Â∫îÁî®Âç°È°øÁöÑÁúüÊ≠£ÂÖÉÂá∂„ÄÇÂêéÈù¢Êàë‰ºö‰ªãÁªç‰ΩøÁî® <code>-Xlog:safepoint</code> ÂèÇÊï∞ÔºåÊü•ÁúãÊØèÊ¨°ÊöÇÂÅúÁöÑ TTSP„ÄÇ</p>
<h2 id="openjdk-Â∫ïÂ±ÇÂÆûÁé∞Êè≠Áßò">
    <a href="#openjdk-%e5%ba%95%e5%b1%82%e5%ae%9e%e7%8e%b0%e6%8f%ad%e7%a7%98" class="header-anchor">#</a>
    OpenJDK Â∫ïÂ±ÇÂÆûÁé∞Êè≠Áßò
</h2><p>ÁêÜËß£‰∫Ü Safepoint ÁöÑ‚ÄúÊòØ‰ªÄ‰πà‚ÄùÂíå‚Äú‰∏∫‰ªÄ‰πà‚ÄùÔºåÊàë‰ª¨Áé∞Âú®Ê∑±ÂÖ•ÂÖ∂ÂÜÖÈÉ®ÔºåÁúãÁúãÂú® OpenJDK ‰∏≠ÔºåËøô‰∏ÄÂàáÊòØÂ¶Ç‰ΩïÈÄöËøá‰ª£Á†ÅÂÆûÁé∞ÁöÑ„ÄÇ</p>
<h3 id="vmthread-‰∏é-vm_operation">
    <a href="#vmthread-%e4%b8%8e-vm_operation" class="header-anchor">#</a>
    VMThread ‰∏é VM_Operation
</h3><p>Âú® JVM ÂÜÖÈÉ®ÔºåÂ≠òÂú®‰∏Ä‰∏™ÁâπÊÆäÁöÑÁ≥ªÁªüÁ∫ßÁ∫øÁ®ãÔºåÂêç‰∏∫ <strong>VMThread</strong>„ÄÇÂÆÉ‰∏çÊâßË°å‰ªª‰Ωï Java Â∫îÁî®‰ª£Á†ÅÔºåÂÖ∂Ê†∏ÂøÉËÅåË¥£ÊòØÁÆ°ÁêÜÂíåÊâßË°åÈúÄË¶ÅÂÖ®Â±ÄÂçèË∞ÉÁöÑÂÜÖÈÉ®‰ªªÂä°„ÄÇÂÆÉÊòØ‰∏Ä‰∏™Âçï‰∏ÄÁöÑ„ÄÅÈ´ò‰ºòÂÖàÁ∫ßÁöÑÂêéÂè∞Á∫øÁ®ãÔºåÊ†∏ÂøÉ‰ΩøÂëΩÊòØÂ§ÑÁêÜÈÇ£‰∫õÈúÄË¶Å<strong>ÂÖ®Â±Ä‰∏ÄËá¥ÊÄß</strong>ÁöÑ„ÄÅ<strong>ÈáçÈáèÁ∫ß</strong>ÁöÑÂÜÖÈÉ®‰ªªÂä°„ÄÇËøô‰∫õ‰ªªÂä°Â¶ÇÊûúÁî±ÊôÆÈÄöÂ∫îÁî®Á∫øÁ®ãÊù•ÊâßË°åÔºåÂèØËÉΩ‰ºöÂºïÂèëÂ§çÊùÇÁöÑÁ´ûÊÄÅÊù°‰ª∂ÂíåÊ≠ªÈîÅÈóÆÈ¢ò„ÄÇÂõ†Ê≠§ÔºåÂ∞ÜÂÆÉ‰ª¨ÈõÜ‰∏≠‰∫§Áî±‰∏Ä‰∏™‰∏ìËÅåÁöÑ VMThread Êù•Â§ÑÁêÜÔºåÊòØ JVM ÂÜÖÈÉ®ÁöÑ‰∏ÄÁßçËÆæËÆ°Ê®°Âºè„ÄÇ</p>
<p>ÂΩì JVM ÁöÑÊüê‰∏™Â≠êÁ≥ªÁªüÔºàÊØîÂ¶Ç GC„ÄÅJIT ÁºñËØëÂô®„ÄÅ‰ª£Á†ÅÁÉ≠Êõ¥Êñ∞Ê®°ÂùóÁ≠âÔºâÈúÄË¶ÅÊâßË°å‰∏Ä‰∏™ÂÖ®Â±ÄÊìç‰ΩúÊó∂ÔºåÂÆÉ‰∏ç‰ºöÁõ¥Êé•Âä®ÊâãÔºåËÄåÊòØÊääËøô‰∏™Êìç‰ΩúÂ∞ÅË£ÖÊàê‰∏Ä‰∏™ÂØπË±°ÔºåËøô‰∏™ÂØπË±°Â∞±ÊòØ <strong>VM_Operation</strong>„ÄÇ<code>VM_Operation</code> ÊòØ‰∏Ä‰∏™‰ªªÂä°ÁöÑÊäΩË±°ÔºåÂÆÉÊ∏ÖÊô∞Âú∞ÂÆö‰πâ‰∫ÜÈúÄË¶ÅÊâßË°å‰ªÄ‰πàÊìç‰ΩúÔºà<code>doit()</code> ÊñπÊ≥ïÔºâ‰ª•ÂèäËøô‰∏™Êìç‰ΩúÊòØÂê¶ÈúÄË¶ÅÂú® Safepoint ‰∏≠ËøõË°åÔºà<code>evaluate_at_safepoint()</code> ÊñπÊ≥ïÔºâ„ÄÇ</p>
<p>ËøôÁßçËÆæËÆ°ÁöÑÂ•ΩÂ§ÑÂú®‰∫é<strong>Ëß£ËÄ¶</strong>Ôºö‰ªªÂä°ÁöÑ‚ÄúËØ∑Ê±ÇÊñπ‚ÄùÂíå‚ÄúÊâßË°åÊñπ‚ÄùË¢´ÂàÜÂºÄ‰∫Ü„ÄÇËØ∑Ê±ÇÊñπÂè™ÈúÄÂàõÂª∫‰∏Ä‰∏™ <code>VM_Operation</code> Âπ∂Â∞ÜÂÖ∂Êèê‰∫§Âà∞‰∏Ä‰∏™ÂÖ±‰∫´ÁöÑ‰ªªÂä°ÈòüÂàó <code>VMOperationQueue</code> ‰∏≠ÔºåËÄåÊó†ÈúÄÂÖ≥ÂøÉÂ§çÊùÇÁöÑÁ∫øÁ®ãÂêåÊ≠•ÂíåÊöÇÂÅúÈÄªËæë„ÄÇ</p>
<p>Êàë‰ª¨ÂèØ‰ª•Âú® <a class="link" href="https://github.com/openjdk/jdk/blob/master/src/hotspot/share/runtime/vmOperation.hpp"  target="_blank" rel="noopener"
    >vmOperation.hpp</a> ‰∏≠ÔºåÊü•ÁúãÁõÆÂâç JVM ÊîØÊåÅÁöÑÊâÄÊúâ <code>VM_Operation</code> ÂàóË°®Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// The following classes are used for operations
</span></span></span><span class="line"><span class="cl"><span class="c1">// initiated by a Java thread but that must
</span></span></span><span class="line"><span class="cl"><span class="c1">// take place in the VMThread.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define VM_OP_ENUM(type)   VMOp_##type,
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Note: When new VM_XXX comes up, add &#39;XXX&#39; to the template table.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define VM_OPS_DO(template)                       \
</span></span></span><span class="line"><span class="cl"><span class="cp">  template(Halt)                                  \
</span></span></span><span class="line"><span class="cl"><span class="cp">  template(SafepointALot)                         \
</span></span></span><span class="line"><span class="cl"><span class="cp">  template(ThreadDump)                            \
</span></span></span><span class="line"><span class="cl"><span class="cp">  template(PrintThreads)                          \
</span></span></span><span class="line"><span class="cl"><span class="cp">  ...
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="k">template</span><span class="p">(</span><span class="n">G1CollectForAllocation</span><span class="p">)</span>                \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">G1CollectFull</span><span class="p">)</span>                         \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">G1PauseRemark</span><span class="p">)</span>                         \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">G1PauseCleanup</span><span class="p">)</span>                        \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">G1TryInitiateConcMark</span><span class="p">)</span>                 \
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ZMarkEndOld</span><span class="p">)</span>                           \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ZMarkEndYoung</span><span class="p">)</span>                         \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ZMarkFlushOperation</span><span class="p">)</span>                   \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ZMarkStartYoung</span><span class="p">)</span>                       \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ZMarkStartYoungAndOld</span><span class="p">)</span>                 \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ZRelocateStartOld</span><span class="p">)</span>                     \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ZRelocateStartYoung</span><span class="p">)</span>                   \
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ShenandoahFullGC</span><span class="p">)</span>                      \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ShenandoahInitMark</span><span class="p">)</span>                    \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ShenandoahFinalMarkStartEvac</span><span class="p">)</span>          \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ShenandoahInitUpdateRefs</span><span class="p">)</span>              \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ShenandoahFinalUpdateRefs</span><span class="p">)</span>             \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ShenandoahFinalRoots</span><span class="p">)</span>                  \
</span></span><span class="line"><span class="cl">  <span class="k">template</span><span class="p">(</span><span class="n">ShenandoahDegeneratedGC</span><span class="p">)</span>               \
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªé‰∏äÈù¢ÁöÑÂàóË°®‰∏≠ÂèØ‰ª•ÁúãÂà∞ÔºåÂêÑ GC ÁÆóÊ≥ïÈúÄË¶ÅÂú® Safepoint ‰∫§Áî± VMThread ÊâßË°åÁöÑ VM Êìç‰Ωú„ÄÇÂΩìÁÑ∂‰πüÂåÖÂê´‰∏Ä‰∫õÈùû GC ÁöÑÂÖ∂‰ªñ VM Êìç‰ΩúÔºåÂ¶Ç ThreadDump„ÄÇ</p>
<h3 id="safepoint-Êï¥‰ΩìÊµÅÁ®ã">
    <a href="#safepoint-%e6%95%b4%e4%bd%93%e6%b5%81%e7%a8%8b" class="header-anchor">#</a>
    Safepoint Êï¥‰ΩìÊµÅÁ®ã
</h3><p>Êúâ‰∫Ü VMThread Âíå VM_Operation Ëøô‰∏§‰∏™Âü∫Êú¨ÊûÑ‰ª∂ÔºåSafepoint ÁöÑÊï¥‰ΩìÊâßË°åÊµÅÁ®ãÂ∞±ÂèòÂæóÈùûÂ∏∏Ê∏ÖÊô∞‰∫Ü„ÄÇÂÆÉÊòØ‰∏Ä‰∏™Ê†áÂáÜÂåñÁöÑ„ÄÅÁî± VMThread ‰∏ªÂØºÁöÑË∞ÉÂ∫¶ËøáÁ®ã„ÄÇ</p>
<ol>
<li>
<p><strong>Êèê‰∫§‰ªªÂä°</strong>
ÂΩì‰∏Ä‰∏™ÈúÄË¶Å Safepoint ÁöÑ <code>VM_Operation</code> Ë¢´ÂàõÂª∫Âπ∂Êèê‰∫§Âà∞ <code>VMOperationQueue</code> ÂêéÔºåÂÆÉÂ∞±ËøõÂÖ•‰∫ÜÁ≠âÂæÖÂ§ÑÁêÜÁöÑÁä∂ÊÄÅ„ÄÇ</p>
</li>
<li>
<p><strong>Ë∞ÉÂ∫¶‰∏éÂèëËµ∑</strong>
VMThread Âú®ÂÖ∂‰∏ªÂæ™ÁéØ‰∏≠Ôºå‰ªéÈòüÂàóÈáåÂèñÂá∫Ëøô‰∏™ <code>VM_Operation</code>„ÄÇÂú®Á°ÆËÆ§ËØ•‰ªªÂä°ÈúÄË¶Å Safepoint ÂêéÔºåÂÆÉ‰æøË∞ÉÁî® <code>SafepointSynchronize::begin()</code>ÔºåÊ≠£ÂºèÂêØÂä®‰∫ÜÂ∞ÜÊâÄÊúâÁ∫øÁ®ãÂ∏¶ÂÖ• Safepoint ÁöÑÂêåÊ≠•ËøáÁ®ã„ÄÇ</p>
</li>
<li>
<p><strong>Ê≠¶Ë£Ö‰∏éËΩÆËØ¢</strong>
<code>begin()</code> ÊñπÊ≥ï‰ºöËÆæÁΩÆ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑ Safepoint Áä∂ÊÄÅÊ†áÂøóÔºåÂπ∂ÈÅçÂéÜÊâÄÊúâÂ≠òÊ¥ªÁöÑ JavaThread ÂÆû‰æãÔºå‰øÆÊîπÂÆÉ‰ª¨ÂêÑËá™Á∫øÁ®ãÊú¨Âú∞ÁöÑËΩÆËØ¢Áä∂ÊÄÅ„ÄÇËøô‰∏™ËøáÁ®ãË¢´Áß∞‰∏∫ <strong>‚ÄúÊ≠¶Ë£Ö‚ÄùÔºàArmingÔºâ</strong>„ÄÇÊ≠§ÂêéÔºåÊØè‰∏™Ê≠£Âú®ËøêË°åÁöÑÁ∫øÁ®ãÂú®ÊâßË°åÂà∞‰ª£Á†Å‰∏≠ÁöÑ**ËΩÆËØ¢ÁÇπÔºàPoll LocationÔºâ**Êó∂ÔºåÂ∞±‰ºöÊ£ÄÊµãÂà∞Ëøô‰∏™Áä∂ÊÄÅÊîπÂèò„ÄÇ</p>
</li>
<li>
<p><strong>ÈòªÂ°û‰∏éÂêåÊ≠•</strong>
‰∏ÄÊó¶Ê£ÄÊµãÂà∞ÊöÇÂÅúËØ∑Ê±ÇÔºåÁ∫øÁ®ã‰ºö‰∏ªÂä®ÊâßË°å <code>SafepointSynchronize::block()</code> ÊñπÊ≥ïÔºå‰ΩøËá™Ë∫´ËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅÔºåÂπ∂Âú®‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑÂ±èÈöúÔºàWaitBarrierÔºâ‰∏äÁ≠âÂæÖ„ÄÇVMThread Âàô‰ºöÊåÅÁª≠Ê£ÄÊü•ÊâÄÊúâÁ∫øÁ®ãÁöÑÁä∂ÊÄÅÔºåÁõ¥Âà∞Á°ÆËÆ§<strong>ÊâÄÊúâ</strong>Á∫øÁ®ãÈÉΩÂ∑≤ÊöÇÂÅú„ÄÇËøô‰∏™Á≠âÂæÖÊâÄÊúâÁ∫øÁ®ãÂÆåÊàêÂêåÊ≠•ÁöÑËÄóÊó∂ÔºåÂ∞±ÊòØ <strong>TTSPÔºàTime-To-SafepointÔºâ</strong>„ÄÇ</p>
</li>
<li>
<p><strong>ÊâßË°åÊìç‰Ωú</strong>
‰∏ÄÊó¶Á°ÆËÆ§ÊâÄÊúâÁ∫øÁ®ãÈÉΩÂ∑≤ÂêåÊ≠•ÔºåJVM Â∞±ËøõÂÖ•‰∫Ü‰∏Ä‰∏™ÂÖ®Â±ÄÈùôÊ≠¢Áä∂ÊÄÅ„ÄÇÊ≠§Êó∂ÔºåVMThread ÊâçÂÆâÂÖ®Âú∞Ë∞ÉÁî® <code>VM_Operation</code> ÂØπË±°ÁöÑÊ†∏ÂøÉ <code>doit()</code> ÊñπÊ≥ïÔºåÊâßË°åÂÆûÈôÖÁöÑ‰ªªÂä°ÈÄªËæëÔºà‰æãÂ¶ÇÔºåGC Êâ´ÊèèÔºâ„ÄÇ</p>
</li>
<li>
<p><strong>ÊÅ¢Â§çÊâßË°å</strong>
Êìç‰ΩúÂÆåÊàêÂêéÔºåVMThread Ë∞ÉÁî® <code>SafepointSynchronize::end()</code> ÊñπÊ≥ï„ÄÇËØ•ÊñπÊ≥ïË¥üË¥£ÈáçÁΩÆÂÖ®Â±ÄÁä∂ÊÄÅÔºåËß£Èô§ÂØπÂêÑÁ∫øÁ®ãËΩÆËØ¢Áä∂ÊÄÅÁöÑ‚ÄúÊ≠¶Ë£Ö‚ÄùÔºåÂπ∂ÊúÄÁªàÈÄöËøá <code>WaitBarrier</code> Âî§ÈÜíÊâÄÊúâË¢´ÈòªÂ°ûÁöÑ Java Á∫øÁ®ãÔºå‰ΩøÂÖ∂ÊÅ¢Â§çÊ≠£Â∏∏ÊâßË°å„ÄÇ</p>
</li>
</ol>
<p>Ëøô‰∏™ÊµÅÁ®ãÁ°Æ‰øù‰∫ÜÊâÄÊúâÂÖ®Â±ÄÊìç‰ΩúÈÉΩÂú®‰∏Ä‰∏™ÁªùÂØπÂÆâÂÖ®„ÄÅ‰∏ÄËá¥ÁöÑÁéØÂ¢É‰∏≠ËøõË°åÔºåÊòØ JVM Á®≥ÂÆöËøêË°åÁöÑÂü∫Áü≥„ÄÇÂú®Êé•‰∏ãÊù•ÁöÑÈÉ®ÂàÜÔºåÊàë‰ª¨Â∞ÜÊ∑±ÂÖ•Êé¢ËÆ®Á¨¨ 3 Ê≠•‰∏≠ÁöÑ‚ÄúËΩÆËØ¢‚ÄùÊòØÂ¶Ç‰ΩïÂú®‰∏çÂêåÊâßË°åÊ®°Âºè‰∏ãË¢´È´òÊïàÂÆûÁé∞ÁöÑ„ÄÇ</p>
<h3 id="jit-‰ª£Á†ÅÁöÑËΩÆËØ¢Âà©Áî®È°µ‰øùÊä§page-protection">
    <a href="#jit-%e4%bb%a3%e7%a0%81%e7%9a%84%e8%bd%ae%e8%af%a2%e5%88%a9%e7%94%a8%e9%a1%b5%e4%bf%9d%e6%8a%a4page-protection" class="header-anchor">#</a>
    JIT ‰ª£Á†ÅÁöÑËΩÆËØ¢ÔºöÂà©Áî®È°µ‰øùÊä§ÔºàPage ProtectionÔºâ
</h3><p>ÂØπ‰∫éÁªèËøá JIT ÁºñËØëÁöÑÈ´òÂ∫¶‰ºòÂåñÁöÑ‰ª£Á†ÅÔºåÊÄßËÉΩÊòØÁ¨¨‰∏ÄË¶ÅÂä°„ÄÇÂ¶ÇÊûúÂú®Âæ™ÁéØ‰∏≠È¢ëÁπÅÂú∞‰ΩøÁî® <code>if-else</code> Êù°‰ª∂ÂàÜÊîØÊù•Ê£ÄÊü• Safepoint Ê†áÂøóÔºå‰ºöÂØπ CPU ÁöÑÊåá‰ª§ÊµÅÊ∞¥Á∫øÈÄ†ÊàêÂπ≤Êâ∞ÔºåÂ∏¶Êù•‰∏çÂèØÂøΩËßÜÁöÑÊÄßËÉΩÊçüÂ§±„ÄÇ</p>
<p>‰∏∫‰∫ÜÂÆûÁé∞‰∏Ä‰∏™Ëøë‰πé‚ÄúÈõ∂ÂºÄÈîÄ‚ÄùÁöÑËΩÆËØ¢ÔºåOpenJDK ÁöÑÂ∑•Á®ãÂ∏à‰ª¨ÈááÁî®‰∫Ü‰∏Ä‰∏™ÊûÅ‰∏∫Â∑ßÂ¶ôÁöÑÊñπÊ°àÔºåÂÆÉÂà©Áî®‰∫ÜÁé∞‰ª£Êìç‰ΩúÁ≥ªÁªüÂíåÁ°¨‰ª∂Êèê‰æõÁöÑ‰∏ÄÈ°πÂäüËÉΩÔºö<strong>È°µ‰øùÊä§ÔºàPage ProtectionÔºâ</strong>„ÄÇ</p>
<h4 id="‰ªÄ‰πàÊòØÈ°µ‰øùÊä§Êú∫Âà∂">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e9%a1%b5%e4%bf%9d%e6%8a%a4%e6%9c%ba%e5%88%b6" class="header-anchor">#</a>
    ‰ªÄ‰πàÊòØÈ°µ‰øùÊä§Êú∫Âà∂
</h4><p>È°µ‰øùÊä§ÊòØÁé∞‰ª£Êìç‰ΩúÁ≥ªÁªü‰∏é CPU Á°¨‰ª∂ÂçèÂêåÊèê‰æõÁöÑ‰∏ÄÈ°πÂÜÖÂ≠òÁÆ°ÁêÜÂü∫Á°ÄÂäüËÉΩ„ÄÇÊìç‰ΩúÁ≥ªÁªü‰∏çÁõ¥Êé•ÁÆ°ÁêÜÂçï‰∏™Â≠óËäÇÔºåËÄåÊòØ‰ª• <strong>È°µÔºàPageÔºâ</strong> ‰∏∫Âçï‰ΩçÔºàÈÄöÂ∏∏ÊòØ 4KBÔºâÊù•ÁÆ°ÁêÜÂÜÖÂ≠ò„ÄÇ</p>
<p>Ëøô‰∏™Êú∫Âà∂ÁöÑÊ†∏ÂøÉÊòØ<strong>ËôöÊãüÂÜÖÂ≠ò</strong>Á≥ªÁªü„ÄÇÁ®ãÂ∫è‰∏≠‰ΩøÁî®ÁöÑÂú∞ÂùÄÂπ∂ÈùûÁúüÂÆûÁöÑÁâ©ÁêÜÂÜÖÂ≠òÂú∞ÂùÄÔºåËÄåÊòØËôöÊãüÂú∞ÂùÄ„ÄÇÊìç‰ΩúÁ≥ªÁªüÈÄöËøá <strong>È°µË°®ÔºàPage TableÔºâ</strong> Êù•Áª¥Êä§ËôöÊãüÂú∞ÂùÄÂà∞Áâ©ÁêÜÂú∞ÂùÄÁöÑÊò†Â∞ÑÂÖ≥Á≥ª„ÄÇÂΩìÁ®ãÂ∫èËÆøÈóÆ‰∏Ä‰∏™ËôöÊãüÂú∞ÂùÄÊó∂ÔºåCPU ÂÜÖÁöÑ <strong>ÂÜÖÂ≠òÁÆ°ÁêÜÂçïÂÖÉÔºàMMUÔºâ</strong> ‰ºöÊü•ËØ¢È°µË°®ÔºåÂÆåÊàêÂú∞ÂùÄËΩ¨Êç¢„ÄÇ</p>
<p>ÂÖ≥ÈîÆÂú®‰∫éÔºåÈ°µË°®ÁöÑÊØè‰∏ÄÈ°π‰∏ç‰ªÖËÆ∞ÂΩï‰∫ÜÊò†Â∞ÑÂÖ≥Á≥ªÔºåËøòÈôÑÂ∏¶‰∫Ü‰∏ÄÁªÑ<strong>‰øùÊä§Ê†áÂøóÔºàProtection FlagsÔºâ</strong>ÔºåÁî®‰ª•ËßÑÂÆöËØ•ÂÜÖÂ≠òÈ°µÁöÑËÆøÈóÆÊùÉÈôê„ÄÇÂ∏∏ËßÅÁöÑÊùÉÈôêÂåÖÊã¨Ôºö</p>
<ul>
<li><code>PROT_READ</code>ÔºöÂÖÅËÆ∏ËØªÂèñ„ÄÇ</li>
<li><code>PROT_WRITE</code>ÔºöÂÖÅËÆ∏ÂÜôÂÖ•„ÄÇ</li>
<li><code>PROT_EXEC</code>ÔºöÂÖÅËÆ∏ÊâßË°å‰ª£Á†Å„ÄÇ</li>
<li><code>PROT_NONE</code>Ôºö<strong>‰∏çÂÖÅËÆ∏‰ªª‰ΩïÂΩ¢ÂºèÁöÑËÆøÈóÆ</strong>„ÄÇ</li>
</ul>
<p>ÂΩìÁ®ãÂ∫èËÆøÈóÆ‰∏Ä‰∏™ÂÜÖÂ≠òÈ°µÊó∂ÔºåMMU ‰ºöÈ¶ñÂÖàÊ£ÄÊü•ÂÖ∂ÊùÉÈôê„ÄÇÂ¶ÇÊûúËÆøÈóÆÂêàÊ≥ïÔºåÊìç‰ΩúÈ°∫Âà©ÂÆåÊàê„ÄÇ‰ΩÜÂ¶ÇÊûúÁ®ãÂ∫èËØïÂõæËØª„ÄÅÂÜôÊàñÊâßË°å‰∏Ä‰∏™Ë¢´ËÆæÁΩÆ‰∏∫ <code>PROT_NONE</code> ÁöÑÈ°µÔºåMMU ‰ºöÁ´ãÂç≥ËØÜÂà´Âá∫ËøôÊòØÈùûÊ≥ïÊìç‰ΩúÔºåÂπ∂Ëß¶Âèë‰∏Ä‰∏™Á°¨‰ª∂Â±ÇÈù¢ÁöÑÂºÇÂ∏∏„ÄÇËøô‰∏™ÂºÇÂ∏∏‰ºö‰Ωø CPU <strong>Èô∑ÂÖ•ÔºàtrapÔºâ</strong> Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏„ÄÇÂÜÖÊ†∏ÁöÑÂºÇÂ∏∏Â§ÑÁêÜÂô®ÈöèÂç≥Êé•ÁÆ°ÔºåÂàÜÊûêÂºÇÂ∏∏ÂéüÂõ†ÔºåÂπ∂ÂêëÂºïÂèëÈóÆÈ¢òÁöÑËøõÁ®ãÂèëÈÄÅ‰∏Ä‰∏™ÁâπÂÆöÁöÑ<strong>‰ø°Âè∑ÔºàSignalÔºâ</strong>ÔºåÂú® Linux ‰∏äÈÄöÂ∏∏ÊòØ <strong><code>SIGSEGV</code>ÔºàÊÆµÈîôËØØÔºâ</strong>„ÄÇ</p>
<p>ÁÆÄÂçïÊù•ËØ¥ÔºåÈ°µ‰øùÊä§Êú∫Âà∂Â∞±ÂÉèÁªôÊØè‰∏™ÂÜÖÂ≠òÈ°µ‰∏ä‰∫Ü‰∏ÄÊääÈîÅ„ÄÇÂ¶ÇÊûú‰Ω†ÊúâÊ≠£Á°ÆÁöÑÊùÉÈôêÔºåÂ∞±ËÉΩËøõÂÖ•ÔºõÂ¶ÇÊûúÊ≤°ÊúâÔºåÂ∞±‰ºöÂºïÂèëÁ°¨‰ª∂ÂºÇÂ∏∏ÔºåÁî±Êìç‰ΩúÁ≥ªÁªüÂÜÖÊ†∏Êé•ÁÆ°ÔºåÂπ∂Âêë‰Ω†ÂèëÈÄÅ<code>SIGSEGV</code> ‰ø°Âè∑„ÄÇ</p>
<h4 id="openjdk-Â¶Ç‰ΩïÂà©Áî®Ëøô‰∏ÄÊú∫Âà∂">
    <a href="#openjdk-%e5%a6%82%e4%bd%95%e5%88%a9%e7%94%a8%e8%bf%99%e4%b8%80%e6%9c%ba%e5%88%b6" class="header-anchor">#</a>
    OpenJDK Â¶Ç‰ΩïÂà©Áî®Ëøô‰∏ÄÊú∫Âà∂
</h4><p>Safepoint ËΩÆËØ¢Êú∫Âà∂Èù¢‰∏¥ÁöÑÊåëÊàòÊòØÔºöÊ£ÄÊü•Êìç‰ΩúÂøÖÈ°ªÂú®<strong>ÊÄßËÉΩÂÖ≥ÈîÆË∑ØÂæÑ</strong>‰∏äÔºà‰æãÂ¶ÇÂæ™ÁéØ‰∏≠ÔºâÔºåÊâÄ‰ª•ÂÆÉÂøÖÈ°ªÊûÅÂ∫¶È´òÊïà„ÄÇÂ¶ÇÊûúÊØèÊ¨°ÈÉΩÁî® <code>if (should_stop) { ... }</code> ËøôÊ†∑ÁöÑÊù°‰ª∂ÂàÜÊîØÊù•Ê£ÄÊü•Ôºå‰ºöÂØπ CPU ÁöÑÊåá‰ª§ÊµÅÊ∞¥Á∫øÈÄ†ÊàêÂπ≤Êâ∞ÔºåÂΩ±ÂìçÊÄßËÉΩ„ÄÇ</p>
<p>OpenJDK ÁöÑÂÆûÁé∞Âè¶ËæüËπäÂæÑÔºåÂ∞ÜËΩØ‰ª∂Â±ÇÈù¢ÁöÑËΩÆËØ¢Ê£ÄÊü•ËΩ¨Êç¢‰∏∫‰∫Ü‰∏Ä‰∏™Á°¨‰ª∂Â±ÇÈù¢ÁöÑ‰∫ã‰ª∂„ÄÇÊàë‰ª¨ÂÜçÊù•Áúã OpenJDK ÁöÑÂÆûÁé∞Ôºö</p>
<p><img src="https://cdn.mazhen.tech/2024/202507151741351.png"
	
	
	
	loading="lazy"
	
		alt="Page Protection"
	
	
></p>
<ol>
<li>
<p><strong>ÂàùÂßãÂåñÔºöÂàõÂª∫ÁâπÊÆäÁöÑÂÜÖÂ≠òÈ°µ</strong></p>
<p>Âú® JVM ÂêØÂä®Êó∂ÔºåÂÆÉ‰ºöÈÄöËøáÁ≥ªÁªüË∞ÉÁî®ÂàÜÈÖç‰∏Ä‰∏™ÁâπÊÆäÁöÑÂÜÖÂ≠òÈ°µÔºåÊàë‰ª¨Áß∞‰πã‰∏∫<strong>ËΩÆËØ¢È°µÔºàPolling PageÔºâ</strong>„ÄÇËøô‰∏™È°µË¢´ËÆæÁΩÆ‰∏∫<strong>Ê≤°Êúâ‰ªª‰ΩïËÆøÈóÆÊùÉÈôê</strong>Ôºà<code>PROT_NONE</code>Ôºâ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Ê∫êÁ†ÅÁâáÊÆµ‰∏≠ÁöÑÈÄªËæë (SafepointMechanism.cpp)
</span></span></span><span class="line"><span class="cl"><span class="c1">// ÂàÜÈÖçÂÜÖÂ≠òÔºå‰∏ÄÈÉ®ÂàÜ‰Ωú‰∏∫ bad_pageÔºå‰∏ÄÈÉ®ÂàÜ‰Ωú‰∏∫ good_page
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">char</span><span class="o">*</span> <span class="n">polling_page</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">reserve_memory</span><span class="p">(</span><span class="n">allocation_size</span><span class="p">,</span> <span class="o">!</span><span class="n">ExecMem</span><span class="p">,</span> <span class="n">mtSafepoint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">char</span><span class="o">*</span> <span class="n">bad_page</span>  <span class="o">=</span> <span class="n">polling_page</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span><span class="o">*</span> <span class="n">good_page</span> <span class="o">=</span> <span class="n">polling_page</span> <span class="o">+</span> <span class="n">page_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">::</span><span class="n">protect_memory</span><span class="p">(</span><span class="n">bad_page</span><span class="p">,</span>  <span class="n">page_size</span><span class="p">,</span> <span class="n">os</span><span class="o">::</span><span class="n">MEM_PROT_NONE</span><span class="p">);</span> <span class="c1">// ÂÖ≥ÈîÆÔºÅËÆæÁΩÆ‰∏∫Êó†ÊùÉÈôê
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">os</span><span class="o">::</span><span class="n">protect_memory</span><span class="p">(</span><span class="n">good_page</span><span class="p">,</span> <span class="n">page_size</span><span class="p">,</span> <span class="n">os</span><span class="o">::</span><span class="n">MEM_PROT_READ</span><span class="p">);</span> <span class="c1">// ËÆæÁΩÆ‰∏∫ÂèØËØª
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªé‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏≠ÔºåÂèØ‰ª•ÁúãÂá∫ÔºåJVM ‰ºöÂàÜÈÖç‰∏§‰∏™Áõ∏ÈÇªÁöÑÈ°µÔºå‰∏Ä‰∏™Êó†ÊùÉÈôêÁöÑ <code>bad_page</code> Âíå‰∏Ä‰∏™ÊúâËØªÊùÉÈôêÁöÑ <code>good_page</code>ÔºåÈÄöËøáÂàáÊç¢Á∫øÁ®ãÊú¨Âú∞ÊåáÈíàÊù•ÊåáÂêëÂÖ∂‰∏≠‰∏Ä‰∏™„ÄÇ</p>
</li>
<li>
<p><strong>JIT ÁºñËØëÔºöÊèíÂÖ•ËΩÆËØ¢Êåá‰ª§</strong></p>
<p>ÂΩì JIT ÁºñËØëÁÉ≠ÁÇπ‰ª£Á†ÅÊó∂ÔºåÂÆÉ‰ºöÂú®ÈúÄË¶ÅËøõË°å Safepoint Ê£ÄÊü•ÁöÑÂú∞ÊñπÔºàÂ¶ÇÂæ™ÁéØÁöÑÂõûËæπ„ÄÅÊñπÊ≥ïËøîÂõûÂâçÔºâÊèíÂÖ•‰∏ÄÊù°ÈùûÂ∏∏ÁÆÄÂçïÁöÑ<strong>ÂÜÖÂ≠òËØªÂèñÊåá‰ª§</strong>„ÄÇ</p>
<p>Âú® x86 Ê±áÁºñ‰∏≠ÔºåËøôÊù°Êåá‰ª§ÁúãËµ∑Êù•ÂÉèËøôÊ†∑Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">test		dword ptr [r10], eax;   {poll}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÊù°Êåá‰ª§ÁöÑ‰ΩúÁî®ÊòØÂ∞ùËØï‰ªéÊüê‰∏™Âõ∫ÂÆöÁöÑËôöÊãüÂú∞ÂùÄÔºàËΩÆËØ¢È°µÁöÑÂú∞ÂùÄÔºâËØªÂèñÊï∞ÊçÆ„ÄÇ</p>
</li>
<li>
<p><strong>Ê≠£Â∏∏ÊâßË°åÔºàÂø´ÈÄüË∑ØÂæÑÔºâ</strong></p>
<p>Âú®ÁªùÂ§ßÂ§öÊï∞Êó∂Èó¥ÈáåÔºåJVM Âπ∂‰∏çÈúÄË¶ÅÁ∫øÁ®ãÊöÇÂÅú„ÄÇ</p>
<p>Ê≠§Êó∂ÔºåËôΩÁÑ∂ JIT ÁºñËØëÁöÑ‰ª£Á†Å‰∏≠ÂåÖÂê´‰∫ÜÂÜÖÂ≠òËØªÂèñÊåá‰ª§Ôºå‰ΩÜ <code>test</code> Êåá‰ª§Ë¶ÅËÆøÈóÆÁöÑÂÜÖÂ≠òÂú∞ÂùÄÊòØ<strong>‰∏Ä‰∏™ÂêàÊ≥ïÁöÑ„ÄÅÂèØËØªÁöÑÊôÆÈÄöÂÜÖÂ≠òÂú∞ÂùÄ</strong>Ôºà<code>good_page</code>Ôºâ„ÄÇÂõ†Ê≠§Ôºå<code>test</code> Êåá‰ª§ÊØèÊ¨°ÈÉΩËÉΩÊàêÂäüÊâßË°åÔºåÈÄüÂ∫¶ÊûÅÂø´ÔºåÂá†‰πé‰∏ç‰∫ßÁîü‰ªª‰ΩïÊÄßËÉΩÂºÄÈîÄÔºå‰πü‰∏ç‰ºöÂºïËµ∑ÂàÜÊîØÈ¢ÑÊµãÂ§±Ë¥•„ÄÇËøôÊòØ Safepoint Êú∫Âà∂ÊÄßËÉΩÂ¶ÇÊ≠§‰πãÈ´òÁöÑÂÖ≥ÈîÆ„ÄÇ</p>
</li>
<li>
<p>*<strong>ÂèëËµ∑ SafepointÔºàÊÖ¢ÈÄüË∑ØÂæÑÔºâ</strong></p>
<p>ÂΩì <code>VMThread</code> ÂÜ≥ÂÆöÂèëËµ∑‰∏ÄÊ¨°ÂÖ®Â±Ä Safepoint Êó∂ÔºåÂÆÉ‰ºöÊâßË°å‰∏Ä‰∏™ÂÖ≥ÈîÆÂä®‰ΩúÔºö<strong>Â∞ÜÊâÄÊúâÁ∫øÁ®ãÁöÑËΩÆËØ¢ÊåáÈíàÔºåÈÉΩ‰øÆÊîπ‰∏∫ÊåáÂêëÈÇ£‰∏™Ë¢´‰øùÊä§ÁöÑ„ÄÅÊùÉÈôê‰∏∫ <code>PROT_NONE</code> ÁöÑËΩÆËØ¢È°µÂú∞ÂùÄÔºà<code>bad_page</code>Ôºâ</strong>„ÄÇ</p>
</li>
<li>
<p><strong>Ëß¶Âèë‰∏éÂ§ÑÁêÜ</strong></p>
<p>Ê≠§ÂêéÔºå‰ªª‰Ωï‰∏Ä‰∏™Ê≠£Âú®ÊâßË°å JIT ‰ª£Á†ÅÁöÑÁ∫øÁ®ãÔºåÂΩìÂÆÉÂÜçÊ¨°ËøêË°åÂà∞ÈÇ£Êù° <code>test</code> ÂÜÖÂ≠òËØªÂèñÊåá‰ª§Êó∂ÔºåÂ∞±‰ºöËØïÂõæËÆøÈóÆ‰∏Ä‰∏™ <code>PROT_NONE</code> ÁöÑÂú∞ÂùÄ„ÄÇMMU Á´ãÂàªÊçïËé∑Âà∞ËøôÊ¨°ÈùûÊ≥ïËÆøÈóÆÔºåËß¶ÂèëÁ°¨‰ª∂ÂºÇÂ∏∏Ôºå‰ΩøÁ≥ªÁªüÈô∑ÂÖ•ÂÜÖÊ†∏ÔºåÂπ∂ÊúÄÁªàÁî±Êìç‰ΩúÁ≥ªÁªüÂêë JVM ËøõÁ®ãÂèëÈÄÅ <code>SIGSEGV</code> ‰ø°Âè∑„ÄÇ</p>
<p>JVM ÂÜÖÈÉ®È¢ÑÂÖàÊ≥®ÂÜå‰∫Ü‰∏Ä‰∏™<strong>Ëá™ÂÆö‰πâÁöÑ <code>SIGSEGV</code> ‰ø°Âè∑Â§ÑÁêÜÂô®</strong>„ÄÇÂΩìÂ§ÑÁêÜÂô®Ë¢´Ë∞ÉÁî®Êó∂ÔºåÂÆÉ‰ºöÊ£ÄÊü•ÂØºËá¥ÊÆµÈîôËØØÁöÑÂÜÖÂ≠òÂú∞ÂùÄ„ÄÇÂ¶ÇÊûúÂèëÁé∞Âú∞ÂùÄÊ≠£ÊòØÈÇ£‰∏™ÁâπÊÆäÁöÑËΩÆËØ¢È°µÔºåÂÆÉ‰æøÁü•ÈÅìËøôÂπ∂ÈùûÁ®ãÂ∫èÁº∫Èô∑ÔºåËÄåÊòØ‰∏Ä‰∏™È¢ÑÊúüÁöÑ Safepoint Ëß¶Âèë‰∫ã‰ª∂„ÄÇ‰∫éÊòØÔºåÂÆÉ‰ºöÂºïÂØºÂΩìÂâçÁ∫øÁ®ãÊâßË°å <code>SafepointSynchronize::block()</code> ËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅÔºåÁ≠âÂæÖ Safepoint ÁªìÊùü„ÄÇ</p>
</li>
</ol>
<p>ÈÄöËøáËøôÁßçÊñπÂºèÔºåOpenJDK Â∞Ü‰∏Ä‰∏™È¢ëÁπÅÁöÑËΩØ‰ª∂Ê£ÄÊü•ÔºåËΩ¨Êç¢Êàê‰∫Ü‰∏Ä‰∏™Âú®ÁªùÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÊó†ÂºÄÈîÄÁöÑÁ°¨‰ª∂Êìç‰ΩúÔºåÂè™Âú®ÈúÄË¶ÅÊó∂ÊâçÈÄöËøá‰∏Ä‰∏™ÂèØÊéßÁöÑÁ°¨‰ª∂ÂºÇÂ∏∏ËøõÂÖ•Â§ÑÁêÜÊµÅÁ®ã„ÄÇ</p>
<h3 id="ÂÖ∂‰ªñÂú∫ÊôØ‰∏ãÁöÑ-safepoint-Â§ÑÁêÜ">
    <a href="#%e5%85%b6%e4%bb%96%e5%9c%ba%e6%99%af%e4%b8%8b%e7%9a%84-safepoint-%e5%a4%84%e7%90%86" class="header-anchor">#</a>
    ÂÖ∂‰ªñÂú∫ÊôØ‰∏ãÁöÑ Safepoint Â§ÑÁêÜ
</h3><p>È°µ‰øùÊä§Êú∫Âà∂ÊòØ‰∏∫È´òÊÄßËÉΩ JIT ‰ª£Á†ÅÈáèË∫´ÂÆöÂà∂ÁöÑÊñπÊ°à„ÄÇÂØπ‰∫é‰ªçÂú®Ëß£ÈáäÂô®‰∏≠ËøêË°åÁöÑ‰ª£Á†ÅÔºåÊàñÊòØÂ∑≤ËøõÂÖ• JNI ÁöÑÁ∫øÁ®ãÔºåJVM ÈááÁî®‰∫Ü‰∏çÂêåÁöÑÂ§ÑÁêÜÊñπÂºè„ÄÇ</p>
<ul>
<li>
<p><strong>Ëß£ÈáäÂô®‰ª£Á†Å (Interpreted Code)</strong></p>
<p>Ëß£ÈáäÂô®ÁöÑÂ∑•‰ΩúÊ®°ÂºèÊòØÈÄêÊù°Âú∞ÁøªËØëÂíåÊâßË°åÂ≠óËäÇÁ†ÅÔºåÂÖ∂ÊÄßËÉΩÊó†Ê≥ï‰∏é JIT ÁºñËØëÂêéÁöÑ‰ª£Á†ÅÁõ∏ÊØî„ÄÇÂõ†Ê≠§ÔºåÂÆÉÈááÁî®‰∫ÜÊõ¥Áõ¥Êé•ÁöÑËΩÆËØ¢ÊñπÂºè„ÄÇ</p>
<p>ÂΩì Safepoint Ë¢´‚ÄúÊ≠¶Ë£Ö‚ÄùÊó∂ÔºåËß£ÈáäÂô®‰ºöÂàáÊç¢Âà∞‰∏Ä‰∏™<strong>Â§áÁî®ÁöÑÊ¥æÂèëË°®ÔºàDispatch TableÔºâ</strong>ÔºåËøô‰∏™Â§áÁî®Ë°®‰∏≠ÁöÑÂ≠óËäÇÁ†ÅÂÆûÁé∞ÔºåÂú®ÊâßË°åÂæ™ÁéØË∑≥ËΩ¨Á≠âÊåá‰ª§Êó∂Ôºå‰ºöÈ¢ùÂ§ñÂåÖÂê´‰∏ÄÊù°Áõ¥Êé•Ê£ÄÊü•Á∫øÁ®ãÊú¨Âú∞ Safepoint Ê†áÂøó‰ΩçÁöÑÊåá‰ª§„ÄÇËøôÁßçÊñπÂºèÈÅøÂÖç‰∫ÜÂ§çÊùÇÁöÑ‰ø°Âè∑Â§ÑÁêÜÔºåÂÆûÁé∞ÁÆÄÂçïÊòé‰∫Ü„ÄÇ</p>
</li>
<li>
<p><strong>ÂéüÁîü‰ª£Á†Å (Native Code / JNI)</strong></p>
<p>ÂΩì‰∏Ä‰∏™ Java Á∫øÁ®ãËøõÂÖ• JNI Ë∞ÉÁî®ÔºåÊâßË°åÂéüÁîü C/C++ ‰ª£Á†ÅÊó∂ÔºåÂÆÉÂ∑≤ÁªèËÑ±Á¶ª‰∫Ü JVM ÁöÑÁõ¥Êé•ÊéßÂà∂ÔºåËá™ÁÑ∂‰πüÊó†Ê≥ïËøõË°åËΩÆËØ¢„ÄÇÊ≠§Êó∂ÔºåJVM ‰ºöÂ∞ÜËøô‰∏™Á∫øÁ®ãÊ†áËÆ∞‰∏∫<strong>Ê≠£Âú®ÊâßË°åÂéüÁîü‰ª£Á†ÅÔºà_thread_in_nativeÔºâ</strong>„ÄÇ‰ªé JVM ÁöÑËßÜËßíÁúãÔºåËøô‰∏™Á∫øÁ®ãÁöÑ Java Ê†àÊòØÂõ∫ÂÆöÁöÑ„ÄÅÂÆâÂÖ®ÁöÑ„ÄÇ</p>
<p>ÂΩìËøô‰∏™Á∫øÁ®ãÊâßË°åÂÆåÂéüÁîü‰ª£Á†ÅÔºåÂáÜÂ§á<strong>ËøîÂõû Java ‰∏ñÁïå</strong>Êó∂ÔºåÂú®ËøáÊ∏°Èò∂ÊÆµÔºåÂÆÉ<strong>ÂøÖÈ°ªÊ£ÄÊü•</strong>ÂÖ®Â±ÄÁöÑ Safepoint Ê†áÂøó„ÄÇÂ¶ÇÊûúÊ≠§Êó∂ JVM Ê≠£Â§Ñ‰∫é‰∏Ä‰∏™ÂÖ®Â±Ä Safepoint ‰∏≠ÔºåËØ•Á∫øÁ®ã‰ºöË¢´ÊöÇÂÅúÂú®ËøîÂõûÁöÑÂÖ≥Âè£ÔºåÁõ¥Âà∞ Safepoint ÁªìÊùüÔºåÊâçËÉΩÂÆâÂÖ®Âú∞ÁªßÁª≠ÊâßË°å Java ‰ª£Á†Å„ÄÇ</p>
</li>
<li>
<p><strong>Â∑≤ÈòªÂ°ûÁöÑÁ∫øÁ®ã (Blocked Threads)</strong></p>
<p>ËøôÊòØÊúÄÁÆÄÂçïÁöÑ‰∏ÄÁßçÊÉÖÂÜµ„ÄÇÂØπ‰∫éÈÇ£‰∫õÂ∑≤ÁªèÂõ†‰∏∫ÈîÅÁ´û‰∫â„ÄÅÊâßË°å <code>Object.wait()</code>„ÄÅ<code>Thread.sleep()</code> ÊàñÈòªÂ°ûÂºè I/O ËÄåÂ§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅÁöÑÁ∫øÁ®ãÔºåÂÆÉ‰ª¨Êú¨Ë∫´Â∞±Â∑≤Áªè‚ÄúÈùôÊ≠¢‚Äù‰∫ÜÔºå‰∏ç‰ºöÂØπ JVM ÁöÑÂÖ®Â±ÄÊìç‰ΩúÊûÑÊàêÂ®ÅËÉÅ„ÄÇ</p>
<p>Âõ†Ê≠§ÔºåÂΩì VMThread Âú®ËøõË°åÂêåÊ≠•Êó∂Ôºå‰∏ÄÊó¶Ê£ÄÊµãÂà∞Êüê‰∏™Á∫øÁ®ãÂ§Ñ‰∫é <code>_thread_blocked</code> Áä∂ÊÄÅÔºåÂ∞±‰ºöÁõ¥Êé•Â∞ÜÂÖ∂ËßÜ‰∏∫Â∑≤ÂÆåÊàêÂêåÊ≠•ÔºåÊó†ÈúÄ‰ªª‰ΩïÈ¢ùÂ§ñÁöÑÊìç‰Ωú„ÄÇËøô‰∫õÁ∫øÁ®ãÂØπ TTSP ÁöÑË¥°ÁåÆÊó∂Èó¥‰∏∫Èõ∂„ÄÇ</p>
</li>
</ul>
<p>Ëá≥Ê≠§ÔºåOpenJDK ÈÄöËøá‰∏∫‰∏çÂêåÊâßË°åÊ®°ÂºèÈáèË∫´ÂÆöÂà∂ÁöÑÁ≠ñÁï•ÔºåÊûÑÂª∫‰∫Ü‰∏ÄÂ•óÂÆåÊï¥ËÄåÈ´òÊïàÁöÑ Safepoint Âçè‰ΩúÊú∫Âà∂„ÄÇ</p>
<h2 id="ÂÆûÊàòÁõëÊéß‰∏éÂàÜÊûêÂÆâÂÖ®ÁÇπ">
    <a href="#%e5%ae%9e%e6%88%98%e7%9b%91%e6%8e%a7%e4%b8%8e%e5%88%86%e6%9e%90%e5%ae%89%e5%85%a8%e7%82%b9" class="header-anchor">#</a>
    ÂÆûÊàòÔºöÁõëÊéß‰∏éÂàÜÊûêÂÆâÂÖ®ÁÇπ
</h2><p>‰∫ÜËß£‰∫Ü Safepoint ÁöÑÂ∑•‰ΩúÂéüÁêÜÂêéÔºåÊàë‰ª¨ÊúÄÂÖ≥ÂøÉÁöÑÈóÆÈ¢òÊòØÔºöÂ¶Ç‰ΩïÁü•ÈÅìÊàëËá™Â∑±ÁöÑÂ∫îÁî®Á®ãÂ∫è‰∏≠ Safepoint ÁöÑË°®Áé∞Â¶Ç‰ΩïÔºüÂÆÉÊòØÂê¶ÊòØÂØºËá¥ÊàëÁöÑÂ∫îÁî®Âç°È°øÁöÑÂÖÉÂá∂Ôºü</p>
<p>Âπ∏ËøêÁöÑÊòØÔºåOpenJDK Êèê‰æõ‰∫Ü‰∏Ä‰∏™Âº∫Â§ßÁöÑÂèÇÊï∞ÔºåËÆ©Êàë‰ª¨ËÉΩÊ∏ÖÊô∞Âú∞ÁúãÂà∞ÊØè‰∏ÄÊ¨° Safepoint Êìç‰ΩúÁöÑÁªÜËäÇ„ÄÇ</p>
<h3 id="-xlogsafepoint-ÂèÇÊï∞">
    <a href="#-xlogsafepoint-%e5%8f%82%e6%95%b0" class="header-anchor">#</a>
    <code>-Xlog:safepoint</code> ÂèÇÊï∞
</h3><p>Ë¶ÅÂºÄÂêØ Safepoint Êó•ÂøóÔºå‰Ω†ÈúÄË¶ÅÂú®ÂêØÂä® JVM Êó∂Ê∑ªÂä† <code>-Xlog</code> ÂèÇÊï∞ÔºåÂπ∂ÊåáÂÆö <code>safepoint</code> Ê†áÁ≠æÔºå‰æãÂ¶ÇÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-Xlog:safepoint:safepoint.log
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëøô‰∏™ÈÖçÁΩÆ‰ºö Safepoint Êó•ÂøóËæìÂá∫Âà∞ <code>safepoint.log</code> Êñá‰ª∂‰∏≠„ÄÇÂú® JDK 9 ‰πãÂâçÔºåÂèØ‰ª•‰ΩøÁî® <code>-XX:+PrintSafepoints</code> Âíå <code>-XX:+PrintGCApplicationStoppedTime</code> Ëøô‰∏§‰∏™ÂèÇÊï∞Êù•Ëé∑ÂèñÁ±ª‰ººÁöÑ‰ø°ÊÅØ„ÄÇ</p>
<h3 id="Êó•ÂøóËß£ËØª">
    <a href="#%e6%97%a5%e5%bf%97%e8%a7%a3%e8%af%bb" class="header-anchor">#</a>
    Êó•ÂøóËß£ËØª
</h3><p>ÂºÄÂêØÊó•ÂøóÂêéÔºå‰Ω†‰ºöÁúãÂà∞Á±ª‰ºº‰∏ãÈù¢ËøôÊ†∑ÁöÑËæìÂá∫„ÄÇÊàë‰ª¨Êù•ÈÄêÂàóËß£ËØªÂÖ∂‰∏≠ÁöÑÂÖ≥ÈîÆ‰ø°ÊÅØÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[5.745s][info][safepoint] Safepoint &#34;G1CollectForAllocation&#34;, Time since last: 21216960 ns, Reaching safepoint: 23275 ns, At safepoint: 3836938 ns, Total: 3900312 ns
</span></span><span class="line"><span class="cl">[8.713s][info][safepoint] Safepoint &#34;ThreadDump&#34;, Time since last: 128147238 ns, Reaching safepoint: 145843 ns, At safepoint: 572080 ns, Total: 802856 ns
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËÆ©Êàë‰ª¨‰ª•Á¨¨‰∏ÄÊù°Êó•Âøó‰∏∫‰æãÔºåÂàÜËß£ÂÆÉÁöÑÂê´‰πâÔºö</p>
<ul>
<li>
<p><strong><code>[5.745s]</code></strong>: <strong>Êó∂Èó¥Êà≥</strong>„ÄÇË°®Á§∫‰ªé JVM ÂêØÂä®Âà∞Ê≠§Ê¨° Safepoint Êìç‰ΩúÂºÄÂßãÁöÑÊó∂Èó¥ÁÇπ„ÄÇ</p>
</li>
<li>
<p><strong><code>Safepoint &quot;G1CollectForAllocation&quot;</code></strong>: <strong>Ëß¶ÂèëÂéüÂõ†</strong>„ÄÇËøôÊòØÊúÄÈáçË¶ÅÁöÑ‰ø°ÊÅØ‰πã‰∏ÄÔºåÂÆÉÂëäËØâÊàë‰ª¨ËøôÊ¨°ÂÖ®Â±ÄÊöÇÂÅúÊòØÁî±‰ªÄ‰πà‰∫ã‰ª∂ÂºïËµ∑ÁöÑ„ÄÇËøôÈáåÁöÑ <code>G1CollectForAllocation</code> ÊÑèÂë≥ÁùÄ G1 ÂûÉÂúæÊî∂ÈõÜÂô®Âõ†‰∏∫Â†ÜÂÜÖÂ≠òÂàÜÈÖçËØ∑Ê±ÇÊó†Ê≥ïÊª°Ë∂≥ËÄåËß¶Âèë‰∫Ü‰∏ÄÊ¨° Young GC„ÄÇÂú®Á¨¨‰∫åÊù°Êó•Âøó‰∏≠ÔºåÂéüÂõ†ÂàôÊòØ <code>ThreadDump</code>ÔºåËØ¥ÊòéÊòØÂ§ñÈÉ®Â∑•ÂÖ∑ËØ∑Ê±Ç‰∫ÜÁ∫øÁ®ãÂ†ÜÊ†àËΩ¨ÂÇ®„ÄÇ</p>
</li>
<li>
<p><strong><code>Time since last: 21216960 ns</code></strong>: <strong>Ë∑ùÁ¶ª‰∏äÊ¨°ÂÆâÂÖ®ÁÇπÁöÑÈó¥Èöî</strong>„ÄÇË°®Á§∫‰ªé‰∏ä‰∏Ä‰∏™ Safepoint ÁªìÊùüÂà∞Êú¨Ê¨°ÂºÄÂßãÔºåÂ∫îÁî®Á®ãÂ∫èËá™Áî±ËøêË°åÁöÑÊó∂Èó¥ÔºàÁ∫¶ 21.2 ÊØ´ÁßíÔºâ„ÄÇËøô‰∏™ÂÄºÂèçÊò†‰∫Ü Safepoint ÁöÑÂèëÁîüÈ¢ëÁéá„ÄÇ</p>
</li>
<li>
<p><strong><code>Reaching safepoint: 23275 ns</code></strong>: <strong>Âà∞ËææÂÆâÂÖ®ÁÇπËÄóÊó∂</strong>„ÄÇËøôÂ∞±ÊòØÊàë‰ª¨ÂèçÂ§çÂº∫Ë∞ÉÁöÑ <strong>TTSP</strong>„ÄÇËøôÈáåÊòØÁ∫¶ 23.3 ÂæÆÁßíÔºå‰∏Ä‰∏™ÈùûÂ∏∏ÂÅ•Â∫∑ÁöÑÂÄº„ÄÇÂÆÉË°®Á§∫‰ªé JVM ÂèëËµ∑ËØ∑Ê±ÇÂà∞ÊâÄÊúâÁ∫øÁ®ãÈÉΩÊöÇÂÅúÔºåÊÄªÂÖ±Ëä±‰∫ÜÂ§öÈïøÊó∂Èó¥„ÄÇ</p>
</li>
<li>
<p><strong><code>At safepoint: 3836938 ns</code></strong>: <strong>Âú®ÂÆâÂÖ®ÁÇπÂÜÖÊâßË°åÊìç‰ΩúÁöÑËÄóÊó∂</strong>„ÄÇËøôÊòØÁúüÊ≠£ÁöÑ‚ÄúStop-The-World‚ÄùÊó∂ÈïøÔºåÂç≥ VMThread ÊâßË°åÂÖ∂Ê†∏ÂøÉ‰ªªÂä°ÊâÄËä±ÁöÑÊó∂Èó¥„ÄÇËøôÈáåÊòØÁ∫¶ 3.8 ÊØ´Áßí„ÄÇ</p>
</li>
<li>
<p><strong><code>Total: 3900312 ns</code></strong>: <strong>ÊÄªÂÅúÈ°øÊó∂Èó¥</strong>„ÄÇÁ∫¶Á≠â‰∫é <code>Reaching safepoint</code> + <code>At safepoint</code> ÁöÑÊÄªÂíå„ÄÇËøôÊòØÂ∫îÁî®Á∫øÁ®ã‰ªéË¢´ËØ∑Ê±ÇÊöÇÂÅúÂà∞ÊúÄÁªàË¢´Âî§ÈÜíÊâÄÁªèÂéÜÁöÑÂÖ®ÈÉ®Êó∂Èó¥„ÄÇ</p>
</li>
</ul>
<h3 id="Â¶Ç‰ΩïÂÆö‰ΩçÈóÆÈ¢ò">
    <a href="#%e5%a6%82%e4%bd%95%e5%ae%9a%e4%bd%8d%e9%97%ae%e9%a2%98" class="header-anchor">#</a>
    Â¶Ç‰ΩïÂÆö‰ΩçÈóÆÈ¢ò
</h3><p>ÈÄöËøáÂàÜÊûêËøô‰ªΩÊó•ÂøóÔºåÊàë‰ª¨ÂèØ‰ª•Ê∏ÖÊô∞Âú∞ËØäÊñ≠Âá∫Â∫îÁî®ÁöÑÂÅúÈ°øÊ®°ÂºèÔºö</p>
<ol>
<li>
<p><strong>ÂÅúÈ°øÁöÑÂÖÉÂá∂ÊòØË∞ÅÔºü</strong></p>
<p>ËßÇÂØü <strong><code>Safepoint &quot;Cause&quot;</code></strong> Â≠óÊÆµ„ÄÇÂ¶ÇÊûúÂ§ßÈÉ®ÂàÜÂÅúÈ°øÈÉΩÁî± <code>G1CollectForAllocation</code> ÊàñÁ±ª‰ºº GC ÂéüÂõ†ÂºïËµ∑ÔºåËØ¥ÊòéÊÄßËÉΩÁì∂È¢àÂú®‰∫é<strong>ÂØπË±°ÂàÜÈÖçÈÄüÁéáËøáÈ´ò</strong>Êàñ<strong>Â†ÜÂÜÖÂ≠ò‰∏çË∂≥</strong>„ÄÇÂ¶ÇÊûúÁúãÂà∞ÂæàÂ§ö <code>Deoptimize</code> Êàñ <code>RevokeBias</code>ÔºåÂàôÂèØËÉΩÈúÄË¶ÅÂÖ≥Ê≥® JIT ÁºñËØëÊàñÈîÅÁ´û‰∫âÁöÑÈóÆÈ¢ò„ÄÇ</p>
</li>
<li>
<p><strong>ÊòØ TTSP ËøáÈïøÔºåËøòÊòØ VM Êìç‰ΩúÊú¨Ë∫´ËÄóÊó∂Ôºü</strong></p>
<p>ËøôÊòØÂàÜÊûêÁöÑÂÖ≥ÈîÆ„ÄÇÂØπÊØî <code>Reaching safepoint</code> Âíå <code>At safepoint</code> Ëøô‰∏§‰∏™ÂÄº„ÄÇ</p>
<ul>
<li>
<p>Â¶ÇÊûú <strong><code>At safepoint</code> ÂæàÂ§ß</strong>ÔºàÈÄöÂ∏∏ÊòØÊØ´ÁßíÁ∫ßÂà´ÔºâÔºåËØ¥ÊòéÊòØ VM Êìç‰ΩúÊú¨Ë∫´ÂæàËÄóÊó∂„ÄÇÊØîÂ¶Ç GC ËÄóÊó∂ÈïøÔºåÂ∞±Â∫îËØ•ÂéªË∞É‰ºò GC ÂèÇÊï∞ÊàñÂàÜÊûêÂÜÖÂ≠ò‰ΩøÁî®„ÄÇ</p>
</li>
<li>
<p>Â¶ÇÊûú <strong><code>Reaching safepoint</code> ÂæàÂ§ß</strong>ÔºàÊØîÂ¶Ç‰πüËææÂà∞‰∫ÜÊØ´ÁßíÁ∫ßÂà´ÔºâÔºåËøôÈÄöÂ∏∏ÊòØ‰∏Ä‰∏™Êõ¥Âç±Èô©ÁöÑ‰ø°Âè∑ÔºåËØ¥ÊòéÊúâÁ∫øÁ®ãËä±‰∫ÜÂæàÈïøÊó∂Èó¥ÊâçÂìçÂ∫îÊöÇÂÅúËØ∑Ê±Ç„ÄÇÊ≠§Êó∂Ôºå‰Ω†Â∫îËØ•ÂéªÊ£ÄÊü•‰ª£Á†Å‰∏≠ÊòØÂê¶Â≠òÂú®Ê≤°Êúâ Safepoint ËΩÆËØ¢ÁÇπÁöÑÈïøËÆ°ÁÆóÔºåÊàñËÄÖÊòØÂê¶Â≠òÂú®‰∏•ÈáçÁöÑ CPU ËµÑÊ∫ê‰∫âÊä¢„ÄÇ</p>
</li>
</ul>
</li>
</ol>
<p>‰ª•ÊñáÁ´†ÂºÄÂ§¥Êèê‰æõÁöÑÊó•Âøó‰∏∫‰æãÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÁªùÂ§ßÂ§öÊï∞ÂÅúÈ°øÈÉΩÊòØÁî± GC (<code>G1CollectForAllocation</code>, <code>G1PauseRemark</code> Á≠â) ÂºïËµ∑ÁöÑÔºåÂπ∂‰∏î <code>At safepoint</code> Êó∂Èó¥ËøúÂ§ß‰∫é <code>Reaching safepoint</code> Êó∂Èó¥„ÄÇËøôÊ∏ÖÊô∞Âú∞Ë°®ÊòéÔºåËØ•Â∫îÁî®ÁöÑÂÅúÈ°øÁì∂È¢àÂú®‰∫é GC Êìç‰ΩúÊú¨Ë∫´ÔºåËÄå‰∏çÊòØ TTSP„ÄÇ</p>
<p>ÊéåÊè°‰∫Ü Safepoint Êó•ÂøóÁöÑÂàÜÊûêÊñπÊ≥ïÔºå‰Ω†Â∞±Êã•Êúâ‰∫Ü‰∏ÄÊääÂº∫Â§ßÁöÑÊ≠¶Âô®ÔºåËÉΩÂ§üÊõ¥ÂÖ®Èù¢„ÄÅÊõ¥Ê∑±ÂÖ•Âú∞ËØäÊñ≠Âíå‰ºòÂåñ JVM ÁöÑÂÅúÈ°øÈóÆÈ¢ò„ÄÇ</p>
<h2 id="ÊÄªÁªì">
    <a href="#%e6%80%bb%e7%bb%93" class="header-anchor">#</a>
    ÊÄªÁªì
</h2><p>Â∏åÊúõÈÄöËøáÊú¨ÊñáÁöÑ‰ªãÁªçÔºå‰Ω†ËÉΩÂ§üÂª∫Á´ãËµ∑ÂÖ≥‰∫é Safepoint ÁöÑÂá†‰∏™Ê†∏ÂøÉËÆ§Áü•Ôºö</p>
<ul>
<li>
<p><strong>Safepoint ÊòØÊâÄÊúâ STW ÂÅúÈ°øÁöÑÂü∫Á°Ä</strong>„ÄÇÊàë‰ª¨Â∏∏ËØ¥ÁöÑ GC STWÔºåÂÖ∂Êú¨Ë¥®Â∞±ÊòØ‰∏ÄÊ¨°ÂÖ®Â±Ä Safepoint Êìç‰Ωú„ÄÇ‰ΩÜ GC Âè™ÊòØËß¶Âèë Safepoint ÁöÑ‰ºóÂ§ö‚ÄúÂÆ¢Êà∑‚Äù‰πã‰∏ÄÔºå‰ª£Á†ÅÂèç‰ºòÂåñ„ÄÅÁ∫øÁ®ãËΩ¨ÂÇ®Á≠âÂ§öÁßç VM Êìç‰ΩúÂêåÊ†∑‰æùËµñÂÆÉ„ÄÇ</p>
</li>
<li>
<p><strong>ËøôÊòØ‰∏ÄÁßç‚ÄúÂçè‰Ωú‚ÄùÔºåËÄåÈùû‚ÄúÂëΩ‰ª§‚Äù</strong>„ÄÇJVM Êó†Ê≥ïÂú®‰ªªÊÑèÊó∂ÂàªÂº∫Ë°å‰∏≠Êñ≠‰∏Ä‰∏™Ê≠£Âú®È´òÈÄüËøêË°åÁöÑÁ∫øÁ®ã„ÄÇÂÆÉÂøÖÈ°ª‰æùËµñÁ∫øÁ®ã‰∏ªÂä®Âú®È¢ÑËÆæÁöÑËΩÆËØ¢ÁÇπÊ£ÄÊü•Âπ∂Ëá™Ë°åÊöÇÂÅú„ÄÇËøôÁßçÂçè‰ΩúÂºèÊú∫Âà∂ÔºåÊòØ‰øùËØÅÊâÄÊúâÂÖ®Â±ÄÊìç‰ΩúÂÆâÂÖ®„ÄÅÊ≠£Á°ÆÁöÑÂâçÊèê„ÄÇ</p>
</li>
<li>
<p><strong>ÂÅúÈ°øÊó∂Èó¥Áî±‰∏§ÈÉ®ÂàÜÊûÑÊàê</strong>„ÄÇ‰∏ÄÊ¨°ÂÆåÊï¥ÁöÑ Safepoint ÂÅúÈ°øÔºåÂåÖÂê´‰∫ÜÊâÄÊúâÁ∫øÁ®ã<strong>Âà∞Ëææ Safepoint ÁöÑÊó∂Èó¥ÔºàTTSPÔºâ<strong>Âíå</strong>Âú® Safepoint ÂÜÖÊâßË°å VM Êìç‰ΩúÁöÑÊó∂Èó¥</strong>„ÄÇ‰ªÖ‰ªÖÂÖ≥Ê≥® GC Êó•ÂøóÈáåÁöÑÊìç‰ΩúËÄóÊó∂ÊòØ‰∏çÂ§üÁöÑÔºåË¢´ÂøΩÁï•ÁöÑ TTSP Â∏∏Â∏∏ÊòØÂØºËá¥Â∫îÁî®Âç°È°øÁöÑ‚ÄúÈöêÂΩ¢ÊùÄÊâã‚Äù„ÄÇ</p>
</li>
<li>
<p><strong>È´òÊïàÁöÑÂÆûÁé∞Ê∫ê‰∫éÂØπÂ∫ïÂ±ÇÁöÑÊ∑±ÂàªÁêÜËß£</strong>„ÄÇOpenJDK ÈÄöËøáÂ∑ßÂ¶ôÂú∞Âà©Áî®È°µ‰øùÊä§Âíå‰ø°Âè∑Â§ÑÁêÜÊú∫Âà∂Ôºå‰∏∫ JIT ÁºñËØë‰ª£Á†ÅÂÆûÁé∞‰∫ÜËøë‰πéÈõ∂ÂºÄÈîÄÁöÑËΩÆËØ¢ÔºåËøôÂÖÖÂàÜÂ±ïÁé∞‰∫ÜÁé∞‰ª£ËôöÊãüÊú∫Âú®ÊÄßËÉΩÂ∑•Á®ã‰∏äÁöÑÊô∫ÊÖß„ÄÇ</p>
</li>
</ul>
<p>ÊúÄÁªàÔºåÁêÜËß£ Safepoint Âπ∂‰∏çÂè™ÊòØ‰∏∫‰∫ÜÊª°Ë∂≥ÊäÄÊúØ‰∏äÁöÑÂ•ΩÂ•áÂøÉ„ÄÇÂÆÉ‰∏∫Êàë‰ª¨Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÂÖ®Êñ∞ÁöÑ„ÄÅÊõ¥Â∫ïÂ±ÇÁöÑËßÜËßíÊù•ÂÆ°ËßÜÂ∫îÁî®ÁöÑÊÄßËÉΩÈóÆÈ¢ò„ÄÇ‰∏ã‰∏ÄÊ¨°ÔºåÂΩì‰Ω†Èù¢ÂØπ‰∏Ä‰∏™Ê£òÊâãÁöÑÂª∂ËøüÊàñÊÄßËÉΩÊäñÂä®ÈóÆÈ¢òÔºåÂú®Ê∑±ÂÖ•ÂàÜÊûê‰∏öÂä°ÈÄªËæëÂíå GC Êó•Âøó‰πãÂ§ñÔºå‰∏çÂ¶®‰πüÂä†‰∏ä <code>-Xlog:safepoint</code>ÔºåÁúã‰∏ÄÁúãÈÇ£‰∫õÈöêËóèÂú®ÂπïÂêéÁöÑ‚ÄúÈõÜ‰ΩìÊöÇÂÅú‚ÄùÔºåÊàñËÆ∏ÔºåÈóÆÈ¢òÁöÑÁ≠îÊ°àÂ∞±ËóèÂú®ÂÖ∂‰∏≠„ÄÇ</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/java/">Java</a>
        
            <a href="/tags/linux/">Linux</a>
        
            <a href="/tags/performance/">Performance</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E7%90%86%E8%A7%A3-crac-%E8%83%8C%E5%90%8E%E7%9A%84-linux-%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/">
        
        

        <div class="article-details">
            <h2 class="article-title">ÁêÜËß£ CRaC ËÉåÂêéÁöÑ Linux Á≥ªÁªüÁºñÁ®ã</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/crac-%E6%8A%80%E6%9C%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/">
        
        

        <div class="article-details">
            <h2 class="article-title">CRaC ÊäÄÊúØÊ∑±Â∫¶Ëß£Êûê</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/perf-%E7%9A%84-cpu-clock-%E4%B8%8E-cpu-cycles-%E9%87%87%E6%A0%B7%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%AF%B9%E6%AF%94/">
        
        

        <div class="article-details">
            <h2 class="article-title">Perf ÁöÑ cpu-clock ‰∏é cpu-cycles ÈááÊ†∑ÂÆûÁé∞‰∏éÂØπÊØî</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/wall-clock-%E4%B8%8E-cpu-cycles-%E9%87%87%E6%A0%B7%E7%9A%84%E5%8C%BA%E5%88%AB/">
        
        

        <div class="article-details">
            <h2 class="article-title">Wall-Clock ‰∏é CPU-Cycles ÈááÊ†∑ÁöÑÂå∫Âà´</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%BD%BF%E7%94%A8-printassembly-%E6%9F%A5%E7%9C%8B-jit-%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81/">
        
        

        <div class="article-details">
            <h2 class="article-title">‰ΩøÁî® PrintAssembly Êü•Áúã JIT ÁºñËØëÂêéÁöÑÊ±áÁºñ‰ª£Á†Å</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mazhen-tech" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2014 - 
        
        2025 mazhen.tech
    </section>
    
    <section class="powerby">
        
            <a target=\"_blank\" href=\"https://beian.miit.gov.cn\">Á≤§ ICP Â§á 2022085181 Âè∑ -1</a> <br/>
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.25.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
