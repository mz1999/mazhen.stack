<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ç”¨æˆ·åœ¨è®¿é—®Kubernetesé›†ç¾¤çš„API serveræ—¶ï¼Œè®¿é—®è¯·æ±‚éœ€è¦ç»è¿‡èº«ä»½éªŒè¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶è¿™ä¸‰ä¸ªé˜¶æ®µçš„æ£€æŸ¥ï¼Œæ‰èƒ½çœŸæ­£åˆ°è¾¾APIæœåŠ¡ï¼Œ'>
<title>Kubernetesé›†ç¾¤çš„èº«ä»½éªŒè¯</title>

<link rel='canonical' href='https://mazhen.tech/p/kubernetes%E9%9B%86%E7%BE%A4%E7%9A%84%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='Kubernetesé›†ç¾¤çš„èº«ä»½éªŒè¯'>
<meta property='og:description' content='ç”¨æˆ·åœ¨è®¿é—®Kubernetesé›†ç¾¤çš„API serveræ—¶ï¼Œè®¿é—®è¯·æ±‚éœ€è¦ç»è¿‡èº«ä»½éªŒè¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶è¿™ä¸‰ä¸ªé˜¶æ®µçš„æ£€æŸ¥ï¼Œæ‰èƒ½çœŸæ­£åˆ°è¾¾APIæœåŠ¡ï¼Œ'>
<meta property='og:url' content='https://mazhen.tech/p/kubernetes%E9%9B%86%E7%BE%A4%E7%9A%84%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/'>
<meta property='og:site_name' content='mazhen.tech'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='kubernetes' /><meta property='article:tag' content='security' /><meta property='article:published_time' content='2019-05-19T09:46:53&#43;08:00'/><meta property='article:modified_time' content='2019-05-19T09:46:53&#43;08:00'/>
<meta name="twitter:site" content="@mazhen">
    <meta name="twitter:creator" content="@mazhen"><meta name="twitter:title" content="Kubernetesé›†ç¾¤çš„èº«ä»½éªŒè¯">
<meta name="twitter:description" content="ç”¨æˆ·åœ¨è®¿é—®Kubernetesé›†ç¾¤çš„API serveræ—¶ï¼Œè®¿é—®è¯·æ±‚éœ€è¦ç»è¿‡èº«ä»½éªŒè¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶è¿™ä¸‰ä¸ªé˜¶æ®µçš„æ£€æŸ¥ï¼Œæ‰èƒ½çœŸæ­£åˆ°è¾¾APIæœåŠ¡ï¼Œ">
    <link rel="shortcut icon" href="/favicon.png" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-LBEVB8TRX2"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LBEVB8TRX2', { 'anonymize_ip': false });
}
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/mazhen_hu6e56901738cd7f8ddabbbe3def51a5b4_111611_300x0_resize_q75_box.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">mazhen.tech</a></h1>
            <h2 class="site-description">Stay hungry. Stay foolish.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='mailto:me@mazhen.tech'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/mz1999'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.instagram.com/sword_holder/'
                        target="_blank"
                        title="instagram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="4" />
  <circle cx="12" cy="12" r="3" />
  <line x1="16.5" y1="7.5" x2="16.5" y2="7.501" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/sword_holder'
                        target="_blank"
                        title="telegram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/mazhen'
                        target="_blank"
                        title="twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://mazhen.tech/" selected>ä¸­æ–‡</option>
                        
                            <option value="https://mazhen.tech/en/" >English</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯">ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯</a>
      <ol>
        <li><a href="#ç†è§£æ•°å­—è¯ä¹¦">ç†è§£æ•°å­—è¯ä¹¦</a></li>
        <li><a href="#æ•°å­—è¯ä¹¦åœ¨kubernetesä¸­çš„åº”ç”¨">æ•°å­—è¯ä¹¦åœ¨Kubernetesä¸­çš„åº”ç”¨</a></li>
        <li><a href="#api-server-å¦‚ä½•ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯">API server å¦‚ä½•ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯</a></li>
      </ol>
    </li>
    <li><a href="#ä½¿ç”¨jwt-tokensè¿›è¡Œèº«ä»½éªŒè¯">ä½¿ç”¨<code>JWT Tokens</code>è¿›è¡Œèº«ä»½éªŒè¯</a></li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tech/" >
                tech
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/kubernetes%E9%9B%86%E7%BE%A4%E7%9A%84%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/">Kubernetesé›†ç¾¤çš„èº«ä»½éªŒè¯</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2019-05-19</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 16 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>ç”¨æˆ·åœ¨è®¿é—®<code>Kubernetes</code>é›†ç¾¤çš„<code>API server</code>æ—¶ï¼Œè®¿é—®è¯·æ±‚éœ€è¦ç»è¿‡èº«ä»½éªŒè¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶è¿™ä¸‰ä¸ªé˜¶æ®µçš„æ£€æŸ¥ï¼Œæ‰èƒ½çœŸæ­£åˆ°è¾¾<code>API</code>æœåŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://cdn.mazhen.tech/images/202209220949892.svg"
	
	
	
	loading="lazy"
	
		alt="access-control-overview"
	
	
></p>
<p><code>Kubernetes</code>ä¸­çš„ç”¨æˆ·æœ‰ä¸¤ç§ç±»å‹ï¼š<code>service accounts</code> å’Œ <code>normal users</code>ã€‚<code>service accounts</code> ç”± <code>Kubernetes</code>ç®¡ç†ï¼Œå®ƒæ˜¯<code>Pod</code>ä¸­çš„è¿›ç¨‹ç”¨äºè®¿é—®<code>API</code>æœåŠ¡çš„<code>account</code>ï¼Œä¸º<code>Pod</code>ä¸­çš„è¿›ç¨‹æä¾›äº†ä¸€ç§èº«ä»½æ ‡è¯†ã€‚<code>normal users</code>æ˜¯ç”±å¤–éƒ¨ç³»ç»Ÿç®¡ç†ï¼Œåœ¨<code>Kubernetes</code>ä¸­å¹¶æ²¡æœ‰å¯¹åº”çš„ <code>user</code> å¯¹è±¡ï¼Œå®ƒä¸ºäººç±»ç”¨æˆ·ä½¿ç”¨<code>kubectl</code>ä¹‹ç±»çš„å·¥å…·è®¿é—®<code>API</code>æœåŠ¡æ—¶æä¾›èº«ä»½æ ‡è¯†ã€‚æ‰€æœ‰ç”¨æˆ·ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ <code>kubectl</code>ã€å®¢æˆ·ç«¯libã€è¿˜æ˜¯ç›´æ¥å‘èµ·<code>REST</code>è¯·æ±‚è®¿é—®<code>API server</code>ï¼Œéƒ½éœ€è¦ç»è¿‡ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤çš„æ£€æŸ¥ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç»<code>Kubernetes</code>é›†ç¾¤çš„èº«ä»½éªŒè¯ï¼Œå³<code>Kubernetes</code>å¦‚ä½•ç¡®è®¤æ¥è®¿è€…çš„èº«ä»½ã€‚</p>
<p><code>Kubernetes</code>æ”¯æŒ<a class="link" href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/"  target="_blank" rel="noopener"
    >å¤šç§æ–¹å¼çš„èº«ä»½éªŒè¯</a>ï¼šå®¢æˆ·ç«¯è¯ä¹¦ï¼ŒPasswordï¼Œ Plain Tokensï¼ŒJWT(JSON Web Token)ï¼ŒHTTP basic authç­‰ã€‚ä½ å¯ä»¥åŒæ—¶å¯ç”¨å¤šç§è®¤è¯ï¼Œä¸€èˆ¬å»ºè®®è‡³å°‘ä½¿ç”¨ä¸¤ç§ï¼š</p>
<ul>
<li>ä¸ºéªŒè¯<code>normal users</code>èº«ä»½çš„å®¢æˆ·ç«¯è¯ä¹¦æ–¹å¼</li>
<li>ä¸ºéªŒè¯<code>Service accounts</code>èº«ä»½çš„ <code>JWT Tokens</code>æ–¹å¼</li>
</ul>
<h2 id="ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯">ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯</h2>
<h3 id="ç†è§£æ•°å­—è¯ä¹¦">ç†è§£æ•°å­—è¯ä¹¦</h3>
<p>éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯è¯ä¹¦çš„åŸºç¡€ã€‚æ•°å­—ç­¾åã€æ•°å­—è¯ä¹¦ç­‰ä¸€ç³»åˆ—æ¦‚å¿µæœ‰ç‚¹ç»•ï¼Œä½†åªè¦è®°ä½ï¼š<strong>å…¬é’¥ç”¨æ¥åŠ å¯†</strong>ï¼Œ<strong>ç§é’¥ç”¨æ¥ç­¾å</strong> å°±å¯ä»¥äº†ã€‚</p>
<p>æ€ä¹ˆç†è§£å‘¢ï¼Ÿå…¬é’¥å¯ä»¥éšæ„åˆ†å‘ï¼Œè°éƒ½å¯ä»¥æŒæœ‰ï¼Œå¦‚æœä½ ç”¨ç§é’¥åŠ å¯†ï¼Œä»»ä½•æŒæœ‰å¯¹åº”å…¬é’¥çš„äººéƒ½å¯ä»¥è§£å¯†ï¼Œè¿™æ ·åšå’Œæ²¡åŠ å¯†ä¸€æ ·ï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å…¬é’¥åŠ å¯†ï¼Œåªæœ‰æŒæœ‰ç§é’¥çš„é‚£ä¸ªäººæ‰èƒ½è§£å¯†ã€‚ç§é’¥ä¹‹æ‰€ä»¥ç§°ä¸ºç§é’¥ï¼Œä¸€å®šä¼šç§å¯†ä¿å­˜ï¼Œä¸ä¼šå‘å…¶ä»–äººæ³„æ¼ã€‚åŒæ—¶ï¼Œç”¨ç§é’¥åŠ å¯†è™½ç„¶æ²¡æœ‰æ„ä¹‰ï¼Œä½†å¦‚æœåˆ«äººç”¨å…¬é’¥è§£å¼€äº†ç§é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œå°±èƒ½å¤Ÿè¯æ˜ä¿¡æ¯æ˜¯ç”±ç§é’¥æŒæœ‰è€…å‘å‡ºçš„ï¼ŒéªŒè¯äº†ä¿¡æ¯å‘é€è€…çš„èº«ä»½ï¼Œè¿™å°±æ˜¯æ•°å­—ç­¾åã€‚</p>
<p>æ¯ä¸ªäººåˆ¶ä½œå¥½è‡ªå·±çš„å…¬é’¥å’Œç§é’¥ï¼Œç„¶åæŠŠå…¬é’¥å‘å¸ƒå‡ºå»ã€‚ä¸¤ä¸ªäººå¦‚æœéƒ½æœ‰å¯¹æ–¹çš„å…¬é’¥ï¼Œå°±å¯ä»¥ç”¨å¯¹æ–¹çš„å…¬é’¥ç»™å¯¹æ–¹å‘é€åŠ å¯†ä¿¡æ¯ï¼ŒåŒæ—¶é™„ä¸Šç”¨ç§é’¥åŠ å¯†çš„ä¿¡æ¯æ‘˜è¦ä½œä¸ºæ•°å­—ç­¾åï¼Œè¯æ˜æ¶ˆæ¯å‘é€è€…çš„èº«ä»½ã€‚</p>
<p>é€šè¿‡åŠ å¯†é˜²æ­¢äº†çªƒå¬é£é™©ï¼Œé€šè¿‡æ•°å­—ç­¾åé˜²æ­¢äº†å†’å……é£é™©ï¼Œæ•°å­—ç­¾åå†…çš„æ¶ˆæ¯æ‘˜è¦é˜²æ­¢äº†ç¯¡æ”¹é£é™©ï¼Œä¸€èµ·çœ‹ä¼¼å¾ˆå®Œç¾ã€‚</p>
<p>ç­‰ç­‰ï¼Œè¿™é‡Œæœ‰ä¸ªå¾ˆé‡è¦çš„é—®é¢˜è¢«å¿½ç•¥äº†ï¼šå¦‚ä½•å®‰å…¨çš„å°†å…¬é’¥å‘å¸ƒå‡ºå»ï¼Ÿå¦‚æœåŒæ–¹å¸Œæœ›å®‰å…¨é€šä¿¡ï¼Œæœ€å¥½å½“é¢äº¤æ¢å…¬é’¥ï¼Œä»¥å…è¢«åˆ«äººå†’å……ï¼Œå¹¶ä¸”è¦ä¿æŠ¤å¥½è‡ªå·±çš„ç”µè„‘ï¼Œé¿å…å…¬é’¥è¢«åˆ«æœ‰ç”¨å¿ƒçš„äººæ›¿æ¢ã€‚ç°å®ä¸­ä¸å¯èƒ½è¿™æ ·åˆ†å‘å…¬é’¥ï¼Œæ•ˆç‡å¤ªä½ï¼Œå‡ ä¹æ— æ³•å¤§è§„æ¨¡å®è¡Œã€‚äºæ˜¯å‡ºç°äº†<code>CA</code>(certificate authority)ï¼Œä¸ºå…¬é’¥åšè®¤è¯ã€‚<code>CA</code>ç”¨è‡ªå·±çš„ç§é’¥ï¼Œå¯¹ç”³è¯·ç”¨æˆ·çš„å…¬é’¥å’Œä¸€äº›èº«ä»½ä¿¡æ¯åŠ å¯†ï¼Œç”Ÿæˆ&quot;æ•°å­—è¯ä¹¦&quot;ï¼ˆDigital Certificateï¼‰ã€‚ä½ ç°åœ¨å¯ä»¥ç”¨ä»»ä½•æ–¹å¼å°†å†…å«å…¬é’¥çš„æ•°å­—è¯ä¹¦å‘å¸ƒå‡ºå»ï¼Œä¾‹å¦‚æœ‰å®¢æˆ·å‘èµ·è¯·æ±‚ï¼Œå¸Œæœ›ä»¥<code>HTTPS</code>çš„æ–¹å¼è®¿é—®ä½ çš„WEBæœåŠ¡ï¼Œä½ å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡å›å¤å®¢æˆ·çš„å“åº”ä¸­å¸¦ä¸Šæ•°å­—è¯ä¹¦ã€‚å®¢æˆ·æ‹¿åˆ°ä½ çš„æ•°å­—è¯ä¹¦ï¼Œç”¨<code>CA</code>çš„å…¬é’¥è§£å¼€æ•°å­—è¯ä¹¦ï¼Œå®‰å…¨çš„è·å¾—ä½ çš„å…¬é’¥ã€‚æœ‰äº†<code>CA</code>ä¸ºä½ çš„æ•°å­—è¯ä¹¦èƒŒä¹¦ï¼Œå®¢æˆ·å¯ä»¥ç¡®å®šä½ çš„èº«ä»½ï¼Œä¸æ˜¯æœ‰äººåœ¨å†’å……ä½ ã€‚</p>
<p>é‚£ä¹ˆ<code>CA</code>çš„å…¬é’¥å¦‚ä½•å®‰å…¨çš„åˆ†å‘å‘¢ï¼Ÿé¦–å…ˆï¼Œè¯ä¹¦çš„ç­¾å‘æ˜¯â€œé“¾â€å¼ç»“æ„ï¼Œç»™ä½ ç­¾å‘è¯ä¹¦çš„<code>CA</code>ï¼Œå®ƒçš„è¯ä¹¦å¯èƒ½è¿˜æ˜¯ç”±ä¸Šä¸€çº§<code>CA</code>æœºæ„ç­¾å‘çš„ï¼Œè¿™æ ·ä¸€ç›´å¾€ä¸Šè¿½æº¯ï¼Œæœ€ç»ˆä¼šåˆ°æŸä¸ªâ€œæ ¹è¯ä¹¦â€ã€‚å¦‚æœâ€œæ ¹è¯ä¹¦â€æ˜¯è¢«æˆ‘ä»¬ä¿¡ä»»çš„ï¼Œé‚£ä¹ˆæ•´æ¡â€œé“¾â€ä¸Šçš„è¯ä¹¦éƒ½å¯ä¿¡ã€‚</p>
<p><img src="https://cdn.mazhen.tech/images/202209220949566.png"
	
	
	
	loading="lazy"
	
		alt="certificates in a chain"
	
	
></p>
<p>å…¶æ¬¡ï¼Œæ“ä½œç³»ç»Ÿéƒ½å†…ç½®äº†â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦â€ã€‚æˆ‘ä»¬æ‹¿åˆ°æŸä¸ªè¯ä¹¦ï¼Œå¦‚æœå®ƒçš„æ ¹è¯ä¹¦åœ¨ç³»ç»Ÿçš„â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦â€åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯ä¹¦å°±æ˜¯å¯ä¿¡çš„ã€‚ä¾‹å¦‚çŸ¥ä¹çš„è¯ä¹¦ï¼š</p>
<p><img src="https://cdn.mazhen.tech/images/202209220950113.png"
	
	
	
	loading="lazy"
	
		alt="zhihu crt"
	
	
></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒçš„æ ¹è¯ä¹¦æ˜¯<a class="link" href="https://www.digicert.com/digicert-root-certificates.htm"  target="_blank" rel="noopener"
    >DigiCert Global Root CA</a>ï¼Œåœ¨æ“ä½œç³»ç»Ÿçš„â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦â€åˆ—è¡¨ä¸­èƒ½æ‰¾åˆ°å®ƒï¼š</p>
<p><img src="https://cdn.mazhen.tech/images/202209220950931.png"
	
	
	
	loading="lazy"
	
		alt="root ca"
	
	
></p>
<p>æ ¹è¯ä¹¦æ˜¯é€šè¿‡é¢„è£…çš„æ–¹å¼å®Œæˆçš„åˆ†å‘ï¼Œå› æ­¤å®‰è£…æ¥æºä¸æ˜çš„æ“ä½œç³»ç»Ÿæœ‰é£é™©ï¼Œå¯èƒ½æ½œä¼äº†éæ³•çš„æ ¹è¯ä¹¦ã€‚ä¸€æ—¦è¢«æ¤å…¥äº†éæ³•çš„æ ¹è¯ä¹¦ï¼Œä¸€æ•´å¥—çš„å®‰å…¨ä½“ç³»ç¬é—´åœŸå´©ç“¦è§£ã€‚åŒæ—¶ï¼Œä¸èƒ½éšæ„å‘ç³»ç»Ÿä¸­æ·»åŠ å¯ä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œä½ å¾ˆéš¾éªŒè¯æ ¹è¯ä¹¦çš„çœŸä¼ªï¼Œå®ƒå·²ç»æ˜¯rootï¼Œæ²¡äººèƒ½ä¸ºå®ƒåšèƒŒä¹¦äº†ã€‚12306ç½‘ç«™æ—©æœŸçš„æ ¹è¯ä¹¦å°±ä¸åœ¨æ“ä½œç³»ç»Ÿçš„â€œå—ä¿¡ä»»æ ¹è¯ä¹¦â€åˆ—è¡¨ä¸­ï¼Œéœ€è¦ç”¨æˆ·æ‰‹å·¥å®‰è£…ï¼Œåœ¨ç½‘ä¸Š<a class="link" href="https://www.williamlong.info/archives/3461.html"  target="_blank" rel="noopener"
    >å¼•èµ·è½©ç„¶å¤§æ³¢</a>ã€‚æœ€ç»ˆ12306åœ¨17å¹´åº•çš„æ—¶å€™æ¢æˆäº†Digicertçš„è¯ä¹¦ã€‚</p>
<p>ç®€å•æ€»ç»“ä¸€ä¸‹åŸºäºéå¯¹ç§°åŠ å¯†ç®—æ³•çš„å…¬é’¥/ç§é’¥ä½“ç³»ï¼Œ<strong>å…¬é’¥ç”¨æ¥åŠ å¯†</strong>ï¼Œ<strong>ç§é’¥ç”¨æ¥ç­¾å</strong>ï¼Œ<strong>å¼•å…¥<code>CA</code>ä¿è¯å…¬é’¥çš„å®‰å…¨åˆ†å‘</strong>ã€‚ä½ å¯ä»¥æ‰¾<code>CA</code>ç­¾å‘æ•°å­—è¯ä¹¦ï¼Œé‚£ä¹ˆä½ çš„å®¢æˆ·å°±å¯ä»¥æ ¹æ®æœ¬åœ°â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦â€éªŒè¯ä½ çš„æ•°å­—è¯ä¹¦ï¼Œä»è€Œç¡®è®¤ä½ çš„èº«ä»½ï¼Œç„¶åç”¨è¯ä¹¦å†…åŒ…å«çš„å…¬é’¥ç»™ä½ å‘åŠ å¯†çš„ä¿¡æ¯ã€‚åŒæ ·ï¼Œä½ ä¹Ÿå¯ä»¥è¦æ±‚å¯¹æ–¹çš„æ•°å­—è¯ä¹¦ï¼Œä»¥ä¾¿ç¡®è®¤å¯¹æ–¹çš„èº«ä»½ï¼Œå¹¶ç»™ä»–å›åŠ å¯†çš„ä¿¡æ¯ã€‚</p>
<p>ç†è§£äº†æ•°å­—è¯ä¹¦çš„åŸºæœ¬åŸç†ï¼Œæˆ‘ä»¬å†çœ‹çœ‹<code>Kubernetes</code>ä¸­å¦‚ä½•ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<h3 id="æ•°å­—è¯ä¹¦åœ¨kubernetesä¸­çš„åº”ç”¨">æ•°å­—è¯ä¹¦åœ¨Kubernetesä¸­çš„åº”ç”¨</h3>
<p><code>Kubernetes</code>å„ç»„ä»¶ä¹‹é—´çš„é€šä¿¡éƒ½æ˜¯åŸºäº<code>TLS</code>ï¼Œå®ç°æœåŠ¡çš„åŠ å¯†è®¿é—®ï¼ŒåŒæ—¶æ”¯æŒåŸºäºè¯ä¹¦çš„åŒå‘è®¤è¯ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ­å»ºç§æœ‰<code>Kubernetes</code>é›†ç¾¤æ—¶ï¼Œä¸€èˆ¬æ˜¯è‡ªå»º<code>root CA</code>ï¼Œå› ä¸ºå‚ä¸è®¤è¯çš„æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬è¿œç¨‹è®¿é—®é›†ç¾¤çš„å®¢æˆ·ç«¯æ¡Œé¢éƒ½å®Œå…¨ç”±è‡ªå·±æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨çš„å°†æ ¹è¯ä¹¦åˆ†å‘åˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚æœ‰äº†<code>CA</code>ï¼Œæˆ‘ä»¬å†ç”¨<code>CA</code>çš„ç§é’¥/å…¬é’¥ä¸ºå„ä¸ªç»„ä»¶ç­¾å‘æ‰€éœ€çš„è¯ä¹¦ã€‚</p>
<p><code>CA</code>çš„åˆ›å»ºï¼Œä»¥åŠä¸€ç³»åˆ—å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯è¯ä¹¦çš„ç­¾å‘ï¼Œå®é™…ä¸Šæ˜¯å»ºç«‹äº†<code>Kubernetes</code>é›†ç¾¤çš„<a class="link" href="https://en.wikipedia.org/wiki/Public_key_infrastructure"  target="_blank" rel="noopener"
    >PKI(Public key infrastructure)</a>ã€‚</p>
<p><code>Kubernetes</code>ä¸­çš„ç»„ä»¶æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥éœ€è¦çš„è¯ä¹¦ä¼šéå¸¸å¤šï¼Œ<a class="link" href="https://kubernetes.io/docs/setup/certificates/"  target="_blank" rel="noopener"
    >è¿™ç¯‡æ–‡æ¡£</a>åšäº†ä»‹ç»ã€‚æˆ‘æŒ‰è¯ä¹¦çš„ç”¨é€”å½’ç±»æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li><code>CA</code>è¯ä¹¦
<ul>
<li><code>Kubernetes</code> ä¸€èˆ¬ç”¨é€”</li>
<li><code>etcd</code> é›†ç¾¤æ ¹è¯ä¹¦</li>
<li><a class="link" href="https://kubernetes.io/docs/tasks/access-kubernetes-api/configure-aggregation-layer/"  target="_blank" rel="noopener"
    >aggregation ç›¸å…³åŠŸèƒ½</a></li>
</ul>
</li>
<li>æœåŠ¡ç«¯è¯ä¹¦
<ul>
<li><code>API server</code></li>
<li><code>etcd</code></li>
<li><code>kubelet</code></li>
</ul>
</li>
<li>è®¿é—®<code>API server</code>æ—¶è¿›è¡Œèº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯è¯ä¹¦
<ul>
<li><code>kubelet</code>ã€€ã€€ã€€ã€€ã€€ã€€-&gt; <code>API server</code></li>
<li><code>controller-manager</code> -&gt; <code>API server</code></li>
<li><code>kube-scheduler</code> ã€€ã€€-&gt; <code>API server</code></li>
<li><code>admin</code>ç”¨æˆ·ã€€ã€€ã€€ã€€ã€€-&gt; <code>API server</code></li>
</ul>
</li>
<li><code>API server</code> è®¿é—®å…¶ä»–ç»„ä»¶æ—¶è¿›è¡Œèº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯è¯ä¹¦
<ul>
<li><code>API server</code> -&gt; <code>etcd</code></li>
<li><code>API server</code> -&gt; <code>kubelet</code></li>
<li><code>API server</code> -&gt; <code>aggregated API server</code></li>
</ul>
</li>
<li><code>etcd</code> ç›¸å…³åŠŸèƒ½
<ul>
<li><code>etcd</code> é›†ç¾¤ä¸­èŠ‚ç‚¹äº’ç›¸é€šä¿¡ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦</li>
<li>å¦‚æœ<code>etcd</code>æ˜¯ä»¥Podæ–¹å¼è¿è¡Œï¼Œé’ˆå¯¹<code>etcd</code>çš„ Liveness éœ€è¦çš„å®¢æˆ·ç«¯è¯ä¹¦</li>
</ul>
</li>
<li><code>Service accounts</code> ç§é’¥/å…¬é’¥å¯¹ï¼Œç”¨äºç”Ÿæˆ<code>Service accounts</code>èº«ä»½éªŒè¯çš„ <code>JWT Tokens</code></li>
</ul>
<p>æœ€åä¸€ä¸ªä¸æ˜¯è¯ä¹¦ï¼Œä¸è¿‡ä¹Ÿåœ¨<code>Kubernetes PKI</code>çš„ç®¡ç†èŒƒå›´ã€‚å…³äº<code>Service accounts</code> ç§é’¥/å…¬é’¥å¯¹çš„ä½œç”¨ï¼Œåé¢ä¼šè®²åˆ°ã€‚</p>
<p>ç†è®ºä¸Š<code>CA</code>æ ¹è¯ä¹¦å¯ä»¥åªä½¿ç”¨ä¸€ä¸ªï¼Œä¸è¿‡ä¸ºäº†å®‰å…¨å’Œæ–¹ä¾¿ç®¡ç†ï¼Œå®˜æ–¹å¼ºè°ƒåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡æœ€å¥½ä½¿ç”¨ä¸åŒçš„<code>CA</code>ï¼š</p>
<blockquote>
<p><strong>Warning</strong>: Do not reuse a CA that is used in a different context unless you understand the risks and the mechanisms to protect the CAâ€™s usage.</p>
</blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>API server</code>æ˜¯æ ¸å¿ƒç»„ä»¶ï¼Œå…¶ä»–ç»„ä»¶ã€åŒ…æ‹¬adminç”¨æˆ·å¯¹å®ƒçš„è®¿é—®éƒ½éœ€è¦<code>TLS</code>åŒå‘è®¤è¯ï¼Œæ‰€ä»¥ä¼šæœ‰<code>API server</code>çš„æœåŠ¡ç«¯è¯ä¹¦å’Œå„ä¸ªç»„ä»¶çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚<code>API server</code>ä½œä¸ºå®¢æˆ·ç«¯éœ€è¦è®¿é—®<code>etcd</code>ã€<code>kubelet</code>å’Œ<code>aggregated API server</code>ï¼Œæ‰€ä»¥ä¹Ÿä¼šæœ‰ç›¸åº”çš„æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯è¯ä¹¦ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨<code>kubeadm</code>å®‰è£…<code>Kubernetes</code>æ—¶ï¼Œ<code>kubeadm</code>ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆä¸Šè¿°çš„ä¸€ç³»åˆ—ç§é’¥å’Œè¯ä¹¦ï¼Œæ”¾åœ¨<code>/etc/kubernetes/</code>ç›®å½•ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># tree --dirsfirst /etc/kubernetes/
</span></span><span class="line"><span class="cl">/etc/kubernetes/
</span></span><span class="line"><span class="cl">â”œâ”€â”€ manifests                         ç»„ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œä»¥Podæ–¹å¼è¿è¡Œåœ¨é›†ç¾¤ä¸­
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ etcd.yaml
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ kube-apiserver.yaml
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ kube-controller-manager.yaml  
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ kube-scheduler.yaml           
</span></span><span class="line"><span class="cl">â”œâ”€â”€ pki                               
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ etcd                          
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ ca.crt                    etcd é›†ç¾¤CAè¯ä¹¦
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ ca.key                    etcd é›†ç¾¤CAç§é’¥
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ healthcheck-client.crt    Liveness å¥åº·æ£€æŸ¥ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ healthcheck-client.key
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ peer.crt                  etcdèŠ‚ç‚¹é—´é€šä¿¡ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ peer.key                  
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ server.crt                etcdæœåŠ¡ç«¯è¯ä¹¦
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ server.key
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ apiserver.crt                 API Server æœåŠ¡ç«¯è¯ä¹¦
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ apiserver.key
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ apiserver-etcd-client.crt     API server -&gt; etcd
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ apiserver-etcd-client.key
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ apiserver-kubelet-client.crt  API server -&gt; kubelet
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ apiserver-kubelet-client.key
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ca.crt                        CAè¯ä¹¦
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ca.key                        CAç§é’¥
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ front-proxy-ca.crt            aggregation ç›¸å…³åŠŸèƒ½CAè¯ä¹¦
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ front-proxy-ca.key            aggregation ç›¸å…³åŠŸèƒ½CAç§é’¥
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ front-proxy-client.crt        API server -&gt; aggregated API server
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ front-proxy-client.key
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ sa.key                        Service accounts ç§é’¥
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ sa.pub                        Service accounts å…¬é’¥
</span></span><span class="line"><span class="cl">â”œâ”€â”€ admin.conf                        admin              -&gt; API server 
</span></span><span class="line"><span class="cl">â”œâ”€â”€ controller-manager.conf           controller-manager -&gt; API server 
</span></span><span class="line"><span class="cl">â”œâ”€â”€ kubelet.conf                      kubeletã€€ã€€ã€€ã€€ã€€ã€€  -&gt; API server 
</span></span><span class="line"><span class="cl">â””â”€â”€ scheduler.conf                    kube-scheduler     -&gt; API server 
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œæœ€åå››ä¸ª<code>*.conf</code>æ˜¯<a class="link" href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/"  target="_blank" rel="noopener"
    >kubeconfig file</a>ï¼Œå†…å®¹åŒ…å«äº†é›†ç¾¤ã€ç”¨æˆ·ã€namespaceç­‰ä¿¡æ¯ï¼Œè¿˜æœ‰ç”¨æ¥è®¤è¯çš„CAè¯ä¹¦ã€å®¢æˆ·ç«¯è¯ä¹¦å’Œç§é’¥ã€‚ä¾‹å¦‚<code>admin.conf</code>å°±æ˜¯<code>kubectl</code>è®¿é—®é›†ç¾¤ç”¨åˆ°çš„<code>kubeconfig file</code>ï¼Œç¼ºçœæƒ…å†µä¸‹<code>kubectl</code>ä¼šä½¿ç”¨<code>$HOME/.kube/config</code>ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡<code>KUBECONFIG</code>ç¯å¢ƒå˜é‡ï¼Œæˆ–<code>kubectl</code> çš„ <code>--kubeconfig</code> å‚æ•°è¿›è¡Œè®¾ç½®ã€‚</p>
<p><code>kubelet</code>è¿è¡Œåœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ï¼Œæ— æ³•æå‰é¢„çŸ¥ <code>node</code> çš„ <code>IP</code> ä¿¡æ¯ï¼Œæ‰€ä»¥ <code>kubelet</code> ä¸€èˆ¬ä¸ä¼šæ˜ç¡®æŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦, è€Œæ˜¯åªæŒ‡å®š <code>CA</code> æ ¹è¯ä¹¦, è®© <code>kubelet</code> æ ¹æ®æœ¬æœºä¿¡æ¯è‡ªåŠ¨ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ï¼Œä¿å­˜åˆ°é…ç½®å‚æ•°æŒ‡å®šçš„<a class="link" href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/"  target="_blank" rel="noopener"
    >&ndash;cert-dir</a>ç›®å½•ä¸­ã€‚<code>cert-dir</code>çš„ç¼ºçœå€¼æ˜¯<code>/var/lib/kubelet/pki</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1"># tree /var/lib/kubelet/pki</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kubelet</span><span class="o">/</span><span class="n">pki</span>
</span></span><span class="line"><span class="cl"><span class="err">â”œâ”€â”€</span> <span class="n">kubelet</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="mi">2019</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">28</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">48</span><span class="o">-</span><span class="mf">13.</span><span class="n">pem</span>
</span></span><span class="line"><span class="cl"><span class="err">â”œâ”€â”€</span> <span class="n">kubelet</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">current</span><span class="o">.</span><span class="n">pem</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kubelet</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">kubelet</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="mi">2019</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">28</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">48</span><span class="o">-</span><span class="mf">13.</span><span class="n">pem</span>
</span></span><span class="line"><span class="cl"><span class="err">â”œâ”€â”€</span> <span class="n">kubelet</span><span class="o">.</span><span class="n">crt</span>   <span class="n">kubeletæœåŠ¡ç«¯è¯ä¹¦</span>
</span></span><span class="line"><span class="cl"><span class="err">â””â”€â”€</span> <span class="n">kubelet</span><span class="o">.</span><span class="n">key</span>   <span class="n">kubeletæœåŠ¡ç«¯ç§é’¥</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦å¤–ï¼Œ<code>API server</code>æœ‰å¾ˆå¤šè®¤è¯ç›¸å…³çš„<a class="link" href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/#options"  target="_blank" rel="noopener"
    >å¯åŠ¨å‚æ•°</a>ï¼Œå‚æ•°åç§°è®©äººå®¹æ˜“æ··æ·†ï¼Œæœ‰äººè¿˜ä¸“é—¨æäº†<a class="link" href="https://github.com/kubernetes/kubernetes/issues/54665"  target="_blank" rel="noopener"
    >issue</a>ï¼Œ<a class="link" href="https://github.com/kubernetes/kubernetes/issues/54665#issuecomment-340960398"  target="_blank" rel="noopener"
    >è¿™ä¸ªå›ç­”</a>æ ¹æ®ç”¨é€”å¯¹è¿™äº›å‚æ•°è¿›è¡Œäº†åˆ†ç±»ï¼Œè¯´æ˜çš„éå¸¸æ¸…æ™°ã€‚</p>
<h3 id="api-server-å¦‚ä½•ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯">API server å¦‚ä½•ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯</h3>
<p>å‰é¢æåˆ°ï¼Œå½“ç”¨æˆ·ä½¿ç”¨<code>kubectl</code>è®¿é—®<code>API server</code>æ—¶ï¼Œéœ€è¦ä»¥æŸç§æ–¹å¼è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæœ€å¸¸ç”¨çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦ã€‚<code>Kubernetes</code>æ˜¯æ²¡æœ‰ <code>user</code> è¿™ç§ API å¯¹è±¡ï¼Œ<code>kubectl</code>çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯å°±åŒ…å«åœ¨å®¢æˆ·ç«¯è¯ä¹¦ä¸­ã€‚<code>API server</code>éªŒè¯äº†å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä¹Ÿå°±å¯ä»¥ä»è¯ä¹¦ä¸­è·å¾—ç”¨æˆ·åå’Œæ‰€å±çš„<code>group</code>ã€‚</p>
<p>æˆ‘ä»¬ä»¥<code>/etc/kubernetes/admin.conf</code> ä¸ºä¾‹ï¼Œçœ‹çœ‹å®¢æˆ·ç«¯è¯ä¹¦ä¸­æä¾›äº†é‚£äº›ä¿¡æ¯ã€‚</p>
<p>å…ˆæŸ¥çœ‹<code>admin.conf</code>æ–‡ä»¶çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl --kubeconfig /etc/kubernetes/admin.conf  config view
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">clusters:
</span></span><span class="line"><span class="cl">- cluster:
</span></span><span class="line"><span class="cl">    certificate-authority-data: DATA+OMITTED
</span></span><span class="line"><span class="cl">    server: https://172.18.100.90:6443
</span></span><span class="line"><span class="cl">  name: test
</span></span><span class="line"><span class="cl">contexts:
</span></span><span class="line"><span class="cl">- context:
</span></span><span class="line"><span class="cl">    cluster: test
</span></span><span class="line"><span class="cl">    user: kubernetes-admin
</span></span><span class="line"><span class="cl">  name: kubernetes-admin@test
</span></span><span class="line"><span class="cl">current-context: kubernetes-admin@test
</span></span><span class="line"><span class="cl">kind: Config
</span></span><span class="line"><span class="cl">preferences: {}
</span></span><span class="line"><span class="cl">users:
</span></span><span class="line"><span class="cl">- name: kubernetes-admin
</span></span><span class="line"><span class="cl">  user:
</span></span><span class="line"><span class="cl">    client-certificate-data: REDACTED
</span></span><span class="line"><span class="cl">    client-key-data: REDACTED
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªæ–‡ä»¶æä¾›äº†<code>API server</code>çš„åœ°å€ï¼Œä»¥åŠèº«ä»½éªŒè¯ç”¨åˆ°çš„è¯ä¹¦ï¼š</p>
<ul>
<li><code>certificate-authority-data</code> ï¼šCAè¯ä¹¦</li>
<li><code>client-certificate-data</code> ï¼šå®¢æˆ·ç«¯è¯ä¹¦</li>
<li><code>client-key-data</code>ï¼š å®¢æˆ·ç«¯ç§é’¥</li>
</ul>
<p>å®¢æˆ·ç«¯è¯ä¹¦æ˜¯ä»¥<code>base64</code>ç¼–ç çš„æ–¹å¼ä¿å­˜åœ¨<code>client-certificate-data</code>å­—æ®µä¸­ï¼Œæˆ‘ä»¬å°†è¯ä¹¦æå–å‡ºæ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># cat /etc/kubernetes/admin.conf | grep client-certificate-data | cut -d &#34; &#34; -f 6 | base64 -d &gt; admin.crt
</span></span><span class="line"><span class="cl"># cat admin.crt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">MIIC8jCCAdqgAwIBAgIIaBuxevPYGaswDQYJKoZIhvcNAQELBQAwFTETMBEGA1UE
</span></span><span class="line"><span class="cl">AxMKa3ViZXJuZXRlczAeFw0xOTA0MjgwMjQwMDBaFw0yMDA0MjcwMjQwMDNaMDQx
</span></span><span class="line"><span class="cl">FzAVBgNVBAoTDnN5c3RlbTptYXN0ZXJzMRkwFwYDVQQDExBrdWJlcm5ldGVzLWFk
</span></span><span class="line"><span class="cl">bWluMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvRTIQ4YEMh0mUWKP
</span></span><span class="line"><span class="cl">17pLdUocgZMLVCK6tYmj0DJIihRk+wKvNzYSStfxsug9nnEqVVzmbW5/UxER776H
</span></span><span class="line"><span class="cl">844y/1NGk/8LsDIkFGspf3cEmQ8OE8TlLNW7h9gWIGymLQ/K1qhYfNOPDYoJXPix
</span></span><span class="line"><span class="cl">eUWTJgn0+neJNbJ3JoJk2WRlDFwbE0uXgYYczuDcJablSdbb8Oc+E4qJ1U7u9YMN
</span></span><span class="line"><span class="cl">Bo/JBY68wYtdjXHl6Mg28aCioVZrs5eZWkNzNpXMVjQwFdZAdWbnS3OJGN1b6IrV
</span></span><span class="line"><span class="cl">gWk9PMoCE2TtFv5NdlHSYFtEAaBEwfl3/D3rGHKb4ZH/fgKWsepy8ffxxibM6pND
</span></span><span class="line"><span class="cl">pLnmAwIDAQABoycwJTAOBgNVHQ8BAf8EBAMCBaAwEwYDVR0lBAwwCgYIKwYBBQUH
</span></span><span class="line"><span class="cl">AwIwDQYJKoZIhvcNAQELBQADggEBALPYorv2mlXyu6jpX/6gE1kTvpPGK4vylfSY
</span></span><span class="line"><span class="cl">9jl4PtQZgRaXvmVsUKpyIdtVhdMZp9EFaYNC4AYkqaVEOoAbU96SYhdO/6h7Rn8T
</span></span><span class="line"><span class="cl">0Ae+f1Vwt+8GxErEN3xp4noHfXM0eSEuFLPXt43BBJInYRyx1J0urAjYtNCvc9wX
</span></span><span class="line"><span class="cl">uQFVmNKsqgmjvHQsRkvKcb8HEzcaD1TqqnTpq3usGjNggVZFTChB58R909yGPEXL
</span></span><span class="line"><span class="cl">n7VsilmN86gom3fgqwCn2C00iKcuzCOwYN2T+Mi8KI2DraDDoVeRMSaYQNUfKNIX
</span></span><span class="line"><span class="cl">Ngeod/C4piq+OAdyrPPFEINdLi404EYHyod0CgiD6uhoX5W06O4=
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨<code>openssl</code>æŸ¥çœ‹è¯ä¹¦å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># openssl x509 -in ./admin.crt -text
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Certificate:
</span></span><span class="line"><span class="cl">    Data:
</span></span><span class="line"><span class="cl">        Version: 3 (0x2)
</span></span><span class="line"><span class="cl">        Serial Number: 7501784745950845355 (0x681bb17af3d819ab)
</span></span><span class="line"><span class="cl">    Signature Algorithm: sha256WithRSAEncryption
</span></span><span class="line"><span class="cl">        Issuer: CN=kubernetes
</span></span><span class="line"><span class="cl">        Validity
</span></span><span class="line"><span class="cl">            Not Before: Apr 28 02:40:00 2019 GMT
</span></span><span class="line"><span class="cl">            Not After : Apr 27 02:40:03 2020 GMT
</span></span><span class="line"><span class="cl">        Subject: O=system:masters, CN=kubernetes-admin
</span></span><span class="line"><span class="cl">        Subject Public Key Info:
</span></span><span class="line"><span class="cl">            Public Key Algorithm: rsaEncryption
</span></span><span class="line"><span class="cl">                Public-Key: (2048 bit)
</span></span><span class="line"><span class="cl">......
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„è¿™ä¸€è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Subject: O=system:masters, CN=kubernetes-admin
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>API server</code>ä¼šå°†è¯ä¹¦ä¸­<code>CN(Common Name)</code>ä½œä¸ºç”¨æˆ·åï¼Œ<code>O(Organization)</code>ä½œä¸ºç”¨æˆ·æ‰€å±çš„<code>group</code>ã€‚<code>API server</code>ä»è¿™ä¸ªè¯ä¹¦å¾—åˆ°çš„ä¿¡æ¯æ˜¯ï¼šadminç”¨æˆ·æ‰€å±çš„groupæ˜¯<code>system:masters</code>ã€‚è‡³æ­¤ï¼Œèº«ä»½éªŒè¯é˜¶æ®µå®Œæˆã€‚</p>
<p>ä¸‹ä¸€æ­¥æ˜¯æˆæƒæ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯æ£€æŸ¥ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚è¿™æ˜¯å¦å¤–ä¸€ä¸ª<a class="link" href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/"  target="_blank" rel="noopener"
    >è¯é¢˜</a>ï¼Œæœ¬æ–‡ä¸åšè¯¦ç»†è®¨è®ºï¼Œåªæ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚æ ¹æ®<a class="link" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/"  target="_blank" rel="noopener"
    >å®˜æ–¹æ–‡æ¡£</a>ï¼Œ<code>Kubernetes</code>æä¾›äº†ç¼ºçœçš„ <code>ClusterRole - group</code> ç»‘å®šå…³ç³»ï¼Œå·²ç»å°†<code>system:masters</code> group å’Œ è§’è‰² <code>cluster-admin</code>ç»‘å®šåˆ°äº†ä¸€èµ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># kubectl get clusterrolebindings  cluster-admin -o yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class="line"><span class="cl">kind: ClusterRoleBinding
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  annotations:
</span></span><span class="line"><span class="cl">    rbac.authorization.kubernetes.io/autoupdate: &#34;true&#34;
</span></span><span class="line"><span class="cl">  creationTimestamp: &#34;2019-04-28T02:40:17Z&#34;
</span></span><span class="line"><span class="cl">  labels:
</span></span><span class="line"><span class="cl">    kubernetes.io/bootstrapping: rbac-defaults
</span></span><span class="line"><span class="cl">  name: cluster-admin
</span></span><span class="line"><span class="cl">  resourceVersion: &#34;98&#34;
</span></span><span class="line"><span class="cl">  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/cluster-admin
</span></span><span class="line"><span class="cl">  uid: f58a87a7-695e-11e9-91ca-005056ac1c1c
</span></span><span class="line"><span class="cl">roleRef:
</span></span><span class="line"><span class="cl">  apiGroup: rbac.authorization.k8s.io
</span></span><span class="line"><span class="cl">  kind: ClusterRole
</span></span><span class="line"><span class="cl">  name: cluster-admin
</span></span><span class="line"><span class="cl">subjects:
</span></span><span class="line"><span class="cl">- apiGroup: rbac.authorization.k8s.io
</span></span><span class="line"><span class="cl">  kind: Group
</span></span><span class="line"><span class="cl">  name: system:masters
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªç»‘å®šå…³ç³»çš„æ„æ€æ˜¯ï¼Œå±äº<code>system:masters</code>groupçš„ç”¨æˆ·ï¼Œéƒ½æ‹¥æœ‰<code>cluster-admin</code>è§’è‰²åŒ…å«çš„æƒé™ã€‚æˆ‘ä»¬å†çœ‹çœ‹è§’è‰²<code>cluster-admin</code>çš„å…·ä½“æƒé™ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># kubectl get clusterrole cluster-admin -o yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class="line"><span class="cl">kind: ClusterRole
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  annotations:
</span></span><span class="line"><span class="cl">    rbac.authorization.kubernetes.io/autoupdate: &#34;true&#34;
</span></span><span class="line"><span class="cl">  creationTimestamp: &#34;2019-04-28T02:40:17Z&#34;
</span></span><span class="line"><span class="cl">  labels:
</span></span><span class="line"><span class="cl">    kubernetes.io/bootstrapping: rbac-defaults
</span></span><span class="line"><span class="cl">  name: cluster-admin
</span></span><span class="line"><span class="cl">  resourceVersion: &#34;44&#34;
</span></span><span class="line"><span class="cl">  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/cluster-admin
</span></span><span class="line"><span class="cl">  uid: f5523c21-695e-11e9-91ca-005056ac1c1c
</span></span><span class="line"><span class="cl">rules:
</span></span><span class="line"><span class="cl">- apiGroups:
</span></span><span class="line"><span class="cl">  - &#39;*&#39;
</span></span><span class="line"><span class="cl">  resources:
</span></span><span class="line"><span class="cl">  - &#39;*&#39;
</span></span><span class="line"><span class="cl">  verbs:
</span></span><span class="line"><span class="cl">  - &#39;*&#39;
</span></span><span class="line"><span class="cl">- nonResourceURLs:
</span></span><span class="line"><span class="cl">  - &#39;*&#39;
</span></span><span class="line"><span class="cl">  verbs:
</span></span><span class="line"><span class="cl">  - &#39;*&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»<code>rules</code>åˆ—è¡¨å¯ä»¥çœ‹å‡ºï¼Œ<code>cluster-admin</code>è¿™ä¸ªè§’è‰²å¯¹æ‰€æœ‰èµ„æºéƒ½æœ‰æ— é™åˆ¶çš„æ“ä½œæƒé™ã€‚å› æ­¤ï¼Œä½¿ç”¨äº†è¿™ä¸ª<code>kubeconfig file</code>çš„<code>kubectl</code>çš„è¯·æ±‚å°±æœ‰äº†æ“æ§å’Œç®¡ç†æ•´ä¸ªé›†ç¾¤çš„æƒé™ã€‚</p>
<h2 id="ä½¿ç”¨jwt-tokensè¿›è¡Œèº«ä»½éªŒè¯">ä½¿ç”¨<code>JWT Tokens</code>è¿›è¡Œèº«ä»½éªŒè¯</h2>
<p>è¿è¡Œåœ¨<code>Pod</code>ä¸­çš„è¿›ç¨‹éœ€è¦è®¿é—®<code>API server</code>æ—¶ï¼ŒåŒæ ·éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒæ£€æŸ¥ã€‚å¦‚ä½•è®©<code>Pod</code>å…·æœ‰ç”¨æˆ·èº«ä»½å‘¢ï¼Ÿé€šè¿‡ç»™<code>Pod</code>æŒ‡å®š<code>service account</code>æ¥å®ç°ã€‚<code>service account</code>æ˜¯<code>Kubernetes</code>å†…ç½®çš„ä¸€ç§ â€œæœåŠ¡è´¦æˆ·â€ï¼Œå®ƒä¸º<code>Pod</code>ä¸­çš„è¿›ç¨‹æä¾›äº†ä¸€ç§èº«ä»½æ ‡è¯†ã€‚å¦‚æœ<code>Pod</code>æ²¡æœ‰æ˜¾å¼çš„æŒ‡å®š<code>service account</code>ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå…¶å…³è”<code>default service account</code>ã€‚</p>
<p>æˆ‘ä»¬è‡ªå·±åˆ›å»º<code>service account</code>å¯¹è±¡éå¸¸ç®€å•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//serviceaccount.yaml
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: ServiceAccount
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: nginx-example
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># kubectl apply -f serviceaccount.yaml
</span></span><span class="line"><span class="cl">serviceaccount/nginx-example created
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹åˆšåˆšåˆ›å»ºçš„<code>service account</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># kubectl describe serviceaccounts nginx-example
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name:                nginx-example
</span></span><span class="line"><span class="cl">Namespace:           default
</span></span><span class="line"><span class="cl">Labels:              &lt;none&gt;
</span></span><span class="line"><span class="cl">Annotations:         kubectl.kubernetes.io/last-applied-configuration:
</span></span><span class="line"><span class="cl">                       {&#34;apiVersion&#34;:&#34;v1&#34;,&#34;kind&#34;:&#34;ServiceAccount&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;nginx-example&#34;,&#34;namespace&#34;:&#34;default&#34;}}
</span></span><span class="line"><span class="cl">Image pull secrets:  &lt;none&gt;
</span></span><span class="line"><span class="cl">Mountable secrets:   nginx-example-token-r2cv6
</span></span><span class="line"><span class="cl">Tokens:              nginx-example-token-r2cv6
</span></span><span class="line"><span class="cl">Events:              &lt;none&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“<code>service account</code>å¯¹è±¡åˆ›å»ºæˆåŠŸï¼Œ<code>controller-manager</code>ä¼šå‘ç°è¿™ä¸ªæ–°å¯¹è±¡ï¼Œç„¶åä¸ºå®ƒç”Ÿæˆ<code>token</code>ã€‚<code>token</code>å®é™…ä¸Šæ˜¯<code>secret</code>å¯¹è±¡ï¼Œå†…éƒ¨åŒ…å«äº†ç”¨æ¥èº«ä»½éªŒè¯çš„<code>token</code>ã€‚<code>service account</code>å¯¹è±¡çš„<code>Tokens</code>åˆ—å¼•ç”¨çš„å°±æ˜¯<code>controller-manager</code>ä¸ºå®ƒåˆ›å»ºçš„<code>token</code>ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>token</code>çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># kubectl get secrets nginx-example-token-r2cv6 -o yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">data:
</span></span><span class="line"><span class="cl">  ca.crt: (APISERVER&#39;S CA BASE64 ENCODED)
</span></span><span class="line"><span class="cl">  namespace: ZGVmYXVsdA==
</span></span><span class="line"><span class="cl">  token: (BEARER TOKEN BASE64 ENCODED)
</span></span><span class="line"><span class="cl">kind: Secret
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  ......
</span></span><span class="line"><span class="cl">type: kubernetes.io/service-account-token
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª<code>secret</code>å¯¹è±¡çš„<code>type</code>æ˜¯<code>service-account-token</code>ï¼ŒåŒ…å«äº†ä¸‰éƒ¨åˆ†æ•°æ®ï¼š</p>
<ul>
<li><code>ca.crt</code>ï¼š <code>API Server</code>çš„<code>CA</code>è¯ä¹¦ï¼Œç”¨äº<code>Pod</code>ä¸­çš„è¿›ç¨‹è®¿é—®<code>API Server</code>æ—¶å¯¹æœåŠ¡ç«¯è¯ä¹¦è¿›è¡Œæ ¡éªŒ</li>
<li><code>namespace</code>ï¼š <code>secret</code>æ‰€åœ¨<code>namespace</code>ï¼Œä½¿ç”¨äº†<code>base64</code>ç¼–ç </li>
<li><code>token</code>ï¼š<code>JWT Tokens</code></li>
</ul>
<p><code>JWT Tokens</code> æ˜¯ <code>controller-manager</code> ç”¨ <code>service account</code>ç§é’¥<code>sa.key</code>ç­¾å‘çš„ï¼Œå…¶ä¸­åŒ…å«äº†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œ<code>API Server</code>å¯ä»¥ç”¨<code>sa.pub</code>éªŒè¯<code>token</code>ï¼Œæ‹¿åˆ°ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»è€Œå®Œæˆèº«ä»½éªŒè¯ã€‚</p>
<p>å¦‚æœæ˜¯ä½¿ç”¨<code>kubeadm</code>å®‰è£…çš„<code>Kubernetes</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>/etc/kubernetes/manifests/</code>ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ç¡®è®¤<code>sa.key</code>å’Œ<code>sa.pub</code>çš„ä½œç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># cat /etc/kubernetes/manifests/kube-controller-manager.yaml
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  containers:
</span></span><span class="line"><span class="cl">  - command:
</span></span><span class="line"><span class="cl">    - kube-controller-manager
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    - --service-account-private-key-file=/etc/kubernetes/pki/sa.key
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># cat /etc/kubernetes/manifests/kube-apiserver.yaml
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  containers:
</span></span><span class="line"><span class="cl">  - command:
</span></span><span class="line"><span class="cl">    - kube-apiserver
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    - --service-account-key-file=/etc/kubernetes/pki/sa.pub
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>controller-manager</code>ç”¨ç§é’¥<code>sa.key</code>ç­¾åï¼Œ<code>API Server</code>ç”¨å…¬é’¥<code>sa.pub</code>éªŒç­¾ã€‚</p>
<p>è¿è¡Œåœ¨<code>Pod</code>ä¸­çš„è¿›ç¨‹åœ¨å‘<code>API server</code>å‘èµ·<code>HTTP</code>è¯·æ±‚æ—¶ï¼Œ<code>HTTP header</code>ä¸­ä¼šæºå¸¦<code>token</code>ï¼Œ<code>API server</code>ä»<code>header</code>ä¸­æ‹¿åˆ°<code>token</code>ï¼Œè¿›è¡Œèº«ä»½éªŒè¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Authorization: Bearer [token]
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>JWT Tokens</code>çš„æ˜¯ç”±ç”¨<code>.</code>åˆ†å‰²çš„ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>Header</li>
<li>Payload</li>
<li>Signature</li>
</ul>
<p>å› æ­¤ï¼Œä¸€ä¸ª<code>JWT Tokens</code>çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">xxxxxxx.yyyyyyyy.zzzzzzz
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Header</code>å’Œ<code>Payload</code>éƒ½æ˜¯<code>base64</code>ç¼–ç çš„<code>JSON</code>ï¼Œä»¥ä¸Šé¢<code>nginx-example</code>å…³è”çš„<code>token</code>ä¸ºä¾‹ï¼Œçœ‹çœ‹<code>Header</code>å’Œ<code>Payload</code>çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">secrets</span> <span class="n">nginx</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">r2cv6</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">token</span><span class="p">:</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34; &#34;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9</span><span class="o">.</span><span class="n">eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6Im5naW54LWV4YW1wbGUtdG9rZW4tcjJjdjYiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibmdpbngtZXhhbXBsZSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjBmZWRlOWM1LTc2YjUtMTFlOS05MWNhLTAwNTA1NmFjMWMxYyIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0Om5naW54LWV4YW1wbGUifQ</span><span class="o">.</span><span class="n">VOjVQBr5PKg1WyZYtIW0Fos5fxFN4cYE3Mz9p1eWbQP6rQRQGDEiGX</span><span class="o">-</span><span class="n">LBuM6ECI9cpSL</span><span class="o">-</span><span class="n">F4nYQAL9vmIlA4vbAgS4OFgC4nwu8SzLu2FVeE7RDpguvsdAsj</span><span class="o">-</span><span class="mi">4</span><span class="n">T_LxEGX1RPljGTpvlt8HRjTnp9K8W4dy7PyJQEB5XvCf</span><span class="o">-</span><span class="n">IVNAs3zESgmuJ7wJwO7mXQe5WdeqhI5vXjcZiXP97oH0VRYT1vTKVP</span><span class="o">-</span><span class="n">GooC5YfaNhU7rHoJ0gmR10xNqZjwKGsHKkq5maC5BOrXFLlHRqVRwm9</span><span class="o">-</span><span class="n">hRn</span><span class="o">-</span><span class="n">ZLgAoCwujCIpLvPaFUR8HaatzX4GQ_HWev2soJnk1qcav0smxfjC</span><span class="o">-</span><span class="n">fu540vZA</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">secrets</span> <span class="n">nginx</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">r2cv6</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">token</span><span class="p">:</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34; &#34;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">7</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34;.&#34;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">base64</span> <span class="o">-</span><span class="n">d</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">mjson</span><span class="o">.</span><span class="k">tool</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;alg&#34;</span><span class="p">:</span> <span class="s2">&#34;RS256&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kid&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">secrets</span> <span class="n">nginx</span><span class="o">-</span><span class="n">example</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">r2cv6</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">token</span><span class="p">:</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34; &#34;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">7</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34;.&#34;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">2</span> <span class="o">|</span> <span class="n">base64</span> <span class="o">-</span><span class="n">d</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">mjson</span><span class="o">.</span><span class="k">tool</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;iss&#34;</span><span class="p">:</span> <span class="s2">&#34;kubernetes/serviceaccount&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/namespace&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/secret.name&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-example-token-r2cv6&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/service-account.name&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-example&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/service-account.uid&#34;</span><span class="p">:</span> <span class="s2">&#34;0fede9c5-76b5-11e9-91ca-005056ac1c1c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;system:serviceaccount:default:nginx-example&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Header</code>ä¸­çš„<code>alg</code>æŒ‡æ˜äº†ç­¾åç”¨åˆ°çš„åŠ å¯†ç®—æ³•ï¼Œ<code>Payload</code> ä¸­åŒ…å«äº†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œå¯ä»¥çŸ¥é“è¿™ä¸ª<code>service account</code>å±äºçš„<code>namespace</code>ä¸º<code>default</code>ï¼Œåç§°ä¸º<code>nginx-example</code>ã€‚</p>
<p>ç¬¬ä¸‰éƒ¨åˆ†<code>Signature</code>çš„æ„é€ æ–¹å¼å¦‚ä¸‹ï¼Œå¦‚æœåŠ å¯†ç®—æ³•é€‰æ‹©äº†PKCS SHAï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">PKCSSHA256</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;.&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">secret</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>controller-manager</code>ç”¨<code>sa.key</code>ç­¾åï¼Œ<code>API Server</code>ç”¨å…¬é’¥<code>sa.pub</code>éªŒç­¾ï¼Œè¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<p>å¦‚æœå…ˆæ·±å…¥äº†è§£<code>JWT(JSON Web Token)</code>ï¼Œå»ºè®®é˜…è¯»è¿™ç¯‡æ–‡æ¡£<a class="link" href="https://blog.angular-university.io/angular-jwt/"  target="_blank" rel="noopener"
    >&lt;JWT: The Complete Guide to JSON Web Tokens&gt;</a></p>
<p><code>Pod</code>ä¸­çš„è¿›ç¨‹å¦‚ä½•è·å¾—è¿™ä¸ª<code>token</code>å‘¢ï¼Ÿ<code>Kubernetes</code>åœ¨åˆ›å»º<code>Pod</code>æ—¶ï¼Œä¼šå°†<code>service account token</code>æ˜ å°„åˆ°<code>Pod</code>çš„<code>/var/run/secrets/kubernetes.io/serviceaccount</code> ç›®å½•ä¸‹ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¼”ç¤ºä¸€ä¸‹ã€‚</p>
<p>åˆ›å»º<code>Pod</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// simple.yaml
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Pod
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">    name: firstpod
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">    serviceAccountName: nginx-example
</span></span><span class="line"><span class="cl">    containers:
</span></span><span class="line"><span class="cl">    - image: nginx
</span></span><span class="line"><span class="cl">      name: stan
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl apply -f simple.yaml
</span></span><span class="line"><span class="cl">pod/firstpod created
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹<code>Pod</code>å†…<code>/var/run/secrets/kubernetes.io/serviceaccount</code>ç›®å½•çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">$</span> <span class="n">kubectl</span> <span class="n">exec</span> <span class="n">firstpod</span> <span class="o">--</span> <span class="n">ls</span>  <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span>
</span></span><span class="line"><span class="cl"><span class="n">ca</span><span class="o">.</span><span class="n">crt</span>
</span></span><span class="line"><span class="cl"><span class="n">namespace</span>
</span></span><span class="line"><span class="cl"><span class="n">token</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹<code>Pod</code>å†…æ–‡ä»¶<code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">$</span> <span class="n">kubectl</span> <span class="n">exec</span> <span class="n">firstpod</span> <span class="o">--</span> <span class="n">cat</span>  <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span><span class="o">/</span><span class="n">token</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&#34;.&#34;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">2</span> <span class="o">|</span> <span class="n">base64</span> <span class="o">-</span><span class="n">d</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">mjson</span><span class="o">.</span><span class="k">tool</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;iss&#34;</span><span class="p">:</span> <span class="s2">&#34;kubernetes/serviceaccount&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/namespace&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/secret.name&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-example-token-r2cv6&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/service-account.name&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-example&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;kubernetes.io/serviceaccount/service-account.uid&#34;</span><span class="p">:</span> <span class="s2">&#34;0fede9c5-76b5-11e9-91ca-005056ac1c1c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;system:serviceaccount:default:nginx-example&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ˜ å°„è¿›<code>Pod</code>ä¸­çš„<code>token</code>ï¼Œæ­£æ˜¯æˆ‘ä»¬åœ¨é…ç½®ä¸­é€šè¿‡<code>serviceAccountName</code>æŒ‡å®šçš„<code>nginx-example</code>ã€‚<code>Pod</code>ä¸­çš„è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®æ–‡ä»¶<code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>æ‹¿åˆ°<code>token</code>ã€‚</p>
<p>å¦‚ä½•ä¸º<code>service account</code>æˆæƒï¼Ÿé€šè¿‡å®šä¹‰<code>service account</code>å’Œ<code>role</code>çš„ç»‘å®šå®Œæˆã€‚æœ¬æ–‡ç®€å•æ¼”ç¤ºä¸€ä¸‹ï¼Œè¯¦ç»†çš„è¯´æ˜å‚åŠ <a class="link" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/"  target="_blank" rel="noopener"
    >å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>åˆ›å»º<code>role</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// example-role.yaml
</span></span><span class="line"><span class="cl">kind: Role
</span></span><span class="line"><span class="cl">apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: example-role
</span></span><span class="line"><span class="cl">rules:
</span></span><span class="line"><span class="cl">- apiGroups: [&#34;&#34;]
</span></span><span class="line"><span class="cl">  resources: [&#34;pods&#34;]
</span></span><span class="line"><span class="cl">  verbs: [&#34;get&#34;, &#34;watch&#34;, &#34;list&#34;]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl apply -f example-role.yaml
</span></span><span class="line"><span class="cl">role.rbac.authorization.k8s.io/example-role created
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>role</code>å¯ä»¥ç†è§£ä¸ºä¸€ç»„æƒé™çš„é›†åˆï¼Œä¾‹å¦‚ä¸Šé¢åˆ›å»ºçš„<code>example-role</code>å¯¹<code>default</code> Namesapceå†…çš„<code>Pods</code>æœ‰<code>get</code>ã€<code>watch</code>å’Œ<code>list</code>æ“ä½œæƒé™ã€‚</p>
<p>ä¸‹ä¸€æ­¥å°±æ˜¯å°†<code>service account</code>å’Œ<code>role</code>è¿›è¡Œç»‘å®šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//example-rolebinding.yaml
</span></span><span class="line"><span class="cl">kind: RoleBinding
</span></span><span class="line"><span class="cl">apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: example-rolebinding
</span></span><span class="line"><span class="cl">  namespace: default
</span></span><span class="line"><span class="cl">subjects:
</span></span><span class="line"><span class="cl">- kind: ServiceAccount
</span></span><span class="line"><span class="cl">  name: nginx-example
</span></span><span class="line"><span class="cl">  namespace: default
</span></span><span class="line"><span class="cl">roleRef:
</span></span><span class="line"><span class="cl">  kind: Role
</span></span><span class="line"><span class="cl">  name: example-role
</span></span><span class="line"><span class="cl">  apiGroup: rbac.authorization.k8s.io
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl apply -f example-rolebinding.yaml
</span></span><span class="line"><span class="cl">rolebinding.rbac.authorization.k8s.io/example-rolebinding created
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ç»‘å®šçš„åˆ›å»ºï¼Œ<code>service account</code>å°±æ‹¥æœ‰äº†<code>role</code>å®šä¹‰çš„æƒé™ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ç”¨æˆ·å¯¹<code>API server</code>çš„è®¿é—®éœ€è¦é€šè¿‡èº«ä»½éªŒè¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶è¿™ä¸‰ä¸ªé˜¶æ®µçš„æ£€æŸ¥ã€‚</p>
<p>ä¸€èˆ¬é›†ç¾¤å¤–éƒ¨ç”¨æˆ·è®¿é—®<code>API Server</code>ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚<code>Kubernetes</code>å„ç»„ä»¶ä¹‹é—´çš„é€šä¿¡éƒ½ä½¿ç”¨äº†<code>TLS</code>åŠ å¯†ä¼ è¾“ï¼ŒåŒæ—¶æ”¯æŒåŸºäºè¯ä¹¦çš„åŒå‘è®¤è¯ã€‚å› æ­¤<code>Kubernetes</code>çš„å®‰è£…è¿‡ç¨‹æ¶‰åŠå¾ˆå¤šè¯ä¹¦çš„åˆ›å»ºï¼Œæœ¬æ–‡åˆ†ç±»ä»‹ç»äº†è¿™äº›è¯ä¹¦çš„ä½œç”¨ã€‚</p>
<p>é›†ç¾¤å†…<code>Pod</code>ä¸­çš„è¿›ç¨‹è®¿é—®<code>API server</code>æ—¶ï¼Œä½¿ç”¨<code>service account</code>å…³è”çš„<code>token</code>è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<p>æ¯ä¸ª<code>Pod</code>éƒ½ä¼šå…³è”ä¸€ä¸ª<code>service account</code>ï¼Œæ²¡æœ‰æ˜ç¡®æŒ‡å®šæ—¶ä½¿ç”¨<code>default</code>ã€‚å½“æˆ‘ä»¬åˆ›å»º<code>service account</code>å¯¹è±¡ï¼Œ<code>controller-manager</code>ä¼šä¸ºè¿™ä¸ª<code>service account</code>ç”Ÿæˆ<code>Secret</code>ï¼Œå†…éƒ¨åŒ…å«äº†ç”¨æ¥èº«ä»½éªŒè¯çš„<code>JWT Tokens</code>ã€‚<code>Kubernetes</code>ä¼šå°†<code>token</code>æ–‡ä»¶<code>mount</code>åˆ°<code>Pod</code>çš„<code>/var/run/secrets/kubernetes.io/serviceaccount/token</code>ï¼Œ<code>Pod</code>å†…çš„è¿›ç¨‹åœ¨å‘<code>API server</code>å‘èµ·çš„<code>HTTP</code>æ—¶ï¼Œå°±å¯ä»¥åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦è¿™ä¸ª<code>token</code>ã€‚</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/kubernetes/">kubernetes</a>
        
            <a href="/tags/security/">security</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/helm%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/">
        
        

        <div class="article-details">
            <h2 class="article-title">Helmçš„å®‰è£…å’Œä½¿ç”¨</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%BD%BF%E7%94%A8kubectl%E7%AE%A1%E7%90%86%E5%A4%9A%E9%9B%86%E7%BE%A4/">
        
        

        <div class="article-details">
            <h2 class="article-title">ä½¿ç”¨kubectlç®¡ç†å¤šé›†ç¾¤</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E5%9C%A8ubuntu%E4%B8%8A%E5%AE%89%E8%A3%85minikube/">
        
        

        <div class="article-details">
            <h2 class="article-title">åœ¨Ubuntuä¸Šå®‰è£…Minikube</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/kubernetes%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%A6%82%E8%BF%B0/">
        
        

        <div class="article-details">
            <h2 class="article-title">Kuberneteså·¥ä½œåŸç†æ¦‚è¿°</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E4%BB%8E%E6%BA%90%E7%A0%81%E6%9E%84%E5%BB%BA-perf/">
        
        

        <div class="article-details">
            <h2 class="article-title">ä»æºç æ„å»º perf</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mazhen-tech" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2014 - 
        
        2023 mazhen.tech
    </section>
    
    <section class="powerby">
        
            <a target=\"_blank\" href=\"https://beian.miit.gov.cn\">ç²¤ICPå¤‡2022085181å·-1</a> <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
